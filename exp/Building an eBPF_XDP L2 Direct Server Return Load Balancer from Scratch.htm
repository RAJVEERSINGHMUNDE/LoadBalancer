<!DOCTYPE html>
<html lang="en" data-theme="cmyk"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Building an eBPF/XDP L2 Direct Server Return Load Balancer from Scratch</title><link nonce="" rel="stylesheet" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/inter.css"><link nonce="" rel="stylesheet" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/Source_Code_Pro.css"><link nonce="" integrity="sha384-W0UkFG5ktUlCLBh/tZDw+slzbqWhSr7IE92M0sRiua5PJAa1/rQ1oZeywI2xmhma" rel="stylesheet" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/css-tokens-theme.css"><style nonce="">.layout-enter-active,.layout-leave-active{transition:all .2s}.layout-enter-from,.layout-leave-to{filter:grayscale(1)}.page-enter-active,.page-leave-active{transition:all .2s}.page-enter-from,.page-leave-to{filter:blur(1rem);opacity:0}</style><style nonce="">.tutorial-header[data-v-0d30d5a9]{display:block;font-family:var(--typography-font-display);font-size:40px;font-weight:var(--prose-h1-fontWeight);letter-spacing:var(--prose-h1-letterSpacing);line-height:var(--prose-h1-lineHeight);margin:var(--prose-h1-margin);margin-bottom:20px;margin-top:20px}</style><style nonce="">#site-header[data-v-7f8ed6a6]{transition:border .25s ease}</style><style nonce="">a[data-v-c294bba9]{font-family:var(--typography-font-sans);font-weight:400}</style><style nonce="">[data-v-6adfc778]{font-family:var(--typography-font-body);font-size:.85rem;line-height:var(--prose-p-lineHeight)}</style><style nonce="">.fade-out[data-v-200caef3]{position:relative}.fade-out[data-v-200caef3]:after{background:linear-gradient(180deg,#fff0 0,#fff);bottom:0;content:"";height:200px;left:0;position:absolute;width:100%}.unit-title[data-v-200caef3]{font-family:var(--typography-font-display);font-size:1.25rem;font-weight:var(--prose-h3-fontWeight);letter-spacing:var(--prose-h3-letterSpacing);line-height:var(--prose-h3-lineHeight);margin-bottom:16px;margin-top:16px}@media(min-width:768px){.unit-title[data-v-200caef3]{font-size:var(--prose-h3-fontSize)}}.expand-all .unit-title[data-v-200caef3]{border-bottom:1px solid #eee;margin-bottom:4px;padding-bottom:.3em}.prose-h1[data-v-200caef3]{margin-top:24px}</style><style nonce="">p[data-v-b025fb9f]{font-family:var(--typography-font-body);font-size:var(--prose-p-fontSize);line-height:var(--prose-p-lineHeight);margin:var(--prose-p-margin)}p[data-v-b025fb9f] br{content:"";display:block;margin:var(--prose-p-br-margin)}</style><style nonce="">a[data-v-abeb6555]{color:#4078c0;font-family:var(--typography-font-body);font-weight:400;text-decoration:none}a[data-v-abeb6555]:hover{text-decoration:underline}a[data-v-abeb6555]:has(img){border-width:0}</style><style nonce="">ul[data-v-533e29f3]{font-family:var(--typography-font-body);list-style-type:var(--prose-ul-listStyleType);margin:var(--prose-ul-margin);padding-inline-start:var(--prose-ul-paddingInlineStart)}ul[data-v-533e29f3]>li::marker{color:var(--prose-ul-li-markerColor)}ul[data-v-533e29f3]>li ol,ul[data-v-533e29f3]>li ul{margin:0}</style><style nonce="">li[data-v-2969431c]{font-family:var(--typography-font-body);list-style-position:var(--prose-li-listStylePosition);margin:var(--prose-li-margin)}</style><style nonce="">code[data-v-a031129a]{border-radius:var(--prose-code-inline-borderRadius);font-family:var(--typography-font-code);padding:var(--prose-code-inline-padding);mx:1px;background-color:var(--prose-code-inline-backgroundColor);color:var(--prose-code-inline-color);font-size:var(--prose-code-inline-fontSize);font-weight:var(--prose-code-inline-fontWeight)}tbody code[data-v-a031129a]{font-size:var(--prose-tbody-code-inline-fontSize)}h1 a code[data-v-a031129a],h2 a code[data-v-a031129a],h3 a code[data-v-a031129a],h4 a code[data-v-a031129a],h5 a code[data-v-a031129a],h6 a code[data-v-a031129a]{border-radius:var(--prose-code-inline-borderRadius);color:var(--prose-code-inline-color);font-size:.777777em;padding:.15em .5em}a code[data-v-a031129a]{border-color:var(--prose-a-code-border-color-static);border-style:var(--prose-a-code-border-style);border-width:var(--prose-a-code-border-width);color:var(--prose-a-code-color-static)}a:hover code[data-v-a031129a]{background-color:var(--prose-a-code-background-hover);border-color:var(--prose-a-code-border-color-hover);color:var(--prose-a-code-color-hover)}</style><style nonce="">h2[data-v-b9b1576a]{border-bottom:1px solid #eee;display:block;font-family:var(--typography-font-display);font-size:var(--prose-h2-fontSize);font-weight:var(--prose-h2-fontWeight);letter-spacing:var(--prose-h2-letterSpacing);line-height:var(--prose-h2-lineHeight);margin:var(--prose-h2-margin);padding-bottom:.3em}h2[data-v-b9b1576a] .icon{display:inline-block;height:var(--prose-h2-iconSize);margin-inline-start:12px;opacity:0;transition:opacity .1s;width:var(--prose-h2-iconSize)}h2 a[data-v-b9b1576a]:hover .icon{opacity:1}</style><style nonce="">strong[data-v-24022f14]{font-family:var(--typography-font-body);font-weight:var(--prose-strong-fontWeight)}</style><style nonce="">h3[data-v-9a0ceb30]{display:block;font-family:var(--typography-font-display);font-size:var(--prose-h3-fontSize);font-weight:var(--prose-h3-fontWeight);letter-spacing:var(--prose-h3-letterSpacing);line-height:var(--prose-h3-lineHeight);margin:var(--prose-h3-margin)}h3[data-v-9a0ceb30] .icon{display:inline-block;height:var(--prose-h3-iconSize);margin-inline-start:12px;opacity:0;transition:opacity .1s;width:var(--prose-h3-iconSize)}h3 a[data-v-9a0ceb30]:hover .icon{opacity:1}</style><style nonce="">pre code .line{display:block;min-height:1rem}</style><style nonce="">.prose-code[data-v-4578ab24]{-webkit-backdrop-filter:var(--prose-code-block-backdropFilter);backdrop-filter:var(--prose-code-block-backdropFilter);background-color:var(--prose-code-block-backgroundColor);border-color:var(--prose-code-block-borderColor);border-radius:var(--prose-code-block-borderRadius);border-style:var(--prose-code-block-borderStyle);border-width:var(--prose-code-block-borderWidth);color:var(--prose-code-block-color);font-size:var(--prose-code-block-fontSize);margin:var(--prose-code-block-margin);overflow:hidden;position:relative;width:100%}.prose-code[data-v-4578ab24] code{flex-grow:1}.copy-button[data-v-4578ab24]{background-color:#3c3c3c99;bottom:0;color:#e6e6e6cc;inset-inline-end:0;opacity:0;position:absolute}.prose-code:hover .copy-button[data-v-4578ab24]{opacity:1}.prose-code:hover .copy-button[data-v-4578ab24]:hover{color:#e6e6e6}.copy-button[data-v-4578ab24]:focus{box-shadow:none!important}[data-v-4578ab24] code{display:flex;flex-direction:column}[data-v-4578ab24] .line{display:inline-table;min-height:1.5rem}.filename[data-v-4578ab24]{-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);border-radius:var(--typography-radii-lg);color:#e6e6e6;font-family:var(--typography-font-code);font-size:var(--typography-fontSize-xs);inset-inline-end:0;line-height:var(--typography-lead-normal);padding:.5rem .75rem;position:absolute;top:0;transition:opacity .2s}.prose-code:hover .filename[data-v-4578ab24]:hover{opacity:1}[data-v-4578ab24] pre{display:flex;flex:1;line-height:var(--typography-lead-relaxed);margin:0;overflow-x:auto;padding:var(--prose-code-block-pre-padding)}[data-v-4578ab24] .line.highlight{background-color:#000;margin:0 -16px;padding:0 16px}[data-v-4578ab24] .line:not(.highlight)+.line.highlight{border-top:1px solid #444}[data-v-4578ab24] .line.highlight+.line:not(.highlight){border-top:1px solid #444;margin:0 -16px;padding:0 16px}[data-v-4578ab24] .line.highlight:first-child{border-top:1px solid #444}[data-v-4578ab24] .line.highlight:last-child{border-bottom:1px solid #444}</style><style nonce="">button[data-v-134dddac]{border-radius:3px;margin:4px;opacity:0;padding:4px;transform:scale(.75);transition:all .2s}button[data-v-134dddac]:focus{box-shadow:0 0 0 2px var(--typography-color-primary-500);opacity:1;outline:none}button.show[data-v-134dddac]{opacity:1;transform:scale(1)}button .icon-wrapper[data-v-134dddac]{display:block;height:18px;position:relative;width:18px}button .icon-wrapper .icon[data-v-134dddac]{display:block;position:absolute}button .icon-wrapper .fade-enter-active[data-v-134dddac],button .icon-wrapper .fade-leave-active[data-v-134dddac]{transition:opacity .2s}button .icon-wrapper .fade-enter-from[data-v-134dddac],button .icon-wrapper .fade-leave-to[data-v-134dddac]{opacity:0}</style><style nonce="">details>summary[data-v-370f298d]{font-size:var(--prose-p-fontSize)}</style><style nonce="">hr[data-v-34b8dd49]{border-top:var(--prose-hr-width) var(--prose-hr-style) var(--prose-hr-color);margin:var(--prose-hr-margin)}</style><link nonce="" integrity="sha384-VgdaralgzMMDKoxbvggz88cSHbXjvjsd7NI4i46uVtHp/jjxBeJak6GsR2cO7GHi" rel="stylesheet" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/entry.DO90-MQw.css" crossorigin=""><link nonce="" integrity="sha384-K18nopic+X0JunSv2KJqsE7W6KB015nwBWeFR+Jh5SQtvXW7Yy4WjDfxnYjG/Q6g" rel="modulepreload" as="script" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/A538-Xd4.js"><link nonce="" integrity="sha384-Wc22hz0UYZLeSexsNb8aBw3zxHJlH2ESymLXu3JHi6m3sR49j4dleLGt1BVOkDjD" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CiaVwNEs.js"><link nonce="" integrity="sha384-wV/FyIfkoKuneA9gx32UbcC1rWydYJhlr+cMCHu0oN57ZtVcBz8nUCI/A5rPOyHo" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DlAUqK2U.js"><link nonce="" integrity="sha384-JBRondsjCje9uCAk+glC4LA43omHrNK2Afdoafa36EDjES+Za12EFI00uupOcyt9" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BGeBmTCG.js"><link nonce="" integrity="sha384-iOrs0N2+i+e0F5pOd4kyCQpmnc35XQjz3RZS60HpeqOwIhinqlaiSmxKCbvBJsW1" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CMnvrPLD.js"><link nonce="" integrity="sha384-CEUXna7zyFjV1aUCqrEskDTDcYt8x65beb5ECylmP2u4a3XjjuBUt/selECdFNZK" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/B1saq5Fe.js"><link nonce="" integrity="sha384-syA1913w37X8NLuSOALbgW9QS2EPUV6mM/Ff8nCauX6ZiD/sHqOLDthOqDMKckCB" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D1KxtS4O.js"><link nonce="" integrity="sha384-M0JTRKVfKGOUYhocKYuV/WMSR+qOluNgGUQsIG3GYlIiO+jnxgHfMO2WJmrUEqcK" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Cd08WlCA.js"><link nonce="" integrity="sha384-2W8FPc/1+bG0TweePWS4uRwvvuxGyDDRF59Oq4c+38RHPjntjyyWlD7v1Sa6zpkX" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DTtjwkpk.js"><link nonce="" integrity="sha384-L1CRgqloambsm3q9dC2rb+ifjcv/8Hpqm7EHEDie0lhu2KclJZ/sSVOkeDGM9zDX" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C82fcFPv.js"><link nonce="" integrity="sha384-0hD5FZjIYmNI9RitylIyG4efbmRl6kOaKiNnJAhMuCYGphbCEU2T/NgpXk32OXh5" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/4AR0jMDd.js"><link nonce="" integrity="sha384-DPKYF61GYn/kB6dn/ABdKqapefAnD2W9nBAk2ofHesgnyMnqMJkO7Too4t+mNYYP" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/B0C1x6gY.js"><link nonce="" integrity="sha384-YgqV0R4URFlIK0f7PeExV/RhB0jCgDJ9GeV41VNl6GAEEwy6vHA/PoQ3VSH8s56f" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DwrbW19N.js"><link nonce="" integrity="sha384-0BznfphaLvyEnFT1usV091akUax6dLFoMcZMmzjansRVn5BItWKgsDDCoo8iT/TY" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CwAYGw04.js"><link nonce="" integrity="sha384-b3SarygGZMZbGN79KG/bEqtJ2xVRemDnvZgqDewtIpgFuNBh75kpOVhZZYbBBlV/" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/B6Ia1wBT.js"><link nonce="" integrity="sha384-WRh3x9Ejk0elAhcgJQ8ETP2IGNgvqNr91aJXHrH9yZxCCLgchCR41NgV3E7vAodd" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/ChZSQl3-.js"><link nonce="" integrity="sha384-F2pzDKtK6Wor8cY0Y3zbRz+fFovMZFLX8BsggEVAPXGz2+Ycy1I3P2cDE2KS/wOh" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/dzq8fjun.js"><link nonce="" integrity="sha384-I2aMPU2PaXlVS4e/fOmYY9zmZzsm1trtgIbztBZU0wObDOs1VIroOVWNsDhl6wHN" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/M8Go6PQG.js"><link nonce="" integrity="sha384-uodls5TYxZ8s/FGmTB1Xi3Eu1LUqit11VZ0fVdqtz16nO/2EG8G6ftEpI1QClK52" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/A7blpOo1.js"><link nonce="" integrity="sha384-wZXyrgfemDfNvKK67noacMWWCC0zKLBCwby1agqLAZk1PYstO1pYXd5LJ1vuq0JB" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BsfvSMgi.js"><link nonce="" integrity="sha384-Vs+CUGTU4JWQD2L1q1QN40N3Zvq9rYcfTbmA5eOdrmD/VMyI1iDmCHzMLPSdnCqv" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BWcS6GWa.js"><link nonce="" integrity="sha384-VVomnY5chwSXkMawT1OSXWNPPAe86IfpyIKeWX688WzzJ7lq/B0rADiyVnYOh6HM" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/JEhZ6VKh.js"><link nonce="" integrity="sha384-AbnqAjVFi3AmpARRzjM6+16Kv+rETq5s6nmZjsBv+hcl6SxoewxvHT+bGBjAhXeK" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Ci8QyKoZ.js"><link nonce="" integrity="sha384-td3wGu7krmhEJ5seMu1AU/xkFk7vUdQ3suaalpFhM4fwTaVN1h/H9rGaxFj5hmG8" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Btqf3kJo.js"><link nonce="" integrity="sha384-yQp3ZlUZQ0DO+FYouwTSmaxweszONpQqBRmj0jPaUrGPs6qVDenMPabcBy7ZVLmy" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Bxj5g83y.js"><link nonce="" integrity="sha384-n1bd298ysXlcokRTgpfLCRSQT0AXTmnPEQXg4ZJzQHwX1PKezwdaLv1OJ/b4mzD0" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CvPDKjD7.js"><link nonce="" integrity="sha384-ZTF2eLLsj0u4hMXoY82NP13biwgJDAwMzR2d+xBY6rQLO4f3t7LajO3uzq/vZqRX" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BcqSyfqL.js"><link nonce="" integrity="sha384-R5RBPCrYygxUzDyczdS9hiczqgYiS67n5heUG2T1GpfHtDEsmXSBLEmEO/BQzJaN" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/kvsfWoeJ.js"><link nonce="" integrity="sha384-tb1vqM45YGGFhc7XMYx4bDtjYSaXzAs9cnrgfmG8GKlE7RhDH4qAyu26XzuJ2YIC" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CzEdsMlG.js"><link nonce="" integrity="sha384-sUqEz/7mCozcDTVa3220YpCuurG9+lxtT39mpvAKoTCj9QExlOBwmCIFpsInI+s1" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/-3BZtTVG.js"><link nonce="" integrity="sha384-tnmwzNkA0rvNInwTi3QoUuQf2RJ/bW02kX94g7tDAOWaYuCg85E9BWXXixucWjqZ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BupvEF6F.js"><link nonce="" integrity="sha384-cv5eYt8EdzDHogT9noRhAtFPV9+Lrtkd/pkrKyTuN5tJroumDowpyUzCzhwVtaiC" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CxmcBoAF.js"><link nonce="" integrity="sha384-Y8UFu09ps1XTln8sVqrgbr/U3lz2Dhm/dACnR9sMrlzgij55P2HmnGCWzPoBSYyu" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BSSuG8K0.js"><link nonce="" integrity="sha384-z9/ospmVZd5cw4nwu5/8Qp5hJ8LT0YLR5aprKBlth8ZdKwPYddtBV4lpwoGmUwfN" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CCu705Yd.js"><link nonce="" integrity="sha384-ZSbWNj1OjFWl7HowKKC8kafoBc1s/7LHOfE9M7ljrgu/wf1sJhfQbLAYyRCzhZdY" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C_Jn_tlQ.js"><link nonce="" integrity="sha384-agWmXONfzBbTvKJgUzocvOAVtRahUQJ22dVI+EIlQcdvlhE/n+dJRuMKYyjQZNAJ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DVSoXPMN.js"><link nonce="" integrity="sha384-mgFzSSjDqczZLwcbehdgDcFRYeUW6C3GqxjgZTu/SLT01MGi+dpHHVI922F+X7C3" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CCTXTz88.js"><link nonce="" integrity="sha384-M74HEk3mc8nvuopWlZzTsK144Edv+f2lEjDaYoh2m4d7U7/KfZbi4AusDL0KhPHH" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CjdH43sM.js"><link nonce="" integrity="sha384-1gFXWiA9BubdJu/94hOlNp2XvvHoVIz4IGNQv59ibBQfiufGbZxQNBNhF8TAG/RV" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CDvDm27B.js"><link nonce="" integrity="sha384-jJcANp9lIArTZ9yN4OBsQ++lCuSSt2pGu3Scy2GlEgU3+8NcDeS7dyssrIUitInI" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/7kwUfJ3d.js"><link nonce="" integrity="sha384-EbtRkNeZD9um6+KMX5jCfluq+qSLTrv0RoysLc7gM+g4HZFMODnEaMGiOldAKh8/" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Bnu8tQBb.js"><link nonce="" integrity="sha384-UO8ijEdqHf7NyXBUpuq/GC4PXT75sLLrNgF2uqVsvASmGCRpiewQ2SHk9ea1IUqb" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CDzRe_IS.js"><link nonce="" integrity="sha384-cKyEWFmQQXO6kDxrNQo20qgZ4VMzQi2uSYiRl05tv1cNyQqU0PJtKu5fqUe4Ki1o" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BzCtePKg.js"><link nonce="" integrity="sha384-COlwUySgtGE6J2TePCYfL/nRrHywmQ1Jwo60ID/objGu8uiCIxttVy2yMr+jbpxj" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Db0ou0G2.js"><link nonce="" integrity="sha384-Rzk+8Cz0gBXmLuLBTSGp80a8fquQIqhPvRlo1IiJeo7hkgncIWi34YKwBlxVgsHt" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BARAL6rY.js"><link nonce="" integrity="sha384-/ZmdKieFBiaYx+w0UksW/OG8Hb72bs89W/nKPICK6PZl+kuDHDmuEvI4mRNPXLSv" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CM8tEzsp.js"><link nonce="" integrity="sha384-giGL5jqk/0PqHOOqxQuvp4G+iXuMqkfE+1Zlf/2kKJV7sYQ+BxSclVpba3tX/wh+" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CZ8UCyxH.js"><link nonce="" integrity="sha384-Jh+iKjfe7e7mgPtH9IYjVPHoUbiLzg8mm+xLGL/iff4u64ibokFnUpv/+RGj9dCO" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D8ksmjjz.js"><link nonce="" integrity="sha384-PvErhVuPH41hvqTZ49vsoFCpIC/z4slDP48GmOyo1IxCgXgMmhZYcqWmXvxmDdE1" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BnA2AwGF.js"><link nonce="" integrity="sha384-ML7907U1uYAjBfEawIa16NlkvQLFs4sBc0O+ZsHqG36bs2G6qYgIBKOtB3fbDcm3" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/mB6xp2LS.js"><link nonce="" integrity="sha384-obBf3ueJAL8aoDGeHfEgrAtpJ3qVSgFbWLFfi8i9I1zn7Fh9bL6xCWKRkSAsBPpf" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DOnqS9Sz.js"><link nonce="" integrity="sha384-ozfcbqESKh4t4toPRMlI7E/LSfwducV89LLckOM/iIRj/4KZI3Wvkzv1IIlXs4/c" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BUutWmwC.js"><link nonce="" integrity="sha384-WlWOhcPtQ/Kad84KA6wzn0gQeGRjnbnHA6YbAmrjb3x1h3Z2xgzDQn6hhPZNCoTd" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CYc7oDxg.js"><link nonce="" integrity="sha384-mrDm7dap5ABkEwphhcEecvmbqNbeRsvBYymtq9QRTG7VpTjjYlz8cKc81RROUeFA" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/iModbmJm.js"><link nonce="" integrity="sha384-p4j3LmYqWA9vFZi8KI2yZhEabBARpNL/Oi3nVD0aXbx96P85FplA/9FgQDD2BLdP" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BttOikXX.js"><link nonce="" integrity="sha384-l/XpZEHaHpHdyvYueKCjFu/1G9Azm0MCiXUSR+fyOtckk4NeLZF8k6zYCoBVDUUg" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CAUFPZS4.js"><link nonce="" integrity="sha384-Av0300jLea50veBs6pE41xEXCjESbAfDNYm2yxz8d97vI9SoWmI0Hcp+uma/jcX+" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D4i9E6T8.js"><link nonce="" integrity="sha384-Kt/+bu7AOzFl0uwSyv3X04YhXDK4jzHtjffPy2aGEnk/FoJB9cOsHGnPwPSskKMh" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Bv083VCc.js"><link nonce="" integrity="sha384-r/TOwaK7QKJSt/5vwLwCOITevVrg2DX1lGIdwdfBFVrN7yuzTWlORu7/uf2dJC9y" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/B57yXAr8.js"><link nonce="" integrity="sha384-0N5RM4kElInS4Fp1qFMxOc4OF69GD5JOJhCTDN1uFON4zETYzLPQhMF0kskTRzMM" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Bg33dJBS.js"><link nonce="" integrity="sha384-u3VmYVbrqSkrQNLkzFveD/vvLINNY0yl3cddefGwPydaEYiUQCs1uV/KRVUjPTa8" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DQwRZosE.js"><link nonce="" integrity="sha384-fH3nLz2uDngAE48/eCpdZrqWvpG0xiHSwlUR8aF2ihSqvqmN4OmDS/TVNCNTWnqR" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CArlX-cu.js"><link nonce="" integrity="sha384-u74iMlKyC0kRP5BMHYNGkp5S9orN2/gCeJgj5aZX1XDbtHuAdZFrU8qFOFz/eNLm" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DZyGvdVe.js"><link nonce="" integrity="sha384-GS5VYkWxfL4u4MdDC6Qo0DGKGF+lrWyOqK9ZJe2lisyIa7Svve0Ttt78PZZTwqY3" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BDKlkuys.js"><link nonce="" integrity="sha384-y80+/9hrjJwiVyHBE8AWXREf/wof34st0opT/h4kvDrEb2laljm3R8wJKQseme/J" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/1LkmMtl7.js"><link nonce="" integrity="sha384-9c95hdmG6ReSHzePMhSkOHTJSopHenH0otWJ8vMBjpF9X3CPHtYIcbCAQTX8PdOl" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/xOp4NLFu.js"><link nonce="" integrity="sha384-gMSBshNkqG1tBeB+L2gKaoY4oMW4+hYd4oWv9iLWHw9xBx0xV1OUHKMirXddsFRw" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BioJOeeE.js"><link nonce="" integrity="sha384-MwA0Sdu4AakDulpLReqjqw1RIa5qrB2TUqLJo+Db5G6CvTRTTDx4a8tEaOdSVNLx" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BHPsZYYG.js"><link nonce="" integrity="sha384-0L2Td2nqsSLt4fMliUjq+dvceWfLxnsNNeggJgFL+z1RP6q2lY3dIpBRDM2ObZAH" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CQUe4kzL.js"><link nonce="" integrity="sha384-53XwglVJLtGDmmynrYM9rgyETBLrmhyLZ7rrMhSo2SBjK3WgMof9cVczfk/F/Jzl" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BXoysCvc.js"><link nonce="" integrity="sha384-gzXIriZQL0YJn1tbOutH7KABTCI37AxDXpfsDegtUpa5c156iQBTuhrfNROu5Thk" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/bVVUK1Up.js"><link nonce="" integrity="sha384-NbmkXIRw/iEsysuJXcicjZ+p6w1q/BKa/sqxFk9dzfKtkUVNHl2dlWdzjczq3hQJ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/ChpWfMYt.js"><link nonce="" integrity="sha384-MiEIX+8nvVcF4/C2AnakM/xZVOSZUwgp9sX3M0dp9xuVHHHrJlv91nJQRgHk0Quv" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/csMlMc7I.js"><link nonce="" integrity="sha384-svAxaky+wOkSm0FK3/zqjV14+w8HlkJNStl5PbW1q/6YLYNXa3TVQlNdyRs25Pg0" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C7GKAtGK.js"><link nonce="" integrity="sha384-jWKAGfP+O3ErHtWOlwouqobnwxC2DN29v588eTZITOrTc2R01ngtrouBsqVdbCT7" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BL7qTDAr.js"><link nonce="" integrity="sha384-4pI+RYdvJhid05b/siB7KHnNxZlPTOdPojDRfnbIxjZho/sWNJcNQ1SNb5Qjo3I9" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CK0M71lT.js"><link nonce="" integrity="sha384-0+pxV72C5SbjyQwCXwgd4DF8SkZtG84RqBISsq7+Ml6e6P5t2g9o94DWGpB0Oy0b" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/c4uxQ8Wc.js"><link nonce="" integrity="sha384-1oAGdh3Ob3DhjeaIvvoAMwPn11xKR5BGJKypl8udvI7FxRd5094e7LiGBU+AXQNc" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DAsZ60qF.js"><link nonce="" integrity="sha384-B9ZNtOQnOJzP0adjSA7vD9KFGE8wq8Az8dT/U/qpIgJb/YyEYs6uz2CgKvr2PUoX" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DUAqYmp4.js"><link nonce="" integrity="sha384-pe7HW9XccXxhUCVvMVOXq3zlfWNDJ8M1xHyOt/JxJgJmlR0CXQ6TyVUa8J0WQabY" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DQyuHP0A.js"><link nonce="" integrity="sha384-4wAUkozzIJ0JmwD1ZWcwBO3VV7yJaa/KFi+K84/CamYjheklx4BVD8U8q8BtGJRe" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D6_gAmFJ.js"><link nonce="" integrity="sha384-j+AUYc7gZxlxcek5ud0DEYE8my+mwN+Q+N4Dz4yL+oXAeag33srrntaaKZzvhKnQ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BSBUAEYG.js"><link nonce="" integrity="sha384-FTHPQttPFF935jU0Dnu/R56VxY4WBQgpU2LGNNDf92i3nank9Q5S7x0bLH1PaLft" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/lTI5I4yu.js"><link nonce="" integrity="sha384-16L8vZm+5D4i9uhUuw6JV1TqCb9BMniQikxfKnswEUlRtfwDol+s4uqDhaZXwny2" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/91A8zhHS.js"><link nonce="" integrity="sha384-f+e1FVNE/T2lDce76NJMfxcdawJLbJnxqwGE8hcbh294/PD2/w5Ic3KQhSaNEleM" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BkeRmi07.js"><link nonce="" integrity="sha384-Q2DxEGTJ8Qr8IWjOnEEarTzTz8gde4A/QHCSgTH3rWp5dsGATv7Scyjkhy7ULO3K" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/UbdPEwEM.js"><link nonce="" integrity="sha384-qfRcPAxqaf0zA/FjgoER7vbIrE7mKhDttRFftIiUGQpYjDdPRSBKwCgFcrcAzDni" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DuAV58dt.js"><link nonce="" integrity="sha384-kQvyEBtLdEc9VGMkIeoQTjia1w52BsUjOJOYQhO4IcjAiViZDvVuQppZBRTqH6so" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BtTtLD25.js"><link nonce="" integrity="sha384-I039ANJGHhr2CaXH4icET/UUPslTqPGKPSOSoyofSjqe6+kwX8LAdMPMrVjkYrPH" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CUCNVA8S.js"><link nonce="" integrity="sha384-N1WfKiEg3SzR9CdokLFytZKVFw0H9QQCVqRyJABaCEAs5CF4oufjdkW9IgG+YoCf" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CvNiyATc.js"><link nonce="" integrity="sha384-Nmn6sUp07EnvYHCFN+bm3FSRVXMCEptrev8HKT04oml9cqtToSvJbrZa587R6Jwb" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/B5MQNTTm.js"><link nonce="" integrity="sha384-lKen8cvcDypP/BHrDug0k6q7J8SZJeaXgkUHjMjsguHHEFpwkiGYT1OhbXnethxH" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/4GYs45G9.js"><link nonce="" integrity="sha384-Ag2b5l4eEdsPCf7PE351pdvuMKZoAl2xcMge7HTtClEW6Y/izToOCEUSitNE2G0O" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/3oipLbd9.js"><link nonce="" integrity="sha384-gKkSnsBfMx5E3ar0WuTrpQkwVTJ/xlB3mCvlZvaxovj/RFWY82iBUBMnBhmMYWdk" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/m68L2hpN.js"><link nonce="" integrity="sha384-rkv14JDYlXj9BOiAfZaprkgZxm/Svqudu1oS7XH2J9epB768Yl/3zi4ob/iKWKym" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C5V8Z8ce.js"><link nonce="" integrity="sha384-C+9gFHof4xuWApmZD1yxSrq3zSFoAfCSJ7GdAqhtTlnwokHdyo/RUdleazn2uUBU" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/ctsQ0uQd.js"><link nonce="" integrity="sha384-6tGyJ7ePyQ9JREwDJFMygzTwMd3wV8grp9oPlS9f/f1eN55FC53MZQTJ5AfrnQk3" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CukEpSyf.js"><link nonce="" integrity="sha384-73mTlv6HnG9Y/nbl0pGyJZFeOvmZSPbu+1me5Mne55cH/oo55VPSkVNTAdt/S4dn" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C0Gi0Wkx.js"><link nonce="" integrity="sha384-E/lIGMB3s8lSmW1Wb/y2n/Xeh8yv8M/bycUj4DFXJIUCtLirrzQjYAvrr0cPGR4v" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Ct22R-2H.js"><link nonce="" integrity="sha384-HyGGNaFK3pSrLQbrCgicHYpnukgAQRnDKB0DsuokPeKmwta157YZJprLDc9ghWyt" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Cw8bpxEW.js"><link nonce="" integrity="sha384-hbTX8CKF7jYJP0G/fLUHf6Den+wClgVnJM1tYFtts3mz+w8q91kwvb63K+slJYPm" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BUWl0FAQ.js"><link nonce="" integrity="sha384-ajwUaldUJ12nDzWlFnlolk74utt0j8jJqaMTyAkzRI4MV1e4V2dGQQoabzLyE8Xe" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D9dB82Sf.js"><link nonce="" integrity="sha384-NBfcaWnmGwIH21ubW2vAcjF5699xmBnT3JrjgLtznuxJo9CV0BleGMglS1rDKfyR" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/X_eaGsVb.js"><link nonce="" integrity="sha384-h5b/dAqAQnOmyK0J7Vl3n449/pgGKSEVcqhv2SdhBz1ubaugKj7Ma97Nqb2DXIEc" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D4qSbAf1.js"><link nonce="" integrity="sha384-Za9VTnFnNXdDtfx8qy++/h46z9Q8Jws8W3x5v9jOAxh+6EiKNw6DLPuuqZGnPBFl" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C54he5AG.js"><link nonce="" integrity="sha384-CVqcfYSVKDtGTSEQ43quuif5kNqhnHhBpbUB8cXrZ9XY45Lw7b9Fpm1XjVnQIBXi" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Dfjlac11.js"><link nonce="" integrity="sha384-lXI1SLhL09RmXzya8PN1uIOpbeLOUMZ6NRszs0Ei2Ntq0QMx1Dtp7vtZwND57Fjb" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BHRJrsMd.js"><link nonce="" integrity="sha384-p3t8bYj/Hb0MfjRxSxTVT3ovtJYHYJpNPl9pLF9ZR7TsXzJthhqJnBokc3sonzUL" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CLdKaltm.js"><link nonce="" integrity="sha384-WWKOB22oIiKi5I2OAXMQHZvQGDu0ovNny41vF0l4CE7v1XVyrnWC7qJHtcZ/IgSS" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BQOI21vo.js"><link nonce="" integrity="sha384-68SI/6ff1AXkeHD7fvD6HrZ4dVe0xaR9VHWFPFZD/uWGZ49pd2beFXIJsAMJr5o+" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CqhnfTvz.js"><link nonce="" integrity="sha384-WZ5pik+7iVzN8oC3Y6RQG7ykH7JWlg+LnbNtCJuIgr0SDvTrcNYt94c3oKm89tU8" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DSbDmzAv.js"><link nonce="" integrity="sha384-6vY3TSy/Jbx4OzC1mO+pTJFKXG5FsZoX5U9pKycyll2vzak4TaVhz3DJEuKwpLRF" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DdSWIcVP.js"><link nonce="" integrity="sha384-/RmA7E98f7Q+6zOjyOE/ULDtygrXc/5K2AOI63oUjHAthpiOMd+llFdIZM+w25yC" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CMBSaFfM.js"><link nonce="" integrity="sha384-ZBrMqdnfEdCkyyr7sKgzP5miIfpBq3c5XQvM1BXGyTo7SH4zallfB+4uxSClt8bo" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/B7uvIniN.js"><link nonce="" integrity="sha384-UD9yC2AzbDdD5EK1l9Mi59WZoGGYcyprdctRDEEkzv3ZSjNThlQvozKYNZuIsbSd" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/B8VfGPME.js"><link nonce="" integrity="sha384-KdUIrGSVNZI3k3A9OXg9Qiq9DO7CACohQnp26o19gGJlijOSgUwjfEbDqUe9OMEJ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DdAcxpHr.js"><link nonce="" integrity="sha384-TR45iesdfuTCrAoS6OxSaJTVi+OQWD0mM/PKB2g7vrV8xHJ47GlcGoY0YduedI38" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Bp3dZx8A.js"><link nonce="" integrity="sha384-nOA2SAWnorgZE/YX8hKE6WZILbbK3iGh5o5j2evHngy3atd0PpBbO3INKw47qiaR" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DbHZS3kB.js"><link nonce="" integrity="sha384-RM/Mo1ghfGkllOi+CDGLnd20DWVN1t08mtTcwNUiXBEJRjpZkQtDRx/jVXtJz41Y" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CwRp0Xpq.js"><link nonce="" integrity="sha384-RyM4rUhyBSz8fmPFNbPomNhEGNVOzjIOLiaXC4Ko2qfim2oQsUxgSF5Ph2aIRqlG" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Bp1_D2AQ.js"><link nonce="" integrity="sha384-lBee+EBxJwlQT/EIkkt/pTv4vAQOc0fgN5o5eYkpq9gdj9noR5zDkusN3ShaWaF5" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/9AJ66TUp.js"><link nonce="" integrity="sha384-vRjC9eer2LRI5TZCe1KoMcxRls7jex5ZFTsZ8MolJE1t7J7JVgbbbDulHcGIldMB" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CEXEj78B.js"><link nonce="" integrity="sha384-GIbFX+zhMJCEH4XGvK7kQyWHeRgqwPN1WYH9cBaw+k8RSsY9HxSg153f0yqDf/Ax" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CRfmA1bm.js"><link nonce="" integrity="sha384-mirQ9xkJWaO21ywpuWop5HjFICi9zbBXBKWFO3UK5YfsCSSehmyHqf4oZVWQqsID" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BZIEhpEc.js"><link nonce="" integrity="sha384-ZS0dy5T81natV7R6Dk5VaYA2d5MlO4t0nPsBc5NZh+R5t4Vbdx8QCONwl3Z7GDJQ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/6INMPEbM.js"><link nonce="" integrity="sha384-Hk6ffNtPiGoxfI8TygjqdFsxfFzqEojGwc/bGLgoLpAkbU2dGn4aFOTdHmsF/tTv" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BiHU9HLl.js"><link nonce="" integrity="sha384-VB229iY445N1sGEQKoH4OhWJJorS/KVSits7FB+9fCBfjVkYDrceq435k4P/wIjI" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D54rIIIu.js"><link nonce="" integrity="sha384-/NzF5r7B5Dd9FZj2VNaIuUf10brer8kf1ljNa8vxn96g7ELxSkQUU6OB5BSA14xl" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/_DUMccsq.js"><link nonce="" integrity="sha384-6RpWbACR1dR1X7lSttskfK8FjGSyc0vdg96WfBK+gn30b9+6pazk5ECO0XvxHMBF" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CwXlw7iE.js"><link nonce="" integrity="sha384-YEMzifEwiJDrTS+mZ8hRwFwDa9JRLZwCu8jNct/772Gz16vMt0IuCII9JLrUy45b" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/KpUMbPIU.js"><link nonce="" integrity="sha384-/qMPJ8gBan0mMr3YZ5j73nUXWbZcvlhzMBqC0s02HA33Er86ElDUEbyXHCHhsaM7" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/O5G_pKvf.js"><link nonce="" integrity="sha384-P+EqG43aviqK4615K2MQKC1g5znE1pq/eZuAsbh3ZIgRjCWM22s+4kgKYbw3GaAc" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BmSZo5vd.js"><link nonce="" integrity="sha384-vz7JjgW2QWGQncY16HiNPYbLYQ+OKtUb5KNndUdhuJw4j/5OrjTMCXQOuctsCP/s" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CqKT32sS.js"><link nonce="" integrity="sha384-9RFXdF3e3K3vvdvkDo9c/yTeofhQZot5z25S1RN+Gmd6uku2vAhs2PTN1Z15ttpO" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CVIvuSKk.js"><link nonce="" integrity="sha384-n0vfE37Xgk0xpViNLpNToKUiZ7I246oSVD3z0aUq+8u1upLNRhCTOuhKkPeV7UdH" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/yV0BN1R6.js"><link nonce="" integrity="sha384-hD3pihvQqvqOb47clwfGM7eoP30EGCxJA8mKCiPLx1iIGLnt/Jj0nJbDldzbdhe5" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DwLVdadC.js"><link nonce="" integrity="sha384-onBDVMoGwRE3QRfuzFk7cP7dUqrPv6fClKp0ZBgbBIHdiCztqd3MiVEkF8Kx2USa" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/1_iL_gOK.js"><link nonce="" integrity="sha384-4JErMhMwN9S+EdU+QgZJzIlMhxCePhDvuitEv+BAwMEfUXGh2ZmhItHg6LYCTlIC" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DDrhJvbN.js"><link nonce="" integrity="sha384-+mbTzQrAM16+5gzKhruDRbvkgzrWryRjppDLh3QORGSvAMtoFwNFY4SVnGcPIWxi" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CdgWLbM0.js"><link nonce="" integrity="sha384-8RFJigfxYGzVgxWTW2gy45MzjdX190pIR9DLZlr/+cIgm4WKj5QtEtMI3ZKn8SsN" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C9xFUvHG.js"><link nonce="" integrity="sha384-w++Jp76+dXZEGKN3ApKy8R4s6Zclm1L+60MWfMkYKu1lSjOQ3E4GmzgXuQidTOaG" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/W7wjYkEu.js"><link nonce="" integrity="sha384-z7e7yUXQAueL7WeJPCaj0rMxioMrr9TNZXplqJCaL3WhmIMAQgePZfyLFq4pZqcJ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C0vOX3wI.js"><link nonce="" integrity="sha384-h/1ej+nEzHZyUTfGxz1GJ9y2bcEZAZ7aj7KXLaWnzA2v1yuPXAJnbJ/htYw3jg/O" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BGlOD76I.js"><link nonce="" integrity="sha384-1MYNPSB37FmA6FdFj077+wWfewzVbTpTR38q0rpWUoxDaqYBZ//322fFFzvDBozK" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C7L-Qewe.js"><link nonce="" integrity="sha384-NhF4xsrG33Hrmoyk0CtdRHWVv5kuNSXCmoaxIiALakeXaeXpiAr3xrIcNMZMa082" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Ajydhuh8.js"><link nonce="" integrity="sha384-cZ/Tz5zzHCOCUuJEGiqP1GPVQAEDCVhznrO/05dCFh4sBdXf8Vrwq61VUyRjGX6C" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BFQR5dwQ.js"><link nonce="" integrity="sha384-/h2WZsDQgkoa7UZm/WayhkhqEod4IvIrmVY92WHHwcnpksYuurXZ5mnAkh/kpvjd" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DRoURJIp.js"><link nonce="" integrity="sha384-nKQhV4dAMU5t/GeMrgq1FG6jOO2pm2dD1zv0RoTOYkPo+rX4S2i6n4wsAQE7ZwCm" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/0q1p6zF5.js"><link nonce="" integrity="sha384-LHr9km/b9aujaROdMqpErXj2bbnZRPOSioFSLi5HEVZSRbpzxAEYzr8rKzs1LelZ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DzRmAYvD.js"><link nonce="" integrity="sha384-s7UennnA5+uKAXflJQSOiBFQyIuyesh7AMB9UevZ/tjSKbYxYRCDt0BVDI7nG/ZR" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BACt5QkB.js"><link nonce="" integrity="sha384-enuNAZc5uQxVc+Wi9HoS2wrqZ8AMvxq+MsAo0Q+nli3WKKMt5R8oDcZee7O5N3Ch" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/EsYxSuUn.js"><link nonce="" integrity="sha384-ijeWYzm10n+O+h47muVibKFhyxzTB5Lo+2bXVOgyJ992mRj3HWrKlCMTU4cid++L" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/TfVQFkXD.js"><link nonce="" integrity="sha384-fYZWSwq465LUeZBu+yR0gIqFWxVYMJkeADsDLAxHQi5iGoN4SU7i9tYfqjlqv3GG" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Cwv0wPrA.js"><link nonce="" integrity="sha384-dmAK1hhiumNXMs/NjWqR1YxMm3vyiMg16sggZx3HjlYKju1wCeiJzsSNr9NEW6TG" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Ddhl0Rna.js"><link nonce="" integrity="sha384-jGINj1ShftWKDI7S23mVZ+L6D2f9piqFpjk0Pzqu1vUKQJ4qE55dJD6e7E5C0bPG" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BBTDB2dI.js"><script nonce="" integrity="sha384-K18nopic+X0JunSv2KJqsE7W6KB015nwBWeFR+Jh5SQtvXW7Yy4WjDfxnYjG/Q6g" type="module" src="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/A538-Xd4.js" crossorigin=""></script><meta name="description" content="In this tutorial, you will learn how to build an Layer 2 DSR load balancer using eBPF/XDP, where backends send responses directly back to clients bypassing the load balancer."><link nonce="" rel="icon" type="image/png" href="https://labs.iximiuz.com/favicon.ico"><link nonce="" rel="apple-touch-icon" type="image/png" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/logo.webp"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><meta name="title" content="Building an eBPF/XDP L2 Direct Server Return Load Balancer from Scratch | iximiuz Labs"><meta name="keywords" content="eBPF"><meta name="author" content="Teodor Janez Podobnik"><meta property="og:type" content="article"><meta property="og:title" content="Building an eBPF/XDP L2 Direct Server Return Load Balancer from Scratch | iximiuz Labs"><meta property="og:description" content="In this tutorial, you will learn how to build an Layer 2 DSR load balancer using eBPF/XDP, where backends send responses directly back to clients bypassing the load balancer."><meta property="og:url" content="https://labs.iximiuz.com/tutorials/xdp-dsr-layer2-lb-92b02f3e"><meta property="og:image" content="https://labs.iximiuz.com/content/files/tutorials/xdp-dsr-layer2-lb-92b02f3e/__static__/dsr-1.png"><meta property="og:site_name" content="iximiuz Labs"><meta name="twitter:dnt" content="on"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@iximiuz"><meta name="twitter:title" content="Building an eBPF/XDP L2 Direct Server Return Load Balancer from Scratch | iximiuz Labs"><meta name="twitter:description" content="In this tutorial, you will learn how to build an Layer 2 DSR load balancer using eBPF/XDP, where backends send responses directly back to clients bypassing the load balancer."><meta name="twitter:image" content="https://labs.iximiuz.com/content/files/tutorials/xdp-dsr-layer2-lb-92b02f3e/__static__/dsr-1.png"><link nonce="" rel="canonical" href="https://labs.iximiuz.com/tutorials/xdp-dsr-layer2-lb-92b02f3e"><link nonce="" rel="image_src" href="https://labs.iximiuz.com/content/files/tutorials/xdp-dsr-layer2-lb-92b02f3e/__static__/dsr-1.png"><style>:is([id*='google_ads_iframe'],[id*='taboola-'],.taboolaHeight,.taboola-placeholder,#top-ad,#credential_picker_container,#credentials-picker-container,#credential_picker_iframe,[id*='google-one-tap-iframe'],#google-one-tap-popup-container,.google-one-tap__module,.google-one-tap-modal-div,#amp_floatingAdDiv,#ez-content-blocker-container) {display:none!important;min-height:0!important;height:0!important;}</style><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/SiteHeaderContent.DrFmd9xY.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ContentTable.ChTBbrAh.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ContentMetaFoot.DFr8HVAl.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ContentBox.rEdLfu6t.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/PlayBoxContentTab.CDHpeXMx.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/_name_.BsyFxT4E.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseP.DVN8_MMS.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseA.CGc139Ky.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseUl.5leepCZD.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseLi.BqrAa653.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseCodeInline.BhuXSD4-.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseH2.BDlwlsRA.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseStrong.DAaF5VAD.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseH3.CuDSVxqV.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseCodeCopyButton.dhGBryGn.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseCode.CdJo3ouR.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProsePre.B_fgAJq0.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/DetailsBox.3wfYThLq.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseHr.BdCZvnSy.css"><link rel="preconnect" href="https://plausible.io/"><link rel="image_src" href="https://labs.iximiuz.com/content/files/tutorials/xdp-dsr-layer2-lb-92b02f3e/__static__/dsr-1.png"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/3yJMaxvi.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C8wdN3Ik.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Bq0UkCYT.js"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/SiteHeaderDefault.CQ-9yJ45.css"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/GriQ8B2M.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CrYjDOdC.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CXxrP7zL.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DUA4yL51.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/MTJvKNbD.js"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/AuthorProfileCard.B2bdkgLl.css"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D5PaCUAZ.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C4h4q3zH.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Dg959Yt1.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CJ7oOdLD.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Hmopn4U9.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Dv2DOayU.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/4J4r8vMm.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CAUMgW0h.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/QwXPddex.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/InMlYjVK.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Dzr_TBnN.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BWu6ZW-1.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/8O-YeDGZ.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Ch3sV4Nw.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Jz7gehop.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CreFxVwq.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/djRO7Jx5.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Dx5dmUye.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/OfFSSdU4.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BDLepdqL.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DF8Kb1Fe.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DGl8mbvI.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BkPnT0P4.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D9IPNEg4.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CSKsp-sX.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BLGyX_7H.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/sTy7mATY.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/5aprXXgQ.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BEhoFAvJ.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DNFnU2Va.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Ddtg1Dbv.js"></head><body><div id="__nuxt"><div class="bg-[length:100%_250px] bg-fixed bg-gradient-to-b bg-mist bg-no-repeat from-[#a6d7f7] min-w-[300px]"><!--[--><div data-v-0d30d5a9=""><header id="site-header" class="bg-base-100 border-b-[1px] border-base-content/40 flex min-h-[3rem] sticky top-0 z-50" data-v-0d30d5a9="" data-v-7f8ed6a6=""><nav class="flex grow items-center justify-between min-w-0 mx-auto px-2 sm:px-4 text-primary-content" data-v-7f8ed6a6=""><div data-headlessui-state="" class="mr-2 relative self-center shrink-0 sm:mr-4" data-v-7f8ed6a6=""><div><button id="button-header-nav-menu-left" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state="" class="flex items-center rounded-full text-primary-content text-sm"><img class="align-text-bottom h-6 inline mr-1 w-auto" src="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/logo.webp" alt="iximiuz Labs"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-4 hover:opacity-100 hover:scale-110 opacity-70 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5"></path></svg></button></div><!----></div><div class="flex grow min-w-0" data-v-7f8ed6a6=""><div class="flex flex-col min-w-0 mr-5" data-v-7f8ed6a6=""><div class="flex gap-1 items-center" data-v-7f8ed6a6=""><!--[--><a aria-current="page" href="https://labs.iximiuz.com/tutorials/xdp-dsr-layer2-lb-92b02f3e" class="router-link-active router-link-exact-active font-semibold text-md truncate" title="Building an eBPF/XDP L2 Direct Server Return Load Balancer from Scratch" data-v-7f8ed6a6=""><h1 class="truncate" data-v-7f8ed6a6="">Building an eBPF/XDP L2 Direct Server Return Load Balancer from Scratch</h1></a><!--]--><!--[--><!--]--></div><span title="Teodor Janez Podobnik" class="text-base-content/85 text-xs truncate" data-v-7f8ed6a6="">Tutorial by <!--[--><!--[--><a href="https://labs.iximiuz.com/a/teodor-janez-podobnik" class="hover:underline decoration-dotted" title="Teodor Janez Podobnik">Teodor Janez Podobnik</a><!----><!----><!--]--><!--]--></span></div></div><!--[--><div class="flex gap-x-3 items-center shrink-0" data-v-0d30d5a9=""><!----><!----><!----><!----></div><!--]--><div class="flex items-center ml-2 shrink-0 sm:ml-3" data-v-7f8ed6a6=""><!--[--><a href="https://labs.iximiuz.com/signin?return_to=%2Ftutorials%2Fxdp-dsr-layer2-lb-92b02f3e" class="leading-6 ml-3 mr-4 shrink-0 text-base"> Sign in </a><a href="https://labs.iximiuz.com/signup?return_to=%2Ftutorials%2Fxdp-dsr-layer2-lb-92b02f3e" class="bg-base-100 border border-primary-content leading-6 px-1.5 rounded-md shrink-0 text-base"> Sign up </a><!--]--></div></nav></header><div class="hidden bg-gradient-to-b flex flex-col from-base-200 gap-y-2 max-h-96 overflow-y-auto p-4 scrollbar-styled to-transparent w-full z-[999999] fixed" data-v-0d30d5a9=""><!--[--><!--]--></div><div class="flex justify-center relative" data-v-0d30d5a9=""><div class="hidden lg:flex lg:h-[calc(100vh-3rem)] lg:sticky lg:top-[3rem] shrink-0 transition-all"><!--[--><div class="duration-300 ease-in-out flex flex-col mb-[3px] mt-1.5 overflow-hidden relative transition-all bg-base-100 border border-slate-400 rounded-lg w-[320px] ml-1.5" data-v-0d30d5a9=""><div class="absolute left-0 right-0 top-0 cursor-pointer flex group h-8 items-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="group-hover:opacity-100 mr-2 opacity-60 stroke-[2.5px] ml-auto h-3 w-3"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5"></path></svg></div><div class="flex flex-col min-h-0 overflow-hidden pl-3 pr-0 pt-2 pt-3" style="" data-v-c294bba9=""><h3 class="flex mb-3 text-[0.875rem] text-base-content/80 text-nowrap tracking-tight" data-v-c294bba9=""> Table of contents <!----></h3><div class="flex-1 mb-3 min-h-0 relative" data-v-c294bba9=""><nav class="h-full overflow-y-auto pr-2 scrollbar-styled" data-v-c294bba9=""><ul data-v-c294bba9=""><!--[--><li data-v-c294bba9=""><a href="#dsr-l2-load-balancing" class="block border-l-[3px] duration-150 hover:bg-mist no-underline px-2 py-1.5 rounded rounded-l-none text-[0.85rem] text-base-content/80 transition-colors pl-4 border-slate-500 !text-base-content/100" data-v-c294bba9="">DSR L2 Load Balancing</a><ul data-v-c294bba9=""><!--[--><li data-v-c294bba9=""><a href="#virtual-ip-vip" class="pl-6 border-slate-200 block border-l-[3px] duration-150 hover:bg-mist no-underline px-2 py-1.5 rounded rounded-l-none text-[0.85rem] text-base-content/80 transition-colors" data-v-c294bba9="">Virtual IP (VIP)</a><!----></li><li data-v-c294bba9=""><a href="#rewriting-mac-addresses" class="pl-6 border-slate-200 block border-l-[3px] duration-150 hover:bg-mist no-underline px-2 py-1.5 rounded rounded-l-none text-[0.85rem] text-base-content/80 transition-colors" data-v-c294bba9="">Rewriting MAC Addresses</a><!----></li><!--]--></ul></li><li data-v-c294bba9=""><a href="#running-the-load-balancer" class="pl-4 border-slate-200 block border-l-[3px] duration-150 hover:bg-mist no-underline px-2 py-1.5 rounded rounded-l-none text-[0.85rem] text-base-content/80 transition-colors" data-v-c294bba9="">Running the Load Balancer</a><!----></li><!--]--></ul></nav><!----></div></div><div class="bg-[#a6d7f7]/70 border-slate-400 border-t mt-auto p-2 py-4" style=""><div class="flex items-center justify-center"><a href="https://labs.iximiuz.com/signup?return_to=%2Ftutorials%2Fxdp-dsr-layer2-lb-92b02f3e" class="btn bg-base-100 btn-outline btn-sm" role="button"><!--[--> Start tutorial <!--]--></a></div></div><div class="flex flex-col gap-y-5 !gap-y-4 border-slate-400 border-t px-4 py-5" style="" data-v-6adfc778=""><div class="flex flex-wrap items-center" data-v-6adfc778=""><span class="font-semibold" data-v-6adfc778="">Tutorial on&nbsp;</span><!--[--><!--[--><!----><a href="https://labs.iximiuz.com/tutorials?category=linux" class="font-normal hover:opacity-100 hover:underline no-underline opacity-80" data-v-6adfc778="">Linux</a><!--]--><!--[--><span data-v-6adfc778="">,&nbsp;</span><a href="https://labs.iximiuz.com/tutorials?category=networking" class="font-normal hover:opacity-100 hover:underline no-underline opacity-80" data-v-6adfc778="">Networking</a><!--]--><!--]--></div><div class="flex flex-wrap items-center" data-v-6adfc778=""><span class="font-semibold" data-v-6adfc778="">Discussion&nbsp;</span><a href="https://discord.gg/p6nxaHm46p" rel="noopener noreferrer" target="_blank noopener noreferrer" class="font-normal hover:opacity-100 hover:underline no-underline opacity-80" data-v-6adfc778=""> Discord <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-[1em] inline pb-[3px] stroke-[2px] w-[1em]" data-v-6adfc778=""><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a></div><div class="flex flex-wrap gap-y-2 items-center mt-1" data-v-6adfc778=""><!--[--><a href="https://labs.iximiuz.com/tutorials?tag=eBPF" class="bg-mist cursor-pointer duration-200 ease-in-out font-medium hover:bg-slate-200 hover:text-gray-800 inline-flex items-center min-w-0 no-underline py-0.5 rounded-md text-gray-600 transition-all px-2.5 text-sm mx-1 not-prose" title="#eBPF" data-v-6adfc778=""><span class="truncate">eBPF</span></a><!--]--></div></div></div><!--]--></div><div class="flex lg:basis-[950px] transition-[flex-basis] duration-300 ease-in-out grow justify-center lg:grow-0 lg:pb-[3px] min-h-[calc(100vh-3rem)] min-w-0 mx-auto overflow-hidden p-1.5 pb-14"><div class="w-full"><!--[--><article class="flex grow min-h-full min-w-0" data-v-0d30d5a9=""><meta itemprop="name" content="Building an eBPF/XDP L2 Direct Server Return Load Balancer from Scratch"><meta itemprop="abstract" content="In this tutorial, you will learn how to build an Layer 2 DSR load balancer using eBPF/XDP, where backends send responses directly back to clients bypassing the load balancer."><meta itemprop="dateCreated" content="2026-01-20T00:00:00.000Z"><meta itemprop="datePublished" content="2026-01-20T00:00:00.000Z"><meta itemprop="dateModified" content="2026-01-20T00:00:00.000Z"><!--[--><div class="flex flex-col grow min-h-full min-w-0" data-v-0d30d5a9="" data-v-200caef3=""><!--[--><!--]--><div class="bg-base-100 border-[1px] border-slate-400 flex flex-col grow overflow-hidden relative rounded-lg shadow-lg" data-v-200caef3=""><div class="px-4 md:px-8 xl:px-12" data-v-200caef3=""><!--[--><div class="flex flex-col mb-8" data-v-0d30d5a9=""><div class="-mx-4 bg-content-tutorial border-b-[1px] border-b-slate-400 flex flex-nowrap items-center md:-mx-8 min-w-0 px-3 py-1.5 rounded-t-lg text-primary-content/70 text-sm xl:-mx-12"><div class="group/content-icon relative cursor-help"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-[1.2em] mr-2 w-[1.2em]"><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"></path></svg><div class="absolute bg-base-content duration-300 ease-in-out group-hover/content-icon:opacity-100 group-hover/content-icon:visible invisible left-0 mt-1 opacity-0 px-3 py-2 right-0 rounded-md text-slate-200 transition-all w-[20em] z-20">This tutorial was carefully crafted by an independent author and proudly hosted by iximiuz Labs.</div></div> Tutorial <span> &nbsp;on&nbsp; </span><!--[--><!--[--><!----><a href="https://labs.iximiuz.com/tutorials?category=linux" class="font-normal hover:underline no-underline truncate">Linux</a><!--]--><!--[--><span>,&nbsp;</span><a href="https://labs.iximiuz.com/tutorials?category=networking" class="font-normal hover:underline no-underline truncate">Networking</a><!--]--><!--]--><!--[--><span class="cursor-help hover:tooltip-open ml-auto pl-4 shrink-0 tooltip tooltip-left" data-tip="Published: Jan 20, 2026"><time datetime="createdAt"> Published: Jan 20, 2026</time></span><!--[--><button type="button" class="hidden lg:flex ml-2" title="Expand content to full width" data-v-0d30d5a9=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--material-symbols-light h-5 w-5" style="" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M6 18v-5h1v4h4v1zm11-7V7h-4V6h5v5z"></path></svg></button><!--]--><!----><!--]--></div><!----></div><h1 class="tutorial-header" data-v-0d30d5a9="">Building an eBPF/XDP L2 Direct Server Return Load Balancer from Scratch</h1><!--]--></div><!----><!--[--><!--[--><div class="flex flex-col" data-v-200caef3=""><!----><div class="h-auto pb-5 px-4 md:px-8 xl:px-12 duration-200 ease-out max-w-full overflow-hidden prose relative transition-all" data-v-200caef3=""><div class="" data-v-200caef3=""><p class="prose-p" data-v-b025fb9f=""><!--[-->In the <a href="https://labs.iximiuz.com/tutorials/xdp-load-balancer-700a1d74" rel="nofollow" target="_blank" class="prose-a !underline !underline-offset-2 !decoration-dashed !text-black" data-v-abeb6555=""><!--[-->previous tutorial<!--]--><!----></a>,
 we built a NAT-based XDP load balancer. One nice thing about that setup
 was that both requests and responses passed through the load balancer, 
making it easier to apply custom network policies or perform packet 
inspection in both directions.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->However,
 this approach isnt always optimal. Because the load balancer handles 
traffic in both directions, it consumes more resources and can become a 
bottleneck. After all, the backend could just respond directly to the 
client instead of routing the reply back through the load balancer.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->Not
 to mention, inbound traffic is usually much smaller than outbound 
traffic. A short search query or initial AI prompt is only a few bytes, 
while the response (search results or an AI completion) is often much 
larger.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->But an 
even bigger problem is that the backend isnt really aware of which 
client made the request, since the NAT load balancer rewrote the packet 
headers. Meaning, if the backend wants to maintain per-user sessions, or
 log requests by source IP, it cant really do that.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->To overcome these downsides, Direct Server Return (DSR) concept was introduced.<!--]--></p><div class="bg-base-100" style="padding:0;margin:30px auto;max-width:800px;"><div class="text-center"><img src="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/dsr-2.webp" alt="XDP DSR Load Balancing" class="cursor-pointer m-0 max-w-full" style=""><!--[--><!--]--></div><!----></div><p class="prose-p" data-v-b025fb9f=""><!--[-->There
 are several DSR (Direct Server Return) implementations  including 
Layer 2 DSR, IP-in-IP, and GRE-based DSR  as well as some unique 
variations that leverage fields like IP or TCP header fields.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->This
 tutorial focuses on Layer 2 DSR (with Simple Hashing) using eBPF/XDP, 
while other approaches will be covered in upcoming labs.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->This playground has a network topology with five nodes on two different networks:<!--]--></p><ul class="prose-ul" data-v-533e29f3=""><!--[--><li class="prose-li" data-v-2969431c=""><!--[--><code class="prose-code-inline" data-v-a031129a=""><!--[-->lb<!--]--></code> in network <code class="prose-code-inline" data-v-a031129a=""><!--[-->192.168.178.10/24<!--]--></code><!--]--></li><li class="prose-li" data-v-2969431c=""><!--[--><code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-01<!--]--></code> in network <code class="prose-code-inline" data-v-a031129a=""><!--[-->192.168.178.11/24<!--]--></code><!--]--></li><li class="prose-li" data-v-2969431c=""><!--[--><code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-02<!--]--></code> in network <code class="prose-code-inline" data-v-a031129a=""><!--[-->192.168.178.12/24<!--]--></code><!--]--></li><li class="prose-li" data-v-2969431c=""><!--[--><code class="prose-code-inline" data-v-a031129a=""><!--[-->client<!--]--></code> in network <code class="prose-code-inline" data-v-a031129a=""><!--[-->10.0.0.20/16<!--]--></code><!--]--></li><li class="prose-li" data-v-2969431c=""><!--[--><code class="prose-code-inline" data-v-a031129a=""><!--[-->gateway<!--]--></code> between networks <code class="prose-code-inline" data-v-a031129a=""><!--[-->192.168.178.2/24<!--]--></code> and <code class="prose-code-inline" data-v-a031129a=""><!--[-->10.0.0.2/16<!--]--></code><!--]--></li><!--]--></ul><div class="bg-base-100" style="padding:0;margin:30px auto;max-width:800px;"><div class="text-center"><img src="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/playground.webp" alt="XDP DSR Load Balancing Playground" class="cursor-pointer m-0 max-w-full" style=""><!--[--><!--]--></div><!----></div><h2 id="dsr-l2-load-balancing" class="prose-h2" data-v-b9b1576a=""><!--[-->DSR L2 Load Balancing<!--]--><!----></h2><p class="prose-p" data-v-b025fb9f=""><!--[-->Unlike
 NAT-based load balancing, DSR preserves the original client IP and 
allows the backend to respond directly to the client, bypassing the load
 balancer on the return path.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->To understand how this is possible, we need to answer three questions:<!--]--></p><ul class="prose-ul" data-v-533e29f3=""><!--[--><li class="prose-li" data-v-2969431c=""><!--[--><strong class="prose-strong" data-v-24022f14=""><!--[-->How does the backend see the client IP if the packet went through the load balancer?<!--]--></strong><!--]--></li><li class="prose-li" data-v-2969431c=""><!--[--><strong class="prose-strong" data-v-24022f14=""><!--[-->How does the backend know which client to respond to?<!--]--></strong><!--]--></li><li class="prose-li" data-v-2969431c=""><!--[--><strong class="prose-strong" data-v-24022f14=""><!--[-->How do we ensure the client receives the response from the same IP it sent the request to?<!--]--></strong><!--]--></li><!--]--></ul><p class="prose-p" data-v-b025fb9f=""><!--[-->In
 short, L2 DSR achieves this by rewriting only the MAC addresses of 
packets at the load balancer, keeping the IP header unchanged, and 
relying on a virtual IP between the load balancer and backend servers.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->Lets take it slow...<!--]--></p><h3 id="virtual-ip-vip" class="prose-h3" data-v-9a0ceb30=""><!--[-->Virtual IP (VIP)<!--]--><!----></h3><p class="prose-p" data-v-b025fb9f=""><!--[-->In
 any network setup, whenever a client sends a request to a specific 
endpoint, it expects the response to come from that same IP address. If 
the reply comes from a different IP, the clients network stack assumes 
an error and drops the packet.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->And
 if you remember the NAT-based load balancing, this creates a problem 
since the clients request always passed through the load balancer, 
which forwarded it to a backend node that has a different IP.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->To
 address this, both the load balancer and the backend nodes need to 
share the same IP, ensuring the client always sees responses as coming 
from the same address it originally contacted.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->This "shared IP" is called Virtual IP (VIP).<!--]--></p><div class="border-[2px] my-[24px] px-6 py-0 rounded-lg border-primary/50 bg-[#f7fbfe]"><!--[--><p class="prose-p" data-v-b025fb9f=""><!--[-->
 Unlike physical IPs, a Virtual IP (VIP) is not bound to a specific 
interface or node. Instead, it's a shared address used by multiple nodes
 to handle traffic for the same service.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->Confusing, right? Read along.<!--]--></p><!--]--></div><p class="prose-p" data-v-b025fb9f=""><!--[-->To set this up in our playground, <strong class="prose-strong" data-v-24022f14=""><!--[-->configure the VIP on the load balancers (<code class="prose-code-inline" data-v-a031129a=""><!--[-->lb<!--]--></code> tab) main interface (<code class="prose-code-inline" data-v-a031129a=""><!--[-->eth0<!--]--></code>)<!--]--></strong>:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> ip</span><span style="--shiki-default:#CE9178"> addr</span><span style="--shiki-default:#CE9178"> add</span><span style="--shiki-default:#CE9178"> 192.168.178.15/32</span><span style="--shiki-default:#CE9178"> dev</span><span style="--shiki-default:#CE9178"> eth0</span><span style="--shiki-default:#6A9955">  # 192.168.178.15 is our VIP for this example
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->And, on both backends (<code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-01<!--]--></code> and <code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-02<!--]--></code> tabs), <strong class="prose-strong" data-v-24022f14=""><!--[-->configure the VIP on the loopback interface (<code class="prose-code-inline" data-v-a031129a=""><!--[-->lo<!--]--></code>)<!--]--></strong>:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> ip</span><span style="--shiki-default:#CE9178"> addr</span><span style="--shiki-default:#CE9178"> add</span><span style="--shiki-default:#CE9178"> 192.168.178.15/32</span><span style="--shiki-default:#CE9178"> dev</span><span style="--shiki-default:#CE9178"> lo</span><span style="--shiki-default:#6A9955"> # 192.168.178.15 is our VIP for this example
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[--><strong class="prose-strong" data-v-24022f14=""><!--[-->But wait  two nodes with the same IP? Wouldn't that confuse the client or gateway, seeing both advertise the same address?<!--]--></strong><!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->Exactly  thats why we assign the VIP to the <code class="prose-code-inline" data-v-a031129a=""><!--[-->lo<!--]--></code> interface on backend nodes. We dont want the backends to advertise the virtual IP (via ARP).<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->In
 other words, no one in the network should know the VIP exists on the 
backends; otherwise, clients could bypass the load balancer and connect 
directly.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->To prevent backend nodes from responding to ARP requests (i.e., advertising) for the VIP address on the <code class="prose-code-inline" data-v-a031129a=""><!--[-->lo<!--]--></code> interface, run the following on each backend node (<code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-01<!--]--></code> and <code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-02<!--]--></code> tabs):<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A9955"># Only reply to ARP requests if the target IP is assigned to the interface 
</span></span><span class="line" line="2"><span style="--shiki-default:#6A9955"># that received the request (prevents advertising the VIP on eth0)
</span></span><span class="line" line="3"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> sysctl</span><span style="--shiki-default:#CE9178"> -w</span><span style="--shiki-default:#CE9178"> net.ipv4.conf.eth0.arp_ignore=</span><span style="--shiki-default:#B5CEA8">1
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span style="--shiki-default:#6A9955"># When sending ARP requests, use only addresses assigned to the outgoing interface
</span></span><span class="line" line="6"><span style="--shiki-default:#6A9955"># (prevents the node from leaking the VIP as a source IP in ARP)
</span></span><span class="line" line="7"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> sysctl</span><span style="--shiki-default:#CE9178"> -w</span><span style="--shiki-default:#CE9178"> net.ipv4.conf.eth0.arp_announce=</span><span style="--shiki-default:#B5CEA8">2
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[--><strong class="prose-strong" data-v-24022f14=""><!--[-->Then whats the point of the virtual IP, and how does the load balancer reach the backends if that IP "isnt advertised"?<!--]--></strong><!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->The cool part is that load balancer doesn't really have to know the VIP exists on the backend nodes.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->It
 only needs the backends MAC address to forward packets at Layer 2. 
When a backend receives the packet, it decapsulates it and recognizes 
the virtual IP as its own (configured on the <code class="prose-code-inline" data-v-a031129a=""><!--[-->lo<!--]--></code> interface), even though that IP is never advertised on the network.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[--><strong class="prose-strong" data-v-24022f14=""><!--[-->This
 is also why this concept is called Layer 2 DSRthe load balancer 
reaches backend nodes using only their MAC addresses, which wouldnt 
work if the backends were in a different (L2) network.<!--]--></strong><!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->Here's an image to illustrate this concept.<!--]--></p><div class="bg-base-100" style="padding:0;margin:30px auto;max-width:800px;"><div class="text-center"><img src="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/dsr-new.webp" alt="XDP DSR L2 Load Balancing" class="cursor-pointer m-0 max-w-full" style=""><!--[--><!--]--></div><!----></div><p class="prose-p" data-v-b025fb9f=""><!--[-->In other words, when a client connects to the VIP, the:<!--]--></p><ul class="prose-ul" data-v-533e29f3=""><!--[--><li class="prose-li" data-v-2969431c=""><!--[-->Gateway routes the traffic to the load balancer<!--]--></li><li class="prose-li" data-v-2969431c=""><!--[-->Load balancer then forwards the packet to a backend by rewriting the (source and) destination MAC address<!--]--></li><li class="prose-li" data-v-2969431c=""><!--[-->Backend has the VIP configured on its <code class="prose-code-inline" data-v-a031129a=""><!--[-->lo<!--]--></code> interface, it recognizes the packet as its own and processes it<!--]--></li><!--]--></ul><div class="border-[2px] my-[24px] px-6 py-0 rounded-lg border-primary/50 bg-[#f7fbfe]" data-v-370f298d=""><!--[--><details data-v-370f298d=""><summary class="cursor-pointer my-3 select-none text-[#4078c0]" data-v-370f298d="">Verify the setup</summary><!--[--><p class="prose-p" data-v-b025fb9f=""><!--[-->You can verify this by checking that <code class="prose-code-inline" data-v-a031129a=""><!--[-->192.168.178.15<!--]--></code> maps to the load balancers MAC address in the ARP table on the gateway.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->Run the following on the <code class="prose-code-inline" data-v-a031129a=""><!--[-->gateway<!--]--></code> tab:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">ip</span><span style="--shiki-default:#CE9178"> neigh</span><span style="--shiki-default:#CE9178"> show
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><!--[--><div class="highlight-text prose-code" data-v-4578ab24=""><!----><!--[--><pre class="language-text" style=""><!--[--><code>192.168.178.15 dev eth0 lladdr XX:XX:XX:XX:XX:XX REACHABLE 
</code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->If theres no entry for <code class="prose-code-inline" data-v-a031129a=""><!--[-->192.168.178.15<!--]--></code>, populate it with:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> ping</span><span style="--shiki-default:#CE9178"> -c1</span><span style="--shiki-default:#B5CEA8"> 192.168.178.15
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->Now, verify that the MAC address (<code class="prose-code-inline" data-v-a031129a=""><!--[-->XX:XX:XX:XX:XX:XX<!--]--></code>) matches the load balancers MAC address (from the <code class="prose-code-inline" data-v-a031129a=""><!--[-->lb<!--]--></code> tab) using:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">ip</span><span style="--shiki-default:#CE9178"> link</span><span style="--shiki-default:#CE9178"> show</span><span style="--shiki-default:#CE9178"> eth0
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><!--[--><div class="highlight-text prose-code" data-v-4578ab24=""><!----><!--[--><pre class="language-text" style=""><!--[--><code>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether XX:XX:XX:XX:XX:XX brd ff:ff:ff:ff:ff:ff
</code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><!--]--></details><!--]--></div><p class="prose-p" data-v-b025fb9f=""><!--[-->We're
 almost ready for the next step, but just like with the NAT load 
balancer, we first need to enable IP forwarding on our load balancer (<code class="prose-code-inline" data-v-a031129a=""><!--[-->lb<!--]--></code> tab) and populate the ARP table so that <code class="prose-code-inline" data-v-a031129a=""><!--[-->bpf_fib_lookup<!--]--></code> can resolve packet destinations:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> sysctl</span><span style="--shiki-default:#CE9178"> -w</span><span style="--shiki-default:#CE9178"> net.ipv4.ip_forward=</span><span style="--shiki-default:#B5CEA8">1
</span></span><span class="line" line="2"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> ping</span><span style="--shiki-default:#CE9178"> -c1</span><span style="--shiki-default:#B5CEA8"> 192.168.178.11</span><span style="--shiki-default:#6A9955"> # backend-01 node/real IP
</span></span><span class="line" line="3"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> ping</span><span style="--shiki-default:#CE9178"> -c1</span><span style="--shiki-default:#B5CEA8"> 192.168.178.12</span><span style="--shiki-default:#6A9955"> # backend-02 node/real IP
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><div class="border-[2px] my-[24px] px-6 py-0 rounded-lg border-primary/50 bg-[#f7fbfe]" data-v-370f298d=""><!--[--><details data-v-370f298d=""><summary class="cursor-pointer my-3 select-none text-[#4078c0]" data-v-370f298d="">Forgot why this is necessary?</summary><!--[--><p class="prose-p" data-v-b025fb9f=""><!--[-->Enabling IP forwarding allows the load balancer to route packets between interfacesin other words, to act as a router.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->Meanwhile, populating the ARP table ensures that <code class="prose-code-inline" data-v-a031129a=""><!--[-->bpf_fib_lookup()<!--]--></code> in our eBPF code can find the correct next-hop information in the kernels routing tables.<!--]--></p><!--]--></details><!--]--></div><h3 id="rewriting-mac-addresses" class="prose-h3" data-v-9a0ceb30=""><!--[-->Rewriting MAC Addresses<!--]--><!----></h3><p class="prose-p" data-v-b025fb9f=""><!--[-->Now we understand how we avoid the client getting confused by receiving a response from always the same IP.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[--><strong class="prose-strong" data-v-24022f14=""><!--[-->But
 we still haven't yet addressed how does then load balancer knows to 
which backend to send the traffic to - especially now when they share 
the (same) VIP.<!--]--></strong><!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->As
 mentioned above, in L2 DSR Load balancing we actually only need to 
update MAC addresses in the load balancer, such that the packets are 
correctly delivered at Layer 2.<!--]--></p><!--[--><div class="highlight-c prose-code" meta="" data-v-4578ab24=""><span class="filename" data-v-4578ab24="">lab/lb.c</span><!--[--><pre class="language-c shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#E6E6E6">  ...
</span></span><span class="line" line="2"><span style="--shiki-default:#6A9955">  // Choose backend using simple hashing
</span></span><span class="line" line="3"><span style="--shiki-default:#569CD6">  struct</span><span style="--shiki-default:#4EC9B0"> four_tuple_t</span><span style="--shiki-default:#E6E6E6"> four_tuple;
</span></span><span class="line" line="4"><span style="--shiki-default:#E6E6E6">  four_tuple.src_ip </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> ip</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">saddr;
</span></span><span class="line" line="5"><span style="--shiki-default:#E6E6E6">  four_tuple.dst_ip </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> ip</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">daddr;
</span></span><span class="line" line="6"><span style="--shiki-default:#E6E6E6">  four_tuple.src_port </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> tcp</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">source;
</span></span><span class="line" line="7"><span style="--shiki-default:#E6E6E6">  four_tuple.dst_port </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> tcp</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">dest;
</span></span><span class="line" line="8"><span style="--shiki-default:#E6E6E6">  four_tuple.protocol </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> IPPROTO_TCP;
</span></span><span class="line" line="9"><span style="--shiki-default:#E6E6E6">  __u32 key </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#DCDCAA"> xdp_hash_tuple</span><span style="--shiki-default:#E6E6E6">(</span><span style="--shiki-default:#D4D4D4">&amp;</span><span style="--shiki-default:#9CDCFE">four_tuple</span><span style="--shiki-default:#E6E6E6">) </span><span style="--shiki-default:#D4D4D4">%</span><span style="--shiki-default:#E6E6E6"> NUM_BACKENDS;
</span></span><span class="line" line="10"><span style="--shiki-default:#569CD6">  struct</span><span style="--shiki-default:#E6E6E6"> endpoint </span><span style="--shiki-default:#D4D4D4">*</span><span style="--shiki-default:#E6E6E6">backend </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#DCDCAA"> bpf_map_lookup_elem</span><span style="--shiki-default:#E6E6E6">(</span><span style="--shiki-default:#D4D4D4">&amp;</span><span style="--shiki-default:#9CDCFE">backends</span><span style="--shiki-default:#E6E6E6">, </span><span style="--shiki-default:#D4D4D4">&amp;</span><span style="--shiki-default:#9CDCFE">key</span><span style="--shiki-default:#E6E6E6">);
</span></span><span class="line" line="11"><span style="--shiki-default:#C586C0">  if</span><span style="--shiki-default:#E6E6E6"> (</span><span style="--shiki-default:#D4D4D4">!</span><span style="--shiki-default:#E6E6E6">backend) {
</span></span><span class="line" line="12"><span style="--shiki-default:#C586C0">    return</span><span style="--shiki-default:#E6E6E6"> XDP_ABORTED;
</span></span><span class="line" line="13"><span style="--shiki-default:#E6E6E6">  }
</span></span><span class="line" line="14"><span emptylineplaceholder="true">
</span></span><span class="line" line="15"><span style="--shiki-default:#6A9955">  // Perform a FIB lookup
</span></span><span class="line" line="16"><span style="--shiki-default:#569CD6">  struct</span><span style="--shiki-default:#E6E6E6"> bpf_fib_lookup fib </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> {};
</span></span><span class="line" line="17"><span style="--shiki-default:#569CD6">  int</span><span style="--shiki-default:#E6E6E6"> rc </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#DCDCAA"> fib_lookup_v4_full</span><span style="--shiki-default:#E6E6E6">(ctx, </span><span style="--shiki-default:#D4D4D4">&amp;</span><span style="--shiki-default:#9CDCFE">fib</span><span style="--shiki-default:#E6E6E6">, ip</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#9CDCFE">daddr</span><span style="--shiki-default:#E6E6E6">, backend</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#9CDCFE">ip</span><span style="--shiki-default:#E6E6E6">,
</span></span><span class="line" line="18"><span style="--shiki-default:#DCDCAA">                              bpf_ntohs</span><span style="--shiki-default:#E6E6E6">(ip</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#9CDCFE">tot_len</span><span style="--shiki-default:#E6E6E6">));
</span></span><span class="line" line="19"><span style="--shiki-default:#C586C0">  if</span><span style="--shiki-default:#E6E6E6"> (rc </span><span style="--shiki-default:#D4D4D4">!=</span><span style="--shiki-default:#E6E6E6"> BPF_FIB_LKUP_RET_SUCCESS) {
</span></span><span class="line" line="20"><span style="--shiki-default:#DCDCAA">    log_fib_error</span><span style="--shiki-default:#E6E6E6">(rc);
</span></span><span class="line" line="21"><span style="--shiki-default:#C586C0">    return</span><span style="--shiki-default:#E6E6E6"> XDP_ABORTED;
</span></span><span class="line" line="22"><span style="--shiki-default:#E6E6E6">  }
</span></span><span class="line" line="23"><span emptylineplaceholder="true">
</span></span><span class="line highlight" line="24"><span style="--shiki-default:#6A9955">  // We only need to update MAC addresses
</span></span><span class="line highlight" line="25"><span style="--shiki-default:#6A9955">  // Backend needs to have a virtual IP on the lo (same one as load balancer)
</span></span><span class="line highlight" line="26"><span style="--shiki-default:#6A9955">  // The source IP is retained as client, so backend will respond directly to it
</span></span><span class="line highlight" line="27"><span style="--shiki-default:#DCDCAA">  __builtin_memcpy</span><span style="--shiki-default:#E6E6E6">(eth</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#9CDCFE">h_source</span><span style="--shiki-default:#E6E6E6">, fib.smac, ETH_ALEN);
</span></span><span class="line highlight" line="28"><span style="--shiki-default:#DCDCAA">  __builtin_memcpy</span><span style="--shiki-default:#E6E6E6">(eth</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#9CDCFE">h_dest</span><span style="--shiki-default:#E6E6E6">, fib.dmac, ETH_ALEN);
</span></span><span class="line" line="29"><span style="--shiki-default:#E6E6E6">  ...
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><div class="border-[2px] my-[24px] px-6 py-0 rounded-lg border-primary/50 bg-[#f7fbfe]"><!--[--><p class="prose-p" data-v-b025fb9f=""><!--[--> The simple hashing implementation (<code class="prose-code-inline" data-v-a031129a=""><!--[-->xdp_hash_tuple<!--]--></code> function) is the same as in the previous NAT load balancer coding lab.<!--]--></p><!--]--></div><p class="prose-p" data-v-b025fb9f=""><!--[-->The
 cool thing here is that theres no need to maintain any 
connection-tracking state in the load balancer (unlike a NAT load 
balancer). We simply redirect the packet to the selected backend 
nodebased on MAC addresses retrieved via <code class="prose-code-inline" data-v-a031129a=""><!--[-->bpf_fib_lookup<!--]--></code> in <code class="prose-code-inline" data-v-a031129a=""><!--[-->fib_lookup_v4_full<!--]--></code>and the backend responds directly to the client based on the IP header.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->The
 load balancer doesnt even touch the IP header, meaning the backend 
still receives the original client source IP and can reply directly to 
it, bypassing the load balancer.<!--]--></p><div class="border-[2px] my-[24px] px-6 py-0 rounded-lg border-primary/50 bg-[#f7fbfe]" data-v-370f298d=""><!--[--><details data-v-370f298d=""><summary class="cursor-pointer my-3 select-none text-[#4078c0]" data-v-370f298d="">The funny thing about source MAC address</summary><!--[--><p class="prose-p" data-v-b025fb9f=""><!--[-->If
 you look at most (if not all) DSR tutorials, they claim you only need 
to update the destination MAC address for L2 DSR to work.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->But
 thats only partially true  those examples actually rely on the 
kernels networking stack to build the correct Ethernet header.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->With
 eBPF, we "operate below the kernel networking stack", so it doesnt 
handle that for us. As a result, we also need to update the source MAC 
address manually.<!--]--></p><!--]--></details><!--]--></div><p class="prose-p" data-v-b025fb9f=""><!--[-->Let's see this in action.<!--]--></p><h2 id="running-the-load-balancer" class="prose-h2" data-v-b9b1576a=""><!--[-->Running the Load Balancer<!--]--><!----></h2><div class="border-[2px] my-[24px] px-6 py-0 rounded-lg border-warning bg-[#fdeee5]"><!--[--><p class="prose-p" data-v-b025fb9f=""><!--[-->
 Before moving on, make sure the VIP is configured on both the load 
balancer and the backend nodes as described above, and that the ARP 
table is populated on the load balancer.<!--]--></p><!--]--></div><p class="prose-p" data-v-b025fb9f=""><!--[-->Spawn the HTTP Server on both backends (<code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-01<!--]--></code> and <code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-02<!--]--></code> tabs), explicitly binded to listen for requests on VIP:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">python3</span><span style="--shiki-default:#CE9178"> -m</span><span style="--shiki-default:#CE9178"> http.server</span><span style="--shiki-default:#B5CEA8"> 8000</span><span style="--shiki-default:#CE9178"> --bind</span><span style="--shiki-default:#B5CEA8"> 192.168.178.15
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->Compile and run the load balancer (in the <code class="prose-code-inline" data-v-a031129a=""><!--[-->lb<!--]--></code> tab under the <code class="prose-code-inline" data-v-a031129a=""><!--[-->lab<!--]--></code> directory), using:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">go</span><span style="--shiki-default:#CE9178"> generate
</span></span><span class="line" line="2"><span style="--shiki-default:#DCDCAA">go</span><span style="--shiki-default:#CE9178"> build
</span></span><span class="line" line="3"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> ./lb</span><span style="--shiki-default:#CE9178"> -i</span><span style="--shiki-default:#CE9178"> eth0</span><span style="--shiki-default:#CE9178"> --backends</span><span style="--shiki-default:#CE9178"> 192.168.178.11,192.168.178.12
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><div class="border-[2px] my-[24px] px-6 py-0 rounded-lg border-primary/50 bg-[#f7fbfe]" data-v-370f298d=""><!--[--><details data-v-370f298d=""><summary class="cursor-pointer my-3 select-none text-[#4078c0]" data-v-370f298d="">What are these input parameters?</summary><!--[--><p class="prose-p" data-v-b025fb9f=""><!--[--><code class="prose-code-inline" data-v-a031129a=""><!--[-->-i<!--]--></code> expects the network interface on which this XDP Load Balancer program will run.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[--><code class="prose-code-inline" data-v-a031129a=""><!--[-->-backends<!--]--></code> expects the list of backend IPs in this playground<!--]--></p><!--]--></details><!--]--></div><p class="prose-p" data-v-b025fb9f=""><!--[-->Now you can query the VIP from the <code class="prose-code-inline" data-v-a031129a=""><!--[-->client<!--]--></code> tab, using:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">curl</span><span style="--shiki-default:#CE9178"> http://192.168.178.15:8000
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->and confirm that the request is indeed on the HTTP server received from the client (IP at the beginning of the line):<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">10.0.0.20</span><span style="--shiki-default:#CE9178"> -</span><span style="--shiki-default:#CE9178"> -</span><span style="--shiki-default:#E6E6E6"> [01/Jan/2026 </span><span style="--shiki-default:#CE9178">16:03:45]</span><span style="--shiki-default:#CE9178"> "GET / HTTP/1.1"</span><span style="--shiki-default:#B5CEA8"> 200</span><span style="--shiki-default:#CE9178"> -
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><div class="border-[2px] my-[24px] px-6 py-0 rounded-lg border-primary/50 bg-[#f7fbfe]"><!--[--><p class="prose-p" data-v-b025fb9f=""><!--[-->But to be absolutely sure the request in fact goes through the load balancer, run <code class="prose-code-inline" data-v-a031129a=""><!--[-->tcpdump<!--]--></code> on both backends and view the MAC addresses:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> tcpdump</span><span style="--shiki-default:#CE9178"> -i</span><span style="--shiki-default:#CE9178"> eth0</span><span style="--shiki-default:#CE9178"> -n</span><span style="--shiki-default:#CE9178"> -t</span><span style="--shiki-default:#CE9178"> -e</span><span style="--shiki-default:#CE9178"> -q</span><span style="--shiki-default:#CE9178"> tcp</span><span style="--shiki-default:#CE9178"> port</span><span style="--shiki-default:#B5CEA8"> 8000
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->You should see output similar to the following (simplified for clarity to highlight the DSR flow):<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">LB_MAC</span><span style="--shiki-default:#D4D4D4"> &gt;</span><span style="--shiki-default:#CE9178"> BACKEND_MAC,</span><span style="--shiki-default:#CE9178"> IPv4,</span><span style="--shiki-default:#CE9178"> length</span><span style="--shiki-default:#CE9178"> 74:</span><span style="--shiki-default:#CE9178"> CLIENT_IP/PORT</span><span style="--shiki-default:#D4D4D4"> &gt;</span><span style="--shiki-default:#CE9178"> BACKEND_IP/PORT:</span><span style="--shiki-default:#CE9178"> tcp</span><span style="--shiki-default:#B5CEA8"> 0</span><span style="--shiki-default:#6A9955"> # LB -&gt; Backend (while retaining client source IP)
</span></span><span class="line" line="2"><span style="--shiki-default:#DCDCAA">BACKEND_MAC</span><span style="--shiki-default:#D4D4D4"> &gt;</span><span style="--shiki-default:#CE9178"> GATEWAY_MAC,</span><span style="--shiki-default:#CE9178"> IPv4,</span><span style="--shiki-default:#CE9178"> length</span><span style="--shiki-default:#CE9178"> 74:</span><span style="--shiki-default:#CE9178"> BACKEND_IP/PORT</span><span style="--shiki-default:#D4D4D4"> &gt;</span><span style="--shiki-default:#CE9178"> CLIENT_IP/PORT:</span><span style="--shiki-default:#CE9178"> tcp</span><span style="--shiki-default:#B5CEA8"> 0</span><span style="--shiki-default:#6A9955"> # Backend -&gt; Gatewat (where the client IP is the destination)
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->Or just check the load balancer logs (in the <code class="prose-code-inline" data-v-a031129a=""><!--[-->lb<!--]--></code>) using:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> bpftool</span><span style="--shiki-default:#CE9178"> prog</span><span style="--shiki-default:#CE9178"> trace
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><!--]--></div><hr class="prose-hr" data-v-34b8dd49=""><p class="prose-p" data-v-b025fb9f=""><!--[--><strong class="prose-strong" data-v-24022f14=""><!--[-->But
 this only really works when the load balancer and the backends are on 
the same subnetwork (i.e., have direct L2 connectivity).<!--]--></strong><!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->Just imagine if the load balancer tried to redirect traffic to a backend in a different L2 network.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->It
 would set the destination MAC address to the gateways interface 
(trying to exit current L2 network), and since only the VIP on the load 
balancer is advertised across the network, the gateway would send the 
packet back to the load balancerbecause thats the only route it knows 
for that VIPcausing a loop.<!--]--></p><div class="bg-base-100" style="padding:0;margin:30px auto;max-width:800px;"><div class="text-center"><img src="Building%20an%20eBPF_XDP%20L2%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/failure.webp" alt="Problem of XDP DSR L2 Load Balancing" class="cursor-pointer m-0 max-w-full" style=""><!--[--><!--]--></div><!----></div><p class="prose-p" data-v-b025fb9f=""><!--[-->And this is quite a constraint for many setups to require the backends to share the same network as the load balancer.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->Not
 to mention, hosting the load balancer and backend nodes on the same 
subnetwork also increases the risk of complete failures - network down 
 everything down.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->This is where IPIP DSR Load balancing comes into play - but more about that in the upcoming tutorial.<!--]--></p><style nonce="">html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}</style></div><!----></div></div><!--]--><div class="px-4 md:px-8 xl:px-12 mt-auto" data-v-200caef3=""><!--[--><div class="bg-frost-light border-[2px] border-primary/30 flex flex-wrap gap-6 items-center px-6 py-6 rounded-lg my-10" data-v-0d30d5a9=""><p class="basis-[480px] grow my-0 py-0 text-slate-700 text-xl"><!--[--> Level up your Server Side game  Join 20,000 engineers who receive insightful learning materials straight to their inbox <!--]--></p><div class="basis-[150px] flex flex-wrap gap-x-5 gap-y-2 grow min-w-[150px]"><input class="focus:ring-0 grow-[4] input input-bordered min-w-[150px]" placeholder="Email" data-ddg-inputtype="identities.emailAddress" data-ddg-autofill="true" style="background-size: auto 24px !important; background-position: right center !important; background-repeat: no-repeat !important; background-origin: content-box !important; background-image: url(&quot;data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTY0IDEyOEM5OS4zNTg2IDEyOCAxMjggOTkuMzU4NiAxMjggNjRDMTI4IDI4LjY0MTQgOTkuMzU4NiAwIDY0IDBDMjguNjQxNCAwIDAgMjguNjQxNCAwIDY0QzAgOTkuMzU4NiAyOC42NDE0IDEyOCA2NCAxMjhaIiBmaWxsPSIjNDQ0NDQ0Ii8+CiAgICA8cGF0aCBkPSJNNzYuOTk5MSA1Mi4yMTM3Qzc3LjQ5NjYgNTIuMjEzNyA3Ny45MDA5IDUxLjgwOTQgNzcuOTAwOSA1MS4zMTE4Qzc3LjkwMDkgNTAuODE0MyA3Ny40OTY2IDUwLjQxIDc2Ljk5OTEgNTAuNDFDNzYuNTAxNSA1MC40MSA3Ni4wOTcyIDUwLjgxNDMgNzYuMDk3MiA1MS4zMTE4Qzc2LjA5NzIgNTEuODA5NCA3Ni41MDE1IDUyLjIxMzcgNzYuOTk5MSA1Mi4yMTM3WiIgZmlsbD0id2hpdGUiLz4KICAgIDxwYXRoIGQ9Ik01MC4xOTI0IDU0LjU0NkM1MC43ODMzIDU0LjU0NiA1MS4yNDk3IDU0LjA3OTYgNTEuMjQ5NyA1My40ODg3QzUxLjI0OTcgNTIuODk3OCA1MC43ODMzIDUyLjQzMTQgNTAuMTkyNCA1Mi40MzE0QzQ5LjYwMTUgNTIuNDMxNCA0OS4xMzUxIDUyLjg5NzggNDkuMTM1MSA1My40ODg3QzQ5LjEzNTEgNTQuMDc5NiA0OS42MDE1IDU0LjU0NiA1MC4xOTI0IDU0LjU0NloiIGZpbGw9IndoaXRlIi8+CiAgICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTEyMi43NSA2NEMxMjIuNzUgOTYuNDQ2OCA5Ni40NDY3IDEyMi43NSA2NCAxMjIuNzVDMzEuNTUzMyAxMjIuNzUgNS4yNSA5Ni40NDY4IDUuMjUgNjRDNS4yNSAzMS41NTMzIDMxLjU1MzMgNS4yNSA2NCA1LjI1Qzk2LjQ0NjcgNS4yNSAxMjIuNzUgMzEuNTUzMyAxMjIuNzUgNjRaTTQ2Ljc4MzcgMTE0LjkzNEM0NS41MjI5IDExMC41NTggNDIuNjQzNCAxMDAuMjYgMzguMjUwNyA4Mi42NTlDMzEuOTM3OCA1Ny4zNzYyIDI3LjI0MTkgMzYuNzU4MSA1MC45Mzg3IDMwLjMyMDhDNTEuMTg3NSAzMC4yNTg2IDUxLjI4MDggMjkuOTc4NyA1MS4wOTQyIDI5LjgyMzJDNDguMzU3NiAyNy4zMzUzIDQzLjcyNCAyNi45IDM5LjE4MzYgMjcuODAxOEMzOC45NjU5IDI3LjgzMjkgMzguODEwNSAyNy42Nzc0IDM4LjgxMDUgMjcuNDkwOEMzOC44MTA1IDI3LjQyODYgMzguODEwNSAyNy4zNjY0IDM4Ljg3MjYgMjcuMzA0MkMzOS45NjExIDI1Ljc4MDQgNDEuOTIwMyAyNC41OTg3IDQzLjI1NzUgMjMuODgzNEM0Mi4zMjQ1IDIzLjA0MzggNDEuMDgwNiAyMi40ODQgNDAuMDIzMyAyMi4xMTA5QzM5LjcxMjMgMjEuOTg2NSAzOS43MTIzIDIxLjQ1NzggMzkuOTkyMiAyMS4zMzM0QzQwLjAyMzMgMjEuMzAyMyA0MC4wNTQ0IDIxLjI3MTIgNDAuMTE2NiAyMS4yNzEyQzQ5LjQ0NiAyMC4wMjczIDU5LjI0MTkgMjIuODI2MSA2NC4wNjIyIDI4Ljk4MzVDNjQuMTI0MyAyOS4wNDU3IDY0LjE4NjUgMjkuMDc2OCA2NC4yNDg3IDI5LjEwNzlDODAuMDc3NyAzMi40OTc2IDgyLjk2OTggNTQuOTE5NCA4Mi4wMDU4IDYxLjEwNzlDODcuNTcyNCA2MC40NTQ5IDkxLjczOTUgNTkuMDg2NiA5NC41MDcyIDU4LjAyOTJDOTguNDg3OCA1Ni41MDU0IDk5Ljg4NzIgNTYuODQ3NSAxMDAuMzg1IDU3Ljc0OTNDMTAwLjkxMyA1OC43NzU2IDEwMC4yOTIgNjAuNDg2IDk4Ljg5MjEgNjIuMDcyQzk2LjI0ODcgNjUuMDg4NSA5MS40NTk2IDY3LjQ1MiA4My4wMzIgNjguMTM2MUM4MC4xMTg5IDY4LjM3MjYgNzcuNTQ0IDY4LjI1OTggNzUuMzIyNSA2OC4xNjI1QzcxLjExNzQgNjcuOTc4NCA2OC4xNzkxIDY3Ljg0OTcgNjYuNjEyMiA3MC4yNTA4QzY1LjU4NiA3MS44MzY4IDY2LjM5NDUgNzUuNTY4NiA3NC41NDIyIDc2Ljc1MDNDODAuMzU4NiA3Ny41ODgzIDg1LjYyODEgNzcuMDAyNiA4OS40NzAxIDc2LjU3NTVDOTIuODk5OCA3Ni4xOTQzIDk1LjE5MiA3NS45Mzk1IDk1LjcyMDEgNzYuOTM2OUM5Ni44Mzk2IDc5LjA4MjcgOTAuNDAyMyA4My4zNzQyIDc5LjM2MjQgODMuNDY3NUM3OC41MjI4IDgzLjQ2NzUgNzcuNjgzMSA4My40MzY0IDc2Ljg3NDYgODMuNDA1M0M3MC4wMzMgODMuMDYzMyA2NC45OTUxIDgxLjE5NzQgNjEuODU0MiA3OS40ODdDNjEuNzYwOSA3OS40NTU5IDYxLjY5ODcgNzkuNDI0OCA2MS42Njc2IDc5LjM5MzdDNjEuMTA3OCA3OS4wODI3IDYwLjAxOTQgNzkuNjQyNCA2MC42NzI1IDgwLjgyNDJDNjEuMDQ1NiA4MS41Mzk0IDYzLjAzNTkgODMuMzc0MiA2Ni4wMjEzIDg0Ljk2MDJDNjUuNzEwNCA4Ny40NDgxIDY2LjQ4NzggOTEuMjczMiA2Ny44MjUgOTUuNjI2OUM2Ny45ODA0IDk1LjYwMSA2OC4xMzU3IDk1LjU2OTcgNjguMjk1NSA5NS41Mzc2QzY4LjUxOTYgOTUuNDkyNCA2OC43NTI2IDk1LjQ0NTUgNjkuMDA2OCA5NS40MDkyQzcxLjcxMjMgOTQuOTczOCA3My4xNDI4IDk1LjQ3MTQgNzMuOTUxNCA5Ni4zNDIyQzc3Ljc3NjQgOTMuNDgxMSA4NC4xNTE2IDg5LjQzODQgODQuNzczNSA5MC4xODQ3Qzg3Ljg4MzMgOTMuODg1NCA4OC4yODc2IDEwMi42MjQgODcuNjAzNSAxMDYuMTM4Qzg3LjU3MjQgMTA2LjIgODcuNTEwMiAxMDYuMjYyIDg3LjM4NTggMTA2LjMyNUM4NS45MjQyIDEwNi45NDcgNzcuODY5OCAxMDQuNzQ2IDc3Ljg2OTggMTAzLjU5NkM3Ny41NTg4IDk3Ljg2NiA3Ni40OTM3IDk3LjMzNzMgNzUuMjQ5OCA5Ny4wNTc0SDc0LjQxNzhDNzQuNDQ4OSA5Ny4wODg1IDc0LjQ4IDk3LjE1MDcgNzQuNTExMSA5Ny4yMTI5TDc0Ljc5MSA5Ny44NjZDNzUuMjg4NiA5OS4yMzQzIDc2LjA2NiAxMDMuNTI2IDc1LjQ3NTIgMTA0LjU4M0M3NC44ODQzIDEwNS42NDEgNzEuMDI4MSAxMDYuMTY5IDY4LjYzMzYgMTA2LjJDNjYuMjcwMSAxMDYuMjMxIDY1Ljc0MTUgMTA1LjM2MSA2NS4yNDM5IDEwNC4wMjNDNjQuODcwNyAxMDIuOTM1IDY0LjY4NDEgMTAwLjQxNiA2NC42ODQxIDk4Ljk1NDRDNjQuNjUzIDk4LjUxOSA2NC42ODQxIDk4LjE0NTkgNjQuNzQ2MyA5Ny44MDM4QzY0LjAzMTEgOTguMTE0OCA2Mi45ODE2IDk4LjgzIDYyLjYzOTUgOTkuMjk2NEM2Mi41NDYyIDEwMC42OTYgNjIuNTQ2MiAxMDIuOTM1IDYzLjI5MjUgMTA1LjQyM0M2My42NjU3IDEwNi42MDUgNTUuMTk5MiAxMTEuNjQyIDU0LjAxNzQgMTEwLjcxQzUyLjgwNDYgMTA5Ljc0NSA1MC42Mjc4IDEwMC4yOTIgNTEuNTYwNyA5Ni40NjY2QzUwLjU2NTYgOTYuNTU5OSA0OS43NTcgOTYuODcwOCA0OS4zMjE2IDk3LjQ5MjhDNDcuMzYyNCAxMDAuMTk4IDQ5LjgxOTIgMTEzLjEzNSA1Mi40MzE0IDExNC44MTRDNTMuNzk5OCAxMTUuNzE2IDYwLjY0MTQgMTExLjg2IDY0LjAzMTEgMTA4Ljk2OEM2NC41OTA4IDEwOS43NDUgNjUuNjYzOCAxMDkuODA4IDY2Ljk4NTQgMTA5LjgwOEM2OC43MjY5IDEwOS43NDUgNzEuMTUyNSAxMDkuNDk3IDcyLjg2MjkgMTA4Ljk2OEM3My44ODY3IDExMS4zNjcgNzUuMTIxOSAxMTQuMTU3IDc2LjEzNTMgMTE2LjM3NEM5OS45NzU5IDExMC44NzMgMTE3Ljc1IDg5LjUxMjEgMTE3Ljc1IDY0QzExNy43NSAzNC4zMTQ3IDkzLjY4NTMgMTAuMjUgNjQgMTAuMjVDMzQuMzE0NyAxMC4yNSAxMC4yNSAzNC4zMTQ3IDEwLjI1IDY0QzEwLjI1IDg3LjY2NCAyNS41NDIzIDEwNy43NTYgNDYuNzgzNyAxMTQuOTM0Wk03Ny4xMjc1IDQyLjUxOThDNzcuMTY4IDQyLjUzNzkgNzcuMjA4MSA0Mi41NTU4IDc3LjI0NzggNDIuNTczNEM3Ny40NjU1IDQyLjY2NjcgNzcuNzE0MiA0Mi40MTggNzcuNTU4NyA0Mi4yMzE0Qzc2Ljg0MzUgNDEuMjY3MyA3NS43ODYyIDQwLjM2NTUgNzMuNTQ3MSA0MC4zNjU1QzcxLjMwOCA0MC4zNjU1IDY5LjkzOTcgNDEuMTQyOSA2OS4zMTc3IDQyLjEzODFDNjkuMTkzMyA0Mi4zODY5IDY5LjU2NjUgNDIuNjM1NiA2OS44MTUzIDQyLjUxMTJDNzAuNTYxNyA0Mi4xMDcgNzEuNzEyMyA0MS42NDA1IDczLjU0NzEgNDEuNjcxNkM3NS4yOTUyIDQxLjcwMTIgNzYuMzA5NCA0Mi4xNTQzIDc3LjEyNzUgNDIuNTE5OFpNNzUuNDQ0MSA1NS45MTQ2Qzc3LjM3MjIgNTUuOTE0NiA3OC45MjcxIDU0LjM1OTYgNzguOTI3MSA1Mi40NjI3Qzc4LjkyNzEgNTAuNTM0NiA3Ny4zNzIyIDQ5LjAxMDggNzUuNDQ0MSA0OS4wMTA4QzczLjUxNiA0OS4wMTA4IDcxLjk2MTEgNTAuNTY1NyA3MS45NjExIDUyLjQ2MjdDNzEuOTYxMSA1NC4zNTk2IDczLjUxNiA1NS45MTQ2IDc1LjQ0NDEgNTUuOTE0NlpNNTIuNDMxNCA1NC44NTcyQzUyLjQzMTQgNTIuNjE4MSA1MC42Mjc4IDUwLjgxNDUgNDguMzg4NyA1MC44MTQ1QzQ2LjE0OTYgNTAuODE0NSA0NC4zMTQ4IDUyLjYxODEgNDQuMzQ1OSA1NC44NTcyQzQ0LjM0NTkgNTcuMDk2MyA0Ni4xNDk2IDU4LjkgNDguMzg4NyA1OC45QzUwLjYyNzggNTguOSA1Mi40MzE0IDU3LjA5NjMgNTIuNDMxNCA1NC44NTcyWk00MC44NjI5IDQ1Ljk2MzFDNDEuMjk4MyA0NS4zMTAxIDQxLjk4MjUgNDQuMzE0OSA0NC4xNTkzIDQzLjQxMzFDNDYuMzM2MiA0Mi41MTEyIDQ4LjA0NjYgNDIuNjM1NiA0OS4yMjgzIDQyLjkxNTVDNDkuNDc3MSA0Mi45Nzc3IDQ5LjY2MzcgNDIuNjk3OCA0OS40NDYgNDIuNTQyM0M0OC41MTMxIDQxLjc2NDkgNDYuNDI5NSA0MC44MzE5IDQzLjY5MjkgNDEuODU4MkM0MS4yNjcyIDQyLjc2IDQwLjExNjYgNDQuNjU3IDQwLjExNjYgNDUuOTAwOUM0MC4xMTY2IDQ2LjE4MDggNDAuNzA3NCA0Ni4yMTE5IDQwLjg2MjkgNDUuOTYzMVoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPg==&quot;) !important; transition: background !important;"><button type="button" class="btn relative btn-primary grow min-w-[150px]"><div class="flex grow items-center justify-center"><!--[--> Subscribe <!--]--></div><!----></button></div></div><!--]--></div><!--]--></div><!--[--><!--]--></div><!--]--></article><!--]--></div></div><!--[--><!----><div class="hidden duration-300 ease-in-out h-[calc(100vh-3rem)] lg:pb-[3px] overflow-y-auto pb-14 pl-[3px] pr-[3px] pt-1.5 scrollbar-styled top-[3rem] transition-[flex-basis]"><!--[--><!--]--></div><!--]--></div><dialog id="contentEditDialog-tutorial-xdp-dsr-layer2-lb-92b02f3e" class="modal" data-v-0d30d5a9=""><form method="dialog" class="lg:max-w-3xl modal-box overflow-hidden p-0 relative scrollbar-hidden"><button class="absolute btn btn-circle btn-ghost btn-xs hover:rotate-90 right-2 top-2 transition-transform z-10">  </button><div class="max-h-[calc(100vh-8rem)] overflow-y-auto px-8 py-6 scrollbar-hidden"><h3 class="font-bold mb-2 text-lg"> How to Author Tutorials on iximiuz Labs</h3><p class="py-3 text-base-content/90"> Instead of providing a subpar online editing experience, iximiuz Labs offers a helper CLI tool called <a href="https://github.com/iximiuz/labctl" rel="noopener noreferrer" target="_blank noopener noreferrer" class="link">labctl</a>,
 allowing you to use your favorite text editor (or a full-featured IDE) 
to write content from the comfort of your local machine. </p><div class="flex flex-col gap-y-6 mt-4"><div class="bg-frost-light border border-primary/50 hover:shadow-md p-5 rounded-xl shadow-sm transition-all"><h4 class="flex font-semibold items-center mb-4"> Install labctl CLI </h4><div class="bg-base-content flex items-center justify-between px-3 py-2 rounded-md my-2"><div class="flex grow min-w-0"><code class="break-all md:break-normal md:truncate text-base-200 text-sm"><!--[--> curl -sf https://labs.iximiuz.com/cli/install.sh | sh <!--]--></code></div><button type="button" class="btn relative bg-base-content border-base-content btn-sm btn-square hover:bg-base-content hover:border-base-300/20 hover:text-base-100 text-base-200"><div class="flex grow items-center justify-center"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:22px;" width="1em" height="1em" viewBox="0 0 256 256"><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg><!--]--></div><!----></button></div><p class="italic mt-3 text-base-content/90 text-sm"> This will download and install the latest version of the labctl CLI. You only need to do this once per workstation. </p></div><div class="bg-frost-light border border-primary/50 hover:shadow-md p-5 rounded-xl shadow-sm transition-all"><h4 class="flex font-semibold items-center mb-4"> Authorize labctl </h4><div class="bg-base-content flex items-center justify-between px-3 py-2 rounded-md my-2"><div class="flex grow min-w-0"><code class="break-all md:break-normal md:truncate text-base-200 text-sm"><!--[--> labctl auth login <!--]--></code></div><button type="button" class="btn relative bg-base-content border-base-content btn-sm btn-square hover:bg-base-content hover:border-base-300/20 hover:text-base-100 text-base-200"><div class="flex grow items-center justify-center"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:22px;" width="1em" height="1em" viewBox="0 0 256 256"><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg><!--]--></div><!----></button></div><p class="italic mt-3 text-base-content/90 text-sm">
 This will open a browser window asking you to authorize labctl to 
access your account. You need to do it after a fresh install of labctl 
and repeat it whenever the auth session expires. </p></div><div class="bg-frost-light border border-primary/50 hover:shadow-md p-5 rounded-xl shadow-sm transition-all"><h4 class="flex font-semibold items-center mb-4"> Pull tutorial content </h4><div class="bg-base-content flex items-center justify-between px-3 py-2 rounded-md my-2"><div class="flex grow min-w-0"><code class="break-all md:break-normal md:truncate text-base-200 text-sm"><!--[--> labctl content pull tutorial xdp-dsr-layer2-lb-92b02f3e<!--]--></code></div><button type="button" class="btn relative bg-base-content border-base-content btn-sm btn-square hover:bg-base-content hover:border-base-300/20 hover:text-base-100 text-base-200"><div class="flex grow items-center justify-center"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:22px;" width="1em" height="1em" viewBox="0 0 256 256"><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg><!--]--></div><!----></button></div><p class="italic mt-3 text-base-content/90 text-sm"> This will create a local copy of the tutorial content in a directory named <code class="bg-base-300 px-1 py-0.5 rounded">xdp-dsr-layer2-lb-92b02f3e</code>. You only need to do this once per tutorial. </p></div><div class="bg-frost-light border border-primary/50 hover:shadow-md p-5 rounded-xl shadow-sm transition-all"><h4 class="flex font-semibold items-center mb-4"> Stream your changes </h4><div class="bg-base-content flex items-center justify-between px-3 py-2 rounded-md my-2"><div class="flex grow min-w-0"><code class="break-all md:break-normal md:truncate text-base-200 text-sm"><!--[--> labctl content push -fw tutorial xdp-dsr-layer2-lb-92b02f3e<!--]--></code></div><button type="button" class="btn relative bg-base-content border-base-content btn-sm btn-square hover:bg-base-content hover:border-base-300/20 hover:text-base-100 text-base-200"><div class="flex grow items-center justify-center"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:22px;" width="1em" height="1em" viewBox="0 0 256 256"><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg><!--]--></div><!----></button></div><p class="italic mt-3 text-base-content/90 text-sm">
 Run this command in a separate terminal to continuously upload your 
changes to the server while editing the tutorial in your favorite text 
editor or IDE. </p></div><p class="leading-relaxed p-4 text-base-content/90 text-sm"> You can also use labctl to create, list, and delete your content. Learn more about the available commands: <code class="bg-base-300 px-1 py-0.5 rounded">labctl content --help</code></p></div></div></form><form method="dialog" class="backdrop-blur-sm modal-backdrop"><button>close</button></form></dialog><div class="border-slate-400 border-t bottom-0 fixed left-0 lg:hidden right-0 z-50" data-v-0d30d5a9=""><div class="flex glass items-center justify-center p-2.5"><!--[--><a href="https://labs.iximiuz.com/signup?return_to=%2Ftutorials%2Fxdp-dsr-layer2-lb-92b02f3e" class="btn bg-base-100 btn-neutral btn-outline btn-sm gap-2 shadow-md" role="button"><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-4 mr-1 w-4"><path fill-rule="evenodd" d="M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z" clip-rule="evenodd"></path></svg> Start tutorial<!--]--></a><!--]--></div></div></div><!--]--></div></div><div id="teleports"></div><script nonce="">window.__NUXT__={};window.__NUXT__.config={public:{environment:"production",siteName:"iximiuz Labs",siteEmail:"ivan@iximiuz.com",siteUrl:"https://labs.iximiuz.com",site:{url:"https://labs.iximiuz.com"},siteTitle:"iximiuz Labs - Indie Learning Platform to Master Server Side Craft",siteDescription:"Skill up in Linux, Networking, Containers, and Kubernetes by taking courses, following interactive tutorials, and solving fun DevOps challenges.",discordServerUrl:"https://discord.gg/p6nxaHm46p",gumroadProfileUrl:"https://products.iximiuz.com",newsletterUrl:"https://newsletter.iximiuz.com/",emailSubsCount:"20,000",mdc:{components:{prose:true,map:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote",pre:"prose-pre","code-inline":"prose-code-inline",code:"prose-code-inline",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",script:"prose-script",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},customElements:[]},headings:{anchorLinks:{h1:false,h2:true,h3:true,h4:true,h5:false,h6:false}},highlight:{theme:"slack-dark",preload:["ada","c","csharp","diff","java","js","json","docker","go","hcl","make","md","php","proto","python","rust","shell","ts","yaml","toml"],highlighter:"shiki",shikiEngine:"oniguruma",langs:["js","jsx","json","ts","tsx","vue","css","html","bash","md","mdc","yaml","ada","c","csharp","diff","java","js","json","docker","go","hcl","make","md","php","proto","python","rust","shell","ts","yaml","toml"]}},plausible:{enabled:true,hashMode:false,domain:"labs.iximiuz.com",ignoredHostnames:["localhost"],ignoreSubDomains:false,trackLocalhost:"",apiHost:"https://plausible.io",autoPageviews:true,autoOutboundTracking:false,logIgnoredEvents:false,proxy:false,proxyBaseEndpoint:"/_plausible"},"nuxt-robots":{version:"5.7.0",isNuxtContentV2:false,debug:false,credits:false,groups:[{userAgent:["*"],disallow:["/account","/dashboard","/new","/enter","/main","/signin","/signup","/*/settings","*?returnTo=","*?return_to=","_nuxt"],allow:[],contentUsage:[],contentSignal:[],_indexable:true,_rules:[{pattern:"/account",allow:false},{pattern:"/dashboard",allow:false},{pattern:"/new",allow:false},{pattern:"/enter",allow:false},{pattern:"/main",allow:false},{pattern:"/signin",allow:false},{pattern:"/signup",allow:false},{pattern:"/*/settings",allow:false},{pattern:"*?returnTo=",allow:false},{pattern:"*?return_to=",allow:false},{pattern:"_nuxt",allow:false}],_normalized:true}],sitemap:["https://labs.iximiuz.com/sitemap.xml","/sitemap.xml"],header:true,robotsEnabledValue:"index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1",robotsDisabledValue:"noindex, nofollow",cacheControl:"max-age=14400, must-revalidate",botDetection:true,pageMetaRobots:{}}},app:{baseURL:"/",buildId:"b756282a-436d-4378-9e80-d3bbd54cd54a",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script><script nonce="" type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__">[["ShallowReactive",1],{"data":2,"state":2374,"once":2389,"_errors":2390,"serverRendered":11,"path":2392},["ShallowReactive",3],{"tutorial-page-tutorial-xdp-dsr-layer2-lb-92b02f3e":4,"content-tutorial-xdp-dsr-layer2-lb-92b02f3e-v1769024630415":65,"i-material-symbols-light:expand-content":2368,"i-ph:copy":2371},{"id":5,"kind":6,"name":7,"title":8,"description":9,"createdAt":10,"updatedAt":10,"independent":11,"trusted":11,"published":11,"playground":12,"units":13,"owner":18,"authors":19,"contentVersion":26,"pageUrl":27,"cover":28,"categories":29,"tags":32,"status":34,"tasks":35,"attemptCount":56,"completionCount":57,"accessControl":58,"userAccess":64},"6903af2cd66b5e25b69b1cfa","tutorial","xdp-dsr-layer2-lb-92b02f3e","Building an eBPF/XDP L2 Direct Server Return Load Balancer from Scratch","In this tutorial, you will learn how to build an Layer 2 DSR load balancer using eBPF/XDP, where backends send responses directly back to clients bypassing the load balancer.","2026-01-20T00:00:00.000Z",true,"flexbox",[14],{"name":7,"hash":15,"title":8,"description":9,"createdAt":16,"updatedAt":16,"file":17},"#xdp-dsr-layer2-lb-92b02f3e","2026-01-20","tutorials/xdp-dsr-layer2-lb-92b02f3e/index.md","6620fa0e724db85e6791a6e2",[20],{"id":21,"createdAt":22,"userId":18,"name":23,"displayName":24,"avatarUrl":25,"independent":11,"certified":11},"68a57e83267bd767257a8c00","2025-08-20T07:51:31.012Z","teodor-janez-podobnik","Teodor Janez Podobnik","https://avatars.githubusercontent.com/u/48418580",1769024630415,"https://labs.iximiuz.com/tutorials/xdp-dsr-layer2-lb-92b02f3e","/content/files/tutorials/xdp-dsr-layer2-lb-92b02f3e/__static__/dsr-1.png",[30,31],"linux","networking",[33],"eBPF","todo",{"setup_networking_lb":36,"setup_networking_backend_01":41,"setup_networking_backend_02":44,"setup_networking_gateway":47,"setup_networking_client_01":50,"clone_lab":53},{"init":11,"machine":37,"user":38,"name":39,"status":40},"lb","root","setup_networking_lb",0,{"init":11,"machine":42,"user":38,"name":43,"status":40},"backend-01","setup_networking_backend_01",{"init":11,"machine":45,"user":38,"name":46,"status":40},"backend-02","setup_networking_backend_02",{"init":11,"machine":48,"user":38,"name":49,"status":40},"gateway","setup_networking_gateway",{"init":11,"machine":51,"user":38,"name":52,"status":40},"client","setup_networking_client_01",{"init":11,"machine":37,"user":54,"name":55,"status":40},"laborant","clone_lab",13,2,{"canList":59,"canPreview":61,"canRead":62,"canStart":63},[60],"anyone",[60],[60],[60],{"canList":11,"canPreview":11,"canRead":11,"canStart":11},[66],{"title":8,"description":67,"kind":6,"categories":68,"tagz":69,"createdAt":10,"updatedAt":10,"cover":28,"playground":70,"type":38,"children":147,"hash":15,"preview":-1,"pageUrl":27,"tasks":2353,"toc":2354,"tutorials":2361,"challenges":2363,"courses":2365,"key":2367},"In this tutorial, you will learn how to build an Layer 2 DSR load balancer using eBPF/XDP, where backends send responses directly back to clients bypassing the load balancer.\n",[30,31],[33],{"name":12,"networks":71,"machines":81},[72,75,78],{"name":73,"subnet":74,"private":11},"net-1","192.168.178.0/24",{"name":76,"subnet":77,"private":11},"net-2","10.0.0.0/16",{"name":79,"subnet":80},"net-3","172.16.0.0/24",[82,99,110,121,136],{"name":37,"kernel":83,"drives":84,"users":89,"network":92,"resources":96},"6.1",[85],{"source":86,"mount":87,"size":88},"oci://ghcr.io/dorkamotorka/ebpf-labs:latest","/","10GiB",[90],{"name":54,"default":11,"welcome":91},"This is the load balancer node.\n\nIP: 192.168.178.10/24\n",{"interfaces":93},[94],{"network":73,"address":95},"192.168.178.10",{"cpuCount":97,"ramSize":98},1,"1GiB",{"name":42,"kernel":83,"drives":100,"users":102,"network":105,"resources":109},[101],{"source":86,"mount":87,"size":88},[103],{"name":54,"default":11,"welcome":104},"This is a backend node.\n\nIP: 192.168.178.11/24\n",{"interfaces":106},[107],{"network":73,"address":108},"192.168.178.11",{"cpuCount":97,"ramSize":98},{"name":45,"kernel":83,"drives":111,"users":113,"network":116,"resources":120},[112],{"source":86,"mount":87,"size":88},[114],{"name":54,"default":11,"welcome":115},"This is a backend node.\n\nIP: 192.168.178.12/24\n",{"interfaces":117},[118],{"network":73,"address":119},"192.168.178.12",{"cpuCount":97,"ramSize":98},{"name":48,"kernel":83,"drives":122,"users":124,"network":127,"resources":135},[123],{"source":86,"mount":87,"size":88},[125],{"name":54,"default":11,"welcome":126},"This is a gateway node that is attached to both networks.\n\nIP #1: 192.168.178.2/24\nIP #2: 10.0.0.2/16\nIP #3: 172.16.0.2/24 (Just for internet access)\n",{"interfaces":128},[129,131,133],{"network":73,"address":130},"192.168.178.2",{"network":76,"address":132},"10.0.0.2",{"network":79,"address":134},"172.16.0.2",{"cpuCount":97,"ramSize":98},{"name":51,"kernel":83,"drives":137,"users":139,"network":142,"resources":146},[138],{"source":86,"mount":87,"size":88},[140],{"name":54,"default":11,"welcome":141},"This is a client node.\n\nIP: 10.0.0.20/16\n",{"interfaces":143},[144],{"network":76,"address":145},"10.0.0.20",{"cpuCount":97,"ramSize":98},[148,167,172,177,182,187,193,198,203,208,299,304,311,316,321,349,354,359,366,371,376,381,386,401,428,487,518,562,570,582,587,612,717,725,730,742,750,755,760,765,790,954,974,1055,1077,1083,1088,1096,1101,1727,1743,1763,1768,1787,1792,1798,1807,1825,1864,1884,1947,1973,1985,2005,2010,2058,2305,2309,2317,2322,2327,2332,2337,2342,2347],{"type":149,"tag":150,"props":151,"children":152},"element","p",{},[153,156,165],{"type":154,"value":155},"text","In the ",{"type":149,"tag":157,"props":158,"children":162},"a",{"href":159,"rel":160},"https://labs.iximiuz.com/tutorials/xdp-load-balancer-700a1d74",[161],"nofollow",[163],{"type":154,"value":164},"previous tutorial",{"type":154,"value":166},", we built a NAT-based XDP load balancer. One nice thing about that setup was that both requests and responses passed through the load balancer, making it easier to apply custom network policies or perform packet inspection in both directions.",{"type":149,"tag":150,"props":168,"children":169},{},[170],{"type":154,"value":171},"However, this approach isnt always optimal. Because the load balancer handles traffic in both directions, it consumes more resources and can become a bottleneck. After all, the backend could just respond directly to the client instead of routing the reply back through the load balancer.",{"type":149,"tag":150,"props":173,"children":174},{},[175],{"type":154,"value":176},"Not to mention, inbound traffic is usually much smaller than outbound traffic. A short search query or initial AI prompt is only a few bytes, while the response (search results or an AI completion) is often much larger.",{"type":149,"tag":150,"props":178,"children":179},{},[180],{"type":154,"value":181},"But an even bigger problem is that the backend isnt really aware of which client made the request, since the NAT load balancer rewrote the packet headers. Meaning, if the backend wants to maintain per-user sessions, or log requests by source IP, it cant really do that.",{"type":149,"tag":150,"props":183,"children":184},{},[185],{"type":154,"value":186},"To overcome these downsides, Direct Server Return (DSR) concept was introduced.",{"type":149,"tag":188,"props":189,"children":192},"image-box",{":alt":190,":src":191},"XDP DSR Load Balancing","/content/files/tutorials/xdp-dsr-layer2-lb-92b02f3e/__static__/dsr-2.png",[],{"type":149,"tag":150,"props":194,"children":195},{},[196],{"type":154,"value":197},"There are several DSR (Direct Server Return) implementations  including Layer 2 DSR, IP-in-IP, and GRE-based DSR  as well as some unique variations that leverage fields like IP or TCP header fields.",{"type":149,"tag":150,"props":199,"children":200},{},[201],{"type":154,"value":202},"This tutorial focuses on Layer 2 DSR (with Simple Hashing) using eBPF/XDP, while other approaches will be covered in upcoming labs.",{"type":149,"tag":150,"props":204,"children":205},{},[206],{"type":154,"value":207},"This playground has a network topology with five nodes on two different networks:",{"type":149,"tag":209,"props":210,"children":211},"ul",{},[212,230,245,260,275],{"type":149,"tag":213,"props":214,"children":215},"li",{},[216,222,224],{"type":149,"tag":217,"props":218,"children":220},"code",{"className":219},[],[221],{"type":154,"value":37},{"type":154,"value":223}," in network ",{"type":149,"tag":217,"props":225,"children":227},{"className":226},[],[228],{"type":154,"value":229},"192.168.178.10/24",{"type":149,"tag":213,"props":231,"children":232},{},[233,238,239],{"type":149,"tag":217,"props":234,"children":236},{"className":235},[],[237],{"type":154,"value":42},{"type":154,"value":223},{"type":149,"tag":217,"props":240,"children":242},{"className":241},[],[243],{"type":154,"value":244},"192.168.178.11/24",{"type":149,"tag":213,"props":246,"children":247},{},[248,253,254],{"type":149,"tag":217,"props":249,"children":251},{"className":250},[],[252],{"type":154,"value":45},{"type":154,"value":223},{"type":149,"tag":217,"props":255,"children":257},{"className":256},[],[258],{"type":154,"value":259},"192.168.178.12/24",{"type":149,"tag":213,"props":261,"children":262},{},[263,268,269],{"type":149,"tag":217,"props":264,"children":266},{"className":265},[],[267],{"type":154,"value":51},{"type":154,"value":223},{"type":149,"tag":217,"props":270,"children":272},{"className":271},[],[273],{"type":154,"value":274},"10.0.0.20/16",{"type":149,"tag":213,"props":276,"children":277},{},[278,283,285,291,293],{"type":149,"tag":217,"props":279,"children":281},{"className":280},[],[282],{"type":154,"value":48},{"type":154,"value":284}," between networks ",{"type":149,"tag":217,"props":286,"children":288},{"className":287},[],[289],{"type":154,"value":290},"192.168.178.2/24",{"type":154,"value":292}," and ",{"type":149,"tag":217,"props":294,"children":296},{"className":295},[],[297],{"type":154,"value":298},"10.0.0.2/16",{"type":149,"tag":188,"props":300,"children":303},{":alt":301,":src":302},"XDP DSR Load Balancing Playground","/content/files/tutorials/xdp-dsr-layer2-lb-92b02f3e/__static__/playground.png",[],{"type":149,"tag":305,"props":306,"children":308},"h2",{"id":307},"dsr-l2-load-balancing",[309],{"type":154,"value":310},"DSR L2 Load Balancing",{"type":149,"tag":150,"props":312,"children":313},{},[314],{"type":154,"value":315},"Unlike NAT-based load balancing, DSR preserves the original client IP and allows the backend to respond directly to the client, bypassing the load balancer on the return path.",{"type":149,"tag":150,"props":317,"children":318},{},[319],{"type":154,"value":320},"To understand how this is possible, we need to answer three questions:",{"type":149,"tag":209,"props":322,"children":323},{},[324,333,341],{"type":149,"tag":213,"props":325,"children":326},{},[327],{"type":149,"tag":328,"props":329,"children":330},"strong",{},[331],{"type":154,"value":332},"How does the backend see the client IP if the packet went through the load balancer?",{"type":149,"tag":213,"props":334,"children":335},{},[336],{"type":149,"tag":328,"props":337,"children":338},{},[339],{"type":154,"value":340},"How does the backend know which client to respond to?",{"type":149,"tag":213,"props":342,"children":343},{},[344],{"type":149,"tag":328,"props":345,"children":346},{},[347],{"type":154,"value":348},"How do we ensure the client receives the response from the same IP it sent the request to?",{"type":149,"tag":150,"props":350,"children":351},{},[352],{"type":154,"value":353},"In short, L2 DSR achieves this by rewriting only the MAC addresses of packets at the load balancer, keeping the IP header unchanged, and relying on a virtual IP between the load balancer and backend servers.",{"type":149,"tag":150,"props":355,"children":356},{},[357],{"type":154,"value":358},"Lets take it slow...",{"type":149,"tag":360,"props":361,"children":363},"h3",{"id":362},"virtual-ip-vip",[364],{"type":154,"value":365},"Virtual IP (VIP)",{"type":149,"tag":150,"props":367,"children":368},{},[369],{"type":154,"value":370},"In any network setup, whenever a client sends a request to a specific endpoint, it expects the response to come from that same IP address. If the reply comes from a different IP, the clients network stack assumes an error and drops the packet.",{"type":149,"tag":150,"props":372,"children":373},{},[374],{"type":154,"value":375},"And if you remember the NAT-based load balancing, this creates a problem since the clients request always passed through the load balancer, which forwarded it to a backend node that has a different IP.",{"type":149,"tag":150,"props":377,"children":378},{},[379],{"type":154,"value":380},"To address this, both the load balancer and the backend nodes need to share the same IP, ensuring the client always sees responses as coming from the same address it originally contacted.",{"type":149,"tag":150,"props":382,"children":383},{},[384],{"type":154,"value":385},"This \"shared IP\" is called Virtual IP (VIP).",{"type":149,"tag":387,"props":388,"children":390},"remark-box",{"kind":389},"info",[391,396],{"type":149,"tag":150,"props":392,"children":393},{},[394],{"type":154,"value":395}," Unlike physical IPs, a Virtual IP (VIP) is not bound to a specific interface or node. Instead, it's a shared address used by multiple nodes to handle traffic for the same service.",{"type":149,"tag":150,"props":397,"children":398},{},[399],{"type":154,"value":400},"Confusing, right? Read along.",{"type":149,"tag":150,"props":402,"children":403},{},[404,406,426],{"type":154,"value":405},"To set this up in our playground, ",{"type":149,"tag":328,"props":407,"children":408},{},[409,411,416,418,424],{"type":154,"value":410},"configure the VIP on the load balancers (",{"type":149,"tag":217,"props":412,"children":414},{"className":413},[],[415],{"type":154,"value":37},{"type":154,"value":417}," tab) main interface (",{"type":149,"tag":217,"props":419,"children":421},{"className":420},[],[422],{"type":154,"value":423},"eth0",{"type":154,"value":425},")",{"type":154,"value":427},":",{"type":149,"tag":429,"props":430,"children":435},"pre",{"className":431,"code":432,"language":433,"meta":434,"style":434},"language-bash shiki shiki-themes slack-dark","sudo ip addr add 192.168.178.15/32 dev eth0  # 192.168.178.15 is our VIP for this example\n","bash","",[436],{"type":149,"tag":217,"props":437,"children":438},{"__ignoreMap":434},[439],{"type":149,"tag":440,"props":441,"children":443},"span",{"class":442,"line":97},"line",[444,450,456,461,466,471,476,481],{"type":149,"tag":440,"props":445,"children":447},{"style":446},"--shiki-default:#DCDCAA",[448],{"type":154,"value":449},"sudo",{"type":149,"tag":440,"props":451,"children":453},{"style":452},"--shiki-default:#CE9178",[454],{"type":154,"value":455}," ip",{"type":149,"tag":440,"props":457,"children":458},{"style":452},[459],{"type":154,"value":460}," addr",{"type":149,"tag":440,"props":462,"children":463},{"style":452},[464],{"type":154,"value":465}," add",{"type":149,"tag":440,"props":467,"children":468},{"style":452},[469],{"type":154,"value":470}," 192.168.178.15/32",{"type":149,"tag":440,"props":472,"children":473},{"style":452},[474],{"type":154,"value":475}," dev",{"type":149,"tag":440,"props":477,"children":478},{"style":452},[479],{"type":154,"value":480}," eth0",{"type":149,"tag":440,"props":482,"children":484},{"style":483},"--shiki-default:#6A9955",[485],{"type":154,"value":486},"  # 192.168.178.15 is our VIP for this example\n",{"type":149,"tag":150,"props":488,"children":489},{},[490,492,497,498,503,505,517],{"type":154,"value":491},"And, on both backends (",{"type":149,"tag":217,"props":493,"children":495},{"className":494},[],[496],{"type":154,"value":42},{"type":154,"value":292},{"type":149,"tag":217,"props":499,"children":501},{"className":500},[],[502],{"type":154,"value":45},{"type":154,"value":504}," tabs), ",{"type":149,"tag":328,"props":506,"children":507},{},[508,510,516],{"type":154,"value":509},"configure the VIP on the loopback interface (",{"type":149,"tag":217,"props":511,"children":513},{"className":512},[],[514],{"type":154,"value":515},"lo",{"type":154,"value":425},{"type":154,"value":427},{"type":149,"tag":429,"props":519,"children":521},{"className":431,"code":520,"language":433,"meta":434,"style":434},"sudo ip addr add 192.168.178.15/32 dev lo # 192.168.178.15 is our VIP for this example\n",[522],{"type":149,"tag":217,"props":523,"children":524},{"__ignoreMap":434},[525],{"type":149,"tag":440,"props":526,"children":527},{"class":442,"line":97},[528,532,536,540,544,548,552,557],{"type":149,"tag":440,"props":529,"children":530},{"style":446},[531],{"type":154,"value":449},{"type":149,"tag":440,"props":533,"children":534},{"style":452},[535],{"type":154,"value":455},{"type":149,"tag":440,"props":537,"children":538},{"style":452},[539],{"type":154,"value":460},{"type":149,"tag":440,"props":541,"children":542},{"style":452},[543],{"type":154,"value":465},{"type":149,"tag":440,"props":545,"children":546},{"style":452},[547],{"type":154,"value":470},{"type":149,"tag":440,"props":549,"children":550},{"style":452},[551],{"type":154,"value":475},{"type":149,"tag":440,"props":553,"children":554},{"style":452},[555],{"type":154,"value":556}," lo",{"type":149,"tag":440,"props":558,"children":559},{"style":483},[560],{"type":154,"value":561}," # 192.168.178.15 is our VIP for this example\n",{"type":149,"tag":150,"props":563,"children":564},{},[565],{"type":149,"tag":328,"props":566,"children":567},{},[568],{"type":154,"value":569},"But wait  two nodes with the same IP? Wouldn't that confuse the client or gateway, seeing both advertise the same address?",{"type":149,"tag":150,"props":571,"children":572},{},[573,575,580],{"type":154,"value":574},"Exactly  thats why we assign the VIP to the ",{"type":149,"tag":217,"props":576,"children":578},{"className":577},[],[579],{"type":154,"value":515},{"type":154,"value":581}," interface on backend nodes. We dont want the backends to advertise the virtual IP (via ARP).",{"type":149,"tag":150,"props":583,"children":584},{},[585],{"type":154,"value":586},"In other words, no one in the network should know the VIP exists on the backends; otherwise, clients could bypass the load balancer and connect directly.",{"type":149,"tag":150,"props":588,"children":589},{},[590,592,597,599,604,605,610],{"type":154,"value":591},"To prevent backend nodes from responding to ARP requests (i.e., advertising) for the VIP address on the ",{"type":149,"tag":217,"props":593,"children":595},{"className":594},[],[596],{"type":154,"value":515},{"type":154,"value":598}," interface, run the following on each backend node (",{"type":149,"tag":217,"props":600,"children":602},{"className":601},[],[603],{"type":154,"value":42},{"type":154,"value":292},{"type":149,"tag":217,"props":606,"children":608},{"className":607},[],[609],{"type":154,"value":45},{"type":154,"value":611}," tabs):",{"type":149,"tag":429,"props":613,"children":615},{"className":431,"code":614,"language":433,"meta":434,"style":434},"# Only reply to ARP requests if the target IP is assigned to the interface \n# that received the request (prevents advertising the VIP on eth0)\nsudo sysctl -w net.ipv4.conf.eth0.arp_ignore=1\n\n# When sending ARP requests, use only addresses assigned to the outgoing interface\n# (prevents the node from leaking the VIP as a source IP in ARP)\nsudo sysctl -w net.ipv4.conf.eth0.arp_announce=2\n",[616],{"type":149,"tag":217,"props":617,"children":618},{"__ignoreMap":434},[619,627,635,664,673,682,691],{"type":149,"tag":440,"props":620,"children":621},{"class":442,"line":97},[622],{"type":149,"tag":440,"props":623,"children":624},{"style":483},[625],{"type":154,"value":626},"# Only reply to ARP requests if the target IP is assigned to the interface \n",{"type":149,"tag":440,"props":628,"children":629},{"class":442,"line":57},[630],{"type":149,"tag":440,"props":631,"children":632},{"style":483},[633],{"type":154,"value":634},"# that received the request (prevents advertising the VIP on eth0)\n",{"type":149,"tag":440,"props":636,"children":638},{"class":442,"line":637},3,[639,643,648,653,658],{"type":149,"tag":440,"props":640,"children":641},{"style":446},[642],{"type":154,"value":449},{"type":149,"tag":440,"props":644,"children":645},{"style":452},[646],{"type":154,"value":647}," sysctl",{"type":149,"tag":440,"props":649,"children":650},{"style":452},[651],{"type":154,"value":652}," -w",{"type":149,"tag":440,"props":654,"children":655},{"style":452},[656],{"type":154,"value":657}," net.ipv4.conf.eth0.arp_ignore=",{"type":149,"tag":440,"props":659,"children":661},{"style":660},"--shiki-default:#B5CEA8",[662],{"type":154,"value":663},"1\n",{"type":149,"tag":440,"props":665,"children":667},{"class":442,"line":666},4,[668],{"type":149,"tag":440,"props":669,"children":670},{"emptyLinePlaceholder":11},[671],{"type":154,"value":672},"\n",{"type":149,"tag":440,"props":674,"children":676},{"class":442,"line":675},5,[677],{"type":149,"tag":440,"props":678,"children":679},{"style":483},[680],{"type":154,"value":681},"# When sending ARP requests, use only addresses assigned to the outgoing interface\n",{"type":149,"tag":440,"props":683,"children":685},{"class":442,"line":684},6,[686],{"type":149,"tag":440,"props":687,"children":688},{"style":483},[689],{"type":154,"value":690},"# (prevents the node from leaking the VIP as a source IP in ARP)\n",{"type":149,"tag":440,"props":692,"children":694},{"class":442,"line":693},7,[695,699,703,707,712],{"type":149,"tag":440,"props":696,"children":697},{"style":446},[698],{"type":154,"value":449},{"type":149,"tag":440,"props":700,"children":701},{"style":452},[702],{"type":154,"value":647},{"type":149,"tag":440,"props":704,"children":705},{"style":452},[706],{"type":154,"value":652},{"type":149,"tag":440,"props":708,"children":709},{"style":452},[710],{"type":154,"value":711}," net.ipv4.conf.eth0.arp_announce=",{"type":149,"tag":440,"props":713,"children":714},{"style":660},[715],{"type":154,"value":716},"2\n",{"type":149,"tag":150,"props":718,"children":719},{},[720],{"type":149,"tag":328,"props":721,"children":722},{},[723],{"type":154,"value":724},"Then whats the point of the virtual IP, and how does the load balancer reach the backends if that IP \"isnt advertised\"?",{"type":149,"tag":150,"props":726,"children":727},{},[728],{"type":154,"value":729},"The cool part is that load balancer doesn't really have to know the VIP exists on the backend nodes.",{"type":149,"tag":150,"props":731,"children":732},{},[733,735,740],{"type":154,"value":734},"It only needs the backends MAC address to forward packets at Layer 2. When a backend receives the packet, it decapsulates it and recognizes the virtual IP as its own (configured on the ",{"type":149,"tag":217,"props":736,"children":738},{"className":737},[],[739],{"type":154,"value":515},{"type":154,"value":741}," interface), even though that IP is never advertised on the network.",{"type":149,"tag":150,"props":743,"children":744},{},[745],{"type":149,"tag":328,"props":746,"children":747},{},[748],{"type":154,"value":749},"This is also why this concept is called Layer 2 DSRthe load balancer reaches backend nodes using only their MAC addresses, which wouldnt work if the backends were in a different (L2) network.",{"type":149,"tag":150,"props":751,"children":752},{},[753],{"type":154,"value":754},"Here's an image to illustrate this concept.",{"type":149,"tag":188,"props":756,"children":759},{":alt":757,":src":758},"XDP DSR L2 Load Balancing","/content/files/tutorials/xdp-dsr-layer2-lb-92b02f3e/__static__/dsr-new.png",[],{"type":149,"tag":150,"props":761,"children":762},{},[763],{"type":154,"value":764},"In other words, when a client connects to the VIP, the:",{"type":149,"tag":209,"props":766,"children":767},{},[768,773,778],{"type":149,"tag":213,"props":769,"children":770},{},[771],{"type":154,"value":772},"Gateway routes the traffic to the load balancer",{"type":149,"tag":213,"props":774,"children":775},{},[776],{"type":154,"value":777},"Load balancer then forwards the packet to a backend by rewriting the (source and) destination MAC address",{"type":149,"tag":213,"props":779,"children":780},{},[781,783,788],{"type":154,"value":782},"Backend has the VIP configured on its ",{"type":149,"tag":217,"props":784,"children":786},{"className":785},[],[787],{"type":154,"value":515},{"type":154,"value":789}," interface, it recognizes the packet as its own and processes it",{"type":149,"tag":791,"props":792,"children":794},"details-box",{":summary":793},"Verify the setup",[795,808,820,845,855,867,896,916,945],{"type":149,"tag":150,"props":796,"children":797},{},[798,800,806],{"type":154,"value":799},"You can verify this by checking that ",{"type":149,"tag":217,"props":801,"children":803},{"className":802},[],[804],{"type":154,"value":805},"192.168.178.15",{"type":154,"value":807}," maps to the load balancers MAC address in the ARP table on the gateway.",{"type":149,"tag":150,"props":809,"children":810},{},[811,813,818],{"type":154,"value":812},"Run the following on the ",{"type":149,"tag":217,"props":814,"children":816},{"className":815},[],[817],{"type":154,"value":48},{"type":154,"value":819}," tab:",{"type":149,"tag":429,"props":821,"children":823},{"className":431,"code":822,"language":433,"meta":434,"style":434},"ip neigh show\n",[824],{"type":149,"tag":217,"props":825,"children":826},{"__ignoreMap":434},[827],{"type":149,"tag":440,"props":828,"children":829},{"class":442,"line":97},[830,835,840],{"type":149,"tag":440,"props":831,"children":832},{"style":446},[833],{"type":154,"value":834},"ip",{"type":149,"tag":440,"props":836,"children":837},{"style":452},[838],{"type":154,"value":839}," neigh",{"type":149,"tag":440,"props":841,"children":842},{"style":452},[843],{"type":154,"value":844}," show\n",{"type":149,"tag":429,"props":846,"children":850},{"className":847,"code":849,"language":154},[848],"language-text","192.168.178.15 dev eth0 lladdr XX:XX:XX:XX:XX:XX REACHABLE \n",[851],{"type":149,"tag":217,"props":852,"children":853},{"__ignoreMap":434},[854],{"type":154,"value":849},{"type":149,"tag":150,"props":856,"children":857},{},[858,860,865],{"type":154,"value":859},"If theres no entry for ",{"type":149,"tag":217,"props":861,"children":863},{"className":862},[],[864],{"type":154,"value":805},{"type":154,"value":866},", populate it with:",{"type":149,"tag":429,"props":868,"children":870},{"className":431,"code":869,"language":433,"meta":434,"style":434},"sudo ping -c1 192.168.178.15\n",[871],{"type":149,"tag":217,"props":872,"children":873},{"__ignoreMap":434},[874],{"type":149,"tag":440,"props":875,"children":876},{"class":442,"line":97},[877,881,886,891],{"type":149,"tag":440,"props":878,"children":879},{"style":446},[880],{"type":154,"value":449},{"type":149,"tag":440,"props":882,"children":883},{"style":452},[884],{"type":154,"value":885}," ping",{"type":149,"tag":440,"props":887,"children":888},{"style":452},[889],{"type":154,"value":890}," -c1",{"type":149,"tag":440,"props":892,"children":893},{"style":660},[894],{"type":154,"value":895}," 192.168.178.15\n",{"type":149,"tag":150,"props":897,"children":898},{},[899,901,907,909,914],{"type":154,"value":900},"Now, verify that the MAC address (",{"type":149,"tag":217,"props":902,"children":904},{"className":903},[],[905],{"type":154,"value":906},"XX:XX:XX:XX:XX:XX",{"type":154,"value":908},") matches the load balancers MAC address (from the ",{"type":149,"tag":217,"props":910,"children":912},{"className":911},[],[913],{"type":154,"value":37},{"type":154,"value":915}," tab) using:",{"type":149,"tag":429,"props":917,"children":919},{"className":431,"code":918,"language":433,"meta":434,"style":434},"ip link show eth0\n",[920],{"type":149,"tag":217,"props":921,"children":922},{"__ignoreMap":434},[923],{"type":149,"tag":440,"props":924,"children":925},{"class":442,"line":97},[926,930,935,940],{"type":149,"tag":440,"props":927,"children":928},{"style":446},[929],{"type":154,"value":834},{"type":149,"tag":440,"props":931,"children":932},{"style":452},[933],{"type":154,"value":934}," link",{"type":149,"tag":440,"props":936,"children":937},{"style":452},[938],{"type":154,"value":939}," show",{"type":149,"tag":440,"props":941,"children":942},{"style":452},[943],{"type":154,"value":944}," eth0\n",{"type":149,"tag":429,"props":946,"children":949},{"className":947,"code":948,"language":154},[848],"2: eth0: \u003CBROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000\n    link/ether XX:XX:XX:XX:XX:XX brd ff:ff:ff:ff:ff:ff\n",[950],{"type":149,"tag":217,"props":951,"children":952},{"__ignoreMap":434},[953],{"type":154,"value":948},{"type":149,"tag":150,"props":955,"children":956},{},[957,959,964,966,972],{"type":154,"value":958},"We're almost ready for the next step, but just like with the NAT load balancer, we first need to enable IP forwarding on our load balancer (",{"type":149,"tag":217,"props":960,"children":962},{"className":961},[],[963],{"type":154,"value":37},{"type":154,"value":965}," tab) and populate the ARP table so that ",{"type":149,"tag":217,"props":967,"children":969},{"className":968},[],[970],{"type":154,"value":971},"bpf_fib_lookup",{"type":154,"value":973}," can resolve packet destinations:",{"type":149,"tag":429,"props":975,"children":977},{"className":431,"code":976,"language":433,"meta":434,"style":434},"sudo sysctl -w net.ipv4.ip_forward=1\nsudo ping -c1 192.168.178.11 # backend-01 node/real IP\nsudo ping -c1 192.168.178.12 # backend-02 node/real IP\n",[978],{"type":149,"tag":217,"props":979,"children":980},{"__ignoreMap":434},[981,1005,1030],{"type":149,"tag":440,"props":982,"children":983},{"class":442,"line":97},[984,988,992,996,1001],{"type":149,"tag":440,"props":985,"children":986},{"style":446},[987],{"type":154,"value":449},{"type":149,"tag":440,"props":989,"children":990},{"style":452},[991],{"type":154,"value":647},{"type":149,"tag":440,"props":993,"children":994},{"style":452},[995],{"type":154,"value":652},{"type":149,"tag":440,"props":997,"children":998},{"style":452},[999],{"type":154,"value":1000}," net.ipv4.ip_forward=",{"type":149,"tag":440,"props":1002,"children":1003},{"style":660},[1004],{"type":154,"value":663},{"type":149,"tag":440,"props":1006,"children":1007},{"class":442,"line":57},[1008,1012,1016,1020,1025],{"type":149,"tag":440,"props":1009,"children":1010},{"style":446},[1011],{"type":154,"value":449},{"type":149,"tag":440,"props":1013,"children":1014},{"style":452},[1015],{"type":154,"value":885},{"type":149,"tag":440,"props":1017,"children":1018},{"style":452},[1019],{"type":154,"value":890},{"type":149,"tag":440,"props":1021,"children":1022},{"style":660},[1023],{"type":154,"value":1024}," 192.168.178.11",{"type":149,"tag":440,"props":1026,"children":1027},{"style":483},[1028],{"type":154,"value":1029}," # backend-01 node/real IP\n",{"type":149,"tag":440,"props":1031,"children":1032},{"class":442,"line":637},[1033,1037,1041,1045,1050],{"type":149,"tag":440,"props":1034,"children":1035},{"style":446},[1036],{"type":154,"value":449},{"type":149,"tag":440,"props":1038,"children":1039},{"style":452},[1040],{"type":154,"value":885},{"type":149,"tag":440,"props":1042,"children":1043},{"style":452},[1044],{"type":154,"value":890},{"type":149,"tag":440,"props":1046,"children":1047},{"style":660},[1048],{"type":154,"value":1049}," 192.168.178.12",{"type":149,"tag":440,"props":1051,"children":1052},{"style":483},[1053],{"type":154,"value":1054}," # backend-02 node/real IP\n",{"type":149,"tag":791,"props":1056,"children":1058},{":summary":1057},"Forgot why this is necessary?",[1059,1064],{"type":149,"tag":150,"props":1060,"children":1061},{},[1062],{"type":154,"value":1063},"Enabling IP forwarding allows the load balancer to route packets between interfacesin other words, to act as a router.",{"type":149,"tag":150,"props":1065,"children":1066},{},[1067,1069,1075],{"type":154,"value":1068},"Meanwhile, populating the ARP table ensures that ",{"type":149,"tag":217,"props":1070,"children":1072},{"className":1071},[],[1073],{"type":154,"value":1074},"bpf_fib_lookup()",{"type":154,"value":1076}," in our eBPF code can find the correct next-hop information in the kernels routing tables.",{"type":149,"tag":360,"props":1078,"children":1080},{"id":1079},"rewriting-mac-addresses",[1081],{"type":154,"value":1082},"Rewriting MAC Addresses",{"type":149,"tag":150,"props":1084,"children":1085},{},[1086],{"type":154,"value":1087},"Now we understand how we avoid the client getting confused by receiving a response from always the same IP.",{"type":149,"tag":150,"props":1089,"children":1090},{},[1091],{"type":149,"tag":328,"props":1092,"children":1093},{},[1094],{"type":154,"value":1095},"But we still haven't yet addressed how does then load balancer knows to which backend to send the traffic to - especially now when they share the (same) VIP.",{"type":149,"tag":150,"props":1097,"children":1098},{},[1099],{"type":154,"value":1100},"As mentioned above, in L2 DSR Load balancing we actually only need to update MAC addresses in the load balancer, such that the packets are correctly delivered at Layer 2.",{"type":149,"tag":429,"props":1102,"children":1113},{"className":1103,"code":1104,"filename":1105,"highlights":1106,"language":1112,"meta":434,"style":434},"language-c shiki shiki-themes slack-dark","  ...\n  // Choose backend using simple hashing\n  struct four_tuple_t four_tuple;\n  four_tuple.src_ip = ip->saddr;\n  four_tuple.dst_ip = ip->daddr;\n  four_tuple.src_port = tcp->source;\n  four_tuple.dst_port = tcp->dest;\n  four_tuple.protocol = IPPROTO_TCP;\n  __u32 key = xdp_hash_tuple(&four_tuple) % NUM_BACKENDS;\n  struct endpoint *backend = bpf_map_lookup_elem(&backends, &key);\n  if (!backend) {\n    return XDP_ABORTED;\n  }\n\n  // Perform a FIB lookup\n  struct bpf_fib_lookup fib = {};\n  int rc = fib_lookup_v4_full(ctx, &fib, ip->daddr, backend->ip,\n                              bpf_ntohs(ip->tot_len));\n  if (rc != BPF_FIB_LKUP_RET_SUCCESS) {\n    log_fib_error(rc);\n    return XDP_ABORTED;\n  }\n\n  // We only need to update MAC addresses\n  // Backend needs to have a virtual IP on the lo (same one as load balancer)\n  // The source IP is retained as client, so backend will respond directly to it\n  __builtin_memcpy(eth->h_source, fib.smac, ETH_ALEN);\n  __builtin_memcpy(eth->h_dest, fib.dmac, ETH_ALEN);\n  ...\n","lab/lb.c",[1107,1108,1109,1110,1111],24,25,26,27,28,"c",[1114],{"type":149,"tag":217,"props":1115,"children":1116},{"__ignoreMap":434},[1117,1126,1134,1154,1182,1207,1233,1258,1276,1325,1389,1414,1428,1436,1444,1453,1475,1544,1572,1595,1609,1621,1629,1637,1647,1656,1665,1693,1719],{"type":149,"tag":440,"props":1118,"children":1119},{"class":442,"line":97},[1120],{"type":149,"tag":440,"props":1121,"children":1123},{"style":1122},"--shiki-default:#E6E6E6",[1124],{"type":154,"value":1125},"  ...\n",{"type":149,"tag":440,"props":1127,"children":1128},{"class":442,"line":57},[1129],{"type":149,"tag":440,"props":1130,"children":1131},{"style":483},[1132],{"type":154,"value":1133},"  // Choose backend using simple hashing\n",{"type":149,"tag":440,"props":1135,"children":1136},{"class":442,"line":637},[1137,1143,1149],{"type":149,"tag":440,"props":1138,"children":1140},{"style":1139},"--shiki-default:#569CD6",[1141],{"type":154,"value":1142},"  struct",{"type":149,"tag":440,"props":1144,"children":1146},{"style":1145},"--shiki-default:#4EC9B0",[1147],{"type":154,"value":1148}," four_tuple_t",{"type":149,"tag":440,"props":1150,"children":1151},{"style":1122},[1152],{"type":154,"value":1153}," four_tuple;\n",{"type":149,"tag":440,"props":1155,"children":1156},{"class":442,"line":666},[1157,1162,1168,1172,1177],{"type":149,"tag":440,"props":1158,"children":1159},{"style":1122},[1160],{"type":154,"value":1161},"  four_tuple.src_ip ",{"type":149,"tag":440,"props":1163,"children":1165},{"style":1164},"--shiki-default:#D4D4D4",[1166],{"type":154,"value":1167},"=",{"type":149,"tag":440,"props":1169,"children":1170},{"style":1122},[1171],{"type":154,"value":455},{"type":149,"tag":440,"props":1173,"children":1174},{"style":1164},[1175],{"type":154,"value":1176},"->",{"type":149,"tag":440,"props":1178,"children":1179},{"style":1122},[1180],{"type":154,"value":1181},"saddr;\n",{"type":149,"tag":440,"props":1183,"children":1184},{"class":442,"line":675},[1185,1190,1194,1198,1202],{"type":149,"tag":440,"props":1186,"children":1187},{"style":1122},[1188],{"type":154,"value":1189},"  four_tuple.dst_ip ",{"type":149,"tag":440,"props":1191,"children":1192},{"style":1164},[1193],{"type":154,"value":1167},{"type":149,"tag":440,"props":1195,"children":1196},{"style":1122},[1197],{"type":154,"value":455},{"type":149,"tag":440,"props":1199,"children":1200},{"style":1164},[1201],{"type":154,"value":1176},{"type":149,"tag":440,"props":1203,"children":1204},{"style":1122},[1205],{"type":154,"value":1206},"daddr;\n",{"type":149,"tag":440,"props":1208,"children":1209},{"class":442,"line":684},[1210,1215,1219,1224,1228],{"type":149,"tag":440,"props":1211,"children":1212},{"style":1122},[1213],{"type":154,"value":1214},"  four_tuple.src_port ",{"type":149,"tag":440,"props":1216,"children":1217},{"style":1164},[1218],{"type":154,"value":1167},{"type":149,"tag":440,"props":1220,"children":1221},{"style":1122},[1222],{"type":154,"value":1223}," tcp",{"type":149,"tag":440,"props":1225,"children":1226},{"style":1164},[1227],{"type":154,"value":1176},{"type":149,"tag":440,"props":1229,"children":1230},{"style":1122},[1231],{"type":154,"value":1232},"source;\n",{"type":149,"tag":440,"props":1234,"children":1235},{"class":442,"line":693},[1236,1241,1245,1249,1253],{"type":149,"tag":440,"props":1237,"children":1238},{"style":1122},[1239],{"type":154,"value":1240},"  four_tuple.dst_port ",{"type":149,"tag":440,"props":1242,"children":1243},{"style":1164},[1244],{"type":154,"value":1167},{"type":149,"tag":440,"props":1246,"children":1247},{"style":1122},[1248],{"type":154,"value":1223},{"type":149,"tag":440,"props":1250,"children":1251},{"style":1164},[1252],{"type":154,"value":1176},{"type":149,"tag":440,"props":1254,"children":1255},{"style":1122},[1256],{"type":154,"value":1257},"dest;\n",{"type":149,"tag":440,"props":1259,"children":1261},{"class":442,"line":1260},8,[1262,1267,1271],{"type":149,"tag":440,"props":1263,"children":1264},{"style":1122},[1265],{"type":154,"value":1266},"  four_tuple.protocol ",{"type":149,"tag":440,"props":1268,"children":1269},{"style":1164},[1270],{"type":154,"value":1167},{"type":149,"tag":440,"props":1272,"children":1273},{"style":1122},[1274],{"type":154,"value":1275}," IPPROTO_TCP;\n",{"type":149,"tag":440,"props":1277,"children":1279},{"class":442,"line":1278},9,[1280,1285,1289,1294,1299,1304,1310,1315,1320],{"type":149,"tag":440,"props":1281,"children":1282},{"style":1122},[1283],{"type":154,"value":1284},"  __u32 key ",{"type":149,"tag":440,"props":1286,"children":1287},{"style":1164},[1288],{"type":154,"value":1167},{"type":149,"tag":440,"props":1290,"children":1291},{"style":446},[1292],{"type":154,"value":1293}," xdp_hash_tuple",{"type":149,"tag":440,"props":1295,"children":1296},{"style":1122},[1297],{"type":154,"value":1298},"(",{"type":149,"tag":440,"props":1300,"children":1301},{"style":1164},[1302],{"type":154,"value":1303},"&",{"type":149,"tag":440,"props":1305,"children":1307},{"style":1306},"--shiki-default:#9CDCFE",[1308],{"type":154,"value":1309},"four_tuple",{"type":149,"tag":440,"props":1311,"children":1312},{"style":1122},[1313],{"type":154,"value":1314},") ",{"type":149,"tag":440,"props":1316,"children":1317},{"style":1164},[1318],{"type":154,"value":1319},"%",{"type":149,"tag":440,"props":1321,"children":1322},{"style":1122},[1323],{"type":154,"value":1324}," NUM_BACKENDS;\n",{"type":149,"tag":440,"props":1326,"children":1328},{"class":442,"line":1327},10,[1329,1333,1338,1343,1348,1352,1357,1361,1365,1370,1375,1379,1384],{"type":149,"tag":440,"props":1330,"children":1331},{"style":1139},[1332],{"type":154,"value":1142},{"type":149,"tag":440,"props":1334,"children":1335},{"style":1122},[1336],{"type":154,"value":1337}," endpoint ",{"type":149,"tag":440,"props":1339,"children":1340},{"style":1164},[1341],{"type":154,"value":1342},"*",{"type":149,"tag":440,"props":1344,"children":1345},{"style":1122},[1346],{"type":154,"value":1347},"backend ",{"type":149,"tag":440,"props":1349,"children":1350},{"style":1164},[1351],{"type":154,"value":1167},{"type":149,"tag":440,"props":1353,"children":1354},{"style":446},[1355],{"type":154,"value":1356}," bpf_map_lookup_elem",{"type":149,"tag":440,"props":1358,"children":1359},{"style":1122},[1360],{"type":154,"value":1298},{"type":149,"tag":440,"props":1362,"children":1363},{"style":1164},[1364],{"type":154,"value":1303},{"type":149,"tag":440,"props":1366,"children":1367},{"style":1306},[1368],{"type":154,"value":1369},"backends",{"type":149,"tag":440,"props":1371,"children":1372},{"style":1122},[1373],{"type":154,"value":1374},", ",{"type":149,"tag":440,"props":1376,"children":1377},{"style":1164},[1378],{"type":154,"value":1303},{"type":149,"tag":440,"props":1380,"children":1381},{"style":1306},[1382],{"type":154,"value":1383},"key",{"type":149,"tag":440,"props":1385,"children":1386},{"style":1122},[1387],{"type":154,"value":1388},");\n",{"type":149,"tag":440,"props":1390,"children":1392},{"class":442,"line":1391},11,[1393,1399,1404,1409],{"type":149,"tag":440,"props":1394,"children":1396},{"style":1395},"--shiki-default:#C586C0",[1397],{"type":154,"value":1398},"  if",{"type":149,"tag":440,"props":1400,"children":1401},{"style":1122},[1402],{"type":154,"value":1403}," (",{"type":149,"tag":440,"props":1405,"children":1406},{"style":1164},[1407],{"type":154,"value":1408},"!",{"type":149,"tag":440,"props":1410,"children":1411},{"style":1122},[1412],{"type":154,"value":1413},"backend) {\n",{"type":149,"tag":440,"props":1415,"children":1417},{"class":442,"line":1416},12,[1418,1423],{"type":149,"tag":440,"props":1419,"children":1420},{"style":1395},[1421],{"type":154,"value":1422},"    return",{"type":149,"tag":440,"props":1424,"children":1425},{"style":1122},[1426],{"type":154,"value":1427}," XDP_ABORTED;\n",{"type":149,"tag":440,"props":1429,"children":1430},{"class":442,"line":56},[1431],{"type":149,"tag":440,"props":1432,"children":1433},{"style":1122},[1434],{"type":154,"value":1435},"  }\n",{"type":149,"tag":440,"props":1437,"children":1439},{"class":442,"line":1438},14,[1440],{"type":149,"tag":440,"props":1441,"children":1442},{"emptyLinePlaceholder":11},[1443],{"type":154,"value":672},{"type":149,"tag":440,"props":1445,"children":1447},{"class":442,"line":1446},15,[1448],{"type":149,"tag":440,"props":1449,"children":1450},{"style":483},[1451],{"type":154,"value":1452},"  // Perform a FIB lookup\n",{"type":149,"tag":440,"props":1454,"children":1456},{"class":442,"line":1455},16,[1457,1461,1466,1470],{"type":149,"tag":440,"props":1458,"children":1459},{"style":1139},[1460],{"type":154,"value":1142},{"type":149,"tag":440,"props":1462,"children":1463},{"style":1122},[1464],{"type":154,"value":1465}," bpf_fib_lookup fib ",{"type":149,"tag":440,"props":1467,"children":1468},{"style":1164},[1469],{"type":154,"value":1167},{"type":149,"tag":440,"props":1471,"children":1472},{"style":1122},[1473],{"type":154,"value":1474}," {};\n",{"type":149,"tag":440,"props":1476,"children":1478},{"class":442,"line":1477},17,[1479,1484,1489,1493,1498,1503,1507,1512,1517,1521,1526,1531,1535,1539],{"type":149,"tag":440,"props":1480,"children":1481},{"style":1139},[1482],{"type":154,"value":1483},"  int",{"type":149,"tag":440,"props":1485,"children":1486},{"style":1122},[1487],{"type":154,"value":1488}," rc ",{"type":149,"tag":440,"props":1490,"children":1491},{"style":1164},[1492],{"type":154,"value":1167},{"type":149,"tag":440,"props":1494,"children":1495},{"style":446},[1496],{"type":154,"value":1497}," fib_lookup_v4_full",{"type":149,"tag":440,"props":1499,"children":1500},{"style":1122},[1501],{"type":154,"value":1502},"(ctx, ",{"type":149,"tag":440,"props":1504,"children":1505},{"style":1164},[1506],{"type":154,"value":1303},{"type":149,"tag":440,"props":1508,"children":1509},{"style":1306},[1510],{"type":154,"value":1511},"fib",{"type":149,"tag":440,"props":1513,"children":1514},{"style":1122},[1515],{"type":154,"value":1516},", ip",{"type":149,"tag":440,"props":1518,"children":1519},{"style":1164},[1520],{"type":154,"value":1176},{"type":149,"tag":440,"props":1522,"children":1523},{"style":1306},[1524],{"type":154,"value":1525},"daddr",{"type":149,"tag":440,"props":1527,"children":1528},{"style":1122},[1529],{"type":154,"value":1530},", backend",{"type":149,"tag":440,"props":1532,"children":1533},{"style":1164},[1534],{"type":154,"value":1176},{"type":149,"tag":440,"props":1536,"children":1537},{"style":1306},[1538],{"type":154,"value":834},{"type":149,"tag":440,"props":1540,"children":1541},{"style":1122},[1542],{"type":154,"value":1543},",\n",{"type":149,"tag":440,"props":1545,"children":1547},{"class":442,"line":1546},18,[1548,1553,1558,1562,1567],{"type":149,"tag":440,"props":1549,"children":1550},{"style":446},[1551],{"type":154,"value":1552},"                              bpf_ntohs",{"type":149,"tag":440,"props":1554,"children":1555},{"style":1122},[1556],{"type":154,"value":1557},"(ip",{"type":149,"tag":440,"props":1559,"children":1560},{"style":1164},[1561],{"type":154,"value":1176},{"type":149,"tag":440,"props":1563,"children":1564},{"style":1306},[1565],{"type":154,"value":1566},"tot_len",{"type":149,"tag":440,"props":1568,"children":1569},{"style":1122},[1570],{"type":154,"value":1571},"));\n",{"type":149,"tag":440,"props":1573,"children":1575},{"class":442,"line":1574},19,[1576,1580,1585,1590],{"type":149,"tag":440,"props":1577,"children":1578},{"style":1395},[1579],{"type":154,"value":1398},{"type":149,"tag":440,"props":1581,"children":1582},{"style":1122},[1583],{"type":154,"value":1584}," (rc ",{"type":149,"tag":440,"props":1586,"children":1587},{"style":1164},[1588],{"type":154,"value":1589},"!=",{"type":149,"tag":440,"props":1591,"children":1592},{"style":1122},[1593],{"type":154,"value":1594}," BPF_FIB_LKUP_RET_SUCCESS) {\n",{"type":149,"tag":440,"props":1596,"children":1598},{"class":442,"line":1597},20,[1599,1604],{"type":149,"tag":440,"props":1600,"children":1601},{"style":446},[1602],{"type":154,"value":1603},"    log_fib_error",{"type":149,"tag":440,"props":1605,"children":1606},{"style":1122},[1607],{"type":154,"value":1608},"(rc);\n",{"type":149,"tag":440,"props":1610,"children":1612},{"class":442,"line":1611},21,[1613,1617],{"type":149,"tag":440,"props":1614,"children":1615},{"style":1395},[1616],{"type":154,"value":1422},{"type":149,"tag":440,"props":1618,"children":1619},{"style":1122},[1620],{"type":154,"value":1427},{"type":149,"tag":440,"props":1622,"children":1624},{"class":442,"line":1623},22,[1625],{"type":149,"tag":440,"props":1626,"children":1627},{"style":1122},[1628],{"type":154,"value":1435},{"type":149,"tag":440,"props":1630,"children":1632},{"class":442,"line":1631},23,[1633],{"type":149,"tag":440,"props":1634,"children":1635},{"emptyLinePlaceholder":11},[1636],{"type":154,"value":672},{"type":149,"tag":440,"props":1638,"children":1641},{"class":1639,"line":1107},[442,1640],"highlight",[1642],{"type":149,"tag":440,"props":1643,"children":1644},{"style":483},[1645],{"type":154,"value":1646},"  // We only need to update MAC addresses\n",{"type":149,"tag":440,"props":1648,"children":1650},{"class":1649,"line":1108},[442,1640],[1651],{"type":149,"tag":440,"props":1652,"children":1653},{"style":483},[1654],{"type":154,"value":1655},"  // Backend needs to have a virtual IP on the lo (same one as load balancer)\n",{"type":149,"tag":440,"props":1657,"children":1659},{"class":1658,"line":1109},[442,1640],[1660],{"type":149,"tag":440,"props":1661,"children":1662},{"style":483},[1663],{"type":154,"value":1664},"  // The source IP is retained as client, so backend will respond directly to it\n",{"type":149,"tag":440,"props":1666,"children":1668},{"class":1667,"line":1110},[442,1640],[1669,1674,1679,1683,1688],{"type":149,"tag":440,"props":1670,"children":1671},{"style":446},[1672],{"type":154,"value":1673},"  __builtin_memcpy",{"type":149,"tag":440,"props":1675,"children":1676},{"style":1122},[1677],{"type":154,"value":1678},"(eth",{"type":149,"tag":440,"props":1680,"children":1681},{"style":1164},[1682],{"type":154,"value":1176},{"type":149,"tag":440,"props":1684,"children":1685},{"style":1306},[1686],{"type":154,"value":1687},"h_source",{"type":149,"tag":440,"props":1689,"children":1690},{"style":1122},[1691],{"type":154,"value":1692},", fib.smac, ETH_ALEN);\n",{"type":149,"tag":440,"props":1694,"children":1696},{"class":1695,"line":1111},[442,1640],[1697,1701,1705,1709,1714],{"type":149,"tag":440,"props":1698,"children":1699},{"style":446},[1700],{"type":154,"value":1673},{"type":149,"tag":440,"props":1702,"children":1703},{"style":1122},[1704],{"type":154,"value":1678},{"type":149,"tag":440,"props":1706,"children":1707},{"style":1164},[1708],{"type":154,"value":1176},{"type":149,"tag":440,"props":1710,"children":1711},{"style":1306},[1712],{"type":154,"value":1713},"h_dest",{"type":149,"tag":440,"props":1715,"children":1716},{"style":1122},[1717],{"type":154,"value":1718},", fib.dmac, ETH_ALEN);\n",{"type":149,"tag":440,"props":1720,"children":1722},{"class":442,"line":1721},29,[1723],{"type":149,"tag":440,"props":1724,"children":1725},{"style":1122},[1726],{"type":154,"value":1125},{"type":149,"tag":387,"props":1728,"children":1729},{"kind":389},[1730],{"type":149,"tag":150,"props":1731,"children":1732},{},[1733,1735,1741],{"type":154,"value":1734}," The simple hashing implementation (",{"type":149,"tag":217,"props":1736,"children":1738},{"className":1737},[],[1739],{"type":154,"value":1740},"xdp_hash_tuple",{"type":154,"value":1742}," function) is the same as in the previous NAT load balancer coding lab.",{"type":149,"tag":150,"props":1744,"children":1745},{},[1746,1748,1753,1755,1761],{"type":154,"value":1747},"The cool thing here is that theres no need to maintain any connection-tracking state in the load balancer (unlike a NAT load balancer). We simply redirect the packet to the selected backend nodebased on MAC addresses retrieved via ",{"type":149,"tag":217,"props":1749,"children":1751},{"className":1750},[],[1752],{"type":154,"value":971},{"type":154,"value":1754}," in ",{"type":149,"tag":217,"props":1756,"children":1758},{"className":1757},[],[1759],{"type":154,"value":1760},"fib_lookup_v4_full",{"type":154,"value":1762},"and the backend responds directly to the client based on the IP header.",{"type":149,"tag":150,"props":1764,"children":1765},{},[1766],{"type":154,"value":1767},"The load balancer doesnt even touch the IP header, meaning the backend still receives the original client source IP and can reply directly to it, bypassing the load balancer.",{"type":149,"tag":791,"props":1769,"children":1771},{":summary":1770},"The funny thing about source MAC address",[1772,1777,1782],{"type":149,"tag":150,"props":1773,"children":1774},{},[1775],{"type":154,"value":1776},"If you look at most (if not all) DSR tutorials, they claim you only need to update the destination MAC address for L2 DSR to work.",{"type":149,"tag":150,"props":1778,"children":1779},{},[1780],{"type":154,"value":1781},"But thats only partially true  those examples actually rely on the kernels networking stack to build the correct Ethernet header.",{"type":149,"tag":150,"props":1783,"children":1784},{},[1785],{"type":154,"value":1786},"With eBPF, we \"operate below the kernel networking stack\", so it doesnt handle that for us. As a result, we also need to update the source MAC address manually.",{"type":149,"tag":150,"props":1788,"children":1789},{},[1790],{"type":154,"value":1791},"Let's see this in action.",{"type":149,"tag":305,"props":1793,"children":1795},{"id":1794},"running-the-load-balancer",[1796],{"type":154,"value":1797},"Running the Load Balancer",{"type":149,"tag":387,"props":1799,"children":1801},{"kind":1800},"warning",[1802],{"type":149,"tag":150,"props":1803,"children":1804},{},[1805],{"type":154,"value":1806}," Before moving on, make sure the VIP is configured on both the load balancer and the backend nodes as described above, and that the ARP table is populated on the load balancer.",{"type":149,"tag":150,"props":1808,"children":1809},{},[1810,1812,1817,1818,1823],{"type":154,"value":1811},"Spawn the HTTP Server on both backends (",{"type":149,"tag":217,"props":1813,"children":1815},{"className":1814},[],[1816],{"type":154,"value":42},{"type":154,"value":292},{"type":149,"tag":217,"props":1819,"children":1821},{"className":1820},[],[1822],{"type":154,"value":45},{"type":154,"value":1824}," tabs), explicitly binded to listen for requests on VIP:",{"type":149,"tag":429,"props":1826,"children":1828},{"className":431,"code":1827,"language":433,"meta":434,"style":434},"python3 -m http.server 8000 --bind 192.168.178.15\n",[1829],{"type":149,"tag":217,"props":1830,"children":1831},{"__ignoreMap":434},[1832],{"type":149,"tag":440,"props":1833,"children":1834},{"class":442,"line":97},[1835,1840,1845,1850,1855,1860],{"type":149,"tag":440,"props":1836,"children":1837},{"style":446},[1838],{"type":154,"value":1839},"python3",{"type":149,"tag":440,"props":1841,"children":1842},{"style":452},[1843],{"type":154,"value":1844}," -m",{"type":149,"tag":440,"props":1846,"children":1847},{"style":452},[1848],{"type":154,"value":1849}," http.server",{"type":149,"tag":440,"props":1851,"children":1852},{"style":660},[1853],{"type":154,"value":1854}," 8000",{"type":149,"tag":440,"props":1856,"children":1857},{"style":452},[1858],{"type":154,"value":1859}," --bind",{"type":149,"tag":440,"props":1861,"children":1862},{"style":660},[1863],{"type":154,"value":895},{"type":149,"tag":150,"props":1865,"children":1866},{},[1867,1869,1874,1876,1882],{"type":154,"value":1868},"Compile and run the load balancer (in the ",{"type":149,"tag":217,"props":1870,"children":1872},{"className":1871},[],[1873],{"type":154,"value":37},{"type":154,"value":1875}," tab under the ",{"type":149,"tag":217,"props":1877,"children":1879},{"className":1878},[],[1880],{"type":154,"value":1881},"lab",{"type":154,"value":1883}," directory), using:",{"type":149,"tag":429,"props":1885,"children":1887},{"className":431,"code":1886,"language":433,"meta":434,"style":434},"go generate\ngo build\nsudo ./lb -i eth0 --backends 192.168.178.11,192.168.178.12\n",[1888],{"type":149,"tag":217,"props":1889,"children":1890},{"__ignoreMap":434},[1891,1904,1916],{"type":149,"tag":440,"props":1892,"children":1893},{"class":442,"line":97},[1894,1899],{"type":149,"tag":440,"props":1895,"children":1896},{"style":446},[1897],{"type":154,"value":1898},"go",{"type":149,"tag":440,"props":1900,"children":1901},{"style":452},[1902],{"type":154,"value":1903}," generate\n",{"type":149,"tag":440,"props":1905,"children":1906},{"class":442,"line":57},[1907,1911],{"type":149,"tag":440,"props":1908,"children":1909},{"style":446},[1910],{"type":154,"value":1898},{"type":149,"tag":440,"props":1912,"children":1913},{"style":452},[1914],{"type":154,"value":1915}," build\n",{"type":149,"tag":440,"props":1917,"children":1918},{"class":442,"line":637},[1919,1923,1928,1933,1937,1942],{"type":149,"tag":440,"props":1920,"children":1921},{"style":446},[1922],{"type":154,"value":449},{"type":149,"tag":440,"props":1924,"children":1925},{"style":452},[1926],{"type":154,"value":1927}," ./lb",{"type":149,"tag":440,"props":1929,"children":1930},{"style":452},[1931],{"type":154,"value":1932}," -i",{"type":149,"tag":440,"props":1934,"children":1935},{"style":452},[1936],{"type":154,"value":480},{"type":149,"tag":440,"props":1938,"children":1939},{"style":452},[1940],{"type":154,"value":1941}," --backends",{"type":149,"tag":440,"props":1943,"children":1944},{"style":452},[1945],{"type":154,"value":1946}," 192.168.178.11,192.168.178.12\n",{"type":149,"tag":791,"props":1948,"children":1950},{":summary":1949},"What are these input parameters?",[1951,1962],{"type":149,"tag":150,"props":1952,"children":1953},{},[1954,1960],{"type":149,"tag":217,"props":1955,"children":1957},{"className":1956},[],[1958],{"type":154,"value":1959},"-i",{"type":154,"value":1961}," expects the network interface on which this XDP Load Balancer program will run.",{"type":149,"tag":150,"props":1963,"children":1964},{},[1965,1971],{"type":149,"tag":217,"props":1966,"children":1968},{"className":1967},[],[1969],{"type":154,"value":1970},"-backends",{"type":154,"value":1972}," expects the list of backend IPs in this playground",{"type":149,"tag":150,"props":1974,"children":1975},{},[1976,1978,1983],{"type":154,"value":1977},"Now you can query the VIP from the ",{"type":149,"tag":217,"props":1979,"children":1981},{"className":1980},[],[1982],{"type":154,"value":51},{"type":154,"value":1984}," tab, using:",{"type":149,"tag":429,"props":1986,"children":1988},{"className":431,"code":1987,"language":433,"meta":434,"style":434},"curl http://192.168.178.15:8000\n",[1989],{"type":149,"tag":217,"props":1990,"children":1991},{"__ignoreMap":434},[1992],{"type":149,"tag":440,"props":1993,"children":1994},{"class":442,"line":97},[1995,2000],{"type":149,"tag":440,"props":1996,"children":1997},{"style":446},[1998],{"type":154,"value":1999},"curl",{"type":149,"tag":440,"props":2001,"children":2002},{"style":452},[2003],{"type":154,"value":2004}," http://192.168.178.15:8000\n",{"type":149,"tag":150,"props":2006,"children":2007},{},[2008],{"type":154,"value":2009},"and confirm that the request is indeed on the HTTP server received from the client (IP at the beginning of the line):",{"type":149,"tag":429,"props":2011,"children":2013},{"className":431,"code":2012,"language":433,"meta":434,"style":434},"10.0.0.20 - - [01/Jan/2026 16:03:45] \"GET / HTTP/1.1\" 200 -\n",[2014],{"type":149,"tag":217,"props":2015,"children":2016},{"__ignoreMap":434},[2017],{"type":149,"tag":440,"props":2018,"children":2019},{"class":442,"line":97},[2020,2024,2029,2033,2038,2043,2048,2053],{"type":149,"tag":440,"props":2021,"children":2022},{"style":446},[2023],{"type":154,"value":145},{"type":149,"tag":440,"props":2025,"children":2026},{"style":452},[2027],{"type":154,"value":2028}," -",{"type":149,"tag":440,"props":2030,"children":2031},{"style":452},[2032],{"type":154,"value":2028},{"type":149,"tag":440,"props":2034,"children":2035},{"style":1122},[2036],{"type":154,"value":2037}," [01/Jan/2026 ",{"type":149,"tag":440,"props":2039,"children":2040},{"style":452},[2041],{"type":154,"value":2042},"16:03:45]",{"type":149,"tag":440,"props":2044,"children":2045},{"style":452},[2046],{"type":154,"value":2047}," \"GET / HTTP/1.1\"",{"type":149,"tag":440,"props":2049,"children":2050},{"style":660},[2051],{"type":154,"value":2052}," 200",{"type":149,"tag":440,"props":2054,"children":2055},{"style":452},[2056],{"type":154,"value":2057}," -\n",{"type":149,"tag":387,"props":2059,"children":2060},{"kind":389},[2061,2074,2135,2140,2264,2276],{"type":149,"tag":150,"props":2062,"children":2063},{},[2064,2066,2072],{"type":154,"value":2065},"But to be absolutely sure the request in fact goes through the load balancer, run ",{"type":149,"tag":217,"props":2067,"children":2069},{"className":2068},[],[2070],{"type":154,"value":2071},"tcpdump",{"type":154,"value":2073}," on both backends and view the MAC addresses:",{"type":149,"tag":429,"props":2075,"children":2077},{"className":431,"code":2076,"language":433,"meta":434,"style":434},"sudo tcpdump -i eth0 -n -t -e -q tcp port 8000\n",[2078],{"type":149,"tag":217,"props":2079,"children":2080},{"__ignoreMap":434},[2081],{"type":149,"tag":440,"props":2082,"children":2083},{"class":442,"line":97},[2084,2088,2093,2097,2101,2106,2111,2116,2121,2125,2130],{"type":149,"tag":440,"props":2085,"children":2086},{"style":446},[2087],{"type":154,"value":449},{"type":149,"tag":440,"props":2089,"children":2090},{"style":452},[2091],{"type":154,"value":2092}," tcpdump",{"type":149,"tag":440,"props":2094,"children":2095},{"style":452},[2096],{"type":154,"value":1932},{"type":149,"tag":440,"props":2098,"children":2099},{"style":452},[2100],{"type":154,"value":480},{"type":149,"tag":440,"props":2102,"children":2103},{"style":452},[2104],{"type":154,"value":2105}," -n",{"type":149,"tag":440,"props":2107,"children":2108},{"style":452},[2109],{"type":154,"value":2110}," -t",{"type":149,"tag":440,"props":2112,"children":2113},{"style":452},[2114],{"type":154,"value":2115}," -e",{"type":149,"tag":440,"props":2117,"children":2118},{"style":452},[2119],{"type":154,"value":2120}," -q",{"type":149,"tag":440,"props":2122,"children":2123},{"style":452},[2124],{"type":154,"value":1223},{"type":149,"tag":440,"props":2126,"children":2127},{"style":452},[2128],{"type":154,"value":2129}," port",{"type":149,"tag":440,"props":2131,"children":2132},{"style":660},[2133],{"type":154,"value":2134}," 8000\n",{"type":149,"tag":150,"props":2136,"children":2137},{},[2138],{"type":154,"value":2139},"You should see output similar to the following (simplified for clarity to highlight the DSR flow):",{"type":149,"tag":429,"props":2141,"children":2143},{"className":431,"code":2142,"language":433,"meta":434,"style":434},"LB_MAC > BACKEND_MAC, IPv4, length 74: CLIENT_IP/PORT > BACKEND_IP/PORT: tcp 0 # LB -> Backend (while retaining client source IP)\nBACKEND_MAC > GATEWAY_MAC, IPv4, length 74: BACKEND_IP/PORT > CLIENT_IP/PORT: tcp 0 # Backend -> Gatewat (where the client IP is the destination)\n",[2144],{"type":149,"tag":217,"props":2145,"children":2146},{"__ignoreMap":434},[2147,2208],{"type":149,"tag":440,"props":2148,"children":2149},{"class":442,"line":97},[2150,2155,2160,2165,2170,2175,2180,2185,2189,2194,2198,2203],{"type":149,"tag":440,"props":2151,"children":2152},{"style":446},[2153],{"type":154,"value":2154},"LB_MAC",{"type":149,"tag":440,"props":2156,"children":2157},{"style":1164},[2158],{"type":154,"value":2159}," >",{"type":149,"tag":440,"props":2161,"children":2162},{"style":452},[2163],{"type":154,"value":2164}," BACKEND_MAC,",{"type":149,"tag":440,"props":2166,"children":2167},{"style":452},[2168],{"type":154,"value":2169}," IPv4,",{"type":149,"tag":440,"props":2171,"children":2172},{"style":452},[2173],{"type":154,"value":2174}," length",{"type":149,"tag":440,"props":2176,"children":2177},{"style":452},[2178],{"type":154,"value":2179}," 74:",{"type":149,"tag":440,"props":2181,"children":2182},{"style":452},[2183],{"type":154,"value":2184}," CLIENT_IP/PORT",{"type":149,"tag":440,"props":2186,"children":2187},{"style":1164},[2188],{"type":154,"value":2159},{"type":149,"tag":440,"props":2190,"children":2191},{"style":452},[2192],{"type":154,"value":2193}," BACKEND_IP/PORT:",{"type":149,"tag":440,"props":2195,"children":2196},{"style":452},[2197],{"type":154,"value":1223},{"type":149,"tag":440,"props":2199,"children":2200},{"style":660},[2201],{"type":154,"value":2202}," 0",{"type":149,"tag":440,"props":2204,"children":2205},{"style":483},[2206],{"type":154,"value":2207}," # LB -> Backend (while retaining client source IP)\n",{"type":149,"tag":440,"props":2209,"children":2210},{"class":442,"line":57},[2211,2216,2220,2225,2229,2233,2237,2242,2246,2251,2255,2259],{"type":149,"tag":440,"props":2212,"children":2213},{"style":446},[2214],{"type":154,"value":2215},"BACKEND_MAC",{"type":149,"tag":440,"props":2217,"children":2218},{"style":1164},[2219],{"type":154,"value":2159},{"type":149,"tag":440,"props":2221,"children":2222},{"style":452},[2223],{"type":154,"value":2224}," GATEWAY_MAC,",{"type":149,"tag":440,"props":2226,"children":2227},{"style":452},[2228],{"type":154,"value":2169},{"type":149,"tag":440,"props":2230,"children":2231},{"style":452},[2232],{"type":154,"value":2174},{"type":149,"tag":440,"props":2234,"children":2235},{"style":452},[2236],{"type":154,"value":2179},{"type":149,"tag":440,"props":2238,"children":2239},{"style":452},[2240],{"type":154,"value":2241}," BACKEND_IP/PORT",{"type":149,"tag":440,"props":2243,"children":2244},{"style":1164},[2245],{"type":154,"value":2159},{"type":149,"tag":440,"props":2247,"children":2248},{"style":452},[2249],{"type":154,"value":2250}," CLIENT_IP/PORT:",{"type":149,"tag":440,"props":2252,"children":2253},{"style":452},[2254],{"type":154,"value":1223},{"type":149,"tag":440,"props":2256,"children":2257},{"style":660},[2258],{"type":154,"value":2202},{"type":149,"tag":440,"props":2260,"children":2261},{"style":483},[2262],{"type":154,"value":2263}," # Backend -> Gatewat (where the client IP is the destination)\n",{"type":149,"tag":150,"props":2265,"children":2266},{},[2267,2269,2274],{"type":154,"value":2268},"Or just check the load balancer logs (in the ",{"type":149,"tag":217,"props":2270,"children":2272},{"className":2271},[],[2273],{"type":154,"value":37},{"type":154,"value":2275},") using:",{"type":149,"tag":429,"props":2277,"children":2279},{"className":431,"code":2278,"language":433,"meta":434,"style":434},"sudo bpftool prog trace\n",[2280],{"type":149,"tag":217,"props":2281,"children":2282},{"__ignoreMap":434},[2283],{"type":149,"tag":440,"props":2284,"children":2285},{"class":442,"line":97},[2286,2290,2295,2300],{"type":149,"tag":440,"props":2287,"children":2288},{"style":446},[2289],{"type":154,"value":449},{"type":149,"tag":440,"props":2291,"children":2292},{"style":452},[2293],{"type":154,"value":2294}," bpftool",{"type":149,"tag":440,"props":2296,"children":2297},{"style":452},[2298],{"type":154,"value":2299}," prog",{"type":149,"tag":440,"props":2301,"children":2302},{"style":452},[2303],{"type":154,"value":2304}," trace\n",{"type":149,"tag":2306,"props":2307,"children":2308},"hr",{},[],{"type":149,"tag":150,"props":2310,"children":2311},{},[2312],{"type":149,"tag":328,"props":2313,"children":2314},{},[2315],{"type":154,"value":2316},"But this only really works when the load balancer and the backends are on the same subnetwork (i.e., have direct L2 connectivity).",{"type":149,"tag":150,"props":2318,"children":2319},{},[2320],{"type":154,"value":2321},"Just imagine if the load balancer tried to redirect traffic to a backend in a different L2 network.",{"type":149,"tag":150,"props":2323,"children":2324},{},[2325],{"type":154,"value":2326},"It would set the destination MAC address to the gateways interface (trying to exit current L2 network), and since only the VIP on the load balancer is advertised across the network, the gateway would send the packet back to the load balancerbecause thats the only route it knows for that VIPcausing a loop.",{"type":149,"tag":188,"props":2328,"children":2331},{":alt":2329,":src":2330},"Problem of XDP DSR L2 Load Balancing","/content/files/tutorials/xdp-dsr-layer2-lb-92b02f3e/__static__/failure.png",[],{"type":149,"tag":150,"props":2333,"children":2334},{},[2335],{"type":154,"value":2336},"And this is quite a constraint for many setups to require the backends to share the same network as the load balancer.",{"type":149,"tag":150,"props":2338,"children":2339},{},[2340],{"type":154,"value":2341},"Not to mention, hosting the load balancer and backend nodes on the same subnetwork also increases the risk of complete failures - network down  everything down.",{"type":149,"tag":150,"props":2343,"children":2344},{},[2345],{"type":154,"value":2346},"This is where IPIP DSR Load balancing comes into play - but more about that in the upcoming tutorial.",{"type":149,"tag":2348,"props":2349,"children":2350},"style",{},[2351],{"type":154,"value":2352},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}",["Reactive",35],{"title":434,"searchDepth":57,"depth":57,"links":2355},[2356,2360],{"id":307,"depth":57,"text":310,"children":2357},[2358,2359],{"id":362,"depth":637,"text":365},{"id":1079,"depth":637,"text":1082},{"id":1794,"depth":57,"text":1797},["Reactive",2362],{},["Reactive",2364],{},["Reactive",2366],{},"#xdp-dsr-layer2-lb-92b02f3e-server",{"left":40,"top":40,"width":1107,"height":1107,"rotate":40,"vFlip":2369,"hFlip":2369,"body":2370},false,"\u003Cpath fill=\"currentColor\" d=\"M6 18v-5h1v4h4v1zm11-7V7h-4V6h5v5z\"/>",{"left":40,"top":40,"width":2372,"height":2372,"rotate":40,"vFlip":2369,"hFlip":2369,"body":2373},256,"\u003Cpath fill=\"currentColor\" d=\"M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z\"/>",["Reactive",2375],{"$scurrentUser":2376,"$salerts":2380,"$scontentToggle":2381,"$ssite-config":2382},{"id":2377,"anonymous":11,"effectiveTier":2378,"hasEmailSubscription":2369},"697b5f64cc8f8f56faac74e1",{"name":2379},"free",[],{"/tutorials/xdp-dsr-layer2-lb-92b02f3e":11},{"_priority":2383,"env":2386,"name":2387,"url":2388},{"name":2384,"env":2385,"url":40},-3,-15,"production","iximiuz Labs","https://labs.iximiuz.com",["Set"],["ShallowReactive",2391],{"tutorial-page-tutorial-xdp-dsr-layer2-lb-92b02f3e":-1,"content-tutorial-xdp-dsr-layer2-lb-92b02f3e-v1769024630415":-1,"tutorial-page-play-none":-1,"i-material-symbols-light:expand-content":-1,"i-ph:copy":-1},"/tutorials/xdp-dsr-layer2-lb-92b02f3e"]</script></body></html>