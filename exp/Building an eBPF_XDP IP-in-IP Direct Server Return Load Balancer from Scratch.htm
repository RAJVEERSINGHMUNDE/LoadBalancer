<!DOCTYPE html>
<html lang="en" data-theme="cmyk"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Building an eBPF/XDP IP-in-IP Direct Server Return Load Balancer from Scratch</title><link nonce="" rel="stylesheet" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/inter.css"><link nonce="" rel="stylesheet" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/Source_Code_Pro.css"><link nonce="" integrity="sha384-W0UkFG5ktUlCLBh/tZDw+slzbqWhSr7IE92M0sRiua5PJAa1/rQ1oZeywI2xmhma" rel="stylesheet" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/css-tokens-theme.css"><style nonce="">.layout-enter-active,.layout-leave-active{transition:all .2s}.layout-enter-from,.layout-leave-to{filter:grayscale(1)}.page-enter-active,.page-leave-active{transition:all .2s}.page-enter-from,.page-leave-to{filter:blur(1rem);opacity:0}</style><style nonce="">.tutorial-header[data-v-0d30d5a9]{display:block;font-family:var(--typography-font-display);font-size:40px;font-weight:var(--prose-h1-fontWeight);letter-spacing:var(--prose-h1-letterSpacing);line-height:var(--prose-h1-lineHeight);margin:var(--prose-h1-margin);margin-bottom:20px;margin-top:20px}</style><style nonce="">#site-header[data-v-7f8ed6a6]{transition:border .25s ease}</style><style nonce="">a[data-v-c294bba9]{font-family:var(--typography-font-sans);font-weight:400}</style><style nonce="">[data-v-6adfc778]{font-family:var(--typography-font-body);font-size:.85rem;line-height:var(--prose-p-lineHeight)}</style><style nonce="">.fade-out[data-v-200caef3]{position:relative}.fade-out[data-v-200caef3]:after{background:linear-gradient(180deg,#fff0 0,#fff);bottom:0;content:"";height:200px;left:0;position:absolute;width:100%}.unit-title[data-v-200caef3]{font-family:var(--typography-font-display);font-size:1.25rem;font-weight:var(--prose-h3-fontWeight);letter-spacing:var(--prose-h3-letterSpacing);line-height:var(--prose-h3-lineHeight);margin-bottom:16px;margin-top:16px}@media(min-width:768px){.unit-title[data-v-200caef3]{font-size:var(--prose-h3-fontSize)}}.expand-all .unit-title[data-v-200caef3]{border-bottom:1px solid #eee;margin-bottom:4px;padding-bottom:.3em}.prose-h1[data-v-200caef3]{margin-top:24px}</style><style nonce="">p[data-v-b025fb9f]{font-family:var(--typography-font-body);font-size:var(--prose-p-fontSize);line-height:var(--prose-p-lineHeight);margin:var(--prose-p-margin)}p[data-v-b025fb9f] br{content:"";display:block;margin:var(--prose-p-br-margin)}</style><style nonce="">a[data-v-abeb6555]{color:#4078c0;font-family:var(--typography-font-body);font-weight:400;text-decoration:none}a[data-v-abeb6555]:hover{text-decoration:underline}a[data-v-abeb6555]:has(img){border-width:0}</style><style nonce="">ul[data-v-533e29f3]{font-family:var(--typography-font-body);list-style-type:var(--prose-ul-listStyleType);margin:var(--prose-ul-margin);padding-inline-start:var(--prose-ul-paddingInlineStart)}ul[data-v-533e29f3]>li::marker{color:var(--prose-ul-li-markerColor)}ul[data-v-533e29f3]>li ol,ul[data-v-533e29f3]>li ul{margin:0}</style><style nonce="">li[data-v-2969431c]{font-family:var(--typography-font-body);list-style-position:var(--prose-li-listStylePosition);margin:var(--prose-li-margin)}</style><style nonce="">code[data-v-a031129a]{border-radius:var(--prose-code-inline-borderRadius);font-family:var(--typography-font-code);padding:var(--prose-code-inline-padding);mx:1px;background-color:var(--prose-code-inline-backgroundColor);color:var(--prose-code-inline-color);font-size:var(--prose-code-inline-fontSize);font-weight:var(--prose-code-inline-fontWeight)}tbody code[data-v-a031129a]{font-size:var(--prose-tbody-code-inline-fontSize)}h1 a code[data-v-a031129a],h2 a code[data-v-a031129a],h3 a code[data-v-a031129a],h4 a code[data-v-a031129a],h5 a code[data-v-a031129a],h6 a code[data-v-a031129a]{border-radius:var(--prose-code-inline-borderRadius);color:var(--prose-code-inline-color);font-size:.777777em;padding:.15em .5em}a code[data-v-a031129a]{border-color:var(--prose-a-code-border-color-static);border-style:var(--prose-a-code-border-style);border-width:var(--prose-a-code-border-width);color:var(--prose-a-code-color-static)}a:hover code[data-v-a031129a]{background-color:var(--prose-a-code-background-hover);border-color:var(--prose-a-code-border-color-hover);color:var(--prose-a-code-color-hover)}</style><style nonce="">h2[data-v-b9b1576a]{border-bottom:1px solid #eee;display:block;font-family:var(--typography-font-display);font-size:var(--prose-h2-fontSize);font-weight:var(--prose-h2-fontWeight);letter-spacing:var(--prose-h2-letterSpacing);line-height:var(--prose-h2-lineHeight);margin:var(--prose-h2-margin);padding-bottom:.3em}h2[data-v-b9b1576a] .icon{display:inline-block;height:var(--prose-h2-iconSize);margin-inline-start:12px;opacity:0;transition:opacity .1s;width:var(--prose-h2-iconSize)}h2 a[data-v-b9b1576a]:hover .icon{opacity:1}</style><style nonce="">h3[data-v-9a0ceb30]{display:block;font-family:var(--typography-font-display);font-size:var(--prose-h3-fontSize);font-weight:var(--prose-h3-fontWeight);letter-spacing:var(--prose-h3-letterSpacing);line-height:var(--prose-h3-lineHeight);margin:var(--prose-h3-margin)}h3[data-v-9a0ceb30] .icon{display:inline-block;height:var(--prose-h3-iconSize);margin-inline-start:12px;opacity:0;transition:opacity .1s;width:var(--prose-h3-iconSize)}h3 a[data-v-9a0ceb30]:hover .icon{opacity:1}</style><style nonce="">pre code .line{display:block;min-height:1rem}</style><style nonce="">.prose-code[data-v-4578ab24]{-webkit-backdrop-filter:var(--prose-code-block-backdropFilter);backdrop-filter:var(--prose-code-block-backdropFilter);background-color:var(--prose-code-block-backgroundColor);border-color:var(--prose-code-block-borderColor);border-radius:var(--prose-code-block-borderRadius);border-style:var(--prose-code-block-borderStyle);border-width:var(--prose-code-block-borderWidth);color:var(--prose-code-block-color);font-size:var(--prose-code-block-fontSize);margin:var(--prose-code-block-margin);overflow:hidden;position:relative;width:100%}.prose-code[data-v-4578ab24] code{flex-grow:1}.copy-button[data-v-4578ab24]{background-color:#3c3c3c99;bottom:0;color:#e6e6e6cc;inset-inline-end:0;opacity:0;position:absolute}.prose-code:hover .copy-button[data-v-4578ab24]{opacity:1}.prose-code:hover .copy-button[data-v-4578ab24]:hover{color:#e6e6e6}.copy-button[data-v-4578ab24]:focus{box-shadow:none!important}[data-v-4578ab24] code{display:flex;flex-direction:column}[data-v-4578ab24] .line{display:inline-table;min-height:1.5rem}.filename[data-v-4578ab24]{-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);border-radius:var(--typography-radii-lg);color:#e6e6e6;font-family:var(--typography-font-code);font-size:var(--typography-fontSize-xs);inset-inline-end:0;line-height:var(--typography-lead-normal);padding:.5rem .75rem;position:absolute;top:0;transition:opacity .2s}.prose-code:hover .filename[data-v-4578ab24]:hover{opacity:1}[data-v-4578ab24] pre{display:flex;flex:1;line-height:var(--typography-lead-relaxed);margin:0;overflow-x:auto;padding:var(--prose-code-block-pre-padding)}[data-v-4578ab24] .line.highlight{background-color:#000;margin:0 -16px;padding:0 16px}[data-v-4578ab24] .line:not(.highlight)+.line.highlight{border-top:1px solid #444}[data-v-4578ab24] .line.highlight+.line:not(.highlight){border-top:1px solid #444;margin:0 -16px;padding:0 16px}[data-v-4578ab24] .line.highlight:first-child{border-top:1px solid #444}[data-v-4578ab24] .line.highlight:last-child{border-bottom:1px solid #444}</style><style nonce="">button[data-v-134dddac]{border-radius:3px;margin:4px;opacity:0;padding:4px;transform:scale(.75);transition:all .2s}button[data-v-134dddac]:focus{box-shadow:0 0 0 2px var(--typography-color-primary-500);opacity:1;outline:none}button.show[data-v-134dddac]{opacity:1;transform:scale(1)}button .icon-wrapper[data-v-134dddac]{display:block;height:18px;position:relative;width:18px}button .icon-wrapper .icon[data-v-134dddac]{display:block;position:absolute}button .icon-wrapper .fade-enter-active[data-v-134dddac],button .icon-wrapper .fade-leave-active[data-v-134dddac]{transition:opacity .2s}button .icon-wrapper .fade-enter-from[data-v-134dddac],button .icon-wrapper .fade-leave-to[data-v-134dddac]{opacity:0}</style><style nonce="">details>summary[data-v-370f298d]{font-size:var(--prose-p-fontSize)}</style><link nonce="" integrity="sha384-VgdaralgzMMDKoxbvggz88cSHbXjvjsd7NI4i46uVtHp/jjxBeJak6GsR2cO7GHi" rel="stylesheet" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/entry.DO90-MQw.css" crossorigin=""><link nonce="" integrity="sha384-K18nopic+X0JunSv2KJqsE7W6KB015nwBWeFR+Jh5SQtvXW7Yy4WjDfxnYjG/Q6g" rel="modulepreload" as="script" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/A538-Xd4.js"><link nonce="" integrity="sha384-Wc22hz0UYZLeSexsNb8aBw3zxHJlH2ESymLXu3JHi6m3sR49j4dleLGt1BVOkDjD" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CiaVwNEs.js"><link nonce="" integrity="sha384-wV/FyIfkoKuneA9gx32UbcC1rWydYJhlr+cMCHu0oN57ZtVcBz8nUCI/A5rPOyHo" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DlAUqK2U.js"><link nonce="" integrity="sha384-JBRondsjCje9uCAk+glC4LA43omHrNK2Afdoafa36EDjES+Za12EFI00uupOcyt9" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BGeBmTCG.js"><link nonce="" integrity="sha384-iOrs0N2+i+e0F5pOd4kyCQpmnc35XQjz3RZS60HpeqOwIhinqlaiSmxKCbvBJsW1" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CMnvrPLD.js"><link nonce="" integrity="sha384-CEUXna7zyFjV1aUCqrEskDTDcYt8x65beb5ECylmP2u4a3XjjuBUt/selECdFNZK" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/B1saq5Fe.js"><link nonce="" integrity="sha384-syA1913w37X8NLuSOALbgW9QS2EPUV6mM/Ff8nCauX6ZiD/sHqOLDthOqDMKckCB" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D1KxtS4O.js"><link nonce="" integrity="sha384-M0JTRKVfKGOUYhocKYuV/WMSR+qOluNgGUQsIG3GYlIiO+jnxgHfMO2WJmrUEqcK" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Cd08WlCA.js"><link nonce="" integrity="sha384-2W8FPc/1+bG0TweePWS4uRwvvuxGyDDRF59Oq4c+38RHPjntjyyWlD7v1Sa6zpkX" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DTtjwkpk.js"><link nonce="" integrity="sha384-L1CRgqloambsm3q9dC2rb+ifjcv/8Hpqm7EHEDie0lhu2KclJZ/sSVOkeDGM9zDX" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C82fcFPv.js"><link nonce="" integrity="sha384-0hD5FZjIYmNI9RitylIyG4efbmRl6kOaKiNnJAhMuCYGphbCEU2T/NgpXk32OXh5" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/4AR0jMDd.js"><link nonce="" integrity="sha384-DPKYF61GYn/kB6dn/ABdKqapefAnD2W9nBAk2ofHesgnyMnqMJkO7Too4t+mNYYP" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/B0C1x6gY.js"><link nonce="" integrity="sha384-YgqV0R4URFlIK0f7PeExV/RhB0jCgDJ9GeV41VNl6GAEEwy6vHA/PoQ3VSH8s56f" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DwrbW19N.js"><link nonce="" integrity="sha384-0BznfphaLvyEnFT1usV091akUax6dLFoMcZMmzjansRVn5BItWKgsDDCoo8iT/TY" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CwAYGw04.js"><link nonce="" integrity="sha384-b3SarygGZMZbGN79KG/bEqtJ2xVRemDnvZgqDewtIpgFuNBh75kpOVhZZYbBBlV/" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/B6Ia1wBT.js"><link nonce="" integrity="sha384-WRh3x9Ejk0elAhcgJQ8ETP2IGNgvqNr91aJXHrH9yZxCCLgchCR41NgV3E7vAodd" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/ChZSQl3-.js"><link nonce="" integrity="sha384-F2pzDKtK6Wor8cY0Y3zbRz+fFovMZFLX8BsggEVAPXGz2+Ycy1I3P2cDE2KS/wOh" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/dzq8fjun.js"><link nonce="" integrity="sha384-I2aMPU2PaXlVS4e/fOmYY9zmZzsm1trtgIbztBZU0wObDOs1VIroOVWNsDhl6wHN" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/M8Go6PQG.js"><link nonce="" integrity="sha384-uodls5TYxZ8s/FGmTB1Xi3Eu1LUqit11VZ0fVdqtz16nO/2EG8G6ftEpI1QClK52" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/A7blpOo1.js"><link nonce="" integrity="sha384-wZXyrgfemDfNvKK67noacMWWCC0zKLBCwby1agqLAZk1PYstO1pYXd5LJ1vuq0JB" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BsfvSMgi.js"><link nonce="" integrity="sha384-Vs+CUGTU4JWQD2L1q1QN40N3Zvq9rYcfTbmA5eOdrmD/VMyI1iDmCHzMLPSdnCqv" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BWcS6GWa.js"><link nonce="" integrity="sha384-VVomnY5chwSXkMawT1OSXWNPPAe86IfpyIKeWX688WzzJ7lq/B0rADiyVnYOh6HM" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/JEhZ6VKh.js"><link nonce="" integrity="sha384-AbnqAjVFi3AmpARRzjM6+16Kv+rETq5s6nmZjsBv+hcl6SxoewxvHT+bGBjAhXeK" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Ci8QyKoZ.js"><link nonce="" integrity="sha384-td3wGu7krmhEJ5seMu1AU/xkFk7vUdQ3suaalpFhM4fwTaVN1h/H9rGaxFj5hmG8" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Btqf3kJo.js"><link nonce="" integrity="sha384-yQp3ZlUZQ0DO+FYouwTSmaxweszONpQqBRmj0jPaUrGPs6qVDenMPabcBy7ZVLmy" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Bxj5g83y.js"><link nonce="" integrity="sha384-n1bd298ysXlcokRTgpfLCRSQT0AXTmnPEQXg4ZJzQHwX1PKezwdaLv1OJ/b4mzD0" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CvPDKjD7.js"><link nonce="" integrity="sha384-ZTF2eLLsj0u4hMXoY82NP13biwgJDAwMzR2d+xBY6rQLO4f3t7LajO3uzq/vZqRX" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BcqSyfqL.js"><link nonce="" integrity="sha384-R5RBPCrYygxUzDyczdS9hiczqgYiS67n5heUG2T1GpfHtDEsmXSBLEmEO/BQzJaN" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/kvsfWoeJ.js"><link nonce="" integrity="sha384-tb1vqM45YGGFhc7XMYx4bDtjYSaXzAs9cnrgfmG8GKlE7RhDH4qAyu26XzuJ2YIC" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CzEdsMlG.js"><link nonce="" integrity="sha384-sUqEz/7mCozcDTVa3220YpCuurG9+lxtT39mpvAKoTCj9QExlOBwmCIFpsInI+s1" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/-3BZtTVG.js"><link nonce="" integrity="sha384-tnmwzNkA0rvNInwTi3QoUuQf2RJ/bW02kX94g7tDAOWaYuCg85E9BWXXixucWjqZ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BupvEF6F.js"><link nonce="" integrity="sha384-cv5eYt8EdzDHogT9noRhAtFPV9+Lrtkd/pkrKyTuN5tJroumDowpyUzCzhwVtaiC" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CxmcBoAF.js"><link nonce="" integrity="sha384-Y8UFu09ps1XTln8sVqrgbr/U3lz2Dhm/dACnR9sMrlzgij55P2HmnGCWzPoBSYyu" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BSSuG8K0.js"><link nonce="" integrity="sha384-z9/ospmVZd5cw4nwu5/8Qp5hJ8LT0YLR5aprKBlth8ZdKwPYddtBV4lpwoGmUwfN" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CCu705Yd.js"><link nonce="" integrity="sha384-ZSbWNj1OjFWl7HowKKC8kafoBc1s/7LHOfE9M7ljrgu/wf1sJhfQbLAYyRCzhZdY" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C_Jn_tlQ.js"><link nonce="" integrity="sha384-agWmXONfzBbTvKJgUzocvOAVtRahUQJ22dVI+EIlQcdvlhE/n+dJRuMKYyjQZNAJ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DVSoXPMN.js"><link nonce="" integrity="sha384-mgFzSSjDqczZLwcbehdgDcFRYeUW6C3GqxjgZTu/SLT01MGi+dpHHVI922F+X7C3" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CCTXTz88.js"><link nonce="" integrity="sha384-M74HEk3mc8nvuopWlZzTsK144Edv+f2lEjDaYoh2m4d7U7/KfZbi4AusDL0KhPHH" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CjdH43sM.js"><link nonce="" integrity="sha384-1gFXWiA9BubdJu/94hOlNp2XvvHoVIz4IGNQv59ibBQfiufGbZxQNBNhF8TAG/RV" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CDvDm27B.js"><link nonce="" integrity="sha384-jJcANp9lIArTZ9yN4OBsQ++lCuSSt2pGu3Scy2GlEgU3+8NcDeS7dyssrIUitInI" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/7kwUfJ3d.js"><link nonce="" integrity="sha384-EbtRkNeZD9um6+KMX5jCfluq+qSLTrv0RoysLc7gM+g4HZFMODnEaMGiOldAKh8/" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Bnu8tQBb.js"><link nonce="" integrity="sha384-UO8ijEdqHf7NyXBUpuq/GC4PXT75sLLrNgF2uqVsvASmGCRpiewQ2SHk9ea1IUqb" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CDzRe_IS.js"><link nonce="" integrity="sha384-cKyEWFmQQXO6kDxrNQo20qgZ4VMzQi2uSYiRl05tv1cNyQqU0PJtKu5fqUe4Ki1o" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BzCtePKg.js"><link nonce="" integrity="sha384-COlwUySgtGE6J2TePCYfL/nRrHywmQ1Jwo60ID/objGu8uiCIxttVy2yMr+jbpxj" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Db0ou0G2.js"><link nonce="" integrity="sha384-Rzk+8Cz0gBXmLuLBTSGp80a8fquQIqhPvRlo1IiJeo7hkgncIWi34YKwBlxVgsHt" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BARAL6rY.js"><link nonce="" integrity="sha384-/ZmdKieFBiaYx+w0UksW/OG8Hb72bs89W/nKPICK6PZl+kuDHDmuEvI4mRNPXLSv" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CM8tEzsp.js"><link nonce="" integrity="sha384-giGL5jqk/0PqHOOqxQuvp4G+iXuMqkfE+1Zlf/2kKJV7sYQ+BxSclVpba3tX/wh+" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CZ8UCyxH.js"><link nonce="" integrity="sha384-Jh+iKjfe7e7mgPtH9IYjVPHoUbiLzg8mm+xLGL/iff4u64ibokFnUpv/+RGj9dCO" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D8ksmjjz.js"><link nonce="" integrity="sha384-PvErhVuPH41hvqTZ49vsoFCpIC/z4slDP48GmOyo1IxCgXgMmhZYcqWmXvxmDdE1" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BnA2AwGF.js"><link nonce="" integrity="sha384-ML7907U1uYAjBfEawIa16NlkvQLFs4sBc0O+ZsHqG36bs2G6qYgIBKOtB3fbDcm3" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/mB6xp2LS.js"><link nonce="" integrity="sha384-obBf3ueJAL8aoDGeHfEgrAtpJ3qVSgFbWLFfi8i9I1zn7Fh9bL6xCWKRkSAsBPpf" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DOnqS9Sz.js"><link nonce="" integrity="sha384-ozfcbqESKh4t4toPRMlI7E/LSfwducV89LLckOM/iIRj/4KZI3Wvkzv1IIlXs4/c" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BUutWmwC.js"><link nonce="" integrity="sha384-WlWOhcPtQ/Kad84KA6wzn0gQeGRjnbnHA6YbAmrjb3x1h3Z2xgzDQn6hhPZNCoTd" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CYc7oDxg.js"><link nonce="" integrity="sha384-mrDm7dap5ABkEwphhcEecvmbqNbeRsvBYymtq9QRTG7VpTjjYlz8cKc81RROUeFA" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/iModbmJm.js"><link nonce="" integrity="sha384-p4j3LmYqWA9vFZi8KI2yZhEabBARpNL/Oi3nVD0aXbx96P85FplA/9FgQDD2BLdP" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BttOikXX.js"><link nonce="" integrity="sha384-l/XpZEHaHpHdyvYueKCjFu/1G9Azm0MCiXUSR+fyOtckk4NeLZF8k6zYCoBVDUUg" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CAUFPZS4.js"><link nonce="" integrity="sha384-Av0300jLea50veBs6pE41xEXCjESbAfDNYm2yxz8d97vI9SoWmI0Hcp+uma/jcX+" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D4i9E6T8.js"><link nonce="" integrity="sha384-Kt/+bu7AOzFl0uwSyv3X04YhXDK4jzHtjffPy2aGEnk/FoJB9cOsHGnPwPSskKMh" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Bv083VCc.js"><link nonce="" integrity="sha384-r/TOwaK7QKJSt/5vwLwCOITevVrg2DX1lGIdwdfBFVrN7yuzTWlORu7/uf2dJC9y" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/B57yXAr8.js"><link nonce="" integrity="sha384-0N5RM4kElInS4Fp1qFMxOc4OF69GD5JOJhCTDN1uFON4zETYzLPQhMF0kskTRzMM" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Bg33dJBS.js"><link nonce="" integrity="sha384-u3VmYVbrqSkrQNLkzFveD/vvLINNY0yl3cddefGwPydaEYiUQCs1uV/KRVUjPTa8" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DQwRZosE.js"><link nonce="" integrity="sha384-fH3nLz2uDngAE48/eCpdZrqWvpG0xiHSwlUR8aF2ihSqvqmN4OmDS/TVNCNTWnqR" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CArlX-cu.js"><link nonce="" integrity="sha384-u74iMlKyC0kRP5BMHYNGkp5S9orN2/gCeJgj5aZX1XDbtHuAdZFrU8qFOFz/eNLm" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DZyGvdVe.js"><link nonce="" integrity="sha384-GS5VYkWxfL4u4MdDC6Qo0DGKGF+lrWyOqK9ZJe2lisyIa7Svve0Ttt78PZZTwqY3" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BDKlkuys.js"><link nonce="" integrity="sha384-y80+/9hrjJwiVyHBE8AWXREf/wof34st0opT/h4kvDrEb2laljm3R8wJKQseme/J" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/1LkmMtl7.js"><link nonce="" integrity="sha384-9c95hdmG6ReSHzePMhSkOHTJSopHenH0otWJ8vMBjpF9X3CPHtYIcbCAQTX8PdOl" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/xOp4NLFu.js"><link nonce="" integrity="sha384-gMSBshNkqG1tBeB+L2gKaoY4oMW4+hYd4oWv9iLWHw9xBx0xV1OUHKMirXddsFRw" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BioJOeeE.js"><link nonce="" integrity="sha384-MwA0Sdu4AakDulpLReqjqw1RIa5qrB2TUqLJo+Db5G6CvTRTTDx4a8tEaOdSVNLx" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BHPsZYYG.js"><link nonce="" integrity="sha384-0L2Td2nqsSLt4fMliUjq+dvceWfLxnsNNeggJgFL+z1RP6q2lY3dIpBRDM2ObZAH" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CQUe4kzL.js"><link nonce="" integrity="sha384-53XwglVJLtGDmmynrYM9rgyETBLrmhyLZ7rrMhSo2SBjK3WgMof9cVczfk/F/Jzl" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BXoysCvc.js"><link nonce="" integrity="sha384-gzXIriZQL0YJn1tbOutH7KABTCI37AxDXpfsDegtUpa5c156iQBTuhrfNROu5Thk" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/bVVUK1Up.js"><link nonce="" integrity="sha384-NbmkXIRw/iEsysuJXcicjZ+p6w1q/BKa/sqxFk9dzfKtkUVNHl2dlWdzjczq3hQJ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/ChpWfMYt.js"><link nonce="" integrity="sha384-MiEIX+8nvVcF4/C2AnakM/xZVOSZUwgp9sX3M0dp9xuVHHHrJlv91nJQRgHk0Quv" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/csMlMc7I.js"><link nonce="" integrity="sha384-svAxaky+wOkSm0FK3/zqjV14+w8HlkJNStl5PbW1q/6YLYNXa3TVQlNdyRs25Pg0" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C7GKAtGK.js"><link nonce="" integrity="sha384-jWKAGfP+O3ErHtWOlwouqobnwxC2DN29v588eTZITOrTc2R01ngtrouBsqVdbCT7" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BL7qTDAr.js"><link nonce="" integrity="sha384-4pI+RYdvJhid05b/siB7KHnNxZlPTOdPojDRfnbIxjZho/sWNJcNQ1SNb5Qjo3I9" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CK0M71lT.js"><link nonce="" integrity="sha384-0+pxV72C5SbjyQwCXwgd4DF8SkZtG84RqBISsq7+Ml6e6P5t2g9o94DWGpB0Oy0b" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/c4uxQ8Wc.js"><link nonce="" integrity="sha384-1oAGdh3Ob3DhjeaIvvoAMwPn11xKR5BGJKypl8udvI7FxRd5094e7LiGBU+AXQNc" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DAsZ60qF.js"><link nonce="" integrity="sha384-B9ZNtOQnOJzP0adjSA7vD9KFGE8wq8Az8dT/U/qpIgJb/YyEYs6uz2CgKvr2PUoX" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DUAqYmp4.js"><link nonce="" integrity="sha384-pe7HW9XccXxhUCVvMVOXq3zlfWNDJ8M1xHyOt/JxJgJmlR0CXQ6TyVUa8J0WQabY" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DQyuHP0A.js"><link nonce="" integrity="sha384-4wAUkozzIJ0JmwD1ZWcwBO3VV7yJaa/KFi+K84/CamYjheklx4BVD8U8q8BtGJRe" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D6_gAmFJ.js"><link nonce="" integrity="sha384-j+AUYc7gZxlxcek5ud0DEYE8my+mwN+Q+N4Dz4yL+oXAeag33srrntaaKZzvhKnQ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BSBUAEYG.js"><link nonce="" integrity="sha384-FTHPQttPFF935jU0Dnu/R56VxY4WBQgpU2LGNNDf92i3nank9Q5S7x0bLH1PaLft" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/lTI5I4yu.js"><link nonce="" integrity="sha384-16L8vZm+5D4i9uhUuw6JV1TqCb9BMniQikxfKnswEUlRtfwDol+s4uqDhaZXwny2" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/91A8zhHS.js"><link nonce="" integrity="sha384-f+e1FVNE/T2lDce76NJMfxcdawJLbJnxqwGE8hcbh294/PD2/w5Ic3KQhSaNEleM" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BkeRmi07.js"><link nonce="" integrity="sha384-Q2DxEGTJ8Qr8IWjOnEEarTzTz8gde4A/QHCSgTH3rWp5dsGATv7Scyjkhy7ULO3K" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/UbdPEwEM.js"><link nonce="" integrity="sha384-qfRcPAxqaf0zA/FjgoER7vbIrE7mKhDttRFftIiUGQpYjDdPRSBKwCgFcrcAzDni" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DuAV58dt.js"><link nonce="" integrity="sha384-kQvyEBtLdEc9VGMkIeoQTjia1w52BsUjOJOYQhO4IcjAiViZDvVuQppZBRTqH6so" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BtTtLD25.js"><link nonce="" integrity="sha384-I039ANJGHhr2CaXH4icET/UUPslTqPGKPSOSoyofSjqe6+kwX8LAdMPMrVjkYrPH" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CUCNVA8S.js"><link nonce="" integrity="sha384-N1WfKiEg3SzR9CdokLFytZKVFw0H9QQCVqRyJABaCEAs5CF4oufjdkW9IgG+YoCf" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CvNiyATc.js"><link nonce="" integrity="sha384-Nmn6sUp07EnvYHCFN+bm3FSRVXMCEptrev8HKT04oml9cqtToSvJbrZa587R6Jwb" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/B5MQNTTm.js"><link nonce="" integrity="sha384-lKen8cvcDypP/BHrDug0k6q7J8SZJeaXgkUHjMjsguHHEFpwkiGYT1OhbXnethxH" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/4GYs45G9.js"><link nonce="" integrity="sha384-Ag2b5l4eEdsPCf7PE351pdvuMKZoAl2xcMge7HTtClEW6Y/izToOCEUSitNE2G0O" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/3oipLbd9.js"><link nonce="" integrity="sha384-gKkSnsBfMx5E3ar0WuTrpQkwVTJ/xlB3mCvlZvaxovj/RFWY82iBUBMnBhmMYWdk" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/m68L2hpN.js"><link nonce="" integrity="sha384-rkv14JDYlXj9BOiAfZaprkgZxm/Svqudu1oS7XH2J9epB768Yl/3zi4ob/iKWKym" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C5V8Z8ce.js"><link nonce="" integrity="sha384-C+9gFHof4xuWApmZD1yxSrq3zSFoAfCSJ7GdAqhtTlnwokHdyo/RUdleazn2uUBU" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/ctsQ0uQd.js"><link nonce="" integrity="sha384-6tGyJ7ePyQ9JREwDJFMygzTwMd3wV8grp9oPlS9f/f1eN55FC53MZQTJ5AfrnQk3" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CukEpSyf.js"><link nonce="" integrity="sha384-73mTlv6HnG9Y/nbl0pGyJZFeOvmZSPbu+1me5Mne55cH/oo55VPSkVNTAdt/S4dn" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C0Gi0Wkx.js"><link nonce="" integrity="sha384-E/lIGMB3s8lSmW1Wb/y2n/Xeh8yv8M/bycUj4DFXJIUCtLirrzQjYAvrr0cPGR4v" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Ct22R-2H.js"><link nonce="" integrity="sha384-HyGGNaFK3pSrLQbrCgicHYpnukgAQRnDKB0DsuokPeKmwta157YZJprLDc9ghWyt" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Cw8bpxEW.js"><link nonce="" integrity="sha384-hbTX8CKF7jYJP0G/fLUHf6Den+wClgVnJM1tYFtts3mz+w8q91kwvb63K+slJYPm" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BUWl0FAQ.js"><link nonce="" integrity="sha384-ajwUaldUJ12nDzWlFnlolk74utt0j8jJqaMTyAkzRI4MV1e4V2dGQQoabzLyE8Xe" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D9dB82Sf.js"><link nonce="" integrity="sha384-NBfcaWnmGwIH21ubW2vAcjF5699xmBnT3JrjgLtznuxJo9CV0BleGMglS1rDKfyR" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/X_eaGsVb.js"><link nonce="" integrity="sha384-h5b/dAqAQnOmyK0J7Vl3n449/pgGKSEVcqhv2SdhBz1ubaugKj7Ma97Nqb2DXIEc" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D4qSbAf1.js"><link nonce="" integrity="sha384-Za9VTnFnNXdDtfx8qy++/h46z9Q8Jws8W3x5v9jOAxh+6EiKNw6DLPuuqZGnPBFl" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C54he5AG.js"><link nonce="" integrity="sha384-CVqcfYSVKDtGTSEQ43quuif5kNqhnHhBpbUB8cXrZ9XY45Lw7b9Fpm1XjVnQIBXi" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Dfjlac11.js"><link nonce="" integrity="sha384-lXI1SLhL09RmXzya8PN1uIOpbeLOUMZ6NRszs0Ei2Ntq0QMx1Dtp7vtZwND57Fjb" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BHRJrsMd.js"><link nonce="" integrity="sha384-p3t8bYj/Hb0MfjRxSxTVT3ovtJYHYJpNPl9pLF9ZR7TsXzJthhqJnBokc3sonzUL" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CLdKaltm.js"><link nonce="" integrity="sha384-WWKOB22oIiKi5I2OAXMQHZvQGDu0ovNny41vF0l4CE7v1XVyrnWC7qJHtcZ/IgSS" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BQOI21vo.js"><link nonce="" integrity="sha384-68SI/6ff1AXkeHD7fvD6HrZ4dVe0xaR9VHWFPFZD/uWGZ49pd2beFXIJsAMJr5o+" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CqhnfTvz.js"><link nonce="" integrity="sha384-WZ5pik+7iVzN8oC3Y6RQG7ykH7JWlg+LnbNtCJuIgr0SDvTrcNYt94c3oKm89tU8" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DSbDmzAv.js"><link nonce="" integrity="sha384-6vY3TSy/Jbx4OzC1mO+pTJFKXG5FsZoX5U9pKycyll2vzak4TaVhz3DJEuKwpLRF" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DdSWIcVP.js"><link nonce="" integrity="sha384-/RmA7E98f7Q+6zOjyOE/ULDtygrXc/5K2AOI63oUjHAthpiOMd+llFdIZM+w25yC" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CMBSaFfM.js"><link nonce="" integrity="sha384-ZBrMqdnfEdCkyyr7sKgzP5miIfpBq3c5XQvM1BXGyTo7SH4zallfB+4uxSClt8bo" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/B7uvIniN.js"><link nonce="" integrity="sha384-UD9yC2AzbDdD5EK1l9Mi59WZoGGYcyprdctRDEEkzv3ZSjNThlQvozKYNZuIsbSd" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/B8VfGPME.js"><link nonce="" integrity="sha384-KdUIrGSVNZI3k3A9OXg9Qiq9DO7CACohQnp26o19gGJlijOSgUwjfEbDqUe9OMEJ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DdAcxpHr.js"><link nonce="" integrity="sha384-TR45iesdfuTCrAoS6OxSaJTVi+OQWD0mM/PKB2g7vrV8xHJ47GlcGoY0YduedI38" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Bp3dZx8A.js"><link nonce="" integrity="sha384-nOA2SAWnorgZE/YX8hKE6WZILbbK3iGh5o5j2evHngy3atd0PpBbO3INKw47qiaR" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DbHZS3kB.js"><link nonce="" integrity="sha384-RM/Mo1ghfGkllOi+CDGLnd20DWVN1t08mtTcwNUiXBEJRjpZkQtDRx/jVXtJz41Y" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CwRp0Xpq.js"><link nonce="" integrity="sha384-RyM4rUhyBSz8fmPFNbPomNhEGNVOzjIOLiaXC4Ko2qfim2oQsUxgSF5Ph2aIRqlG" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Bp1_D2AQ.js"><link nonce="" integrity="sha384-lBee+EBxJwlQT/EIkkt/pTv4vAQOc0fgN5o5eYkpq9gdj9noR5zDkusN3ShaWaF5" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/9AJ66TUp.js"><link nonce="" integrity="sha384-vRjC9eer2LRI5TZCe1KoMcxRls7jex5ZFTsZ8MolJE1t7J7JVgbbbDulHcGIldMB" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CEXEj78B.js"><link nonce="" integrity="sha384-GIbFX+zhMJCEH4XGvK7kQyWHeRgqwPN1WYH9cBaw+k8RSsY9HxSg153f0yqDf/Ax" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CRfmA1bm.js"><link nonce="" integrity="sha384-mirQ9xkJWaO21ywpuWop5HjFICi9zbBXBKWFO3UK5YfsCSSehmyHqf4oZVWQqsID" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BZIEhpEc.js"><link nonce="" integrity="sha384-ZS0dy5T81natV7R6Dk5VaYA2d5MlO4t0nPsBc5NZh+R5t4Vbdx8QCONwl3Z7GDJQ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/6INMPEbM.js"><link nonce="" integrity="sha384-Hk6ffNtPiGoxfI8TygjqdFsxfFzqEojGwc/bGLgoLpAkbU2dGn4aFOTdHmsF/tTv" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BiHU9HLl.js"><link nonce="" integrity="sha384-VB229iY445N1sGEQKoH4OhWJJorS/KVSits7FB+9fCBfjVkYDrceq435k4P/wIjI" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D54rIIIu.js"><link nonce="" integrity="sha384-/NzF5r7B5Dd9FZj2VNaIuUf10brer8kf1ljNa8vxn96g7ELxSkQUU6OB5BSA14xl" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/_DUMccsq.js"><link nonce="" integrity="sha384-6RpWbACR1dR1X7lSttskfK8FjGSyc0vdg96WfBK+gn30b9+6pazk5ECO0XvxHMBF" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CwXlw7iE.js"><link nonce="" integrity="sha384-YEMzifEwiJDrTS+mZ8hRwFwDa9JRLZwCu8jNct/772Gz16vMt0IuCII9JLrUy45b" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/KpUMbPIU.js"><link nonce="" integrity="sha384-/qMPJ8gBan0mMr3YZ5j73nUXWbZcvlhzMBqC0s02HA33Er86ElDUEbyXHCHhsaM7" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/O5G_pKvf.js"><link nonce="" integrity="sha384-P+EqG43aviqK4615K2MQKC1g5znE1pq/eZuAsbh3ZIgRjCWM22s+4kgKYbw3GaAc" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BmSZo5vd.js"><link nonce="" integrity="sha384-vz7JjgW2QWGQncY16HiNPYbLYQ+OKtUb5KNndUdhuJw4j/5OrjTMCXQOuctsCP/s" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CqKT32sS.js"><link nonce="" integrity="sha384-9RFXdF3e3K3vvdvkDo9c/yTeofhQZot5z25S1RN+Gmd6uku2vAhs2PTN1Z15ttpO" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CVIvuSKk.js"><link nonce="" integrity="sha384-n0vfE37Xgk0xpViNLpNToKUiZ7I246oSVD3z0aUq+8u1upLNRhCTOuhKkPeV7UdH" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/yV0BN1R6.js"><link nonce="" integrity="sha384-hD3pihvQqvqOb47clwfGM7eoP30EGCxJA8mKCiPLx1iIGLnt/Jj0nJbDldzbdhe5" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DwLVdadC.js"><link nonce="" integrity="sha384-onBDVMoGwRE3QRfuzFk7cP7dUqrPv6fClKp0ZBgbBIHdiCztqd3MiVEkF8Kx2USa" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/1_iL_gOK.js"><link nonce="" integrity="sha384-4JErMhMwN9S+EdU+QgZJzIlMhxCePhDvuitEv+BAwMEfUXGh2ZmhItHg6LYCTlIC" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DDrhJvbN.js"><link nonce="" integrity="sha384-+mbTzQrAM16+5gzKhruDRbvkgzrWryRjppDLh3QORGSvAMtoFwNFY4SVnGcPIWxi" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CdgWLbM0.js"><link nonce="" integrity="sha384-8RFJigfxYGzVgxWTW2gy45MzjdX190pIR9DLZlr/+cIgm4WKj5QtEtMI3ZKn8SsN" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C9xFUvHG.js"><link nonce="" integrity="sha384-w++Jp76+dXZEGKN3ApKy8R4s6Zclm1L+60MWfMkYKu1lSjOQ3E4GmzgXuQidTOaG" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/W7wjYkEu.js"><link nonce="" integrity="sha384-z7e7yUXQAueL7WeJPCaj0rMxioMrr9TNZXplqJCaL3WhmIMAQgePZfyLFq4pZqcJ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C0vOX3wI.js"><link nonce="" integrity="sha384-h/1ej+nEzHZyUTfGxz1GJ9y2bcEZAZ7aj7KXLaWnzA2v1yuPXAJnbJ/htYw3jg/O" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BGlOD76I.js"><link nonce="" integrity="sha384-1MYNPSB37FmA6FdFj077+wWfewzVbTpTR38q0rpWUoxDaqYBZ//322fFFzvDBozK" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C7L-Qewe.js"><link nonce="" integrity="sha384-NhF4xsrG33Hrmoyk0CtdRHWVv5kuNSXCmoaxIiALakeXaeXpiAr3xrIcNMZMa082" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Ajydhuh8.js"><link nonce="" integrity="sha384-cZ/Tz5zzHCOCUuJEGiqP1GPVQAEDCVhznrO/05dCFh4sBdXf8Vrwq61VUyRjGX6C" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BFQR5dwQ.js"><link nonce="" integrity="sha384-nKQhV4dAMU5t/GeMrgq1FG6jOO2pm2dD1zv0RoTOYkPo+rX4S2i6n4wsAQE7ZwCm" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/0q1p6zF5.js"><link nonce="" integrity="sha384-s7UennnA5+uKAXflJQSOiBFQyIuyesh7AMB9UevZ/tjSKbYxYRCDt0BVDI7nG/ZR" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BACt5QkB.js"><link nonce="" integrity="sha384-enuNAZc5uQxVc+Wi9HoS2wrqZ8AMvxq+MsAo0Q+nli3WKKMt5R8oDcZee7O5N3Ch" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/EsYxSuUn.js"><link nonce="" integrity="sha384-ijeWYzm10n+O+h47muVibKFhyxzTB5Lo+2bXVOgyJ992mRj3HWrKlCMTU4cid++L" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/TfVQFkXD.js"><link nonce="" integrity="sha384-fYZWSwq465LUeZBu+yR0gIqFWxVYMJkeADsDLAxHQi5iGoN4SU7i9tYfqjlqv3GG" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Cwv0wPrA.js"><link nonce="" integrity="sha384-LHr9km/b9aujaROdMqpErXj2bbnZRPOSioFSLi5HEVZSRbpzxAEYzr8rKzs1LelZ" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DzRmAYvD.js"><link nonce="" integrity="sha384-dmAK1hhiumNXMs/NjWqR1YxMm3vyiMg16sggZx3HjlYKju1wCeiJzsSNr9NEW6TG" rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Ddhl0Rna.js"><script nonce="" integrity="sha384-K18nopic+X0JunSv2KJqsE7W6KB015nwBWeFR+Jh5SQtvXW7Yy4WjDfxnYjG/Q6g" type="module" src="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/A538-Xd4.js" crossorigin=""></script><meta name="description" content="In this tutorial, you will learn how to build a IPIP DSR load balancer using eBPF/XDP, where backends from arbitrary networks send responses directly back to clients bypassing the load balancer."><link nonce="" rel="icon" type="image/png" href="https://labs.iximiuz.com/favicon.ico"><link nonce="" rel="apple-touch-icon" type="image/png" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/logo.webp"><meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"><meta name="title" content="Building an eBPF/XDP IP-in-IP Direct Server Return Load Balancer from Scratch | iximiuz Labs"><meta name="keywords" content="eBPF"><meta name="author" content="Teodor Janez Podobnik"><meta property="og:type" content="article"><meta property="og:title" content="Building an eBPF/XDP IP-in-IP Direct Server Return Load Balancer from Scratch | iximiuz Labs"><meta property="og:description" content="In this tutorial, you will learn how to build a IPIP DSR load balancer using eBPF/XDP, where backends from arbitrary networks send responses directly back to clients bypassing the load balancer."><meta property="og:url" content="https://labs.iximiuz.com/tutorials/xdp-dsr-load-balancer-b701a95a"><meta property="og:image" content="https://labs.iximiuz.com/content/files/tutorials/xdp-dsr-load-balancer-b701a95a/__static__/ipip-1.png"><meta property="og:site_name" content="iximiuz Labs"><meta name="twitter:dnt" content="on"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@iximiuz"><meta name="twitter:title" content="Building an eBPF/XDP IP-in-IP Direct Server Return Load Balancer from Scratch | iximiuz Labs"><meta name="twitter:description" content="In this tutorial, you will learn how to build a IPIP DSR load balancer using eBPF/XDP, where backends from arbitrary networks send responses directly back to clients bypassing the load balancer."><meta name="twitter:image" content="https://labs.iximiuz.com/content/files/tutorials/xdp-dsr-load-balancer-b701a95a/__static__/ipip-1.png"><link nonce="" rel="canonical" href="https://labs.iximiuz.com/tutorials/xdp-dsr-load-balancer-b701a95a"><link nonce="" rel="image_src" href="https://labs.iximiuz.com/content/files/tutorials/xdp-dsr-load-balancer-b701a95a/__static__/ipip-1.png"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/SiteHeaderContent.DrFmd9xY.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ContentTable.ChTBbrAh.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ContentMetaFoot.DFr8HVAl.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ContentBox.rEdLfu6t.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/PlayBoxContentTab.CDHpeXMx.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/_name_.BsyFxT4E.css"><style>:is([id*='google_ads_iframe'],[id*='taboola-'],.taboolaHeight,.taboola-placeholder,#top-ad,#credential_picker_container,#credentials-picker-container,#credential_picker_iframe,[id*='google-one-tap-iframe'],#google-one-tap-popup-container,.google-one-tap__module,.google-one-tap-modal-div,#amp_floatingAdDiv,#ez-content-blocker-container) {display:none!important;min-height:0!important;height:0!important;}</style><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseP.DVN8_MMS.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseA.CGc139Ky.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseUl.5leepCZD.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseLi.BqrAa653.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseCodeInline.BhuXSD4-.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseH2.BDlwlsRA.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseH3.CuDSVxqV.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseCodeCopyButton.dhGBryGn.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProseCode.CdJo3ouR.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ProsePre.B_fgAJq0.css"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/DetailsBox.3wfYThLq.css"><link rel="preconnect" href="https://plausible.io/"><link rel="image_src" href="https://labs.iximiuz.com/content/files/tutorials/xdp-dsr-load-balancer-b701a95a/__static__/ipip-1.png"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/3yJMaxvi.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C8wdN3Ik.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Bq0UkCYT.js"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/SiteHeaderDefault.CQ-9yJ45.css"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/GriQ8B2M.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CrYjDOdC.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CXxrP7zL.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DUA4yL51.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/MTJvKNbD.js"><link rel="stylesheet" crossorigin="" href="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/AuthorProfileCard.B2bdkgLl.css"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D5PaCUAZ.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/C4h4q3zH.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Dg959Yt1.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CJ7oOdLD.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Hmopn4U9.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Dv2DOayU.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/4J4r8vMm.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CAUMgW0h.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/QwXPddex.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/InMlYjVK.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Dzr_TBnN.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BWu6ZW-1.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/8O-YeDGZ.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Ch3sV4Nw.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Jz7gehop.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CreFxVwq.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/djRO7Jx5.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Dx5dmUye.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/OfFSSdU4.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BDLepdqL.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DF8Kb1Fe.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DGl8mbvI.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BkPnT0P4.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/D9IPNEg4.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/CSKsp-sX.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BLGyX_7H.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/sTy7mATY.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/5aprXXgQ.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/BEhoFAvJ.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/DNFnU2Va.js"><link rel="modulepreload" as="script" crossorigin="" href="https://labs.iximiuz.com/_nuxt/Ddtg1Dbv.js"></head><body><div id="__nuxt"><div class="bg-[length:100%_250px] bg-fixed bg-gradient-to-b bg-mist bg-no-repeat from-[#a6d7f7] min-w-[300px]"><!--[--><div data-v-0d30d5a9=""><header id="site-header" class="bg-base-100 border-b-[1px] border-base-content/40 flex min-h-[3rem] sticky top-0 z-50" data-v-0d30d5a9="" data-v-7f8ed6a6=""><nav class="flex grow items-center justify-between min-w-0 mx-auto px-2 sm:px-4 text-primary-content" data-v-7f8ed6a6=""><div data-headlessui-state="" class="mr-2 relative self-center shrink-0 sm:mr-4" data-v-7f8ed6a6=""><div><button id="button-header-nav-menu-left" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state="" class="flex items-center rounded-full text-primary-content text-sm"><img class="align-text-bottom h-6 inline mr-1 w-auto" src="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/logo.webp" alt="iximiuz Labs"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-4 hover:opacity-100 hover:scale-110 opacity-70 w-4"><path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5"></path></svg></button></div><!----></div><div class="flex grow min-w-0" data-v-7f8ed6a6=""><div class="flex flex-col min-w-0 mr-5" data-v-7f8ed6a6=""><div class="flex gap-1 items-center" data-v-7f8ed6a6=""><!--[--><a aria-current="page" href="https://labs.iximiuz.com/tutorials/xdp-dsr-load-balancer-b701a95a" class="router-link-active router-link-exact-active font-semibold text-md truncate" title="Building an eBPF/XDP IP-in-IP Direct Server Return Load Balancer from Scratch" data-v-7f8ed6a6=""><h1 class="truncate" data-v-7f8ed6a6="">Building an eBPF/XDP IP-in-IP Direct Server Return Load Balancer from Scratch</h1></a><!--]--><!--[--><!--]--></div><span title="Teodor Janez Podobnik" class="text-base-content/85 text-xs truncate" data-v-7f8ed6a6="">Tutorial by <!--[--><!--[--><a href="https://labs.iximiuz.com/a/teodor-janez-podobnik" class="hover:underline decoration-dotted" title="Teodor Janez Podobnik">Teodor Janez Podobnik</a><!----><!----><!--]--><!--]--></span></div></div><!--[--><div class="flex gap-x-3 items-center shrink-0" data-v-0d30d5a9=""><!----><!----><!----><!----></div><!--]--><div class="flex items-center ml-2 shrink-0 sm:ml-3" data-v-7f8ed6a6=""><!--[--><a href="https://labs.iximiuz.com/signin?return_to=%2Ftutorials%2Fxdp-dsr-load-balancer-b701a95a" class="leading-6 ml-3 mr-4 shrink-0 text-base"> Sign in </a><a href="https://labs.iximiuz.com/signup?return_to=%2Ftutorials%2Fxdp-dsr-load-balancer-b701a95a" class="bg-base-100 border border-primary-content leading-6 px-1.5 rounded-md shrink-0 text-base"> Sign up </a><!--]--></div></nav></header><div class="hidden bg-gradient-to-b flex flex-col from-base-200 gap-y-2 max-h-96 overflow-y-auto p-4 scrollbar-styled to-transparent w-full z-[999999] fixed" data-v-0d30d5a9=""><!--[--><!--]--></div><div class="flex justify-center relative" data-v-0d30d5a9=""><div class="hidden lg:flex lg:h-[calc(100vh-3rem)] lg:sticky lg:top-[3rem] shrink-0 transition-all"><!--[--><div class="duration-300 ease-in-out flex flex-col mb-[3px] mt-1.5 overflow-hidden relative transition-all bg-base-100 border border-slate-400 rounded-lg w-[320px] ml-1.5" data-v-0d30d5a9=""><div class="absolute left-0 right-0 top-0 cursor-pointer flex group h-8 items-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="group-hover:opacity-100 mr-2 opacity-60 stroke-[2.5px] ml-auto h-3 w-3"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5"></path></svg></div><div class="flex flex-col min-h-0 overflow-hidden pl-3 pr-0 pt-2 pt-3" style="" data-v-c294bba9=""><h3 class="flex mb-3 text-[0.875rem] text-base-content/80 text-nowrap tracking-tight" data-v-c294bba9=""> Table of contents <!----></h3><div class="flex-1 mb-3 min-h-0 relative" data-v-c294bba9=""><nav class="h-full overflow-y-auto pr-2 scrollbar-styled" data-v-c294bba9=""><ul data-v-c294bba9=""><!--[--><li data-v-c294bba9=""><a href="#dsr-ipip-load-balancing" class="block border-l-[3px] duration-150 hover:bg-mist no-underline px-2 py-1.5 rounded rounded-l-none text-[0.85rem] text-base-content/80 transition-colors pl-4 border-slate-500 !text-base-content/100" data-v-c294bba9="">DSR IPIP Load Balancing</a><ul data-v-c294bba9=""><!--[--><li data-v-c294bba9=""><a href="#setting-up-the-environment" class="pl-6 border-slate-200 block border-l-[3px] duration-150 hover:bg-mist no-underline px-2 py-1.5 rounded rounded-l-none text-[0.85rem] text-base-content/80 transition-colors" data-v-c294bba9="">Setting Up the Environment</a><!----></li><li data-v-c294bba9=""><a href="#ipip-packet-decapsulation" class="pl-6 border-slate-200 block border-l-[3px] duration-150 hover:bg-mist no-underline px-2 py-1.5 rounded rounded-l-none text-[0.85rem] text-base-content/80 transition-colors" data-v-c294bba9="">IPIP Packet Decapsulation</a><!----></li><!--]--></ul></li><li data-v-c294bba9=""><a href="#running-the-load-balancer" class="pl-4 border-slate-200 block border-l-[3px] duration-150 hover:bg-mist no-underline px-2 py-1.5 rounded rounded-l-none text-[0.85rem] text-base-content/80 transition-colors" data-v-c294bba9="">Running the Load Balancer</a><!----></li><!--]--></ul></nav><!----></div></div><div class="bg-[#a6d7f7]/70 border-slate-400 border-t mt-auto p-2 py-4" style=""><div class="flex items-center justify-center"><a href="https://labs.iximiuz.com/signup?return_to=%2Ftutorials%2Fxdp-dsr-load-balancer-b701a95a" class="btn bg-base-100 btn-outline btn-sm" role="button"><!--[--> Start tutorial <!--]--></a></div></div><div class="flex flex-col gap-y-5 !gap-y-4 border-slate-400 border-t px-4 py-5" style="" data-v-6adfc778=""><div class="flex flex-wrap items-center" data-v-6adfc778=""><span class="font-semibold" data-v-6adfc778="">Tutorial on&nbsp;</span><!--[--><!--[--><!----><a href="https://labs.iximiuz.com/tutorials?category=linux" class="font-normal hover:opacity-100 hover:underline no-underline opacity-80" data-v-6adfc778="">Linux</a><!--]--><!--[--><span data-v-6adfc778="">,&nbsp;</span><a href="https://labs.iximiuz.com/tutorials?category=programming" class="font-normal hover:opacity-100 hover:underline no-underline opacity-80" data-v-6adfc778="">Programming</a><!--]--><!--]--></div><div class="flex flex-wrap items-center" data-v-6adfc778=""><span class="font-semibold" data-v-6adfc778="">Discussion&nbsp;</span><a href="https://discord.gg/p6nxaHm46p" rel="noopener noreferrer" target="_blank noopener noreferrer" class="font-normal hover:opacity-100 hover:underline no-underline opacity-80" data-v-6adfc778=""> Discord <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-[1em] inline pb-[3px] stroke-[2px] w-[1em]" data-v-6adfc778=""><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg></a></div><div class="flex flex-wrap gap-y-2 items-center mt-1" data-v-6adfc778=""><!--[--><a href="https://labs.iximiuz.com/tutorials?tag=eBPF" class="bg-mist cursor-pointer duration-200 ease-in-out font-medium hover:bg-slate-200 hover:text-gray-800 inline-flex items-center min-w-0 no-underline py-0.5 rounded-md text-gray-600 transition-all px-2.5 text-sm mx-1 not-prose" title="#eBPF" data-v-6adfc778=""><span class="truncate">eBPF</span></a><!--]--></div></div></div><!--]--></div><div class="flex lg:basis-[950px] transition-[flex-basis] duration-300 ease-in-out grow justify-center lg:grow-0 lg:pb-[3px] min-h-[calc(100vh-3rem)] min-w-0 mx-auto overflow-hidden p-1.5 pb-14"><div class="w-full"><!--[--><article class="flex grow min-h-full min-w-0" data-v-0d30d5a9=""><meta itemprop="name" content="Building an eBPF/XDP IP-in-IP Direct Server Return Load Balancer from Scratch"><meta itemprop="abstract" content="In this tutorial, you will learn how to build a IPIP DSR load balancer using eBPF/XDP, where backends from arbitrary networks send responses directly back to clients bypassing the load balancer."><meta itemprop="dateCreated" content="2026-01-27T00:00:00.000Z"><meta itemprop="datePublished" content="2026-01-27T00:00:00.000Z"><meta itemprop="dateModified" content="2026-01-27T00:00:00.000Z"><!--[--><div class="flex flex-col grow min-h-full min-w-0" data-v-0d30d5a9="" data-v-200caef3=""><!--[--><!--]--><div class="bg-base-100 border-[1px] border-slate-400 flex flex-col grow overflow-hidden relative rounded-lg shadow-lg" data-v-200caef3=""><div class="px-4 md:px-8 xl:px-12" data-v-200caef3=""><!--[--><div class="flex flex-col mb-8" data-v-0d30d5a9=""><div class="-mx-4 bg-content-tutorial border-b-[1px] border-b-slate-400 flex flex-nowrap items-center md:-mx-8 min-w-0 px-3 py-1.5 rounded-t-lg text-primary-content/70 text-sm xl:-mx-12"><div class="group/content-icon relative cursor-help"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-[1.2em] mr-2 w-[1.2em]"><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"></path></svg><div class="absolute bg-base-content duration-300 ease-in-out group-hover/content-icon:opacity-100 group-hover/content-icon:visible invisible left-0 mt-1 opacity-0 px-3 py-2 right-0 rounded-md text-slate-200 transition-all w-[20em] z-20">This tutorial was carefully crafted by an independent author and proudly hosted by iximiuz Labs.</div></div> Tutorial <span> &nbsp;on&nbsp; </span><!--[--><!--[--><!----><a href="https://labs.iximiuz.com/tutorials?category=linux" class="font-normal hover:underline no-underline truncate">Linux</a><!--]--><!--[--><span>,&nbsp;</span><a href="https://labs.iximiuz.com/tutorials?category=programming" class="font-normal hover:underline no-underline truncate">Programming</a><!--]--><!--]--><!--[--><span class="cursor-help hover:tooltip-open ml-auto pl-4 shrink-0 tooltip tooltip-left" data-tip="Published: Jan 27, 2026"><time datetime="createdAt"> Published: Jan 27, 2026</time></span><!--[--><button type="button" class="hidden lg:flex ml-2" title="Expand content to full width" data-v-0d30d5a9=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--material-symbols-light h-5 w-5" style="" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M6 18v-5h1v4h4v1zm11-7V7h-4V6h5v5z"></path></svg></button><!--]--><!----><!--]--></div><!----></div><h1 class="tutorial-header" data-v-0d30d5a9="">Building an eBPF/XDP IP-in-IP Direct Server Return Load Balancer from Scratch</h1><!--]--></div><!----><!--[--><!--[--><div class="flex flex-col" data-v-200caef3=""><!----><div class="h-auto pb-5 px-4 md:px-8 xl:px-12 duration-200 ease-out max-w-full overflow-hidden prose relative transition-all" data-v-200caef3=""><div class="" data-v-200caef3=""><p class="prose-p" data-v-b025fb9f=""><!--[-->In <a href="https://labs.iximiuz.com/tutorials/xdp-dsr-layer2-lb-92b02f3e" rel="nofollow" target="_blank" class="prose-a !underline !underline-offset-2 !decoration-dashed !text-black" data-v-abeb6555=""><!--[-->the previous tutorial<!--]--><!----></a>,
 we built a DSR L2 eBPF/XDP-based load balancer. A key takeaway was how 
the virtual IP can be shared between the load balancer and backend 
nodes, as well as keeping the IP header intact, allowing the backend to 
see the clients IP.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->While this worked nicely, L2 DSR relies on the fact that backend nodes need to be on the same L2 network as the load balancer.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->This
 is quite a constraint, and not quite suitable for cloud environments, 
where nodes are often distributed across different virtual networks.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->To overcome these limitations, DSR IP-in-IP load balancing was introduced.<!--]--></p><div class="bg-base-100" style="padding:0;margin:30px auto;max-width:800px;"><div class="text-center"><img src="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ipipbla.webp" alt="XDP DSR Load Balancing" class="cursor-pointer m-0 max-w-full" style=""><!--[--><!--]--></div><!----></div><p class="prose-p" data-v-b025fb9f=""><!--[-->In
 an IP-in-IP DSR load-balancing setup, backends not only respond 
directly to clients but can also reside in different networks than the 
load balancer.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->This playground has a network topology with five nodes on three different networks:<!--]--></p><ul class="prose-ul" data-v-533e29f3=""><!--[--><li class="prose-li" data-v-2969431c=""><!--[--><code class="prose-code-inline" data-v-a031129a=""><!--[-->lb<!--]--></code> in network <code class="prose-code-inline" data-v-a031129a=""><!--[-->192.168.178.10/24<!--]--></code><!--]--></li><li class="prose-li" data-v-2969431c=""><!--[--><code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-01<!--]--></code> in network <code class="prose-code-inline" data-v-a031129a=""><!--[-->172.16.0.10/24<!--]--></code><!--]--></li><li class="prose-li" data-v-2969431c=""><!--[--><code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-02<!--]--></code> in network <code class="prose-code-inline" data-v-a031129a=""><!--[-->172.16.0.11/24<!--]--></code><!--]--></li><li class="prose-li" data-v-2969431c=""><!--[--><code class="prose-code-inline" data-v-a031129a=""><!--[-->client<!--]--></code> in network <code class="prose-code-inline" data-v-a031129a=""><!--[-->10.0.0.20/16<!--]--></code><!--]--></li><li class="prose-li" data-v-2969431c=""><!--[--><code class="prose-code-inline" data-v-a031129a=""><!--[-->gateway<!--]--></code> between networks <code class="prose-code-inline" data-v-a031129a=""><!--[-->192.168.178.2/24<!--]--></code>, <code class="prose-code-inline" data-v-a031129a=""><!--[-->10.0.0.2/16<!--]--></code>, <code class="prose-code-inline" data-v-a031129a=""><!--[-->172.16.0.2/24<!--]--></code><!--]--></li><!--]--></ul><div class="bg-base-100" style="padding:0;margin:30px auto;max-width:800px;"><div class="text-center"><img src="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ppp.webp" alt="XDP DSR IPIP Load Balancing Playground" class="cursor-pointer m-0 max-w-full" style=""><!--[--><!--]--></div><!----></div><h2 id="dsr-ipip-load-balancing" class="prose-h2" data-v-b9b1576a=""><!--[-->DSR IPIP Load Balancing<!--]--><!----></h2><p class="prose-p" data-v-b025fb9f=""><!--[-->In
 the L2 DSR load balancing approach, we were only rewriting MAC 
addresses, which limited the load balancer to operate within the same L2
 network. Now, we want to make these packets routable across different 
networks (load balancer  network-hops  backend).<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->To understand how to achieve this, one needs to know how IP-in-IP (IPIP) encapsulation works.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->In
 short, IP-in-IP encapsulation is a technique where one IP packet is 
wrapped inside another IP header, forming an outer and an inner IP 
header.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->And the reason, why we need this is fairly simple.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->The
 main limitation of L2 DSR was that if it tried to redirect traffic to a
 backend in a different L2 network, it would set the destination MAC 
address to the gateways interface (trying to exit current L2 network), 
and since only the VIP on the load balancer is advertised across the 
network, the gateway would send the packet back to the load 
balancerbecause thats the only route it knows for that VIPcausing a 
loop.<!--]--></p><div class="bg-base-100" style="padding:0;margin:30px auto;max-width:800px;"><div class="text-center"><img src="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/fail.png" alt="Problem of XDP DSR L2 Load Balancing" class="cursor-pointer m-0 max-w-full" style=""><!--[--><!--]--></div><!----></div><p class="prose-p" data-v-b025fb9f=""><!--[-->With
 IPIP (IP-in-IP) encapsulation, we solve this problem by wrapping the 
original IP packet inside another IP header where the outer IP header 
contains routable destination IPs, allowing the packet to traverse 
different networks.<!--]--></p><div class="bg-base-100" style="padding:0;margin:30px auto;max-width:800px;"><div class="text-center"><img src="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ipip-packet.png" alt="IP-in-IP Encapsulation (simplified)" class="cursor-pointer m-0 max-w-full" style=""><!--[--><!--]--></div><!----></div><div class="bg-base-100" style="padding:0;margin:30px auto;max-width:800px;"><div class="text-center"><img src="Building%20an%20eBPF_XDP%20IP-in-IP%20Direct%20Server%20Return%20Load%20Balancer%20from%20Scratch_files/ipipdsr.png" alt="XDP DSR IPIP Load Balancing Playground" class="cursor-pointer m-0 max-w-full" style=""><!--[--><!--]--></div><!----></div><h3 id="setting-up-the-environment" class="prose-h3" data-v-9a0ceb30=""><!--[-->Setting Up the Environment<!--]--><!----></h3><p class="prose-p" data-v-b025fb9f=""><!--[-->To make this work in our playground, we first need to configure a VIP and enable IP forwarding on the load balancer (<code class="prose-code-inline" data-v-a031129a=""><!--[-->lb<!--]--></code> tab), just like we did in the L2 DSR coding lab:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> sysctl</span><span style="--shiki-default:#CE9178"> -w</span><span style="--shiki-default:#CE9178"> net.ipv4.ip_forward=</span><span style="--shiki-default:#B5CEA8">1
</span></span><span class="line" line="2"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> ip</span><span style="--shiki-default:#CE9178"> addr</span><span style="--shiki-default:#CE9178"> add</span><span style="--shiki-default:#CE9178"> 192.168.178.15/32</span><span style="--shiki-default:#CE9178"> dev</span><span style="--shiki-default:#CE9178"> eth0
</span></span><span class="line" line="3"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> ping</span><span style="--shiki-default:#CE9178"> -c1</span><span style="--shiki-default:#B5CEA8"> 172.16.0.10
</span></span><span class="line" line="4"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> ping</span><span style="--shiki-default:#CE9178"> -c1</span><span style="--shiki-default:#B5CEA8"> 172.16.0.11
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->We also ping the backend node IPs to populate the ARP table, which is required for the <code class="prose-code-inline" data-v-a031129a=""><!--[-->bpf_fib_lookup<!--]--></code> helper function to work.<!--]--></p><div class="border-[2px] my-[24px] px-6 py-0 rounded-lg border-primary/50 bg-[#f7fbfe]"><!--[--><p class="prose-p" data-v-b025fb9f=""><!--[--> If you need a quick reminder why this is necessary:<!--]--></p><ul class="prose-ul" data-v-533e29f3=""><!--[--><li class="prose-li" data-v-2969431c=""><!--[-->Enabling IP forwarding allows the load balancer to route packets between interfaces.<!--]--></li><li class="prose-li" data-v-2969431c=""><!--[-->The <code class="prose-code-inline" data-v-a031129a=""><!--[-->bpf_fib_lookup()<!--]--></code>
 helper function retrieves the next-hop MAC address from the kernels 
routing tables  either the backends MAC in the case of L2 DSR, or the 
gateways MAC in IPIP DSR.<!--]--></li><!--]--></ul><!--]--></div><p class="prose-p" data-v-b025fb9f=""><!--[-->Next, on both backend nodes (<code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-01<!--]--></code> and <code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-02<!--]--></code> tabs), configure the VIP and disable its ARP advertisement:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> ip</span><span style="--shiki-default:#CE9178"> addr</span><span style="--shiki-default:#CE9178"> add</span><span style="--shiki-default:#CE9178"> 192.168.178.15/32</span><span style="--shiki-default:#CE9178"> dev</span><span style="--shiki-default:#CE9178"> lo
</span></span><span class="line" line="2"><span style="--shiki-default:#6A9955"># Only reply to ARP requests if the target IP is assigned to the interface 
</span></span><span class="line" line="3"><span style="--shiki-default:#6A9955"># that received the request (prevents advertising the VIP on eth0)
</span></span><span class="line" line="4"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> sysctl</span><span style="--shiki-default:#CE9178"> -w</span><span style="--shiki-default:#CE9178"> net.ipv4.conf.eth0.arp_ignore=</span><span style="--shiki-default:#B5CEA8">1
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span style="--shiki-default:#6A9955"># When sending ARP requests, use only addresses assigned to the outgoing interface
</span></span><span class="line" line="7"><span style="--shiki-default:#6A9955"># (prevents the node from leaking the VIP as a source IP in ARP)
</span></span><span class="line" line="8"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> sysctl</span><span style="--shiki-default:#CE9178"> -w</span><span style="--shiki-default:#CE9178"> net.ipv4.conf.eth0.arp_announce=</span><span style="--shiki-default:#B5CEA8">2
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><div class="border-[2px] my-[24px] px-6 py-0 rounded-lg border-primary/50 bg-[#f7fbfe]"><!--[--><p class="prose-p" data-v-b025fb9f=""><!--[-->
 This is important, so no node knows the VIP exists on the backends; 
otherwise, clients could bypass the load balancer and establish a direct
 connection. We had described this in more details in the previous DSR 
L2 Load Balancing tutorial.<!--]--></p><!--]--></div><p class="prose-p" data-v-b025fb9f=""><!--[-->With
 that in place, the final step is to make sure our eBPF/XDP-based DSR 
IPIP load balancer encapsulates the packet before forwarding it.<!--]--></p><!--[--><div class="highlight-c prose-code" meta="" data-v-4578ab24=""><span class="filename" data-v-4578ab24="">lab/lb.c</span><!--[--><pre class="language-c shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#6A9955">  // Choose backend using simple hashing
</span></span><span class="line" line="2"><span style="--shiki-default:#569CD6">  struct</span><span style="--shiki-default:#4EC9B0"> four_tuple_t</span><span style="--shiki-default:#E6E6E6"> four_tuple;
</span></span><span class="line" line="3"><span style="--shiki-default:#E6E6E6">  four_tuple.src_ip </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> ip</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">saddr;
</span></span><span class="line" line="4"><span style="--shiki-default:#E6E6E6">  four_tuple.dst_ip </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> ip</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">daddr;
</span></span><span class="line" line="5"><span style="--shiki-default:#E6E6E6">  four_tuple.src_port </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> tcp</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">source;
</span></span><span class="line" line="6"><span style="--shiki-default:#E6E6E6">  four_tuple.dst_port </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> tcp</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">dest;
</span></span><span class="line" line="7"><span style="--shiki-default:#E6E6E6">  four_tuple.protocol </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> IPPROTO_TCP;
</span></span><span class="line" line="8"><span style="--shiki-default:#E6E6E6">  __u32 key </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#DCDCAA"> xdp_hash_tuple</span><span style="--shiki-default:#E6E6E6">(</span><span style="--shiki-default:#D4D4D4">&amp;</span><span style="--shiki-default:#9CDCFE">four_tuple</span><span style="--shiki-default:#E6E6E6">) </span><span style="--shiki-default:#D4D4D4">%</span><span style="--shiki-default:#E6E6E6"> NUM_BACKENDS;
</span></span><span class="line" line="9"><span style="--shiki-default:#569CD6">  struct</span><span style="--shiki-default:#E6E6E6"> endpoint </span><span style="--shiki-default:#D4D4D4">*</span><span style="--shiki-default:#E6E6E6">backend </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#DCDCAA"> bpf_map_lookup_elem</span><span style="--shiki-default:#E6E6E6">(</span><span style="--shiki-default:#D4D4D4">&amp;</span><span style="--shiki-default:#9CDCFE">backends</span><span style="--shiki-default:#E6E6E6">, </span><span style="--shiki-default:#D4D4D4">&amp;</span><span style="--shiki-default:#9CDCFE">key</span><span style="--shiki-default:#E6E6E6">);
</span></span><span class="line" line="10"><span style="--shiki-default:#C586C0">  if</span><span style="--shiki-default:#E6E6E6"> (</span><span style="--shiki-default:#D4D4D4">!</span><span style="--shiki-default:#E6E6E6">backend) {
</span></span><span class="line" line="11"><span style="--shiki-default:#C586C0">    return</span><span style="--shiki-default:#E6E6E6"> XDP_ABORTED;
</span></span><span class="line" line="12"><span style="--shiki-default:#E6E6E6">  }
</span></span><span class="line" line="13"><span emptylineplaceholder="true">
</span></span><span class="line" line="14"><span style="--shiki-default:#6A9955">  // Perform a FIB lookup
</span></span><span class="line" line="15"><span style="--shiki-default:#569CD6">  struct</span><span style="--shiki-default:#E6E6E6"> bpf_fib_lookup fib </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> {};
</span></span><span class="line" line="16"><span style="--shiki-default:#569CD6">  int</span><span style="--shiki-default:#E6E6E6"> rc </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#DCDCAA"> fib_lookup_v4_full</span><span style="--shiki-default:#E6E6E6">(ctx, </span><span style="--shiki-default:#D4D4D4">&amp;</span><span style="--shiki-default:#9CDCFE">fib</span><span style="--shiki-default:#E6E6E6">, ip</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#9CDCFE">daddr</span><span style="--shiki-default:#E6E6E6">, backend</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#9CDCFE">ip</span><span style="--shiki-default:#E6E6E6">,
</span></span><span class="line" line="17"><span style="--shiki-default:#DCDCAA">                              bpf_ntohs</span><span style="--shiki-default:#E6E6E6">(ip</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#9CDCFE">tot_len</span><span style="--shiki-default:#E6E6E6">));
</span></span><span class="line" line="18"><span style="--shiki-default:#C586C0">  if</span><span style="--shiki-default:#E6E6E6"> (rc </span><span style="--shiki-default:#D4D4D4">!=</span><span style="--shiki-default:#E6E6E6"> BPF_FIB_LKUP_RET_SUCCESS) {
</span></span><span class="line" line="19"><span style="--shiki-default:#DCDCAA">    log_fib_error</span><span style="--shiki-default:#E6E6E6">(rc);
</span></span><span class="line" line="20"><span style="--shiki-default:#C586C0">    return</span><span style="--shiki-default:#E6E6E6"> XDP_ABORTED;
</span></span><span class="line" line="21"><span style="--shiki-default:#E6E6E6">  }
</span></span><span class="line" line="22"><span emptylineplaceholder="true">
</span></span><span class="line highlight" line="23"><span style="--shiki-default:#6A9955">  // Make room for the new outer IPv4 header (20 bytes) between ETH and inner IPv4
</span></span><span class="line highlight" line="24"><span style="--shiki-default:#569CD6">  int</span><span style="--shiki-default:#E6E6E6"> adj </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#DCDCAA"> bpf_xdp_adjust_head</span><span style="--shiki-default:#E6E6E6">(ctx, </span><span style="--shiki-default:#B5CEA8">0</span><span style="--shiki-default:#D4D4D4"> -</span><span style="--shiki-default:#E6E6E6"> (</span><span style="--shiki-default:#569CD6">int</span><span style="--shiki-default:#E6E6E6">)</span><span style="--shiki-default:#569CD6">sizeof</span><span style="--shiki-default:#E6E6E6">(</span><span style="--shiki-default:#569CD6">struct</span><span style="--shiki-default:#E6E6E6"> iphdr));
</span></span><span class="line highlight" line="25"><span style="--shiki-default:#C586C0">  if</span><span style="--shiki-default:#E6E6E6"> (adj </span><span style="--shiki-default:#D4D4D4">&lt;</span><span style="--shiki-default:#B5CEA8"> 0</span><span style="--shiki-default:#E6E6E6">) {
</span></span><span class="line highlight" line="26"><span style="--shiki-default:#DCDCAA">    bpf_printk</span><span style="--shiki-default:#E6E6E6">(</span><span style="--shiki-default:#CE9178">"Failed to adjust packet head"</span><span style="--shiki-default:#E6E6E6">);
</span></span><span class="line highlight" line="27"><span style="--shiki-default:#C586C0">    return</span><span style="--shiki-default:#E6E6E6"> XDP_ABORTED;
</span></span><span class="line highlight" line="28"><span style="--shiki-default:#E6E6E6">  }
</span></span><span class="line highlight" line="29"><span emptylineplaceholder="true">
</span></span><span class="line highlight" line="30"><span style="--shiki-default:#6A9955">  // Recompute packet pointers after adjusting headed
</span></span><span class="line highlight" line="31"><span style="--shiki-default:#569CD6">  void</span><span style="--shiki-default:#D4D4D4"> *</span><span style="--shiki-default:#E6E6E6">new_data_end </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> (</span><span style="--shiki-default:#569CD6">void</span><span style="--shiki-default:#D4D4D4"> *</span><span style="--shiki-default:#E6E6E6">)(</span><span style="--shiki-default:#569CD6">long</span><span style="--shiki-default:#E6E6E6">)ctx</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">data_end;
</span></span><span class="line highlight" line="32"><span style="--shiki-default:#569CD6">  void</span><span style="--shiki-default:#D4D4D4"> *</span><span style="--shiki-default:#E6E6E6">new_data </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> (</span><span style="--shiki-default:#569CD6">void</span><span style="--shiki-default:#D4D4D4"> *</span><span style="--shiki-default:#E6E6E6">)(</span><span style="--shiki-default:#569CD6">long</span><span style="--shiki-default:#E6E6E6">)ctx</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">data;
</span></span><span class="line highlight" line="33"><span emptylineplaceholder="true">
</span></span><span class="line highlight" line="34"><span style="--shiki-default:#6A9955">  // Re-parse Ethernet header
</span></span><span class="line highlight" line="35"><span style="--shiki-default:#569CD6">  struct</span><span style="--shiki-default:#E6E6E6"> ethhdr </span><span style="--shiki-default:#D4D4D4">*</span><span style="--shiki-default:#E6E6E6">new_eth </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> new_data;
</span></span><span class="line highlight" line="36"><span style="--shiki-default:#C586C0">  if</span><span style="--shiki-default:#E6E6E6"> ((</span><span style="--shiki-default:#569CD6">void</span><span style="--shiki-default:#D4D4D4"> *</span><span style="--shiki-default:#E6E6E6">)(new_eth </span><span style="--shiki-default:#D4D4D4">+</span><span style="--shiki-default:#B5CEA8"> 1</span><span style="--shiki-default:#E6E6E6">) </span><span style="--shiki-default:#D4D4D4">&gt;</span><span style="--shiki-default:#E6E6E6"> new_data_end) {
</span></span><span class="line highlight" line="37"><span style="--shiki-default:#C586C0">    return</span><span style="--shiki-default:#E6E6E6"> XDP_ABORTED;
</span></span><span class="line highlight" line="38"><span style="--shiki-default:#E6E6E6">  }
</span></span><span class="line highlight" line="39"><span emptylineplaceholder="true">
</span></span><span class="line highlight" line="40"><span style="--shiki-default:#6A9955">  // Outer IPv4 header lives right after Ethernet
</span></span><span class="line highlight" line="41"><span style="--shiki-default:#569CD6">  struct</span><span style="--shiki-default:#E6E6E6"> iphdr </span><span style="--shiki-default:#D4D4D4">*</span><span style="--shiki-default:#E6E6E6">outer </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> (</span><span style="--shiki-default:#569CD6">void</span><span style="--shiki-default:#D4D4D4"> *</span><span style="--shiki-default:#E6E6E6">)(new_eth </span><span style="--shiki-default:#D4D4D4">+</span><span style="--shiki-default:#B5CEA8"> 1</span><span style="--shiki-default:#E6E6E6">);
</span></span><span class="line highlight" line="42"><span style="--shiki-default:#C586C0">  if</span><span style="--shiki-default:#E6E6E6"> ((</span><span style="--shiki-default:#569CD6">void</span><span style="--shiki-default:#D4D4D4"> *</span><span style="--shiki-default:#E6E6E6">)(outer </span><span style="--shiki-default:#D4D4D4">+</span><span style="--shiki-default:#B5CEA8"> 1</span><span style="--shiki-default:#E6E6E6">) </span><span style="--shiki-default:#D4D4D4">&gt;</span><span style="--shiki-default:#E6E6E6"> new_data_end) {
</span></span><span class="line highlight" line="43"><span style="--shiki-default:#C586C0">    return</span><span style="--shiki-default:#E6E6E6"> XDP_ABORTED;
</span></span><span class="line highlight" line="44"><span style="--shiki-default:#E6E6E6">  }
</span></span><span class="line highlight" line="45"><span emptylineplaceholder="true">
</span></span><span class="line highlight" line="46"><span style="--shiki-default:#6A9955">  // Inner IPv4 header is now right after the new outer IP header
</span></span><span class="line highlight" line="47"><span style="--shiki-default:#569CD6">  struct</span><span style="--shiki-default:#E6E6E6"> iphdr </span><span style="--shiki-default:#D4D4D4">*</span><span style="--shiki-default:#E6E6E6">inner </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> (</span><span style="--shiki-default:#569CD6">void</span><span style="--shiki-default:#D4D4D4"> *</span><span style="--shiki-default:#E6E6E6">)(outer </span><span style="--shiki-default:#D4D4D4">+</span><span style="--shiki-default:#B5CEA8"> 1</span><span style="--shiki-default:#E6E6E6">);
</span></span><span class="line highlight" line="48"><span style="--shiki-default:#C586C0">  if</span><span style="--shiki-default:#E6E6E6"> ((</span><span style="--shiki-default:#569CD6">void</span><span style="--shiki-default:#D4D4D4"> *</span><span style="--shiki-default:#E6E6E6">)(inner </span><span style="--shiki-default:#D4D4D4">+</span><span style="--shiki-default:#B5CEA8"> 1</span><span style="--shiki-default:#E6E6E6">) </span><span style="--shiki-default:#D4D4D4">&gt;</span><span style="--shiki-default:#E6E6E6"> new_data_end) {
</span></span><span class="line highlight" line="49"><span style="--shiki-default:#C586C0">    return</span><span style="--shiki-default:#E6E6E6"> XDP_ABORTED;
</span></span><span class="line highlight" line="50"><span style="--shiki-default:#E6E6E6">  }
</span></span><span class="line highlight" line="51"><span emptylineplaceholder="true">
</span></span><span class="line highlight" line="52"><span style="--shiki-default:#6A9955">  // Backend needs to have a virtual IP on the lo (same one as load balancer)
</span></span><span class="line highlight" line="53"><span style="--shiki-default:#6A9955">  // The source IP is retained as client, so backend will respond directly to it
</span></span><span class="line highlight" line="54"><span style="--shiki-default:#DCDCAA">  __builtin_memcpy</span><span style="--shiki-default:#E6E6E6">(new_eth</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#9CDCFE">h_source</span><span style="--shiki-default:#E6E6E6">, fib.smac, ETH_ALEN);
</span></span><span class="line highlight" line="55"><span style="--shiki-default:#DCDCAA">  __builtin_memcpy</span><span style="--shiki-default:#E6E6E6">(new_eth</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#9CDCFE">h_dest</span><span style="--shiki-default:#E6E6E6">, fib.dmac, ETH_ALEN);
</span></span><span class="line highlight" line="56"><span style="--shiki-default:#E6E6E6">  new_eth</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">h_proto </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#DCDCAA"> bpf_htons</span><span style="--shiki-default:#E6E6E6">(ETH_P_IP);
</span></span><span class="line highlight" line="57"><span emptylineplaceholder="true">
</span></span><span class="line highlight" line="58"><span style="--shiki-default:#6A9955">  // Build OUTER IPv4 header
</span></span><span class="line highlight" line="59"><span style="--shiki-default:#E6E6E6">  __u16 inner_len </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#DCDCAA"> bpf_ntohs</span><span style="--shiki-default:#E6E6E6">(inner</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#9CDCFE">tot_len</span><span style="--shiki-default:#E6E6E6">);
</span></span><span class="line highlight" line="60"><span style="--shiki-default:#E6E6E6">  __u16 outer_len </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> (__u16)(inner_len </span><span style="--shiki-default:#D4D4D4">+</span><span style="--shiki-default:#569CD6"> sizeof</span><span style="--shiki-default:#E6E6E6">(</span><span style="--shiki-default:#569CD6">struct</span><span style="--shiki-default:#E6E6E6"> iphdr));
</span></span><span class="line highlight" line="61"><span style="--shiki-default:#E6E6E6">  outer</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">version </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#B5CEA8"> 4</span><span style="--shiki-default:#E6E6E6">;
</span></span><span class="line highlight" line="62"><span style="--shiki-default:#E6E6E6">  outer</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">ihl </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#B5CEA8"> 5</span><span style="--shiki-default:#E6E6E6">;</span><span style="--shiki-default:#6A9955"> // 20 bytes
</span></span><span class="line highlight" line="63"><span style="--shiki-default:#E6E6E6">  outer</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">tos </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#B5CEA8"> 0</span><span style="--shiki-default:#E6E6E6">;
</span></span><span class="line highlight" line="64"><span style="--shiki-default:#E6E6E6">  outer</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">tot_len </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#DCDCAA"> bpf_htons</span><span style="--shiki-default:#E6E6E6">(outer_len);
</span></span><span class="line highlight" line="65"><span style="--shiki-default:#E6E6E6">  outer</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">id </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#B5CEA8"> 0</span><span style="--shiki-default:#E6E6E6">;
</span></span><span class="line highlight" line="66"><span style="--shiki-default:#E6E6E6">  outer</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">frag_off </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#B5CEA8"> 0</span><span style="--shiki-default:#E6E6E6">;
</span></span><span class="line highlight" line="67"><span style="--shiki-default:#E6E6E6">  outer</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">ttl </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#B5CEA8"> 64</span><span style="--shiki-default:#E6E6E6">;
</span></span><span class="line highlight" line="68"><span style="--shiki-default:#E6E6E6">  outer</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">protocol </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> IPPROTO_IPIP;
</span></span><span class="line highlight" line="69"><span emptylineplaceholder="true">
</span></span><span class="line highlight" line="70"><span style="--shiki-default:#6A9955">  // Retrieve LB real IP
</span></span><span class="line highlight" line="71"><span style="--shiki-default:#E6E6E6">  __u32 lbkey </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#B5CEA8"> 0</span><span style="--shiki-default:#E6E6E6">;
</span></span><span class="line highlight" line="72"><span style="--shiki-default:#569CD6">  struct</span><span style="--shiki-default:#E6E6E6"> endpoint </span><span style="--shiki-default:#D4D4D4">*</span><span style="--shiki-default:#E6E6E6">lb </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#DCDCAA"> bpf_map_lookup_elem</span><span style="--shiki-default:#E6E6E6">(</span><span style="--shiki-default:#D4D4D4">&amp;</span><span style="--shiki-default:#9CDCFE">load_balancer</span><span style="--shiki-default:#E6E6E6">, </span><span style="--shiki-default:#D4D4D4">&amp;</span><span style="--shiki-default:#9CDCFE">lbkey</span><span style="--shiki-default:#E6E6E6">);
</span></span><span class="line highlight" line="73"><span style="--shiki-default:#C586C0">  if</span><span style="--shiki-default:#E6E6E6"> (</span><span style="--shiki-default:#D4D4D4">!</span><span style="--shiki-default:#E6E6E6">lb) {
</span></span><span class="line highlight" line="74"><span style="--shiki-default:#C586C0">    return</span><span style="--shiki-default:#E6E6E6"> XDP_ABORTED;
</span></span><span class="line highlight" line="75"><span style="--shiki-default:#E6E6E6">  }
</span></span><span class="line highlight" line="76"><span style="--shiki-default:#E6E6E6">  outer</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">saddr </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> lb</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">ip;</span><span style="--shiki-default:#6A9955"> // use LB real IP as outer source
</span></span><span class="line highlight" line="77"><span emptylineplaceholder="true">
</span></span><span class="line highlight" line="78"><span style="--shiki-default:#E6E6E6">  outer</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">daddr </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#E6E6E6"> backend</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">ip;</span><span style="--shiki-default:#6A9955">  // tunnel endpoint = backend node IP
</span></span><span class="line highlight" line="79"><span style="--shiki-default:#E6E6E6">  outer</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">check </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#B5CEA8"> 0</span><span style="--shiki-default:#E6E6E6">;
</span></span><span class="line highlight" line="80"><span emptylineplaceholder="true">
</span></span><span class="line highlight" line="81"><span style="--shiki-default:#6A9955">  // Compute outer L3 checksum from scratch
</span></span><span class="line highlight" line="82"><span style="--shiki-default:#E6E6E6">  outer</span><span style="--shiki-default:#D4D4D4">-&gt;</span><span style="--shiki-default:#E6E6E6">check </span><span style="--shiki-default:#D4D4D4">=</span><span style="--shiki-default:#DCDCAA"> recalc_ip_checksum</span><span style="--shiki-default:#E6E6E6">(outer);
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><div class="border-[2px] my-[24px] px-6 py-0 rounded-lg border-primary/50 bg-[#f7fbfe]"><!--[--><p class="prose-p" data-v-b025fb9f=""><!--[--> Im leaving out other code details, such as hashing and packet rewriting, since they are exactly the same as in the <a href="https://labs.iximiuz.com/tutorials/xdp-dsr-layer2-lb-92b02f3e" rel="nofollow" target="_blank" class="prose-a !underline !underline-offset-2 !decoration-dashed !text-black" data-v-abeb6555=""><!--[-->L2 DSR tutorial<!--]--><!----></a>. Make sure to check it out if you havent already, as it makes a lot of sense to learn both in this order.<!--]--></p><!--]--></div><p class="prose-p" data-v-b025fb9f=""><!--[-->And that's ALMOST it.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->We
 must still instruct the backend nodes to decapsulate the received IPIP 
packets. Servers do not handle this by default, so we need to manually 
enable the IPIP tunnel interface to ensure the traffic is read 
correctly.<!--]--></p><h3 id="ipip-packet-decapsulation" class="prose-h3" data-v-9a0ceb30=""><!--[-->IPIP Packet Decapsulation<!--]--><!----></h3><p class="prose-p" data-v-b025fb9f=""><!--[-->When the packet reaches the backend node, the backend node needs to decapsulate it  and this is handled by the <code class="prose-code-inline" data-v-a031129a=""><!--[-->ipip<!--]--></code> kernel module.<!--]--></p><div class="border-[2px] my-[24px] px-6 py-0 rounded-lg border-primary/50 bg-[#f7fbfe]" data-v-370f298d=""><!--[--><details data-v-370f298d=""><summary class="cursor-pointer my-3 select-none text-[#4078c0]" data-v-370f298d="">Why does it need to decapsulate the packet?</summary><!--[--><p class="prose-p" data-v-b025fb9f=""><!--[-->Since
 the packet sent from the load balancer to the backend node is an 
encapsulated IP header (inner) within another IP header (outer), the 
backend needs to "access" the inner IP header to figure out it points to
 its VIP on the localhost (<code class="prose-code-inline" data-v-a031129a=""><!--[-->lo<!--]--></code>).<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->It does this by decapsulating the packet.<!--]--></p><!--]--></details><!--]--></div><p class="prose-p" data-v-b025fb9f=""><!--[-->Therefore, first load the <code class="prose-code-inline" data-v-a031129a=""><!--[-->ipip<!--]--></code> kernel module, enabling IP-in-IP tunneling support on the backends (<code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-01<!--]--></code> and <code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-02<!--]--></code> tabs):<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> modprobe</span><span style="--shiki-default:#CE9178"> ipip
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->Then create a new IP-in-IP tunnel interface named <code class="prose-code-inline" data-v-a031129a=""><!--[-->ipip0<!--]--></code> (in the <code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-01<!--]--></code> and <code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-02<!--]--></code> tabs):<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> ip</span><span style="--shiki-default:#CE9178"> link</span><span style="--shiki-default:#CE9178"> add</span><span style="--shiki-default:#CE9178"> name</span><span style="--shiki-default:#CE9178"> ipip0</span><span style="--shiki-default:#CE9178"> type</span><span style="--shiki-default:#CE9178"> ipip</span><span style="--shiki-default:#CE9178"> external
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->Now, to make this tunnel interface active so it can start receiving and sending packets (in the <code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-01<!--]--></code> and <code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-02<!--]--></code> tabs):<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> ip</span><span style="--shiki-default:#CE9178"> link</span><span style="--shiki-default:#CE9178"> set</span><span style="--shiki-default:#CE9178"> up</span><span style="--shiki-default:#CE9178"> dev</span><span style="--shiki-default:#CE9178"> ipip0</span><span style="--shiki-default:#6A9955"> #  Bring the tunnel interface up
</span></span><span class="line" line="2"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> ip</span><span style="--shiki-default:#CE9178"> address</span><span style="--shiki-default:#CE9178"> add</span><span style="--shiki-default:#CE9178"> 127.0.0.42/32</span><span style="--shiki-default:#CE9178"> dev</span><span style="--shiki-default:#CE9178"> ipip0</span><span style="--shiki-default:#6A9955"> # Assign a dummy local IP address to the tunnel device so the kernel considers it active (not used actually - that's why dummy!)
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->Finally, validate the configuration (in the <code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-01<!--]--></code> and <code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-02<!--]--></code> tabs), using:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">ip</span><span style="--shiki-default:#CE9178"> -d</span><span style="--shiki-default:#CE9178"> link</span><span style="--shiki-default:#CE9178"> show</span><span style="--shiki-default:#CE9178"> dev</span><span style="--shiki-default:#CE9178"> ipip0
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">6:</span><span style="--shiki-default:#CE9178"> ipip0@NONE:</span><span style="--shiki-default:#D4D4D4"> &lt;</span><span style="--shiki-default:#CE9178">NOARP,UP,LOWER_U</span><span style="--shiki-default:#E6E6E6">P</span><span style="--shiki-default:#D4D4D4">&gt;</span><span style="--shiki-default:#CE9178"> mtu</span><span style="--shiki-default:#B5CEA8"> 1480</span><span style="--shiki-default:#CE9178"> qdisc</span><span style="--shiki-default:#CE9178"> noqueue</span><span style="--shiki-default:#CE9178"> state</span><span style="--shiki-default:#CE9178"> UNKNOWN</span><span style="--shiki-default:#CE9178"> mode</span><span style="--shiki-default:#CE9178"> DEFAULT</span><span style="--shiki-default:#CE9178"> group</span><span style="--shiki-default:#CE9178"> default</span><span style="--shiki-default:#CE9178"> qlen</span><span style="--shiki-default:#B5CEA8"> 1000
</span></span><span class="line" line="2"><span style="--shiki-default:#DCDCAA">    link/ipip</span><span style="--shiki-default:#B5CEA8"> 0.0.0.0</span><span style="--shiki-default:#CE9178"> brd</span><span style="--shiki-default:#B5CEA8"> 0.0.0.0</span><span style="--shiki-default:#CE9178"> promiscuity</span><span style="--shiki-default:#B5CEA8"> 0</span><span style="--shiki-default:#CE9178">  allmulti</span><span style="--shiki-default:#B5CEA8"> 0</span><span style="--shiki-default:#CE9178"> minmtu</span><span style="--shiki-default:#B5CEA8"> 0</span><span style="--shiki-default:#CE9178"> maxmtu</span><span style="--shiki-default:#B5CEA8"> 0</span><span style="--shiki-default:#E6E6E6"> 
</span></span><span class="line" line="3"><span style="--shiki-default:#DCDCAA">    ipip</span><span style="--shiki-default:#CE9178"> external</span><span style="--shiki-default:#CE9178"> any</span><span style="--shiki-default:#CE9178"> remote</span><span style="--shiki-default:#CE9178"> any</span><span style="--shiki-default:#CE9178"> local</span><span style="--shiki-default:#CE9178"> any</span><span style="--shiki-default:#CE9178"> ttl</span><span style="--shiki-default:#CE9178"> inherit</span><span style="--shiki-default:#CE9178"> pmtudisc</span><span style="--shiki-default:#CE9178"> addrgenmode</span><span style="--shiki-default:#CE9178"> eui64</span><span style="--shiki-default:#CE9178"> numtxqueues</span><span style="--shiki-default:#B5CEA8"> 1</span><span style="--shiki-default:#CE9178"> numrxqueues</span><span style="--shiki-default:#B5CEA8"> 1</span><span style="--shiki-default:#CE9178"> gso_max_size</span><span style="--shiki-default:#B5CEA8"> 65536</span><span style="--shiki-default:#CE9178"> gso_max_segs</span><span style="--shiki-default:#B5CEA8"> 65535</span><span style="--shiki-default:#CE9178"> tso_max_size</span><span style="--shiki-default:#B5CEA8"> 65536</span><span style="--shiki-default:#CE9178"> tso_max_segs</span><span style="--shiki-default:#B5CEA8"> 65535</span><span style="--shiki-default:#CE9178"> gro_max_size</span><span style="--shiki-default:#B5CEA8"> 65536
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->And
 thats all the magic there is  the same VIP configuration concepts 
apply to IPIP DSR as they did for L2 DSR (setting up the VIP and 
ensuring it doesnt respond to ARP requests).<!--]--></p><div class="border-[2px] my-[24px] px-6 py-0 rounded-lg border-primary/50 bg-[#f7fbfe]"><!--[--><p class="prose-p" data-v-b025fb9f=""><!--[-->
 While we could also use XDP/eBPF programs on the backend nodes to 
handle decapsulation, we will skip that for now to keep our focus 
strictly on the load balancer implementation.<!--]--></p><!--]--></div><p class="prose-p" data-v-b025fb9f=""><!--[-->Let's see it in action.<!--]--></p><h2 id="running-the-load-balancer" class="prose-h2" data-v-b9b1576a=""><!--[-->Running the Load Balancer<!--]--><!----></h2><div class="border-[2px] my-[24px] px-6 py-0 rounded-lg border-warning bg-[#fdeee5]"><!--[--><p class="prose-p" data-v-b025fb9f=""><!--[-->
 Before moving on, make sure the VIP is configured on both the load 
balancer and the backend nodes as described above, and that the ARP 
table is populated on the load balancer.<!--]--></p><!--]--></div><p class="prose-p" data-v-b025fb9f=""><!--[-->Compile and run the load balancer (<code class="prose-code-inline" data-v-a031129a=""><!--[-->lb<!--]--></code> tab under <code class="prose-code-inline" data-v-a031129a=""><!--[-->lab<!--]--></code> directory) using:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">go</span><span style="--shiki-default:#CE9178"> generate
</span></span><span class="line" line="2"><span style="--shiki-default:#DCDCAA">go</span><span style="--shiki-default:#CE9178"> build
</span></span><span class="line" line="3"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> ./lb</span><span style="--shiki-default:#CE9178"> -i</span><span style="--shiki-default:#CE9178"> eth0</span><span style="--shiki-default:#CE9178"> -backends</span><span style="--shiki-default:#CE9178"> 172.16.0.10,172.16.0.11</span><span style="--shiki-default:#CE9178"> -lb-ip</span><span style="--shiki-default:#B5CEA8"> 192.168.178.10
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><div class="border-[2px] my-[24px] px-6 py-0 rounded-lg border-primary/50 bg-[#f7fbfe]" data-v-370f298d=""><!--[--><details data-v-370f298d=""><summary class="cursor-pointer my-3 select-none text-[#4078c0]" data-v-370f298d="">What are these input parameters?</summary><!--[--><ul class="prose-ul" data-v-533e29f3=""><!--[--><li class="prose-li" data-v-2969431c=""><!--[--><code class="prose-code-inline" data-v-a031129a=""><!--[-->-i<!--]--></code>: The network interface on which this XDP load balancer program will run.<!--]--></li><li class="prose-li" data-v-2969431c=""><!--[--><code class="prose-code-inline" data-v-a031129a=""><!--[-->-backends<!--]--></code>:
 The list of backend IPs in this playground. You must provide exactly 
two backends, as simplified earlier for the basic hashing example.<!--]--></li><li class="prose-li" data-v-2969431c=""><!--[--><code class="prose-code-inline" data-v-a031129a=""><!--[-->-lb-ip<!--]--></code>:
 The load balancers IP address, used as the source IP in the outer IP 
header. This could be automated, but were keeping the setup simple.<!--]--></li><!--]--></ul><!--]--></details><!--]--></div><p class="prose-p" data-v-b025fb9f=""><!--[-->And run the HTTP Server binded to VIP (on the <code class="prose-code-inline" data-v-a031129a=""><!--[-->lo<!--]--></code>) on both backends (<code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-01<!--]--></code> and <code class="prose-code-inline" data-v-a031129a=""><!--[-->backend-02<!--]--></code> tabs):<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">python3</span><span style="--shiki-default:#CE9178"> -m</span><span style="--shiki-default:#CE9178"> http.server</span><span style="--shiki-default:#B5CEA8"> 8000</span><span style="--shiki-default:#CE9178"> --bind</span><span style="--shiki-default:#B5CEA8"> 192.168.178.15
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->Now you can query the VIP from either <code class="prose-code-inline" data-v-a031129a=""><!--[-->client<!--]--></code> tab, using:<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">curl</span><span style="--shiki-default:#CE9178"> http://192.168.178.15:8000
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->And make sure that the HTTP server actually received the request from the client (IP at the beginning of the line):<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">10.0.0.20</span><span style="--shiki-default:#CE9178"> -</span><span style="--shiki-default:#CE9178"> -</span><span style="--shiki-default:#E6E6E6"> [01/Jan/2026 </span><span style="--shiki-default:#CE9178">16:03:45]</span><span style="--shiki-default:#CE9178"> "GET / HTTP/1.1"</span><span style="--shiki-default:#B5CEA8"> 200</span><span style="--shiki-default:#CE9178"> -
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->Let's
 say you don't believe md, this actually led to request being routed 
through the load balancer and directly back to the client.<!--]--></p><p class="prose-p" data-v-b025fb9f=""><!--[-->If you want to be sure, play-around with <code class="prose-code-inline" data-v-a031129a=""><!--[-->tcpdump<!--]--></code> or just verify it by inspecting the load balancers logs, using (in the "new" <code class="prose-code-inline" data-v-a031129a=""><!--[-->lb<!--]--></code> tab):<!--]--></p><!--[--><div class="highlight-bash prose-code" meta="" data-v-4578ab24=""><!----><!--[--><pre class="language-bash shiki shiki-themes slack-dark" style=""><!--[--><code><span class="line" line="1"><span style="--shiki-default:#DCDCAA">sudo</span><span style="--shiki-default:#CE9178"> bpftool</span><span style="--shiki-default:#CE9178"> prog</span><span style="--shiki-default:#CE9178"> trace
</span></span></code><!--]--></pre><!--]--><button class="copy-button" data-v-4578ab24="" data-v-134dddac=""><span class="sr-only" data-v-134dddac="">Copy to clipboard</span><span class="icon-wrapper" data-v-134dddac=""><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:18px;" width="1em" height="1em" viewBox="0 0 256 256" data-v-134dddac=""><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg></span></button></div><!--]--><p class="prose-p" data-v-b025fb9f=""><!--[-->Congrats - you've came to the end of this tutorial <!--]--></p><style nonce="">html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}</style></div><!----></div></div><!--]--><div class="px-4 md:px-8 xl:px-12 mt-auto" data-v-200caef3=""><!--[--><div class="bg-frost-light border-[2px] border-primary/30 flex flex-wrap gap-6 items-center px-6 py-6 rounded-lg my-10" data-v-0d30d5a9=""><p class="basis-[480px] grow my-0 py-0 text-slate-700 text-xl"><!--[--> Level up your Server Side game  Join 20,000 engineers who receive insightful learning materials straight to their inbox <!--]--></p><div class="basis-[150px] flex flex-wrap gap-x-5 gap-y-2 grow min-w-[150px]"><input class="focus:ring-0 grow-[4] input input-bordered min-w-[150px]" placeholder="Email" data-ddg-inputtype="identities.emailAddress" data-ddg-autofill="true" style="background-size: auto 24px !important; background-position: right center !important; background-repeat: no-repeat !important; background-origin: content-box !important; background-image: url(&quot;data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTY0IDEyOEM5OS4zNTg2IDEyOCAxMjggOTkuMzU4NiAxMjggNjRDMTI4IDI4LjY0MTQgOTkuMzU4NiAwIDY0IDBDMjguNjQxNCAwIDAgMjguNjQxNCAwIDY0QzAgOTkuMzU4NiAyOC42NDE0IDEyOCA2NCAxMjhaIiBmaWxsPSIjNDQ0NDQ0Ii8+CiAgICA8cGF0aCBkPSJNNzYuOTk5MSA1Mi4yMTM3Qzc3LjQ5NjYgNTIuMjEzNyA3Ny45MDA5IDUxLjgwOTQgNzcuOTAwOSA1MS4zMTE4Qzc3LjkwMDkgNTAuODE0MyA3Ny40OTY2IDUwLjQxIDc2Ljk5OTEgNTAuNDFDNzYuNTAxNSA1MC40MSA3Ni4wOTcyIDUwLjgxNDMgNzYuMDk3MiA1MS4zMTE4Qzc2LjA5NzIgNTEuODA5NCA3Ni41MDE1IDUyLjIxMzcgNzYuOTk5MSA1Mi4yMTM3WiIgZmlsbD0id2hpdGUiLz4KICAgIDxwYXRoIGQ9Ik01MC4xOTI0IDU0LjU0NkM1MC43ODMzIDU0LjU0NiA1MS4yNDk3IDU0LjA3OTYgNTEuMjQ5NyA1My40ODg3QzUxLjI0OTcgNTIuODk3OCA1MC43ODMzIDUyLjQzMTQgNTAuMTkyNCA1Mi40MzE0QzQ5LjYwMTUgNTIuNDMxNCA0OS4xMzUxIDUyLjg5NzggNDkuMTM1MSA1My40ODg3QzQ5LjEzNTEgNTQuMDc5NiA0OS42MDE1IDU0LjU0NiA1MC4xOTI0IDU0LjU0NloiIGZpbGw9IndoaXRlIi8+CiAgICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTEyMi43NSA2NEMxMjIuNzUgOTYuNDQ2OCA5Ni40NDY3IDEyMi43NSA2NCAxMjIuNzVDMzEuNTUzMyAxMjIuNzUgNS4yNSA5Ni40NDY4IDUuMjUgNjRDNS4yNSAzMS41NTMzIDMxLjU1MzMgNS4yNSA2NCA1LjI1Qzk2LjQ0NjcgNS4yNSAxMjIuNzUgMzEuNTUzMyAxMjIuNzUgNjRaTTQ2Ljc4MzcgMTE0LjkzNEM0NS41MjI5IDExMC41NTggNDIuNjQzNCAxMDAuMjYgMzguMjUwNyA4Mi42NTlDMzEuOTM3OCA1Ny4zNzYyIDI3LjI0MTkgMzYuNzU4MSA1MC45Mzg3IDMwLjMyMDhDNTEuMTg3NSAzMC4yNTg2IDUxLjI4MDggMjkuOTc4NyA1MS4wOTQyIDI5LjgyMzJDNDguMzU3NiAyNy4zMzUzIDQzLjcyNCAyNi45IDM5LjE4MzYgMjcuODAxOEMzOC45NjU5IDI3LjgzMjkgMzguODEwNSAyNy42Nzc0IDM4LjgxMDUgMjcuNDkwOEMzOC44MTA1IDI3LjQyODYgMzguODEwNSAyNy4zNjY0IDM4Ljg3MjYgMjcuMzA0MkMzOS45NjExIDI1Ljc4MDQgNDEuOTIwMyAyNC41OTg3IDQzLjI1NzUgMjMuODgzNEM0Mi4zMjQ1IDIzLjA0MzggNDEuMDgwNiAyMi40ODQgNDAuMDIzMyAyMi4xMTA5QzM5LjcxMjMgMjEuOTg2NSAzOS43MTIzIDIxLjQ1NzggMzkuOTkyMiAyMS4zMzM0QzQwLjAyMzMgMjEuMzAyMyA0MC4wNTQ0IDIxLjI3MTIgNDAuMTE2NiAyMS4yNzEyQzQ5LjQ0NiAyMC4wMjczIDU5LjI0MTkgMjIuODI2MSA2NC4wNjIyIDI4Ljk4MzVDNjQuMTI0MyAyOS4wNDU3IDY0LjE4NjUgMjkuMDc2OCA2NC4yNDg3IDI5LjEwNzlDODAuMDc3NyAzMi40OTc2IDgyLjk2OTggNTQuOTE5NCA4Mi4wMDU4IDYxLjEwNzlDODcuNTcyNCA2MC40NTQ5IDkxLjczOTUgNTkuMDg2NiA5NC41MDcyIDU4LjAyOTJDOTguNDg3OCA1Ni41MDU0IDk5Ljg4NzIgNTYuODQ3NSAxMDAuMzg1IDU3Ljc0OTNDMTAwLjkxMyA1OC43NzU2IDEwMC4yOTIgNjAuNDg2IDk4Ljg5MjEgNjIuMDcyQzk2LjI0ODcgNjUuMDg4NSA5MS40NTk2IDY3LjQ1MiA4My4wMzIgNjguMTM2MUM4MC4xMTg5IDY4LjM3MjYgNzcuNTQ0IDY4LjI1OTggNzUuMzIyNSA2OC4xNjI1QzcxLjExNzQgNjcuOTc4NCA2OC4xNzkxIDY3Ljg0OTcgNjYuNjEyMiA3MC4yNTA4QzY1LjU4NiA3MS44MzY4IDY2LjM5NDUgNzUuNTY4NiA3NC41NDIyIDc2Ljc1MDNDODAuMzU4NiA3Ny41ODgzIDg1LjYyODEgNzcuMDAyNiA4OS40NzAxIDc2LjU3NTVDOTIuODk5OCA3Ni4xOTQzIDk1LjE5MiA3NS45Mzk1IDk1LjcyMDEgNzYuOTM2OUM5Ni44Mzk2IDc5LjA4MjcgOTAuNDAyMyA4My4zNzQyIDc5LjM2MjQgODMuNDY3NUM3OC41MjI4IDgzLjQ2NzUgNzcuNjgzMSA4My40MzY0IDc2Ljg3NDYgODMuNDA1M0M3MC4wMzMgODMuMDYzMyA2NC45OTUxIDgxLjE5NzQgNjEuODU0MiA3OS40ODdDNjEuNzYwOSA3OS40NTU5IDYxLjY5ODcgNzkuNDI0OCA2MS42Njc2IDc5LjM5MzdDNjEuMTA3OCA3OS4wODI3IDYwLjAxOTQgNzkuNjQyNCA2MC42NzI1IDgwLjgyNDJDNjEuMDQ1NiA4MS41Mzk0IDYzLjAzNTkgODMuMzc0MiA2Ni4wMjEzIDg0Ljk2MDJDNjUuNzEwNCA4Ny40NDgxIDY2LjQ4NzggOTEuMjczMiA2Ny44MjUgOTUuNjI2OUM2Ny45ODA0IDk1LjYwMSA2OC4xMzU3IDk1LjU2OTcgNjguMjk1NSA5NS41Mzc2QzY4LjUxOTYgOTUuNDkyNCA2OC43NTI2IDk1LjQ0NTUgNjkuMDA2OCA5NS40MDkyQzcxLjcxMjMgOTQuOTczOCA3My4xNDI4IDk1LjQ3MTQgNzMuOTUxNCA5Ni4zNDIyQzc3Ljc3NjQgOTMuNDgxMSA4NC4xNTE2IDg5LjQzODQgODQuNzczNSA5MC4xODQ3Qzg3Ljg4MzMgOTMuODg1NCA4OC4yODc2IDEwMi42MjQgODcuNjAzNSAxMDYuMTM4Qzg3LjU3MjQgMTA2LjIgODcuNTEwMiAxMDYuMjYyIDg3LjM4NTggMTA2LjMyNUM4NS45MjQyIDEwNi45NDcgNzcuODY5OCAxMDQuNzQ2IDc3Ljg2OTggMTAzLjU5NkM3Ny41NTg4IDk3Ljg2NiA3Ni40OTM3IDk3LjMzNzMgNzUuMjQ5OCA5Ny4wNTc0SDc0LjQxNzhDNzQuNDQ4OSA5Ny4wODg1IDc0LjQ4IDk3LjE1MDcgNzQuNTExMSA5Ny4yMTI5TDc0Ljc5MSA5Ny44NjZDNzUuMjg4NiA5OS4yMzQzIDc2LjA2NiAxMDMuNTI2IDc1LjQ3NTIgMTA0LjU4M0M3NC44ODQzIDEwNS42NDEgNzEuMDI4MSAxMDYuMTY5IDY4LjYzMzYgMTA2LjJDNjYuMjcwMSAxMDYuMjMxIDY1Ljc0MTUgMTA1LjM2MSA2NS4yNDM5IDEwNC4wMjNDNjQuODcwNyAxMDIuOTM1IDY0LjY4NDEgMTAwLjQxNiA2NC42ODQxIDk4Ljk1NDRDNjQuNjUzIDk4LjUxOSA2NC42ODQxIDk4LjE0NTkgNjQuNzQ2MyA5Ny44MDM4QzY0LjAzMTEgOTguMTE0OCA2Mi45ODE2IDk4LjgzIDYyLjYzOTUgOTkuMjk2NEM2Mi41NDYyIDEwMC42OTYgNjIuNTQ2MiAxMDIuOTM1IDYzLjI5MjUgMTA1LjQyM0M2My42NjU3IDEwNi42MDUgNTUuMTk5MiAxMTEuNjQyIDU0LjAxNzQgMTEwLjcxQzUyLjgwNDYgMTA5Ljc0NSA1MC42Mjc4IDEwMC4yOTIgNTEuNTYwNyA5Ni40NjY2QzUwLjU2NTYgOTYuNTU5OSA0OS43NTcgOTYuODcwOCA0OS4zMjE2IDk3LjQ5MjhDNDcuMzYyNCAxMDAuMTk4IDQ5LjgxOTIgMTEzLjEzNSA1Mi40MzE0IDExNC44MTRDNTMuNzk5OCAxMTUuNzE2IDYwLjY0MTQgMTExLjg2IDY0LjAzMTEgMTA4Ljk2OEM2NC41OTA4IDEwOS43NDUgNjUuNjYzOCAxMDkuODA4IDY2Ljk4NTQgMTA5LjgwOEM2OC43MjY5IDEwOS43NDUgNzEuMTUyNSAxMDkuNDk3IDcyLjg2MjkgMTA4Ljk2OEM3My44ODY3IDExMS4zNjcgNzUuMTIxOSAxMTQuMTU3IDc2LjEzNTMgMTE2LjM3NEM5OS45NzU5IDExMC44NzMgMTE3Ljc1IDg5LjUxMjEgMTE3Ljc1IDY0QzExNy43NSAzNC4zMTQ3IDkzLjY4NTMgMTAuMjUgNjQgMTAuMjVDMzQuMzE0NyAxMC4yNSAxMC4yNSAzNC4zMTQ3IDEwLjI1IDY0QzEwLjI1IDg3LjY2NCAyNS41NDIzIDEwNy43NTYgNDYuNzgzNyAxMTQuOTM0Wk03Ny4xMjc1IDQyLjUxOThDNzcuMTY4IDQyLjUzNzkgNzcuMjA4MSA0Mi41NTU4IDc3LjI0NzggNDIuNTczNEM3Ny40NjU1IDQyLjY2NjcgNzcuNzE0MiA0Mi40MTggNzcuNTU4NyA0Mi4yMzE0Qzc2Ljg0MzUgNDEuMjY3MyA3NS43ODYyIDQwLjM2NTUgNzMuNTQ3MSA0MC4zNjU1QzcxLjMwOCA0MC4zNjU1IDY5LjkzOTcgNDEuMTQyOSA2OS4zMTc3IDQyLjEzODFDNjkuMTkzMyA0Mi4zODY5IDY5LjU2NjUgNDIuNjM1NiA2OS44MTUzIDQyLjUxMTJDNzAuNTYxNyA0Mi4xMDcgNzEuNzEyMyA0MS42NDA1IDczLjU0NzEgNDEuNjcxNkM3NS4yOTUyIDQxLjcwMTIgNzYuMzA5NCA0Mi4xNTQzIDc3LjEyNzUgNDIuNTE5OFpNNzUuNDQ0MSA1NS45MTQ2Qzc3LjM3MjIgNTUuOTE0NiA3OC45MjcxIDU0LjM1OTYgNzguOTI3MSA1Mi40NjI3Qzc4LjkyNzEgNTAuNTM0NiA3Ny4zNzIyIDQ5LjAxMDggNzUuNDQ0MSA0OS4wMTA4QzczLjUxNiA0OS4wMTA4IDcxLjk2MTEgNTAuNTY1NyA3MS45NjExIDUyLjQ2MjdDNzEuOTYxMSA1NC4zNTk2IDczLjUxNiA1NS45MTQ2IDc1LjQ0NDEgNTUuOTE0NlpNNTIuNDMxNCA1NC44NTcyQzUyLjQzMTQgNTIuNjE4MSA1MC42Mjc4IDUwLjgxNDUgNDguMzg4NyA1MC44MTQ1QzQ2LjE0OTYgNTAuODE0NSA0NC4zMTQ4IDUyLjYxODEgNDQuMzQ1OSA1NC44NTcyQzQ0LjM0NTkgNTcuMDk2MyA0Ni4xNDk2IDU4LjkgNDguMzg4NyA1OC45QzUwLjYyNzggNTguOSA1Mi40MzE0IDU3LjA5NjMgNTIuNDMxNCA1NC44NTcyWk00MC44NjI5IDQ1Ljk2MzFDNDEuMjk4MyA0NS4zMTAxIDQxLjk4MjUgNDQuMzE0OSA0NC4xNTkzIDQzLjQxMzFDNDYuMzM2MiA0Mi41MTEyIDQ4LjA0NjYgNDIuNjM1NiA0OS4yMjgzIDQyLjkxNTVDNDkuNDc3MSA0Mi45Nzc3IDQ5LjY2MzcgNDIuNjk3OCA0OS40NDYgNDIuNTQyM0M0OC41MTMxIDQxLjc2NDkgNDYuNDI5NSA0MC44MzE5IDQzLjY5MjkgNDEuODU4MkM0MS4yNjcyIDQyLjc2IDQwLjExNjYgNDQuNjU3IDQwLjExNjYgNDUuOTAwOUM0MC4xMTY2IDQ2LjE4MDggNDAuNzA3NCA0Ni4yMTE5IDQwLjg2MjkgNDUuOTYzMVoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPg==&quot;) !important; transition: background !important;"><button type="button" class="btn relative btn-primary grow min-w-[150px]"><div class="flex grow items-center justify-center"><!--[--> Subscribe <!--]--></div><!----></button></div></div><!--]--></div><!--]--></div><!--[--><!--]--></div><!--]--></article><!--]--></div></div><!--[--><!----><div class="hidden duration-300 ease-in-out h-[calc(100vh-3rem)] lg:pb-[3px] overflow-y-auto pb-14 pl-[3px] pr-[3px] pt-1.5 scrollbar-styled top-[3rem] transition-[flex-basis]"><!--[--><!--]--></div><!--]--></div><dialog id="contentEditDialog-tutorial-xdp-dsr-load-balancer-b701a95a" class="modal" data-v-0d30d5a9=""><form method="dialog" class="lg:max-w-3xl modal-box overflow-hidden p-0 relative scrollbar-hidden"><button class="absolute btn btn-circle btn-ghost btn-xs hover:rotate-90 right-2 top-2 transition-transform z-10">  </button><div class="max-h-[calc(100vh-8rem)] overflow-y-auto px-8 py-6 scrollbar-hidden"><h3 class="font-bold mb-2 text-lg"> How to Author Tutorials on iximiuz Labs</h3><p class="py-3 text-base-content/90"> Instead of providing a subpar online editing experience, iximiuz Labs offers a helper CLI tool called <a href="https://github.com/iximiuz/labctl" rel="noopener noreferrer" target="_blank noopener noreferrer" class="link">labctl</a>,
 allowing you to use your favorite text editor (or a full-featured IDE) 
to write content from the comfort of your local machine. </p><div class="flex flex-col gap-y-6 mt-4"><div class="bg-frost-light border border-primary/50 hover:shadow-md p-5 rounded-xl shadow-sm transition-all"><h4 class="flex font-semibold items-center mb-4"> Install labctl CLI </h4><div class="bg-base-content flex items-center justify-between px-3 py-2 rounded-md my-2"><div class="flex grow min-w-0"><code class="break-all md:break-normal md:truncate text-base-200 text-sm"><!--[--> curl -sf https://labs.iximiuz.com/cli/install.sh | sh <!--]--></code></div><button type="button" class="btn relative bg-base-content border-base-content btn-sm btn-square hover:bg-base-content hover:border-base-300/20 hover:text-base-100 text-base-200"><div class="flex grow items-center justify-center"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:22px;" width="1em" height="1em" viewBox="0 0 256 256"><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg><!--]--></div><!----></button></div><p class="italic mt-3 text-base-content/90 text-sm"> This will download and install the latest version of the labctl CLI. You only need to do this once per workstation. </p></div><div class="bg-frost-light border border-primary/50 hover:shadow-md p-5 rounded-xl shadow-sm transition-all"><h4 class="flex font-semibold items-center mb-4"> Authorize labctl </h4><div class="bg-base-content flex items-center justify-between px-3 py-2 rounded-md my-2"><div class="flex grow min-w-0"><code class="break-all md:break-normal md:truncate text-base-200 text-sm"><!--[--> labctl auth login <!--]--></code></div><button type="button" class="btn relative bg-base-content border-base-content btn-sm btn-square hover:bg-base-content hover:border-base-300/20 hover:text-base-100 text-base-200"><div class="flex grow items-center justify-center"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:22px;" width="1em" height="1em" viewBox="0 0 256 256"><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg><!--]--></div><!----></button></div><p class="italic mt-3 text-base-content/90 text-sm">
 This will open a browser window asking you to authorize labctl to 
access your account. You need to do it after a fresh install of labctl 
and repeat it whenever the auth session expires. </p></div><div class="bg-frost-light border border-primary/50 hover:shadow-md p-5 rounded-xl shadow-sm transition-all"><h4 class="flex font-semibold items-center mb-4"> Pull tutorial content </h4><div class="bg-base-content flex items-center justify-between px-3 py-2 rounded-md my-2"><div class="flex grow min-w-0"><code class="break-all md:break-normal md:truncate text-base-200 text-sm"><!--[--> labctl content pull tutorial xdp-dsr-load-balancer-b701a95a<!--]--></code></div><button type="button" class="btn relative bg-base-content border-base-content btn-sm btn-square hover:bg-base-content hover:border-base-300/20 hover:text-base-100 text-base-200"><div class="flex grow items-center justify-center"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:22px;" width="1em" height="1em" viewBox="0 0 256 256"><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg><!--]--></div><!----></button></div><p class="italic mt-3 text-base-content/90 text-sm"> This will create a local copy of the tutorial content in a directory named <code class="bg-base-300 px-1 py-0.5 rounded">xdp-dsr-load-balancer-b701a95a</code>. You only need to do this once per tutorial. </p></div><div class="bg-frost-light border border-primary/50 hover:shadow-md p-5 rounded-xl shadow-sm transition-all"><h4 class="flex font-semibold items-center mb-4"> Stream your changes </h4><div class="bg-base-content flex items-center justify-between px-3 py-2 rounded-md my-2"><div class="flex grow min-w-0"><code class="break-all md:break-normal md:truncate text-base-200 text-sm"><!--[--> labctl content push -fw tutorial xdp-dsr-load-balancer-b701a95a<!--]--></code></div><button type="button" class="btn relative bg-base-content border-base-content btn-sm btn-square hover:bg-base-content hover:border-base-300/20 hover:text-base-100 text-base-200"><div class="flex grow items-center justify-center"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--ph" style="font-size:22px;" width="1em" height="1em" viewBox="0 0 256 256"><path fill="currentColor" d="M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z"></path></svg><!--]--></div><!----></button></div><p class="italic mt-3 text-base-content/90 text-sm">
 Run this command in a separate terminal to continuously upload your 
changes to the server while editing the tutorial in your favorite text 
editor or IDE. </p></div><p class="leading-relaxed p-4 text-base-content/90 text-sm"> You can also use labctl to create, list, and delete your content. Learn more about the available commands: <code class="bg-base-300 px-1 py-0.5 rounded">labctl content --help</code></p></div></div></form><form method="dialog" class="backdrop-blur-sm modal-backdrop"><button>close</button></form></dialog><div class="border-slate-400 border-t bottom-0 fixed left-0 lg:hidden right-0 z-50" data-v-0d30d5a9=""><div class="flex glass items-center justify-center p-2.5"><!--[--><a href="https://labs.iximiuz.com/signup?return_to=%2Ftutorials%2Fxdp-dsr-load-balancer-b701a95a" class="btn bg-base-100 btn-neutral btn-outline btn-sm gap-2 shadow-md" role="button"><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-4 mr-1 w-4"><path fill-rule="evenodd" d="M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z" clip-rule="evenodd"></path></svg> Start tutorial<!--]--></a><!--]--></div></div></div><!--]--></div></div><div id="teleports"></div><script nonce="">window.__NUXT__={};window.__NUXT__.config={public:{environment:"production",siteName:"iximiuz Labs",siteEmail:"ivan@iximiuz.com",siteUrl:"https://labs.iximiuz.com",site:{url:"https://labs.iximiuz.com"},siteTitle:"iximiuz Labs - Indie Learning Platform to Master Server Side Craft",siteDescription:"Skill up in Linux, Networking, Containers, and Kubernetes by taking courses, following interactive tutorials, and solving fun DevOps challenges.",discordServerUrl:"https://discord.gg/p6nxaHm46p",gumroadProfileUrl:"https://products.iximiuz.com",newsletterUrl:"https://newsletter.iximiuz.com/",emailSubsCount:"20,000",mdc:{components:{prose:true,map:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote",pre:"prose-pre","code-inline":"prose-code-inline",code:"prose-code-inline",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",script:"prose-script",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},customElements:[]},headings:{anchorLinks:{h1:false,h2:true,h3:true,h4:true,h5:false,h6:false}},highlight:{theme:"slack-dark",preload:["ada","c","csharp","diff","java","js","json","docker","go","hcl","make","md","php","proto","python","rust","shell","ts","yaml","toml"],highlighter:"shiki",shikiEngine:"oniguruma",langs:["js","jsx","json","ts","tsx","vue","css","html","bash","md","mdc","yaml","ada","c","csharp","diff","java","js","json","docker","go","hcl","make","md","php","proto","python","rust","shell","ts","yaml","toml"]}},plausible:{enabled:true,hashMode:false,domain:"labs.iximiuz.com",ignoredHostnames:["localhost"],ignoreSubDomains:false,trackLocalhost:"",apiHost:"https://plausible.io",autoPageviews:true,autoOutboundTracking:false,logIgnoredEvents:false,proxy:false,proxyBaseEndpoint:"/_plausible"},"nuxt-robots":{version:"5.7.0",isNuxtContentV2:false,debug:false,credits:false,groups:[{userAgent:["*"],disallow:["/account","/dashboard","/new","/enter","/main","/signin","/signup","/*/settings","*?returnTo=","*?return_to=","_nuxt"],allow:[],contentUsage:[],contentSignal:[],_indexable:true,_rules:[{pattern:"/account",allow:false},{pattern:"/dashboard",allow:false},{pattern:"/new",allow:false},{pattern:"/enter",allow:false},{pattern:"/main",allow:false},{pattern:"/signin",allow:false},{pattern:"/signup",allow:false},{pattern:"/*/settings",allow:false},{pattern:"*?returnTo=",allow:false},{pattern:"*?return_to=",allow:false},{pattern:"_nuxt",allow:false}],_normalized:true}],sitemap:["https://labs.iximiuz.com/sitemap.xml","/sitemap.xml"],header:true,robotsEnabledValue:"index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1",robotsDisabledValue:"noindex, nofollow",cacheControl:"max-age=14400, must-revalidate",botDetection:true,pageMetaRobots:{}}},app:{baseURL:"/",buildId:"b756282a-436d-4378-9e80-d3bbd54cd54a",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script><script nonce="" type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__">[["ShallowReactive",1],{"data":2,"state":3744,"once":3759,"_errors":3760,"serverRendered":11,"path":3762},["ShallowReactive",3],{"tutorial-page-tutorial-xdp-dsr-load-balancer-b701a95a":4,"content-tutorial-xdp-dsr-load-balancer-b701a95a-v1769426947149":65,"i-material-symbols-light:expand-content":3738,"i-ph:copy":3741},{"id":5,"kind":6,"name":7,"title":8,"description":9,"createdAt":10,"updatedAt":10,"independent":11,"trusted":11,"published":11,"playground":12,"units":13,"owner":18,"authors":19,"contentVersion":26,"pageUrl":27,"cover":28,"categories":29,"tags":32,"status":34,"tasks":35,"attemptCount":56,"completionCount":57,"accessControl":58,"userAccess":64},"68f8ed4268be91416aeb3d4c","tutorial","xdp-dsr-load-balancer-b701a95a","Building an eBPF/XDP IP-in-IP Direct Server Return Load Balancer from Scratch","In this tutorial, you will learn how to build a IPIP DSR load balancer using eBPF/XDP, where backends from arbitrary networks send responses directly back to clients bypassing the load balancer.","2026-01-27T00:00:00.000Z",true,"flexbox",[14],{"name":7,"hash":15,"title":8,"description":9,"createdAt":16,"updatedAt":16,"file":17},"#xdp-dsr-load-balancer-b701a95a","2026-01-27","tutorials/xdp-dsr-load-balancer-b701a95a/index.md","6620fa0e724db85e6791a6e2",[20],{"id":21,"createdAt":22,"userId":18,"name":23,"displayName":24,"avatarUrl":25,"independent":11,"certified":11},"68a57e83267bd767257a8c00","2025-08-20T07:51:31.012Z","teodor-janez-podobnik","Teodor Janez Podobnik","https://avatars.githubusercontent.com/u/48418580",1769426947149,"https://labs.iximiuz.com/tutorials/xdp-dsr-load-balancer-b701a95a","/content/files/tutorials/xdp-dsr-load-balancer-b701a95a/__static__/ipip-1.png",[30,31],"linux","programming",[33],"eBPF","todo",{"setup_networking_lb":36,"setup_networking_backend_01":41,"setup_networking_backend_02":44,"setup_networking_gateway":47,"setup_networking_client_01":50,"clone_lab":53},{"init":11,"machine":37,"user":38,"name":39,"status":40},"lb","root","setup_networking_lb",0,{"init":11,"machine":42,"user":38,"name":43,"status":40},"backend-01","setup_networking_backend_01",{"init":11,"machine":45,"user":38,"name":46,"status":40},"backend-02","setup_networking_backend_02",{"init":11,"machine":48,"user":38,"name":49,"status":40},"gateway","setup_networking_gateway",{"init":11,"machine":51,"user":38,"name":52,"status":40},"client","setup_networking_client_01",{"init":11,"machine":37,"user":54,"name":55,"status":40},"laborant","clone_lab",8,3,{"canList":59,"canPreview":61,"canRead":62,"canStart":63},[60],"anyone",[60],[60],[60],{"canList":11,"canPreview":11,"canRead":11,"canStart":11},[66],{"title":8,"description":67,"kind":6,"categories":68,"tagz":69,"createdAt":10,"updatedAt":10,"cover":28,"playground":70,"type":38,"children":152,"hash":15,"preview":-1,"pageUrl":27,"tasks":3723,"toc":3724,"tutorials":3731,"challenges":3733,"courses":3735,"key":3737},"In this tutorial, you will learn how to build a IPIP DSR load balancer using eBPF/XDP, where backends from arbitrary networks send responses directly back to clients bypassing the load balancer.\n",[30,31],[33],{"name":12,"networks":71,"machines":84},[72,75,78,81],{"name":73,"subnet":74,"private":11},"net-1","192.168.178.0/24",{"name":76,"subnet":77,"private":11},"net-2","10.0.0.0/16",{"name":79,"subnet":80,"private":11},"net-3","172.16.0.0/24",{"name":82,"subnet":83},"net-4","100.64.0.0/24",[85,102,119,130,141],{"name":37,"kernel":86,"drives":87,"users":92,"network":95,"resources":99},"6.1",[88],{"source":89,"mount":90,"size":91},"oci://ghcr.io/dorkamotorka/ebpf-labs:latest","/","10GiB",[93],{"name":54,"default":11,"welcome":94},"This is the load balancer node.\n\nIP: 192.168.178.10/24\n",{"interfaces":96},[97],{"network":73,"address":98},"192.168.178.10",{"cpuCount":100,"ramSize":101},1,"1GiB",{"name":48,"kernel":86,"drives":103,"users":105,"network":108,"resources":118},[104],{"source":89,"mount":90,"size":91},[106],{"name":54,"default":11,"welcome":107},"This is a gateway node that is attached to both networks.\n\nIP #1: 192.168.178.2/24\nIP #2: 10.0.0.2/16\nIP #3: 172.16.0.2/24 \nIP #4: 100.64.0.2/24 (Just for internet access)\n",{"interfaces":109},[110,112,114,116],{"network":73,"address":111},"192.168.178.2",{"network":76,"address":113},"10.0.0.2",{"network":79,"address":115},"172.16.0.2",{"network":82,"address":117},"100.64.0.2",{"cpuCount":100,"ramSize":101},{"name":42,"kernel":86,"drives":120,"users":122,"network":125,"resources":129},[121],{"source":89,"mount":90,"size":91},[123],{"name":54,"default":11,"welcome":124},"This is a backend node.\n\nIP: 172.16.0.10/24\n",{"interfaces":126},[127],{"network":79,"address":128},"172.16.0.10",{"cpuCount":100,"ramSize":101},{"name":45,"kernel":86,"drives":131,"users":133,"network":136,"resources":140},[132],{"source":89,"mount":90,"size":91},[134],{"name":54,"default":11,"welcome":135},"This is a backend node.\n\nIP: 172.16.0.11/24\n",{"interfaces":137},[138],{"network":79,"address":139},"172.16.0.11",{"cpuCount":100,"ramSize":101},{"name":51,"kernel":86,"drives":142,"users":144,"network":147,"resources":151},[143],{"source":89,"mount":90,"size":91},[145],{"name":54,"default":11,"welcome":146},"This is a client node.\n\nIP: 10.0.0.20/16\n",{"interfaces":148},[149],{"network":76,"address":150},"10.0.0.20",{"cpuCount":100,"ramSize":101},[153,172,177,182,187,193,198,203,301,306,313,318,323,328,333,338,343,348,353,357,364,376,501,514,545,564,696,704,709,2705,2721,2726,2731,2737,2750,2773,2798,2822,2847,2899,2916,2999,3017,3054,3343,3348,3356,3361,3367,3376,3396,3470,3510,3534,3574,3586,3606,3611,3658,3663,3683,3712,3717],{"type":154,"tag":155,"props":156,"children":157},"element","p",{},[158,161,170],{"type":159,"value":160},"text","In ",{"type":154,"tag":162,"props":163,"children":167},"a",{"href":164,"rel":165},"https://labs.iximiuz.com/tutorials/xdp-dsr-layer2-lb-92b02f3e",[166],"nofollow",[168],{"type":159,"value":169},"the previous tutorial",{"type":159,"value":171},", we built a DSR L2 eBPF/XDP-based load balancer. A key takeaway was how the virtual IP can be shared between the load balancer and backend nodes, as well as keeping the IP header intact, allowing the backend to see the clients IP.",{"type":154,"tag":155,"props":173,"children":174},{},[175],{"type":159,"value":176},"While this worked nicely, L2 DSR relies on the fact that backend nodes need to be on the same L2 network as the load balancer.",{"type":154,"tag":155,"props":178,"children":179},{},[180],{"type":159,"value":181},"This is quite a constraint, and not quite suitable for cloud environments, where nodes are often distributed across different virtual networks.",{"type":154,"tag":155,"props":183,"children":184},{},[185],{"type":159,"value":186},"To overcome these limitations, DSR IP-in-IP load balancing was introduced.",{"type":154,"tag":188,"props":189,"children":192},"image-box",{":alt":190,":src":191},"XDP DSR Load Balancing","/content/files/tutorials/xdp-dsr-load-balancer-b701a95a/__static__/ipipbla.png",[],{"type":154,"tag":155,"props":194,"children":195},{},[196],{"type":159,"value":197},"In an IP-in-IP DSR load-balancing setup, backends not only respond directly to clients but can also reside in different networks than the load balancer.",{"type":154,"tag":155,"props":199,"children":200},{},[201],{"type":159,"value":202},"This playground has a network topology with five nodes on three different networks:",{"type":154,"tag":204,"props":205,"children":206},"ul",{},[207,225,240,255,270],{"type":154,"tag":208,"props":209,"children":210},"li",{},[211,217,219],{"type":154,"tag":212,"props":213,"children":215},"code",{"className":214},[],[216],{"type":159,"value":37},{"type":159,"value":218}," in network ",{"type":154,"tag":212,"props":220,"children":222},{"className":221},[],[223],{"type":159,"value":224},"192.168.178.10/24",{"type":154,"tag":208,"props":226,"children":227},{},[228,233,234],{"type":154,"tag":212,"props":229,"children":231},{"className":230},[],[232],{"type":159,"value":42},{"type":159,"value":218},{"type":154,"tag":212,"props":235,"children":237},{"className":236},[],[238],{"type":159,"value":239},"172.16.0.10/24",{"type":154,"tag":208,"props":241,"children":242},{},[243,248,249],{"type":154,"tag":212,"props":244,"children":246},{"className":245},[],[247],{"type":159,"value":45},{"type":159,"value":218},{"type":154,"tag":212,"props":250,"children":252},{"className":251},[],[253],{"type":159,"value":254},"172.16.0.11/24",{"type":154,"tag":208,"props":256,"children":257},{},[258,263,264],{"type":154,"tag":212,"props":259,"children":261},{"className":260},[],[262],{"type":159,"value":51},{"type":159,"value":218},{"type":154,"tag":212,"props":265,"children":267},{"className":266},[],[268],{"type":159,"value":269},"10.0.0.20/16",{"type":154,"tag":208,"props":271,"children":272},{},[273,278,280,286,288,294,295],{"type":154,"tag":212,"props":274,"children":276},{"className":275},[],[277],{"type":159,"value":48},{"type":159,"value":279}," between networks ",{"type":154,"tag":212,"props":281,"children":283},{"className":282},[],[284],{"type":159,"value":285},"192.168.178.2/24",{"type":159,"value":287},", ",{"type":154,"tag":212,"props":289,"children":291},{"className":290},[],[292],{"type":159,"value":293},"10.0.0.2/16",{"type":159,"value":287},{"type":154,"tag":212,"props":296,"children":298},{"className":297},[],[299],{"type":159,"value":300},"172.16.0.2/24",{"type":154,"tag":188,"props":302,"children":305},{":alt":303,":src":304},"XDP DSR IPIP Load Balancing Playground","/content/files/tutorials/xdp-dsr-load-balancer-b701a95a/__static__/ppp.png",[],{"type":154,"tag":307,"props":308,"children":310},"h2",{"id":309},"dsr-ipip-load-balancing",[311],{"type":159,"value":312},"DSR IPIP Load Balancing",{"type":154,"tag":155,"props":314,"children":315},{},[316],{"type":159,"value":317},"In the L2 DSR load balancing approach, we were only rewriting MAC addresses, which limited the load balancer to operate within the same L2 network. Now, we want to make these packets routable across different networks (load balancer  network-hops  backend).",{"type":154,"tag":155,"props":319,"children":320},{},[321],{"type":159,"value":322},"To understand how to achieve this, one needs to know how IP-in-IP (IPIP) encapsulation works.",{"type":154,"tag":155,"props":324,"children":325},{},[326],{"type":159,"value":327},"In short, IP-in-IP encapsulation is a technique where one IP packet is wrapped inside another IP header, forming an outer and an inner IP header.",{"type":154,"tag":155,"props":329,"children":330},{},[331],{"type":159,"value":332},"And the reason, why we need this is fairly simple.",{"type":154,"tag":155,"props":334,"children":335},{},[336],{"type":159,"value":337},"The main limitation of L2 DSR was that if it tried to redirect traffic to a backend in a different L2 network, it would set the destination MAC address to the gateways interface (trying to exit current L2 network), and since only the VIP on the load balancer is advertised across the network, the gateway would send the packet back to the load balancerbecause thats the only route it knows for that VIPcausing a loop.",{"type":154,"tag":188,"props":339,"children":342},{":alt":340,":src":341},"Problem of XDP DSR L2 Load Balancing","/content/files/tutorials/xdp-dsr-load-balancer-b701a95a/__static__/fail.png",[],{"type":154,"tag":155,"props":344,"children":345},{},[346],{"type":159,"value":347},"With IPIP (IP-in-IP) encapsulation, we solve this problem by wrapping the original IP packet inside another IP header where the outer IP header contains routable destination IPs, allowing the packet to traverse different networks.",{"type":154,"tag":188,"props":349,"children":352},{":alt":350,":src":351},"IP-in-IP Encapsulation (simplified)","/content/files/tutorials/xdp-dsr-load-balancer-b701a95a/__static__/ipip-packet.png",[],{"type":154,"tag":188,"props":354,"children":356},{":alt":303,":src":355},"/content/files/tutorials/xdp-dsr-load-balancer-b701a95a/__static__/ipipdsr.png",[],{"type":154,"tag":358,"props":359,"children":361},"h3",{"id":360},"setting-up-the-environment",[362],{"type":159,"value":363},"Setting Up the Environment",{"type":154,"tag":155,"props":365,"children":366},{},[367,369,374],{"type":159,"value":368},"To make this work in our playground, we first need to configure a VIP and enable IP forwarding on the load balancer (",{"type":154,"tag":212,"props":370,"children":372},{"className":371},[],[373],{"type":159,"value":37},{"type":159,"value":375}," tab), just like we did in the L2 DSR coding lab:",{"type":154,"tag":377,"props":378,"children":383},"pre",{"className":379,"code":380,"language":381,"meta":382,"style":382},"language-bash shiki shiki-themes slack-dark","sudo sysctl -w net.ipv4.ip_forward=1\nsudo ip addr add 192.168.178.15/32 dev eth0\nsudo ping -c1 172.16.0.10\nsudo ping -c1 172.16.0.11\n","bash","",[384],{"type":154,"tag":212,"props":385,"children":386},{"__ignoreMap":382},[387,420,458,480],{"type":154,"tag":388,"props":389,"children":391},"span",{"class":390,"line":100},"line",[392,398,404,409,414],{"type":154,"tag":388,"props":393,"children":395},{"style":394},"--shiki-default:#DCDCAA",[396],{"type":159,"value":397},"sudo",{"type":154,"tag":388,"props":399,"children":401},{"style":400},"--shiki-default:#CE9178",[402],{"type":159,"value":403}," sysctl",{"type":154,"tag":388,"props":405,"children":406},{"style":400},[407],{"type":159,"value":408}," -w",{"type":154,"tag":388,"props":410,"children":411},{"style":400},[412],{"type":159,"value":413}," net.ipv4.ip_forward=",{"type":154,"tag":388,"props":415,"children":417},{"style":416},"--shiki-default:#B5CEA8",[418],{"type":159,"value":419},"1\n",{"type":154,"tag":388,"props":421,"children":423},{"class":390,"line":422},2,[424,428,433,438,443,448,453],{"type":154,"tag":388,"props":425,"children":426},{"style":394},[427],{"type":159,"value":397},{"type":154,"tag":388,"props":429,"children":430},{"style":400},[431],{"type":159,"value":432}," ip",{"type":154,"tag":388,"props":434,"children":435},{"style":400},[436],{"type":159,"value":437}," addr",{"type":154,"tag":388,"props":439,"children":440},{"style":400},[441],{"type":159,"value":442}," add",{"type":154,"tag":388,"props":444,"children":445},{"style":400},[446],{"type":159,"value":447}," 192.168.178.15/32",{"type":154,"tag":388,"props":449,"children":450},{"style":400},[451],{"type":159,"value":452}," dev",{"type":154,"tag":388,"props":454,"children":455},{"style":400},[456],{"type":159,"value":457}," eth0\n",{"type":154,"tag":388,"props":459,"children":460},{"class":390,"line":57},[461,465,470,475],{"type":154,"tag":388,"props":462,"children":463},{"style":394},[464],{"type":159,"value":397},{"type":154,"tag":388,"props":466,"children":467},{"style":400},[468],{"type":159,"value":469}," ping",{"type":154,"tag":388,"props":471,"children":472},{"style":400},[473],{"type":159,"value":474}," -c1",{"type":154,"tag":388,"props":476,"children":477},{"style":416},[478],{"type":159,"value":479}," 172.16.0.10\n",{"type":154,"tag":388,"props":481,"children":483},{"class":390,"line":482},4,[484,488,492,496],{"type":154,"tag":388,"props":485,"children":486},{"style":394},[487],{"type":159,"value":397},{"type":154,"tag":388,"props":489,"children":490},{"style":400},[491],{"type":159,"value":469},{"type":154,"tag":388,"props":493,"children":494},{"style":400},[495],{"type":159,"value":474},{"type":154,"tag":388,"props":497,"children":498},{"style":416},[499],{"type":159,"value":500}," 172.16.0.11\n",{"type":154,"tag":155,"props":502,"children":503},{},[504,506,512],{"type":159,"value":505},"We also ping the backend node IPs to populate the ARP table, which is required for the ",{"type":154,"tag":212,"props":507,"children":509},{"className":508},[],[510],{"type":159,"value":511},"bpf_fib_lookup",{"type":159,"value":513}," helper function to work.",{"type":154,"tag":515,"props":516,"children":518},"remark-box",{"kind":517},"info",[519,524],{"type":154,"tag":155,"props":520,"children":521},{},[522],{"type":159,"value":523}," If you need a quick reminder why this is necessary:",{"type":154,"tag":204,"props":525,"children":526},{},[527,532],{"type":154,"tag":208,"props":528,"children":529},{},[530],{"type":159,"value":531},"Enabling IP forwarding allows the load balancer to route packets between interfaces.",{"type":154,"tag":208,"props":533,"children":534},{},[535,537,543],{"type":159,"value":536},"The ",{"type":154,"tag":212,"props":538,"children":540},{"className":539},[],[541],{"type":159,"value":542},"bpf_fib_lookup()",{"type":159,"value":544}," helper function retrieves the next-hop MAC address from the kernels routing tables  either the backends MAC in the case of L2 DSR, or the gateways MAC in IPIP DSR.",{"type":154,"tag":155,"props":546,"children":547},{},[548,550,555,557,562],{"type":159,"value":549},"Next, on both backend nodes (",{"type":154,"tag":212,"props":551,"children":553},{"className":552},[],[554],{"type":159,"value":42},{"type":159,"value":556}," and ",{"type":154,"tag":212,"props":558,"children":560},{"className":559},[],[561],{"type":159,"value":45},{"type":159,"value":563}," tabs), configure the VIP and disable its ARP advertisement:",{"type":154,"tag":377,"props":565,"children":567},{"className":379,"code":566,"language":381,"meta":382,"style":382},"sudo ip addr add 192.168.178.15/32 dev lo\n# Only reply to ARP requests if the target IP is assigned to the interface \n# that received the request (prevents advertising the VIP on eth0)\nsudo sysctl -w net.ipv4.conf.eth0.arp_ignore=1\n\n# When sending ARP requests, use only addresses assigned to the outgoing interface\n# (prevents the node from leaking the VIP as a source IP in ARP)\nsudo sysctl -w net.ipv4.conf.eth0.arp_announce=2\n",[568],{"type":154,"tag":212,"props":569,"children":570},{"__ignoreMap":382},[571,603,612,620,644,653,662,671],{"type":154,"tag":388,"props":572,"children":573},{"class":390,"line":100},[574,578,582,586,590,594,598],{"type":154,"tag":388,"props":575,"children":576},{"style":394},[577],{"type":159,"value":397},{"type":154,"tag":388,"props":579,"children":580},{"style":400},[581],{"type":159,"value":432},{"type":154,"tag":388,"props":583,"children":584},{"style":400},[585],{"type":159,"value":437},{"type":154,"tag":388,"props":587,"children":588},{"style":400},[589],{"type":159,"value":442},{"type":154,"tag":388,"props":591,"children":592},{"style":400},[593],{"type":159,"value":447},{"type":154,"tag":388,"props":595,"children":596},{"style":400},[597],{"type":159,"value":452},{"type":154,"tag":388,"props":599,"children":600},{"style":400},[601],{"type":159,"value":602}," lo\n",{"type":154,"tag":388,"props":604,"children":605},{"class":390,"line":422},[606],{"type":154,"tag":388,"props":607,"children":609},{"style":608},"--shiki-default:#6A9955",[610],{"type":159,"value":611},"# Only reply to ARP requests if the target IP is assigned to the interface \n",{"type":154,"tag":388,"props":613,"children":614},{"class":390,"line":57},[615],{"type":154,"tag":388,"props":616,"children":617},{"style":608},[618],{"type":159,"value":619},"# that received the request (prevents advertising the VIP on eth0)\n",{"type":154,"tag":388,"props":621,"children":622},{"class":390,"line":482},[623,627,631,635,640],{"type":154,"tag":388,"props":624,"children":625},{"style":394},[626],{"type":159,"value":397},{"type":154,"tag":388,"props":628,"children":629},{"style":400},[630],{"type":159,"value":403},{"type":154,"tag":388,"props":632,"children":633},{"style":400},[634],{"type":159,"value":408},{"type":154,"tag":388,"props":636,"children":637},{"style":400},[638],{"type":159,"value":639}," net.ipv4.conf.eth0.arp_ignore=",{"type":154,"tag":388,"props":641,"children":642},{"style":416},[643],{"type":159,"value":419},{"type":154,"tag":388,"props":645,"children":647},{"class":390,"line":646},5,[648],{"type":154,"tag":388,"props":649,"children":650},{"emptyLinePlaceholder":11},[651],{"type":159,"value":652},"\n",{"type":154,"tag":388,"props":654,"children":656},{"class":390,"line":655},6,[657],{"type":154,"tag":388,"props":658,"children":659},{"style":608},[660],{"type":159,"value":661},"# When sending ARP requests, use only addresses assigned to the outgoing interface\n",{"type":154,"tag":388,"props":663,"children":665},{"class":390,"line":664},7,[666],{"type":154,"tag":388,"props":667,"children":668},{"style":608},[669],{"type":159,"value":670},"# (prevents the node from leaking the VIP as a source IP in ARP)\n",{"type":154,"tag":388,"props":672,"children":673},{"class":390,"line":56},[674,678,682,686,691],{"type":154,"tag":388,"props":675,"children":676},{"style":394},[677],{"type":159,"value":397},{"type":154,"tag":388,"props":679,"children":680},{"style":400},[681],{"type":159,"value":403},{"type":154,"tag":388,"props":683,"children":684},{"style":400},[685],{"type":159,"value":408},{"type":154,"tag":388,"props":687,"children":688},{"style":400},[689],{"type":159,"value":690}," net.ipv4.conf.eth0.arp_announce=",{"type":154,"tag":388,"props":692,"children":693},{"style":416},[694],{"type":159,"value":695},"2\n",{"type":154,"tag":515,"props":697,"children":698},{"kind":517},[699],{"type":154,"tag":155,"props":700,"children":701},{},[702],{"type":159,"value":703}," This is important, so no node knows the VIP exists on the backends; otherwise, clients could bypass the load balancer and establish a direct connection. We had described this in more details in the previous DSR L2 Load Balancing tutorial.",{"type":154,"tag":155,"props":705,"children":706},{},[707],{"type":159,"value":708},"With that in place, the final step is to make sure our eBPF/XDP-based DSR IPIP load balancer encapsulates the packet before forwarding it.",{"type":154,"tag":377,"props":710,"children":776},{"className":711,"code":712,"filename":713,"highlights":714,"language":775,"meta":382,"style":382},"language-c shiki shiki-themes slack-dark","  // Choose backend using simple hashing\n  struct four_tuple_t four_tuple;\n  four_tuple.src_ip = ip->saddr;\n  four_tuple.dst_ip = ip->daddr;\n  four_tuple.src_port = tcp->source;\n  four_tuple.dst_port = tcp->dest;\n  four_tuple.protocol = IPPROTO_TCP;\n  __u32 key = xdp_hash_tuple(&four_tuple) % NUM_BACKENDS;\n  struct endpoint *backend = bpf_map_lookup_elem(&backends, &key);\n  if (!backend) {\n    return XDP_ABORTED;\n  }\n\n  // Perform a FIB lookup\n  struct bpf_fib_lookup fib = {};\n  int rc = fib_lookup_v4_full(ctx, &fib, ip->daddr, backend->ip,\n                              bpf_ntohs(ip->tot_len));\n  if (rc != BPF_FIB_LKUP_RET_SUCCESS) {\n    log_fib_error(rc);\n    return XDP_ABORTED;\n  }\n\n  // Make room for the new outer IPv4 header (20 bytes) between ETH and inner IPv4\n  int adj = bpf_xdp_adjust_head(ctx, 0 - (int)sizeof(struct iphdr));\n  if (adj \u003C 0) {\n    bpf_printk(\"Failed to adjust packet head\");\n    return XDP_ABORTED;\n  }\n\n  // Recompute packet pointers after adjusting headed\n  void *new_data_end = (void *)(long)ctx->data_end;\n  void *new_data = (void *)(long)ctx->data;\n\n  // Re-parse Ethernet header\n  struct ethhdr *new_eth = new_data;\n  if ((void *)(new_eth + 1) > new_data_end) {\n    return XDP_ABORTED;\n  }\n\n  // Outer IPv4 header lives right after Ethernet\n  struct iphdr *outer = (void *)(new_eth + 1);\n  if ((void *)(outer + 1) > new_data_end) {\n    return XDP_ABORTED;\n  }\n\n  // Inner IPv4 header is now right after the new outer IP header\n  struct iphdr *inner = (void *)(outer + 1);\n  if ((void *)(inner + 1) > new_data_end) {\n    return XDP_ABORTED;\n  }\n\n  // Backend needs to have a virtual IP on the lo (same one as load balancer)\n  // The source IP is retained as client, so backend will respond directly to it\n  __builtin_memcpy(new_eth->h_source, fib.smac, ETH_ALEN);\n  __builtin_memcpy(new_eth->h_dest, fib.dmac, ETH_ALEN);\n  new_eth->h_proto = bpf_htons(ETH_P_IP);\n\n  // Build OUTER IPv4 header\n  __u16 inner_len = bpf_ntohs(inner->tot_len);\n  __u16 outer_len = (__u16)(inner_len + sizeof(struct iphdr));\n  outer->version = 4;\n  outer->ihl = 5; // 20 bytes\n  outer->tos = 0;\n  outer->tot_len = bpf_htons(outer_len);\n  outer->id = 0;\n  outer->frag_off = 0;\n  outer->ttl = 64;\n  outer->protocol = IPPROTO_IPIP;\n\n  // Retrieve LB real IP\n  __u32 lbkey = 0;\n  struct endpoint *lb = bpf_map_lookup_elem(&load_balancer, &lbkey);\n  if (!lb) {\n    return XDP_ABORTED;\n  }\n  outer->saddr = lb->ip; // use LB real IP as outer source\n\n  outer->daddr = backend->ip;  // tunnel endpoint = backend node IP\n  outer->check = 0;\n\n  // Compute outer L3 checksum from scratch\n  outer->check = recalc_ip_checksum(outer);\n","lab/lb.c",[715,716,717,718,719,720,721,722,723,724,725,726,727,728,729,730,731,732,733,734,735,736,737,738,739,740,741,742,743,744,745,746,747,748,749,750,751,752,753,754,755,756,757,758,759,760,761,762,763,764,765,766,767,768,769,770,771,772,773,774],23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,"c",[777],{"type":154,"tag":212,"props":778,"children":779},{"__ignoreMap":382},[780,788,809,837,862,888,913,930,978,1041,1066,1080,1089,1097,1106,1128,1198,1226,1249,1263,1275,1283,1291,1301,1370,1398,1420,1432,1440,1448,1457,1517,1571,1579,1588,1619,1669,1681,1689,1697,1706,1760,1805,1817,1825,1833,1842,1895,1940,1952,1960,1968,1977,1986,2014,2040,2072,2080,2089,2124,2163,2195,2231,2260,2290,2319,2348,2378,2404,2412,2421,2442,2501,2522,2534,2542,2582,2590,2629,2658,2666,2675],{"type":154,"tag":388,"props":781,"children":782},{"class":390,"line":100},[783],{"type":154,"tag":388,"props":784,"children":785},{"style":608},[786],{"type":159,"value":787},"  // Choose backend using simple hashing\n",{"type":154,"tag":388,"props":789,"children":790},{"class":390,"line":422},[791,797,803],{"type":154,"tag":388,"props":792,"children":794},{"style":793},"--shiki-default:#569CD6",[795],{"type":159,"value":796},"  struct",{"type":154,"tag":388,"props":798,"children":800},{"style":799},"--shiki-default:#4EC9B0",[801],{"type":159,"value":802}," four_tuple_t",{"type":154,"tag":388,"props":804,"children":806},{"style":805},"--shiki-default:#E6E6E6",[807],{"type":159,"value":808}," four_tuple;\n",{"type":154,"tag":388,"props":810,"children":811},{"class":390,"line":57},[812,817,823,827,832],{"type":154,"tag":388,"props":813,"children":814},{"style":805},[815],{"type":159,"value":816},"  four_tuple.src_ip ",{"type":154,"tag":388,"props":818,"children":820},{"style":819},"--shiki-default:#D4D4D4",[821],{"type":159,"value":822},"=",{"type":154,"tag":388,"props":824,"children":825},{"style":805},[826],{"type":159,"value":432},{"type":154,"tag":388,"props":828,"children":829},{"style":819},[830],{"type":159,"value":831},"->",{"type":154,"tag":388,"props":833,"children":834},{"style":805},[835],{"type":159,"value":836},"saddr;\n",{"type":154,"tag":388,"props":838,"children":839},{"class":390,"line":482},[840,845,849,853,857],{"type":154,"tag":388,"props":841,"children":842},{"style":805},[843],{"type":159,"value":844},"  four_tuple.dst_ip ",{"type":154,"tag":388,"props":846,"children":847},{"style":819},[848],{"type":159,"value":822},{"type":154,"tag":388,"props":850,"children":851},{"style":805},[852],{"type":159,"value":432},{"type":154,"tag":388,"props":854,"children":855},{"style":819},[856],{"type":159,"value":831},{"type":154,"tag":388,"props":858,"children":859},{"style":805},[860],{"type":159,"value":861},"daddr;\n",{"type":154,"tag":388,"props":863,"children":864},{"class":390,"line":646},[865,870,874,879,883],{"type":154,"tag":388,"props":866,"children":867},{"style":805},[868],{"type":159,"value":869},"  four_tuple.src_port ",{"type":154,"tag":388,"props":871,"children":872},{"style":819},[873],{"type":159,"value":822},{"type":154,"tag":388,"props":875,"children":876},{"style":805},[877],{"type":159,"value":878}," tcp",{"type":154,"tag":388,"props":880,"children":881},{"style":819},[882],{"type":159,"value":831},{"type":154,"tag":388,"props":884,"children":885},{"style":805},[886],{"type":159,"value":887},"source;\n",{"type":154,"tag":388,"props":889,"children":890},{"class":390,"line":655},[891,896,900,904,908],{"type":154,"tag":388,"props":892,"children":893},{"style":805},[894],{"type":159,"value":895},"  four_tuple.dst_port ",{"type":154,"tag":388,"props":897,"children":898},{"style":819},[899],{"type":159,"value":822},{"type":154,"tag":388,"props":901,"children":902},{"style":805},[903],{"type":159,"value":878},{"type":154,"tag":388,"props":905,"children":906},{"style":819},[907],{"type":159,"value":831},{"type":154,"tag":388,"props":909,"children":910},{"style":805},[911],{"type":159,"value":912},"dest;\n",{"type":154,"tag":388,"props":914,"children":915},{"class":390,"line":664},[916,921,925],{"type":154,"tag":388,"props":917,"children":918},{"style":805},[919],{"type":159,"value":920},"  four_tuple.protocol ",{"type":154,"tag":388,"props":922,"children":923},{"style":819},[924],{"type":159,"value":822},{"type":154,"tag":388,"props":926,"children":927},{"style":805},[928],{"type":159,"value":929}," IPPROTO_TCP;\n",{"type":154,"tag":388,"props":931,"children":932},{"class":390,"line":56},[933,938,942,947,952,957,963,968,973],{"type":154,"tag":388,"props":934,"children":935},{"style":805},[936],{"type":159,"value":937},"  __u32 key ",{"type":154,"tag":388,"props":939,"children":940},{"style":819},[941],{"type":159,"value":822},{"type":154,"tag":388,"props":943,"children":944},{"style":394},[945],{"type":159,"value":946}," xdp_hash_tuple",{"type":154,"tag":388,"props":948,"children":949},{"style":805},[950],{"type":159,"value":951},"(",{"type":154,"tag":388,"props":953,"children":954},{"style":819},[955],{"type":159,"value":956},"&",{"type":154,"tag":388,"props":958,"children":960},{"style":959},"--shiki-default:#9CDCFE",[961],{"type":159,"value":962},"four_tuple",{"type":154,"tag":388,"props":964,"children":965},{"style":805},[966],{"type":159,"value":967},") ",{"type":154,"tag":388,"props":969,"children":970},{"style":819},[971],{"type":159,"value":972},"%",{"type":154,"tag":388,"props":974,"children":975},{"style":805},[976],{"type":159,"value":977}," NUM_BACKENDS;\n",{"type":154,"tag":388,"props":979,"children":981},{"class":390,"line":980},9,[982,986,991,996,1001,1005,1010,1014,1018,1023,1027,1031,1036],{"type":154,"tag":388,"props":983,"children":984},{"style":793},[985],{"type":159,"value":796},{"type":154,"tag":388,"props":987,"children":988},{"style":805},[989],{"type":159,"value":990}," endpoint ",{"type":154,"tag":388,"props":992,"children":993},{"style":819},[994],{"type":159,"value":995},"*",{"type":154,"tag":388,"props":997,"children":998},{"style":805},[999],{"type":159,"value":1000},"backend ",{"type":154,"tag":388,"props":1002,"children":1003},{"style":819},[1004],{"type":159,"value":822},{"type":154,"tag":388,"props":1006,"children":1007},{"style":394},[1008],{"type":159,"value":1009}," bpf_map_lookup_elem",{"type":154,"tag":388,"props":1011,"children":1012},{"style":805},[1013],{"type":159,"value":951},{"type":154,"tag":388,"props":1015,"children":1016},{"style":819},[1017],{"type":159,"value":956},{"type":154,"tag":388,"props":1019,"children":1020},{"style":959},[1021],{"type":159,"value":1022},"backends",{"type":154,"tag":388,"props":1024,"children":1025},{"style":805},[1026],{"type":159,"value":287},{"type":154,"tag":388,"props":1028,"children":1029},{"style":819},[1030],{"type":159,"value":956},{"type":154,"tag":388,"props":1032,"children":1033},{"style":959},[1034],{"type":159,"value":1035},"key",{"type":154,"tag":388,"props":1037,"children":1038},{"style":805},[1039],{"type":159,"value":1040},");\n",{"type":154,"tag":388,"props":1042,"children":1044},{"class":390,"line":1043},10,[1045,1051,1056,1061],{"type":154,"tag":388,"props":1046,"children":1048},{"style":1047},"--shiki-default:#C586C0",[1049],{"type":159,"value":1050},"  if",{"type":154,"tag":388,"props":1052,"children":1053},{"style":805},[1054],{"type":159,"value":1055}," (",{"type":154,"tag":388,"props":1057,"children":1058},{"style":819},[1059],{"type":159,"value":1060},"!",{"type":154,"tag":388,"props":1062,"children":1063},{"style":805},[1064],{"type":159,"value":1065},"backend) {\n",{"type":154,"tag":388,"props":1067,"children":1069},{"class":390,"line":1068},11,[1070,1075],{"type":154,"tag":388,"props":1071,"children":1072},{"style":1047},[1073],{"type":159,"value":1074},"    return",{"type":154,"tag":388,"props":1076,"children":1077},{"style":805},[1078],{"type":159,"value":1079}," XDP_ABORTED;\n",{"type":154,"tag":388,"props":1081,"children":1083},{"class":390,"line":1082},12,[1084],{"type":154,"tag":388,"props":1085,"children":1086},{"style":805},[1087],{"type":159,"value":1088},"  }\n",{"type":154,"tag":388,"props":1090,"children":1092},{"class":390,"line":1091},13,[1093],{"type":154,"tag":388,"props":1094,"children":1095},{"emptyLinePlaceholder":11},[1096],{"type":159,"value":652},{"type":154,"tag":388,"props":1098,"children":1100},{"class":390,"line":1099},14,[1101],{"type":154,"tag":388,"props":1102,"children":1103},{"style":608},[1104],{"type":159,"value":1105},"  // Perform a FIB lookup\n",{"type":154,"tag":388,"props":1107,"children":1109},{"class":390,"line":1108},15,[1110,1114,1119,1123],{"type":154,"tag":388,"props":1111,"children":1112},{"style":793},[1113],{"type":159,"value":796},{"type":154,"tag":388,"props":1115,"children":1116},{"style":805},[1117],{"type":159,"value":1118}," bpf_fib_lookup fib ",{"type":154,"tag":388,"props":1120,"children":1121},{"style":819},[1122],{"type":159,"value":822},{"type":154,"tag":388,"props":1124,"children":1125},{"style":805},[1126],{"type":159,"value":1127}," {};\n",{"type":154,"tag":388,"props":1129,"children":1131},{"class":390,"line":1130},16,[1132,1137,1142,1146,1151,1156,1160,1165,1170,1174,1179,1184,1188,1193],{"type":154,"tag":388,"props":1133,"children":1134},{"style":793},[1135],{"type":159,"value":1136},"  int",{"type":154,"tag":388,"props":1138,"children":1139},{"style":805},[1140],{"type":159,"value":1141}," rc ",{"type":154,"tag":388,"props":1143,"children":1144},{"style":819},[1145],{"type":159,"value":822},{"type":154,"tag":388,"props":1147,"children":1148},{"style":394},[1149],{"type":159,"value":1150}," fib_lookup_v4_full",{"type":154,"tag":388,"props":1152,"children":1153},{"style":805},[1154],{"type":159,"value":1155},"(ctx, ",{"type":154,"tag":388,"props":1157,"children":1158},{"style":819},[1159],{"type":159,"value":956},{"type":154,"tag":388,"props":1161,"children":1162},{"style":959},[1163],{"type":159,"value":1164},"fib",{"type":154,"tag":388,"props":1166,"children":1167},{"style":805},[1168],{"type":159,"value":1169},", ip",{"type":154,"tag":388,"props":1171,"children":1172},{"style":819},[1173],{"type":159,"value":831},{"type":154,"tag":388,"props":1175,"children":1176},{"style":959},[1177],{"type":159,"value":1178},"daddr",{"type":154,"tag":388,"props":1180,"children":1181},{"style":805},[1182],{"type":159,"value":1183},", backend",{"type":154,"tag":388,"props":1185,"children":1186},{"style":819},[1187],{"type":159,"value":831},{"type":154,"tag":388,"props":1189,"children":1190},{"style":959},[1191],{"type":159,"value":1192},"ip",{"type":154,"tag":388,"props":1194,"children":1195},{"style":805},[1196],{"type":159,"value":1197},",\n",{"type":154,"tag":388,"props":1199,"children":1201},{"class":390,"line":1200},17,[1202,1207,1212,1216,1221],{"type":154,"tag":388,"props":1203,"children":1204},{"style":394},[1205],{"type":159,"value":1206},"                              bpf_ntohs",{"type":154,"tag":388,"props":1208,"children":1209},{"style":805},[1210],{"type":159,"value":1211},"(ip",{"type":154,"tag":388,"props":1213,"children":1214},{"style":819},[1215],{"type":159,"value":831},{"type":154,"tag":388,"props":1217,"children":1218},{"style":959},[1219],{"type":159,"value":1220},"tot_len",{"type":154,"tag":388,"props":1222,"children":1223},{"style":805},[1224],{"type":159,"value":1225},"));\n",{"type":154,"tag":388,"props":1227,"children":1229},{"class":390,"line":1228},18,[1230,1234,1239,1244],{"type":154,"tag":388,"props":1231,"children":1232},{"style":1047},[1233],{"type":159,"value":1050},{"type":154,"tag":388,"props":1235,"children":1236},{"style":805},[1237],{"type":159,"value":1238}," (rc ",{"type":154,"tag":388,"props":1240,"children":1241},{"style":819},[1242],{"type":159,"value":1243},"!=",{"type":154,"tag":388,"props":1245,"children":1246},{"style":805},[1247],{"type":159,"value":1248}," BPF_FIB_LKUP_RET_SUCCESS) {\n",{"type":154,"tag":388,"props":1250,"children":1252},{"class":390,"line":1251},19,[1253,1258],{"type":154,"tag":388,"props":1254,"children":1255},{"style":394},[1256],{"type":159,"value":1257},"    log_fib_error",{"type":154,"tag":388,"props":1259,"children":1260},{"style":805},[1261],{"type":159,"value":1262},"(rc);\n",{"type":154,"tag":388,"props":1264,"children":1266},{"class":390,"line":1265},20,[1267,1271],{"type":154,"tag":388,"props":1268,"children":1269},{"style":1047},[1270],{"type":159,"value":1074},{"type":154,"tag":388,"props":1272,"children":1273},{"style":805},[1274],{"type":159,"value":1079},{"type":154,"tag":388,"props":1276,"children":1278},{"class":390,"line":1277},21,[1279],{"type":154,"tag":388,"props":1280,"children":1281},{"style":805},[1282],{"type":159,"value":1088},{"type":154,"tag":388,"props":1284,"children":1286},{"class":390,"line":1285},22,[1287],{"type":154,"tag":388,"props":1288,"children":1289},{"emptyLinePlaceholder":11},[1290],{"type":159,"value":652},{"type":154,"tag":388,"props":1292,"children":1295},{"class":1293,"line":715},[390,1294],"highlight",[1296],{"type":154,"tag":388,"props":1297,"children":1298},{"style":608},[1299],{"type":159,"value":1300},"  // Make room for the new outer IPv4 header (20 bytes) between ETH and inner IPv4\n",{"type":154,"tag":388,"props":1302,"children":1304},{"class":1303,"line":716},[390,1294],[1305,1309,1314,1318,1323,1327,1332,1337,1341,1346,1351,1356,1360,1365],{"type":154,"tag":388,"props":1306,"children":1307},{"style":793},[1308],{"type":159,"value":1136},{"type":154,"tag":388,"props":1310,"children":1311},{"style":805},[1312],{"type":159,"value":1313}," adj ",{"type":154,"tag":388,"props":1315,"children":1316},{"style":819},[1317],{"type":159,"value":822},{"type":154,"tag":388,"props":1319,"children":1320},{"style":394},[1321],{"type":159,"value":1322}," bpf_xdp_adjust_head",{"type":154,"tag":388,"props":1324,"children":1325},{"style":805},[1326],{"type":159,"value":1155},{"type":154,"tag":388,"props":1328,"children":1329},{"style":416},[1330],{"type":159,"value":1331},"0",{"type":154,"tag":388,"props":1333,"children":1334},{"style":819},[1335],{"type":159,"value":1336}," -",{"type":154,"tag":388,"props":1338,"children":1339},{"style":805},[1340],{"type":159,"value":1055},{"type":154,"tag":388,"props":1342,"children":1343},{"style":793},[1344],{"type":159,"value":1345},"int",{"type":154,"tag":388,"props":1347,"children":1348},{"style":805},[1349],{"type":159,"value":1350},")",{"type":154,"tag":388,"props":1352,"children":1353},{"style":793},[1354],{"type":159,"value":1355},"sizeof",{"type":154,"tag":388,"props":1357,"children":1358},{"style":805},[1359],{"type":159,"value":951},{"type":154,"tag":388,"props":1361,"children":1362},{"style":793},[1363],{"type":159,"value":1364},"struct",{"type":154,"tag":388,"props":1366,"children":1367},{"style":805},[1368],{"type":159,"value":1369}," iphdr));\n",{"type":154,"tag":388,"props":1371,"children":1373},{"class":1372,"line":717},[390,1294],[1374,1378,1383,1388,1393],{"type":154,"tag":388,"props":1375,"children":1376},{"style":1047},[1377],{"type":159,"value":1050},{"type":154,"tag":388,"props":1379,"children":1380},{"style":805},[1381],{"type":159,"value":1382}," (adj ",{"type":154,"tag":388,"props":1384,"children":1385},{"style":819},[1386],{"type":159,"value":1387},"\u003C",{"type":154,"tag":388,"props":1389,"children":1390},{"style":416},[1391],{"type":159,"value":1392}," 0",{"type":154,"tag":388,"props":1394,"children":1395},{"style":805},[1396],{"type":159,"value":1397},") {\n",{"type":154,"tag":388,"props":1399,"children":1401},{"class":1400,"line":718},[390,1294],[1402,1407,1411,1416],{"type":154,"tag":388,"props":1403,"children":1404},{"style":394},[1405],{"type":159,"value":1406},"    bpf_printk",{"type":154,"tag":388,"props":1408,"children":1409},{"style":805},[1410],{"type":159,"value":951},{"type":154,"tag":388,"props":1412,"children":1413},{"style":400},[1414],{"type":159,"value":1415},"\"Failed to adjust packet head\"",{"type":154,"tag":388,"props":1417,"children":1418},{"style":805},[1419],{"type":159,"value":1040},{"type":154,"tag":388,"props":1421,"children":1423},{"class":1422,"line":719},[390,1294],[1424,1428],{"type":154,"tag":388,"props":1425,"children":1426},{"style":1047},[1427],{"type":159,"value":1074},{"type":154,"tag":388,"props":1429,"children":1430},{"style":805},[1431],{"type":159,"value":1079},{"type":154,"tag":388,"props":1433,"children":1435},{"class":1434,"line":720},[390,1294],[1436],{"type":154,"tag":388,"props":1437,"children":1438},{"style":805},[1439],{"type":159,"value":1088},{"type":154,"tag":388,"props":1441,"children":1443},{"class":1442,"line":721},[390,1294],[1444],{"type":154,"tag":388,"props":1445,"children":1446},{"emptyLinePlaceholder":11},[1447],{"type":159,"value":652},{"type":154,"tag":388,"props":1449,"children":1451},{"class":1450,"line":722},[390,1294],[1452],{"type":154,"tag":388,"props":1453,"children":1454},{"style":608},[1455],{"type":159,"value":1456},"  // Recompute packet pointers after adjusting headed\n",{"type":154,"tag":388,"props":1458,"children":1460},{"class":1459,"line":723},[390,1294],[1461,1466,1471,1476,1480,1484,1489,1493,1498,1503,1508,1512],{"type":154,"tag":388,"props":1462,"children":1463},{"style":793},[1464],{"type":159,"value":1465},"  void",{"type":154,"tag":388,"props":1467,"children":1468},{"style":819},[1469],{"type":159,"value":1470}," *",{"type":154,"tag":388,"props":1472,"children":1473},{"style":805},[1474],{"type":159,"value":1475},"new_data_end ",{"type":154,"tag":388,"props":1477,"children":1478},{"style":819},[1479],{"type":159,"value":822},{"type":154,"tag":388,"props":1481,"children":1482},{"style":805},[1483],{"type":159,"value":1055},{"type":154,"tag":388,"props":1485,"children":1486},{"style":793},[1487],{"type":159,"value":1488},"void",{"type":154,"tag":388,"props":1490,"children":1491},{"style":819},[1492],{"type":159,"value":1470},{"type":154,"tag":388,"props":1494,"children":1495},{"style":805},[1496],{"type":159,"value":1497},")(",{"type":154,"tag":388,"props":1499,"children":1500},{"style":793},[1501],{"type":159,"value":1502},"long",{"type":154,"tag":388,"props":1504,"children":1505},{"style":805},[1506],{"type":159,"value":1507},")ctx",{"type":154,"tag":388,"props":1509,"children":1510},{"style":819},[1511],{"type":159,"value":831},{"type":154,"tag":388,"props":1513,"children":1514},{"style":805},[1515],{"type":159,"value":1516},"data_end;\n",{"type":154,"tag":388,"props":1518,"children":1520},{"class":1519,"line":724},[390,1294],[1521,1525,1529,1534,1538,1542,1546,1550,1554,1558,1562,1566],{"type":154,"tag":388,"props":1522,"children":1523},{"style":793},[1524],{"type":159,"value":1465},{"type":154,"tag":388,"props":1526,"children":1527},{"style":819},[1528],{"type":159,"value":1470},{"type":154,"tag":388,"props":1530,"children":1531},{"style":805},[1532],{"type":159,"value":1533},"new_data ",{"type":154,"tag":388,"props":1535,"children":1536},{"style":819},[1537],{"type":159,"value":822},{"type":154,"tag":388,"props":1539,"children":1540},{"style":805},[1541],{"type":159,"value":1055},{"type":154,"tag":388,"props":1543,"children":1544},{"style":793},[1545],{"type":159,"value":1488},{"type":154,"tag":388,"props":1547,"children":1548},{"style":819},[1549],{"type":159,"value":1470},{"type":154,"tag":388,"props":1551,"children":1552},{"style":805},[1553],{"type":159,"value":1497},{"type":154,"tag":388,"props":1555,"children":1556},{"style":793},[1557],{"type":159,"value":1502},{"type":154,"tag":388,"props":1559,"children":1560},{"style":805},[1561],{"type":159,"value":1507},{"type":154,"tag":388,"props":1563,"children":1564},{"style":819},[1565],{"type":159,"value":831},{"type":154,"tag":388,"props":1567,"children":1568},{"style":805},[1569],{"type":159,"value":1570},"data;\n",{"type":154,"tag":388,"props":1572,"children":1574},{"class":1573,"line":725},[390,1294],[1575],{"type":154,"tag":388,"props":1576,"children":1577},{"emptyLinePlaceholder":11},[1578],{"type":159,"value":652},{"type":154,"tag":388,"props":1580,"children":1582},{"class":1581,"line":726},[390,1294],[1583],{"type":154,"tag":388,"props":1584,"children":1585},{"style":608},[1586],{"type":159,"value":1587},"  // Re-parse Ethernet header\n",{"type":154,"tag":388,"props":1589,"children":1591},{"class":1590,"line":727},[390,1294],[1592,1596,1601,1605,1610,1614],{"type":154,"tag":388,"props":1593,"children":1594},{"style":793},[1595],{"type":159,"value":796},{"type":154,"tag":388,"props":1597,"children":1598},{"style":805},[1599],{"type":159,"value":1600}," ethhdr ",{"type":154,"tag":388,"props":1602,"children":1603},{"style":819},[1604],{"type":159,"value":995},{"type":154,"tag":388,"props":1606,"children":1607},{"style":805},[1608],{"type":159,"value":1609},"new_eth ",{"type":154,"tag":388,"props":1611,"children":1612},{"style":819},[1613],{"type":159,"value":822},{"type":154,"tag":388,"props":1615,"children":1616},{"style":805},[1617],{"type":159,"value":1618}," new_data;\n",{"type":154,"tag":388,"props":1620,"children":1622},{"class":1621,"line":728},[390,1294],[1623,1627,1632,1636,1640,1645,1650,1655,1659,1664],{"type":154,"tag":388,"props":1624,"children":1625},{"style":1047},[1626],{"type":159,"value":1050},{"type":154,"tag":388,"props":1628,"children":1629},{"style":805},[1630],{"type":159,"value":1631}," ((",{"type":154,"tag":388,"props":1633,"children":1634},{"style":793},[1635],{"type":159,"value":1488},{"type":154,"tag":388,"props":1637,"children":1638},{"style":819},[1639],{"type":159,"value":1470},{"type":154,"tag":388,"props":1641,"children":1642},{"style":805},[1643],{"type":159,"value":1644},")(new_eth ",{"type":154,"tag":388,"props":1646,"children":1647},{"style":819},[1648],{"type":159,"value":1649},"+",{"type":154,"tag":388,"props":1651,"children":1652},{"style":416},[1653],{"type":159,"value":1654}," 1",{"type":154,"tag":388,"props":1656,"children":1657},{"style":805},[1658],{"type":159,"value":967},{"type":154,"tag":388,"props":1660,"children":1661},{"style":819},[1662],{"type":159,"value":1663},">",{"type":154,"tag":388,"props":1665,"children":1666},{"style":805},[1667],{"type":159,"value":1668}," new_data_end) {\n",{"type":154,"tag":388,"props":1670,"children":1672},{"class":1671,"line":729},[390,1294],[1673,1677],{"type":154,"tag":388,"props":1674,"children":1675},{"style":1047},[1676],{"type":159,"value":1074},{"type":154,"tag":388,"props":1678,"children":1679},{"style":805},[1680],{"type":159,"value":1079},{"type":154,"tag":388,"props":1682,"children":1684},{"class":1683,"line":730},[390,1294],[1685],{"type":154,"tag":388,"props":1686,"children":1687},{"style":805},[1688],{"type":159,"value":1088},{"type":154,"tag":388,"props":1690,"children":1692},{"class":1691,"line":731},[390,1294],[1693],{"type":154,"tag":388,"props":1694,"children":1695},{"emptyLinePlaceholder":11},[1696],{"type":159,"value":652},{"type":154,"tag":388,"props":1698,"children":1700},{"class":1699,"line":732},[390,1294],[1701],{"type":154,"tag":388,"props":1702,"children":1703},{"style":608},[1704],{"type":159,"value":1705},"  // Outer IPv4 header lives right after Ethernet\n",{"type":154,"tag":388,"props":1707,"children":1709},{"class":1708,"line":733},[390,1294],[1710,1714,1719,1723,1728,1732,1736,1740,1744,1748,1752,1756],{"type":154,"tag":388,"props":1711,"children":1712},{"style":793},[1713],{"type":159,"value":796},{"type":154,"tag":388,"props":1715,"children":1716},{"style":805},[1717],{"type":159,"value":1718}," iphdr ",{"type":154,"tag":388,"props":1720,"children":1721},{"style":819},[1722],{"type":159,"value":995},{"type":154,"tag":388,"props":1724,"children":1725},{"style":805},[1726],{"type":159,"value":1727},"outer ",{"type":154,"tag":388,"props":1729,"children":1730},{"style":819},[1731],{"type":159,"value":822},{"type":154,"tag":388,"props":1733,"children":1734},{"style":805},[1735],{"type":159,"value":1055},{"type":154,"tag":388,"props":1737,"children":1738},{"style":793},[1739],{"type":159,"value":1488},{"type":154,"tag":388,"props":1741,"children":1742},{"style":819},[1743],{"type":159,"value":1470},{"type":154,"tag":388,"props":1745,"children":1746},{"style":805},[1747],{"type":159,"value":1644},{"type":154,"tag":388,"props":1749,"children":1750},{"style":819},[1751],{"type":159,"value":1649},{"type":154,"tag":388,"props":1753,"children":1754},{"style":416},[1755],{"type":159,"value":1654},{"type":154,"tag":388,"props":1757,"children":1758},{"style":805},[1759],{"type":159,"value":1040},{"type":154,"tag":388,"props":1761,"children":1763},{"class":1762,"line":734},[390,1294],[1764,1768,1772,1776,1780,1785,1789,1793,1797,1801],{"type":154,"tag":388,"props":1765,"children":1766},{"style":1047},[1767],{"type":159,"value":1050},{"type":154,"tag":388,"props":1769,"children":1770},{"style":805},[1771],{"type":159,"value":1631},{"type":154,"tag":388,"props":1773,"children":1774},{"style":793},[1775],{"type":159,"value":1488},{"type":154,"tag":388,"props":1777,"children":1778},{"style":819},[1779],{"type":159,"value":1470},{"type":154,"tag":388,"props":1781,"children":1782},{"style":805},[1783],{"type":159,"value":1784},")(outer ",{"type":154,"tag":388,"props":1786,"children":1787},{"style":819},[1788],{"type":159,"value":1649},{"type":154,"tag":388,"props":1790,"children":1791},{"style":416},[1792],{"type":159,"value":1654},{"type":154,"tag":388,"props":1794,"children":1795},{"style":805},[1796],{"type":159,"value":967},{"type":154,"tag":388,"props":1798,"children":1799},{"style":819},[1800],{"type":159,"value":1663},{"type":154,"tag":388,"props":1802,"children":1803},{"style":805},[1804],{"type":159,"value":1668},{"type":154,"tag":388,"props":1806,"children":1808},{"class":1807,"line":735},[390,1294],[1809,1813],{"type":154,"tag":388,"props":1810,"children":1811},{"style":1047},[1812],{"type":159,"value":1074},{"type":154,"tag":388,"props":1814,"children":1815},{"style":805},[1816],{"type":159,"value":1079},{"type":154,"tag":388,"props":1818,"children":1820},{"class":1819,"line":736},[390,1294],[1821],{"type":154,"tag":388,"props":1822,"children":1823},{"style":805},[1824],{"type":159,"value":1088},{"type":154,"tag":388,"props":1826,"children":1828},{"class":1827,"line":737},[390,1294],[1829],{"type":154,"tag":388,"props":1830,"children":1831},{"emptyLinePlaceholder":11},[1832],{"type":159,"value":652},{"type":154,"tag":388,"props":1834,"children":1836},{"class":1835,"line":738},[390,1294],[1837],{"type":154,"tag":388,"props":1838,"children":1839},{"style":608},[1840],{"type":159,"value":1841},"  // Inner IPv4 header is now right after the new outer IP header\n",{"type":154,"tag":388,"props":1843,"children":1845},{"class":1844,"line":739},[390,1294],[1846,1850,1854,1858,1863,1867,1871,1875,1879,1883,1887,1891],{"type":154,"tag":388,"props":1847,"children":1848},{"style":793},[1849],{"type":159,"value":796},{"type":154,"tag":388,"props":1851,"children":1852},{"style":805},[1853],{"type":159,"value":1718},{"type":154,"tag":388,"props":1855,"children":1856},{"style":819},[1857],{"type":159,"value":995},{"type":154,"tag":388,"props":1859,"children":1860},{"style":805},[1861],{"type":159,"value":1862},"inner ",{"type":154,"tag":388,"props":1864,"children":1865},{"style":819},[1866],{"type":159,"value":822},{"type":154,"tag":388,"props":1868,"children":1869},{"style":805},[1870],{"type":159,"value":1055},{"type":154,"tag":388,"props":1872,"children":1873},{"style":793},[1874],{"type":159,"value":1488},{"type":154,"tag":388,"props":1876,"children":1877},{"style":819},[1878],{"type":159,"value":1470},{"type":154,"tag":388,"props":1880,"children":1881},{"style":805},[1882],{"type":159,"value":1784},{"type":154,"tag":388,"props":1884,"children":1885},{"style":819},[1886],{"type":159,"value":1649},{"type":154,"tag":388,"props":1888,"children":1889},{"style":416},[1890],{"type":159,"value":1654},{"type":154,"tag":388,"props":1892,"children":1893},{"style":805},[1894],{"type":159,"value":1040},{"type":154,"tag":388,"props":1896,"children":1898},{"class":1897,"line":740},[390,1294],[1899,1903,1907,1911,1915,1920,1924,1928,1932,1936],{"type":154,"tag":388,"props":1900,"children":1901},{"style":1047},[1902],{"type":159,"value":1050},{"type":154,"tag":388,"props":1904,"children":1905},{"style":805},[1906],{"type":159,"value":1631},{"type":154,"tag":388,"props":1908,"children":1909},{"style":793},[1910],{"type":159,"value":1488},{"type":154,"tag":388,"props":1912,"children":1913},{"style":819},[1914],{"type":159,"value":1470},{"type":154,"tag":388,"props":1916,"children":1917},{"style":805},[1918],{"type":159,"value":1919},")(inner ",{"type":154,"tag":388,"props":1921,"children":1922},{"style":819},[1923],{"type":159,"value":1649},{"type":154,"tag":388,"props":1925,"children":1926},{"style":416},[1927],{"type":159,"value":1654},{"type":154,"tag":388,"props":1929,"children":1930},{"style":805},[1931],{"type":159,"value":967},{"type":154,"tag":388,"props":1933,"children":1934},{"style":819},[1935],{"type":159,"value":1663},{"type":154,"tag":388,"props":1937,"children":1938},{"style":805},[1939],{"type":159,"value":1668},{"type":154,"tag":388,"props":1941,"children":1943},{"class":1942,"line":741},[390,1294],[1944,1948],{"type":154,"tag":388,"props":1945,"children":1946},{"style":1047},[1947],{"type":159,"value":1074},{"type":154,"tag":388,"props":1949,"children":1950},{"style":805},[1951],{"type":159,"value":1079},{"type":154,"tag":388,"props":1953,"children":1955},{"class":1954,"line":742},[390,1294],[1956],{"type":154,"tag":388,"props":1957,"children":1958},{"style":805},[1959],{"type":159,"value":1088},{"type":154,"tag":388,"props":1961,"children":1963},{"class":1962,"line":743},[390,1294],[1964],{"type":154,"tag":388,"props":1965,"children":1966},{"emptyLinePlaceholder":11},[1967],{"type":159,"value":652},{"type":154,"tag":388,"props":1969,"children":1971},{"class":1970,"line":744},[390,1294],[1972],{"type":154,"tag":388,"props":1973,"children":1974},{"style":608},[1975],{"type":159,"value":1976},"  // Backend needs to have a virtual IP on the lo (same one as load balancer)\n",{"type":154,"tag":388,"props":1978,"children":1980},{"class":1979,"line":745},[390,1294],[1981],{"type":154,"tag":388,"props":1982,"children":1983},{"style":608},[1984],{"type":159,"value":1985},"  // The source IP is retained as client, so backend will respond directly to it\n",{"type":154,"tag":388,"props":1987,"children":1989},{"class":1988,"line":746},[390,1294],[1990,1995,2000,2004,2009],{"type":154,"tag":388,"props":1991,"children":1992},{"style":394},[1993],{"type":159,"value":1994},"  __builtin_memcpy",{"type":154,"tag":388,"props":1996,"children":1997},{"style":805},[1998],{"type":159,"value":1999},"(new_eth",{"type":154,"tag":388,"props":2001,"children":2002},{"style":819},[2003],{"type":159,"value":831},{"type":154,"tag":388,"props":2005,"children":2006},{"style":959},[2007],{"type":159,"value":2008},"h_source",{"type":154,"tag":388,"props":2010,"children":2011},{"style":805},[2012],{"type":159,"value":2013},", fib.smac, ETH_ALEN);\n",{"type":154,"tag":388,"props":2015,"children":2017},{"class":2016,"line":747},[390,1294],[2018,2022,2026,2030,2035],{"type":154,"tag":388,"props":2019,"children":2020},{"style":394},[2021],{"type":159,"value":1994},{"type":154,"tag":388,"props":2023,"children":2024},{"style":805},[2025],{"type":159,"value":1999},{"type":154,"tag":388,"props":2027,"children":2028},{"style":819},[2029],{"type":159,"value":831},{"type":154,"tag":388,"props":2031,"children":2032},{"style":959},[2033],{"type":159,"value":2034},"h_dest",{"type":154,"tag":388,"props":2036,"children":2037},{"style":805},[2038],{"type":159,"value":2039},", fib.dmac, ETH_ALEN);\n",{"type":154,"tag":388,"props":2041,"children":2043},{"class":2042,"line":748},[390,1294],[2044,2049,2053,2058,2062,2067],{"type":154,"tag":388,"props":2045,"children":2046},{"style":805},[2047],{"type":159,"value":2048},"  new_eth",{"type":154,"tag":388,"props":2050,"children":2051},{"style":819},[2052],{"type":159,"value":831},{"type":154,"tag":388,"props":2054,"children":2055},{"style":805},[2056],{"type":159,"value":2057},"h_proto ",{"type":154,"tag":388,"props":2059,"children":2060},{"style":819},[2061],{"type":159,"value":822},{"type":154,"tag":388,"props":2063,"children":2064},{"style":394},[2065],{"type":159,"value":2066}," bpf_htons",{"type":154,"tag":388,"props":2068,"children":2069},{"style":805},[2070],{"type":159,"value":2071},"(ETH_P_IP);\n",{"type":154,"tag":388,"props":2073,"children":2075},{"class":2074,"line":749},[390,1294],[2076],{"type":154,"tag":388,"props":2077,"children":2078},{"emptyLinePlaceholder":11},[2079],{"type":159,"value":652},{"type":154,"tag":388,"props":2081,"children":2083},{"class":2082,"line":750},[390,1294],[2084],{"type":154,"tag":388,"props":2085,"children":2086},{"style":608},[2087],{"type":159,"value":2088},"  // Build OUTER IPv4 header\n",{"type":154,"tag":388,"props":2090,"children":2092},{"class":2091,"line":751},[390,1294],[2093,2098,2102,2107,2112,2116,2120],{"type":154,"tag":388,"props":2094,"children":2095},{"style":805},[2096],{"type":159,"value":2097},"  __u16 inner_len ",{"type":154,"tag":388,"props":2099,"children":2100},{"style":819},[2101],{"type":159,"value":822},{"type":154,"tag":388,"props":2103,"children":2104},{"style":394},[2105],{"type":159,"value":2106}," bpf_ntohs",{"type":154,"tag":388,"props":2108,"children":2109},{"style":805},[2110],{"type":159,"value":2111},"(inner",{"type":154,"tag":388,"props":2113,"children":2114},{"style":819},[2115],{"type":159,"value":831},{"type":154,"tag":388,"props":2117,"children":2118},{"style":959},[2119],{"type":159,"value":1220},{"type":154,"tag":388,"props":2121,"children":2122},{"style":805},[2123],{"type":159,"value":1040},{"type":154,"tag":388,"props":2125,"children":2127},{"class":2126,"line":752},[390,1294],[2128,2133,2137,2142,2146,2151,2155,2159],{"type":154,"tag":388,"props":2129,"children":2130},{"style":805},[2131],{"type":159,"value":2132},"  __u16 outer_len ",{"type":154,"tag":388,"props":2134,"children":2135},{"style":819},[2136],{"type":159,"value":822},{"type":154,"tag":388,"props":2138,"children":2139},{"style":805},[2140],{"type":159,"value":2141}," (__u16)(inner_len ",{"type":154,"tag":388,"props":2143,"children":2144},{"style":819},[2145],{"type":159,"value":1649},{"type":154,"tag":388,"props":2147,"children":2148},{"style":793},[2149],{"type":159,"value":2150}," sizeof",{"type":154,"tag":388,"props":2152,"children":2153},{"style":805},[2154],{"type":159,"value":951},{"type":154,"tag":388,"props":2156,"children":2157},{"style":793},[2158],{"type":159,"value":1364},{"type":154,"tag":388,"props":2160,"children":2161},{"style":805},[2162],{"type":159,"value":1369},{"type":154,"tag":388,"props":2164,"children":2166},{"class":2165,"line":753},[390,1294],[2167,2172,2176,2181,2185,2190],{"type":154,"tag":388,"props":2168,"children":2169},{"style":805},[2170],{"type":159,"value":2171},"  outer",{"type":154,"tag":388,"props":2173,"children":2174},{"style":819},[2175],{"type":159,"value":831},{"type":154,"tag":388,"props":2177,"children":2178},{"style":805},[2179],{"type":159,"value":2180},"version ",{"type":154,"tag":388,"props":2182,"children":2183},{"style":819},[2184],{"type":159,"value":822},{"type":154,"tag":388,"props":2186,"children":2187},{"style":416},[2188],{"type":159,"value":2189}," 4",{"type":154,"tag":388,"props":2191,"children":2192},{"style":805},[2193],{"type":159,"value":2194},";\n",{"type":154,"tag":388,"props":2196,"children":2198},{"class":2197,"line":754},[390,1294],[2199,2203,2207,2212,2216,2221,2226],{"type":154,"tag":388,"props":2200,"children":2201},{"style":805},[2202],{"type":159,"value":2171},{"type":154,"tag":388,"props":2204,"children":2205},{"style":819},[2206],{"type":159,"value":831},{"type":154,"tag":388,"props":2208,"children":2209},{"style":805},[2210],{"type":159,"value":2211},"ihl ",{"type":154,"tag":388,"props":2213,"children":2214},{"style":819},[2215],{"type":159,"value":822},{"type":154,"tag":388,"props":2217,"children":2218},{"style":416},[2219],{"type":159,"value":2220}," 5",{"type":154,"tag":388,"props":2222,"children":2223},{"style":805},[2224],{"type":159,"value":2225},";",{"type":154,"tag":388,"props":2227,"children":2228},{"style":608},[2229],{"type":159,"value":2230}," // 20 bytes\n",{"type":154,"tag":388,"props":2232,"children":2234},{"class":2233,"line":755},[390,1294],[2235,2239,2243,2248,2252,2256],{"type":154,"tag":388,"props":2236,"children":2237},{"style":805},[2238],{"type":159,"value":2171},{"type":154,"tag":388,"props":2240,"children":2241},{"style":819},[2242],{"type":159,"value":831},{"type":154,"tag":388,"props":2244,"children":2245},{"style":805},[2246],{"type":159,"value":2247},"tos ",{"type":154,"tag":388,"props":2249,"children":2250},{"style":819},[2251],{"type":159,"value":822},{"type":154,"tag":388,"props":2253,"children":2254},{"style":416},[2255],{"type":159,"value":1392},{"type":154,"tag":388,"props":2257,"children":2258},{"style":805},[2259],{"type":159,"value":2194},{"type":154,"tag":388,"props":2261,"children":2263},{"class":2262,"line":756},[390,1294],[2264,2268,2272,2277,2281,2285],{"type":154,"tag":388,"props":2265,"children":2266},{"style":805},[2267],{"type":159,"value":2171},{"type":154,"tag":388,"props":2269,"children":2270},{"style":819},[2271],{"type":159,"value":831},{"type":154,"tag":388,"props":2273,"children":2274},{"style":805},[2275],{"type":159,"value":2276},"tot_len ",{"type":154,"tag":388,"props":2278,"children":2279},{"style":819},[2280],{"type":159,"value":822},{"type":154,"tag":388,"props":2282,"children":2283},{"style":394},[2284],{"type":159,"value":2066},{"type":154,"tag":388,"props":2286,"children":2287},{"style":805},[2288],{"type":159,"value":2289},"(outer_len);\n",{"type":154,"tag":388,"props":2291,"children":2293},{"class":2292,"line":757},[390,1294],[2294,2298,2302,2307,2311,2315],{"type":154,"tag":388,"props":2295,"children":2296},{"style":805},[2297],{"type":159,"value":2171},{"type":154,"tag":388,"props":2299,"children":2300},{"style":819},[2301],{"type":159,"value":831},{"type":154,"tag":388,"props":2303,"children":2304},{"style":805},[2305],{"type":159,"value":2306},"id ",{"type":154,"tag":388,"props":2308,"children":2309},{"style":819},[2310],{"type":159,"value":822},{"type":154,"tag":388,"props":2312,"children":2313},{"style":416},[2314],{"type":159,"value":1392},{"type":154,"tag":388,"props":2316,"children":2317},{"style":805},[2318],{"type":159,"value":2194},{"type":154,"tag":388,"props":2320,"children":2322},{"class":2321,"line":758},[390,1294],[2323,2327,2331,2336,2340,2344],{"type":154,"tag":388,"props":2324,"children":2325},{"style":805},[2326],{"type":159,"value":2171},{"type":154,"tag":388,"props":2328,"children":2329},{"style":819},[2330],{"type":159,"value":831},{"type":154,"tag":388,"props":2332,"children":2333},{"style":805},[2334],{"type":159,"value":2335},"frag_off ",{"type":154,"tag":388,"props":2337,"children":2338},{"style":819},[2339],{"type":159,"value":822},{"type":154,"tag":388,"props":2341,"children":2342},{"style":416},[2343],{"type":159,"value":1392},{"type":154,"tag":388,"props":2345,"children":2346},{"style":805},[2347],{"type":159,"value":2194},{"type":154,"tag":388,"props":2349,"children":2351},{"class":2350,"line":759},[390,1294],[2352,2356,2360,2365,2369,2374],{"type":154,"tag":388,"props":2353,"children":2354},{"style":805},[2355],{"type":159,"value":2171},{"type":154,"tag":388,"props":2357,"children":2358},{"style":819},[2359],{"type":159,"value":831},{"type":154,"tag":388,"props":2361,"children":2362},{"style":805},[2363],{"type":159,"value":2364},"ttl ",{"type":154,"tag":388,"props":2366,"children":2367},{"style":819},[2368],{"type":159,"value":822},{"type":154,"tag":388,"props":2370,"children":2371},{"style":416},[2372],{"type":159,"value":2373}," 64",{"type":154,"tag":388,"props":2375,"children":2376},{"style":805},[2377],{"type":159,"value":2194},{"type":154,"tag":388,"props":2379,"children":2381},{"class":2380,"line":760},[390,1294],[2382,2386,2390,2395,2399],{"type":154,"tag":388,"props":2383,"children":2384},{"style":805},[2385],{"type":159,"value":2171},{"type":154,"tag":388,"props":2387,"children":2388},{"style":819},[2389],{"type":159,"value":831},{"type":154,"tag":388,"props":2391,"children":2392},{"style":805},[2393],{"type":159,"value":2394},"protocol ",{"type":154,"tag":388,"props":2396,"children":2397},{"style":819},[2398],{"type":159,"value":822},{"type":154,"tag":388,"props":2400,"children":2401},{"style":805},[2402],{"type":159,"value":2403}," IPPROTO_IPIP;\n",{"type":154,"tag":388,"props":2405,"children":2407},{"class":2406,"line":761},[390,1294],[2408],{"type":154,"tag":388,"props":2409,"children":2410},{"emptyLinePlaceholder":11},[2411],{"type":159,"value":652},{"type":154,"tag":388,"props":2413,"children":2415},{"class":2414,"line":762},[390,1294],[2416],{"type":154,"tag":388,"props":2417,"children":2418},{"style":608},[2419],{"type":159,"value":2420},"  // Retrieve LB real IP\n",{"type":154,"tag":388,"props":2422,"children":2424},{"class":2423,"line":763},[390,1294],[2425,2430,2434,2438],{"type":154,"tag":388,"props":2426,"children":2427},{"style":805},[2428],{"type":159,"value":2429},"  __u32 lbkey ",{"type":154,"tag":388,"props":2431,"children":2432},{"style":819},[2433],{"type":159,"value":822},{"type":154,"tag":388,"props":2435,"children":2436},{"style":416},[2437],{"type":159,"value":1392},{"type":154,"tag":388,"props":2439,"children":2440},{"style":805},[2441],{"type":159,"value":2194},{"type":154,"tag":388,"props":2443,"children":2445},{"class":2444,"line":764},[390,1294],[2446,2450,2454,2458,2463,2467,2471,2475,2479,2484,2488,2492,2497],{"type":154,"tag":388,"props":2447,"children":2448},{"style":793},[2449],{"type":159,"value":796},{"type":154,"tag":388,"props":2451,"children":2452},{"style":805},[2453],{"type":159,"value":990},{"type":154,"tag":388,"props":2455,"children":2456},{"style":819},[2457],{"type":159,"value":995},{"type":154,"tag":388,"props":2459,"children":2460},{"style":805},[2461],{"type":159,"value":2462},"lb ",{"type":154,"tag":388,"props":2464,"children":2465},{"style":819},[2466],{"type":159,"value":822},{"type":154,"tag":388,"props":2468,"children":2469},{"style":394},[2470],{"type":159,"value":1009},{"type":154,"tag":388,"props":2472,"children":2473},{"style":805},[2474],{"type":159,"value":951},{"type":154,"tag":388,"props":2476,"children":2477},{"style":819},[2478],{"type":159,"value":956},{"type":154,"tag":388,"props":2480,"children":2481},{"style":959},[2482],{"type":159,"value":2483},"load_balancer",{"type":154,"tag":388,"props":2485,"children":2486},{"style":805},[2487],{"type":159,"value":287},{"type":154,"tag":388,"props":2489,"children":2490},{"style":819},[2491],{"type":159,"value":956},{"type":154,"tag":388,"props":2493,"children":2494},{"style":959},[2495],{"type":159,"value":2496},"lbkey",{"type":154,"tag":388,"props":2498,"children":2499},{"style":805},[2500],{"type":159,"value":1040},{"type":154,"tag":388,"props":2502,"children":2504},{"class":2503,"line":765},[390,1294],[2505,2509,2513,2517],{"type":154,"tag":388,"props":2506,"children":2507},{"style":1047},[2508],{"type":159,"value":1050},{"type":154,"tag":388,"props":2510,"children":2511},{"style":805},[2512],{"type":159,"value":1055},{"type":154,"tag":388,"props":2514,"children":2515},{"style":819},[2516],{"type":159,"value":1060},{"type":154,"tag":388,"props":2518,"children":2519},{"style":805},[2520],{"type":159,"value":2521},"lb) {\n",{"type":154,"tag":388,"props":2523,"children":2525},{"class":2524,"line":766},[390,1294],[2526,2530],{"type":154,"tag":388,"props":2527,"children":2528},{"style":1047},[2529],{"type":159,"value":1074},{"type":154,"tag":388,"props":2531,"children":2532},{"style":805},[2533],{"type":159,"value":1079},{"type":154,"tag":388,"props":2535,"children":2537},{"class":2536,"line":767},[390,1294],[2538],{"type":154,"tag":388,"props":2539,"children":2540},{"style":805},[2541],{"type":159,"value":1088},{"type":154,"tag":388,"props":2543,"children":2545},{"class":2544,"line":768},[390,1294],[2546,2550,2554,2559,2563,2568,2572,2577],{"type":154,"tag":388,"props":2547,"children":2548},{"style":805},[2549],{"type":159,"value":2171},{"type":154,"tag":388,"props":2551,"children":2552},{"style":819},[2553],{"type":159,"value":831},{"type":154,"tag":388,"props":2555,"children":2556},{"style":805},[2557],{"type":159,"value":2558},"saddr ",{"type":154,"tag":388,"props":2560,"children":2561},{"style":819},[2562],{"type":159,"value":822},{"type":154,"tag":388,"props":2564,"children":2565},{"style":805},[2566],{"type":159,"value":2567}," lb",{"type":154,"tag":388,"props":2569,"children":2570},{"style":819},[2571],{"type":159,"value":831},{"type":154,"tag":388,"props":2573,"children":2574},{"style":805},[2575],{"type":159,"value":2576},"ip;",{"type":154,"tag":388,"props":2578,"children":2579},{"style":608},[2580],{"type":159,"value":2581}," // use LB real IP as outer source\n",{"type":154,"tag":388,"props":2583,"children":2585},{"class":2584,"line":769},[390,1294],[2586],{"type":154,"tag":388,"props":2587,"children":2588},{"emptyLinePlaceholder":11},[2589],{"type":159,"value":652},{"type":154,"tag":388,"props":2591,"children":2593},{"class":2592,"line":770},[390,1294],[2594,2598,2602,2607,2611,2616,2620,2624],{"type":154,"tag":388,"props":2595,"children":2596},{"style":805},[2597],{"type":159,"value":2171},{"type":154,"tag":388,"props":2599,"children":2600},{"style":819},[2601],{"type":159,"value":831},{"type":154,"tag":388,"props":2603,"children":2604},{"style":805},[2605],{"type":159,"value":2606},"daddr ",{"type":154,"tag":388,"props":2608,"children":2609},{"style":819},[2610],{"type":159,"value":822},{"type":154,"tag":388,"props":2612,"children":2613},{"style":805},[2614],{"type":159,"value":2615}," backend",{"type":154,"tag":388,"props":2617,"children":2618},{"style":819},[2619],{"type":159,"value":831},{"type":154,"tag":388,"props":2621,"children":2622},{"style":805},[2623],{"type":159,"value":2576},{"type":154,"tag":388,"props":2625,"children":2626},{"style":608},[2627],{"type":159,"value":2628},"  // tunnel endpoint = backend node IP\n",{"type":154,"tag":388,"props":2630,"children":2632},{"class":2631,"line":771},[390,1294],[2633,2637,2641,2646,2650,2654],{"type":154,"tag":388,"props":2634,"children":2635},{"style":805},[2636],{"type":159,"value":2171},{"type":154,"tag":388,"props":2638,"children":2639},{"style":819},[2640],{"type":159,"value":831},{"type":154,"tag":388,"props":2642,"children":2643},{"style":805},[2644],{"type":159,"value":2645},"check ",{"type":154,"tag":388,"props":2647,"children":2648},{"style":819},[2649],{"type":159,"value":822},{"type":154,"tag":388,"props":2651,"children":2652},{"style":416},[2653],{"type":159,"value":1392},{"type":154,"tag":388,"props":2655,"children":2656},{"style":805},[2657],{"type":159,"value":2194},{"type":154,"tag":388,"props":2659,"children":2661},{"class":2660,"line":772},[390,1294],[2662],{"type":154,"tag":388,"props":2663,"children":2664},{"emptyLinePlaceholder":11},[2665],{"type":159,"value":652},{"type":154,"tag":388,"props":2667,"children":2669},{"class":2668,"line":773},[390,1294],[2670],{"type":154,"tag":388,"props":2671,"children":2672},{"style":608},[2673],{"type":159,"value":2674},"  // Compute outer L3 checksum from scratch\n",{"type":154,"tag":388,"props":2676,"children":2678},{"class":2677,"line":774},[390,1294],[2679,2683,2687,2691,2695,2700],{"type":154,"tag":388,"props":2680,"children":2681},{"style":805},[2682],{"type":159,"value":2171},{"type":154,"tag":388,"props":2684,"children":2685},{"style":819},[2686],{"type":159,"value":831},{"type":154,"tag":388,"props":2688,"children":2689},{"style":805},[2690],{"type":159,"value":2645},{"type":154,"tag":388,"props":2692,"children":2693},{"style":819},[2694],{"type":159,"value":822},{"type":154,"tag":388,"props":2696,"children":2697},{"style":394},[2698],{"type":159,"value":2699}," recalc_ip_checksum",{"type":154,"tag":388,"props":2701,"children":2702},{"style":805},[2703],{"type":159,"value":2704},"(outer);\n",{"type":154,"tag":515,"props":2706,"children":2707},{"kind":517},[2708],{"type":154,"tag":155,"props":2709,"children":2710},{},[2711,2713,2719],{"type":159,"value":2712}," Im leaving out other code details, such as hashing and packet rewriting, since they are exactly the same as in the ",{"type":154,"tag":162,"props":2714,"children":2716},{"href":164,"rel":2715},[166],[2717],{"type":159,"value":2718},"L2 DSR tutorial",{"type":159,"value":2720},". Make sure to check it out if you havent already, as it makes a lot of sense to learn both in this order.",{"type":154,"tag":155,"props":2722,"children":2723},{},[2724],{"type":159,"value":2725},"And that's ALMOST it.",{"type":154,"tag":155,"props":2727,"children":2728},{},[2729],{"type":159,"value":2730},"We must still instruct the backend nodes to decapsulate the received IPIP packets. Servers do not handle this by default, so we need to manually enable the IPIP tunnel interface to ensure the traffic is read correctly.",{"type":154,"tag":358,"props":2732,"children":2734},{"id":2733},"ipip-packet-decapsulation",[2735],{"type":159,"value":2736},"IPIP Packet Decapsulation",{"type":154,"tag":155,"props":2738,"children":2739},{},[2740,2742,2748],{"type":159,"value":2741},"When the packet reaches the backend node, the backend node needs to decapsulate it  and this is handled by the ",{"type":154,"tag":212,"props":2743,"children":2745},{"className":2744},[],[2746],{"type":159,"value":2747},"ipip",{"type":159,"value":2749}," kernel module.",{"type":154,"tag":2751,"props":2752,"children":2754},"details-box",{":summary":2753},"Why does it need to decapsulate the packet?",[2755,2768],{"type":154,"tag":155,"props":2756,"children":2757},{},[2758,2760,2766],{"type":159,"value":2759},"Since the packet sent from the load balancer to the backend node is an encapsulated IP header (inner) within another IP header (outer), the backend needs to \"access\" the inner IP header to figure out it points to its VIP on the localhost (",{"type":154,"tag":212,"props":2761,"children":2763},{"className":2762},[],[2764],{"type":159,"value":2765},"lo",{"type":159,"value":2767},").",{"type":154,"tag":155,"props":2769,"children":2770},{},[2771],{"type":159,"value":2772},"It does this by decapsulating the packet.",{"type":154,"tag":155,"props":2774,"children":2775},{},[2776,2778,2783,2785,2790,2791,2796],{"type":159,"value":2777},"Therefore, first load the ",{"type":154,"tag":212,"props":2779,"children":2781},{"className":2780},[],[2782],{"type":159,"value":2747},{"type":159,"value":2784}," kernel module, enabling IP-in-IP tunneling support on the backends (",{"type":154,"tag":212,"props":2786,"children":2788},{"className":2787},[],[2789],{"type":159,"value":42},{"type":159,"value":556},{"type":154,"tag":212,"props":2792,"children":2794},{"className":2793},[],[2795],{"type":159,"value":45},{"type":159,"value":2797}," tabs):",{"type":154,"tag":377,"props":2799,"children":2801},{"className":379,"code":2800,"language":381,"meta":382,"style":382},"sudo modprobe ipip\n",[2802],{"type":154,"tag":212,"props":2803,"children":2804},{"__ignoreMap":382},[2805],{"type":154,"tag":388,"props":2806,"children":2807},{"class":390,"line":100},[2808,2812,2817],{"type":154,"tag":388,"props":2809,"children":2810},{"style":394},[2811],{"type":159,"value":397},{"type":154,"tag":388,"props":2813,"children":2814},{"style":400},[2815],{"type":159,"value":2816}," modprobe",{"type":154,"tag":388,"props":2818,"children":2819},{"style":400},[2820],{"type":159,"value":2821}," ipip\n",{"type":154,"tag":155,"props":2823,"children":2824},{},[2825,2827,2833,2835,2840,2841,2846],{"type":159,"value":2826},"Then create a new IP-in-IP tunnel interface named ",{"type":154,"tag":212,"props":2828,"children":2830},{"className":2829},[],[2831],{"type":159,"value":2832},"ipip0",{"type":159,"value":2834}," (in the ",{"type":154,"tag":212,"props":2836,"children":2838},{"className":2837},[],[2839],{"type":159,"value":42},{"type":159,"value":556},{"type":154,"tag":212,"props":2842,"children":2844},{"className":2843},[],[2845],{"type":159,"value":45},{"type":159,"value":2797},{"type":154,"tag":377,"props":2848,"children":2850},{"className":379,"code":2849,"language":381,"meta":382,"style":382},"sudo ip link add name ipip0 type ipip external\n",[2851],{"type":154,"tag":212,"props":2852,"children":2853},{"__ignoreMap":382},[2854],{"type":154,"tag":388,"props":2855,"children":2856},{"class":390,"line":100},[2857,2861,2865,2870,2874,2879,2884,2889,2894],{"type":154,"tag":388,"props":2858,"children":2859},{"style":394},[2860],{"type":159,"value":397},{"type":154,"tag":388,"props":2862,"children":2863},{"style":400},[2864],{"type":159,"value":432},{"type":154,"tag":388,"props":2866,"children":2867},{"style":400},[2868],{"type":159,"value":2869}," link",{"type":154,"tag":388,"props":2871,"children":2872},{"style":400},[2873],{"type":159,"value":442},{"type":154,"tag":388,"props":2875,"children":2876},{"style":400},[2877],{"type":159,"value":2878}," name",{"type":154,"tag":388,"props":2880,"children":2881},{"style":400},[2882],{"type":159,"value":2883}," ipip0",{"type":154,"tag":388,"props":2885,"children":2886},{"style":400},[2887],{"type":159,"value":2888}," type",{"type":154,"tag":388,"props":2890,"children":2891},{"style":400},[2892],{"type":159,"value":2893}," ipip",{"type":154,"tag":388,"props":2895,"children":2896},{"style":400},[2897],{"type":159,"value":2898}," external\n",{"type":154,"tag":155,"props":2900,"children":2901},{},[2902,2904,2909,2910,2915],{"type":159,"value":2903},"Now, to make this tunnel interface active so it can start receiving and sending packets (in the ",{"type":154,"tag":212,"props":2905,"children":2907},{"className":2906},[],[2908],{"type":159,"value":42},{"type":159,"value":556},{"type":154,"tag":212,"props":2911,"children":2913},{"className":2912},[],[2914],{"type":159,"value":45},{"type":159,"value":2797},{"type":154,"tag":377,"props":2917,"children":2919},{"className":379,"code":2918,"language":381,"meta":382,"style":382},"sudo ip link set up dev ipip0 #  Bring the tunnel interface up\nsudo ip address add 127.0.0.42/32 dev ipip0 # Assign a dummy local IP address to the tunnel device so the kernel considers it active (not used actually - that's why dummy!)\n",[2920],{"type":154,"tag":212,"props":2921,"children":2922},{"__ignoreMap":382},[2923,2961],{"type":154,"tag":388,"props":2924,"children":2925},{"class":390,"line":100},[2926,2930,2934,2938,2943,2948,2952,2956],{"type":154,"tag":388,"props":2927,"children":2928},{"style":394},[2929],{"type":159,"value":397},{"type":154,"tag":388,"props":2931,"children":2932},{"style":400},[2933],{"type":159,"value":432},{"type":154,"tag":388,"props":2935,"children":2936},{"style":400},[2937],{"type":159,"value":2869},{"type":154,"tag":388,"props":2939,"children":2940},{"style":400},[2941],{"type":159,"value":2942}," set",{"type":154,"tag":388,"props":2944,"children":2945},{"style":400},[2946],{"type":159,"value":2947}," up",{"type":154,"tag":388,"props":2949,"children":2950},{"style":400},[2951],{"type":159,"value":452},{"type":154,"tag":388,"props":2953,"children":2954},{"style":400},[2955],{"type":159,"value":2883},{"type":154,"tag":388,"props":2957,"children":2958},{"style":608},[2959],{"type":159,"value":2960}," #  Bring the tunnel interface up\n",{"type":154,"tag":388,"props":2962,"children":2963},{"class":390,"line":422},[2964,2968,2972,2977,2981,2986,2990,2994],{"type":154,"tag":388,"props":2965,"children":2966},{"style":394},[2967],{"type":159,"value":397},{"type":154,"tag":388,"props":2969,"children":2970},{"style":400},[2971],{"type":159,"value":432},{"type":154,"tag":388,"props":2973,"children":2974},{"style":400},[2975],{"type":159,"value":2976}," address",{"type":154,"tag":388,"props":2978,"children":2979},{"style":400},[2980],{"type":159,"value":442},{"type":154,"tag":388,"props":2982,"children":2983},{"style":400},[2984],{"type":159,"value":2985}," 127.0.0.42/32",{"type":154,"tag":388,"props":2987,"children":2988},{"style":400},[2989],{"type":159,"value":452},{"type":154,"tag":388,"props":2991,"children":2992},{"style":400},[2993],{"type":159,"value":2883},{"type":154,"tag":388,"props":2995,"children":2996},{"style":608},[2997],{"type":159,"value":2998}," # Assign a dummy local IP address to the tunnel device so the kernel considers it active (not used actually - that's why dummy!)\n",{"type":154,"tag":155,"props":3000,"children":3001},{},[3002,3004,3009,3010,3015],{"type":159,"value":3003},"Finally, validate the configuration (in the ",{"type":154,"tag":212,"props":3005,"children":3007},{"className":3006},[],[3008],{"type":159,"value":42},{"type":159,"value":556},{"type":154,"tag":212,"props":3011,"children":3013},{"className":3012},[],[3014],{"type":159,"value":45},{"type":159,"value":3016}," tabs), using:",{"type":154,"tag":377,"props":3018,"children":3020},{"className":379,"code":3019,"language":381,"meta":382,"style":382},"ip -d link show dev ipip0\n",[3021],{"type":154,"tag":212,"props":3022,"children":3023},{"__ignoreMap":382},[3024],{"type":154,"tag":388,"props":3025,"children":3026},{"class":390,"line":100},[3027,3031,3036,3040,3045,3049],{"type":154,"tag":388,"props":3028,"children":3029},{"style":394},[3030],{"type":159,"value":1192},{"type":154,"tag":388,"props":3032,"children":3033},{"style":400},[3034],{"type":159,"value":3035}," -d",{"type":154,"tag":388,"props":3037,"children":3038},{"style":400},[3039],{"type":159,"value":2869},{"type":154,"tag":388,"props":3041,"children":3042},{"style":400},[3043],{"type":159,"value":3044}," show",{"type":154,"tag":388,"props":3046,"children":3047},{"style":400},[3048],{"type":159,"value":452},{"type":154,"tag":388,"props":3050,"children":3051},{"style":400},[3052],{"type":159,"value":3053}," ipip0\n",{"type":154,"tag":377,"props":3055,"children":3057},{"className":379,"code":3056,"language":381,"meta":382,"style":382},"6: ipip0@NONE: \u003CNOARP,UP,LOWER_UP> mtu 1480 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/ipip 0.0.0.0 brd 0.0.0.0 promiscuity 0  allmulti 0 minmtu 0 maxmtu 0 \n    ipip external any remote any local any ttl inherit pmtudisc addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 tso_max_size 65536 tso_max_segs 65535 gro_max_size 65536 \n",[3058],{"type":154,"tag":212,"props":3059,"children":3060},{"__ignoreMap":382},[3061,3153,3216],{"type":154,"tag":388,"props":3062,"children":3063},{"class":390,"line":100},[3064,3069,3074,3079,3084,3089,3093,3098,3103,3108,3113,3118,3123,3128,3133,3138,3143,3148],{"type":154,"tag":388,"props":3065,"children":3066},{"style":394},[3067],{"type":159,"value":3068},"6:",{"type":154,"tag":388,"props":3070,"children":3071},{"style":400},[3072],{"type":159,"value":3073}," ipip0@NONE:",{"type":154,"tag":388,"props":3075,"children":3076},{"style":819},[3077],{"type":159,"value":3078}," \u003C",{"type":154,"tag":388,"props":3080,"children":3081},{"style":400},[3082],{"type":159,"value":3083},"NOARP,UP,LOWER_U",{"type":154,"tag":388,"props":3085,"children":3086},{"style":805},[3087],{"type":159,"value":3088},"P",{"type":154,"tag":388,"props":3090,"children":3091},{"style":819},[3092],{"type":159,"value":1663},{"type":154,"tag":388,"props":3094,"children":3095},{"style":400},[3096],{"type":159,"value":3097}," mtu",{"type":154,"tag":388,"props":3099,"children":3100},{"style":416},[3101],{"type":159,"value":3102}," 1480",{"type":154,"tag":388,"props":3104,"children":3105},{"style":400},[3106],{"type":159,"value":3107}," qdisc",{"type":154,"tag":388,"props":3109,"children":3110},{"style":400},[3111],{"type":159,"value":3112}," noqueue",{"type":154,"tag":388,"props":3114,"children":3115},{"style":400},[3116],{"type":159,"value":3117}," state",{"type":154,"tag":388,"props":3119,"children":3120},{"style":400},[3121],{"type":159,"value":3122}," UNKNOWN",{"type":154,"tag":388,"props":3124,"children":3125},{"style":400},[3126],{"type":159,"value":3127}," mode",{"type":154,"tag":388,"props":3129,"children":3130},{"style":400},[3131],{"type":159,"value":3132}," DEFAULT",{"type":154,"tag":388,"props":3134,"children":3135},{"style":400},[3136],{"type":159,"value":3137}," group",{"type":154,"tag":388,"props":3139,"children":3140},{"style":400},[3141],{"type":159,"value":3142}," default",{"type":154,"tag":388,"props":3144,"children":3145},{"style":400},[3146],{"type":159,"value":3147}," qlen",{"type":154,"tag":388,"props":3149,"children":3150},{"style":416},[3151],{"type":159,"value":3152}," 1000\n",{"type":154,"tag":388,"props":3154,"children":3155},{"class":390,"line":422},[3156,3161,3166,3171,3175,3180,3184,3189,3193,3198,3202,3207,3211],{"type":154,"tag":388,"props":3157,"children":3158},{"style":394},[3159],{"type":159,"value":3160},"    link/ipip",{"type":154,"tag":388,"props":3162,"children":3163},{"style":416},[3164],{"type":159,"value":3165}," 0.0.0.0",{"type":154,"tag":388,"props":3167,"children":3168},{"style":400},[3169],{"type":159,"value":3170}," brd",{"type":154,"tag":388,"props":3172,"children":3173},{"style":416},[3174],{"type":159,"value":3165},{"type":154,"tag":388,"props":3176,"children":3177},{"style":400},[3178],{"type":159,"value":3179}," promiscuity",{"type":154,"tag":388,"props":3181,"children":3182},{"style":416},[3183],{"type":159,"value":1392},{"type":154,"tag":388,"props":3185,"children":3186},{"style":400},[3187],{"type":159,"value":3188},"  allmulti",{"type":154,"tag":388,"props":3190,"children":3191},{"style":416},[3192],{"type":159,"value":1392},{"type":154,"tag":388,"props":3194,"children":3195},{"style":400},[3196],{"type":159,"value":3197}," minmtu",{"type":154,"tag":388,"props":3199,"children":3200},{"style":416},[3201],{"type":159,"value":1392},{"type":154,"tag":388,"props":3203,"children":3204},{"style":400},[3205],{"type":159,"value":3206}," maxmtu",{"type":154,"tag":388,"props":3208,"children":3209},{"style":416},[3210],{"type":159,"value":1392},{"type":154,"tag":388,"props":3212,"children":3213},{"style":805},[3214],{"type":159,"value":3215}," \n",{"type":154,"tag":388,"props":3217,"children":3218},{"class":390,"line":57},[3219,3224,3229,3234,3239,3243,3248,3252,3257,3262,3267,3272,3277,3282,3286,3291,3295,3300,3305,3310,3315,3320,3324,3329,3333,3338],{"type":154,"tag":388,"props":3220,"children":3221},{"style":394},[3222],{"type":159,"value":3223},"    ipip",{"type":154,"tag":388,"props":3225,"children":3226},{"style":400},[3227],{"type":159,"value":3228}," external",{"type":154,"tag":388,"props":3230,"children":3231},{"style":400},[3232],{"type":159,"value":3233}," any",{"type":154,"tag":388,"props":3235,"children":3236},{"style":400},[3237],{"type":159,"value":3238}," remote",{"type":154,"tag":388,"props":3240,"children":3241},{"style":400},[3242],{"type":159,"value":3233},{"type":154,"tag":388,"props":3244,"children":3245},{"style":400},[3246],{"type":159,"value":3247}," local",{"type":154,"tag":388,"props":3249,"children":3250},{"style":400},[3251],{"type":159,"value":3233},{"type":154,"tag":388,"props":3253,"children":3254},{"style":400},[3255],{"type":159,"value":3256}," ttl",{"type":154,"tag":388,"props":3258,"children":3259},{"style":400},[3260],{"type":159,"value":3261}," inherit",{"type":154,"tag":388,"props":3263,"children":3264},{"style":400},[3265],{"type":159,"value":3266}," pmtudisc",{"type":154,"tag":388,"props":3268,"children":3269},{"style":400},[3270],{"type":159,"value":3271}," addrgenmode",{"type":154,"tag":388,"props":3273,"children":3274},{"style":400},[3275],{"type":159,"value":3276}," eui64",{"type":154,"tag":388,"props":3278,"children":3279},{"style":400},[3280],{"type":159,"value":3281}," numtxqueues",{"type":154,"tag":388,"props":3283,"children":3284},{"style":416},[3285],{"type":159,"value":1654},{"type":154,"tag":388,"props":3287,"children":3288},{"style":400},[3289],{"type":159,"value":3290}," numrxqueues",{"type":154,"tag":388,"props":3292,"children":3293},{"style":416},[3294],{"type":159,"value":1654},{"type":154,"tag":388,"props":3296,"children":3297},{"style":400},[3298],{"type":159,"value":3299}," gso_max_size",{"type":154,"tag":388,"props":3301,"children":3302},{"style":416},[3303],{"type":159,"value":3304}," 65536",{"type":154,"tag":388,"props":3306,"children":3307},{"style":400},[3308],{"type":159,"value":3309}," gso_max_segs",{"type":154,"tag":388,"props":3311,"children":3312},{"style":416},[3313],{"type":159,"value":3314}," 65535",{"type":154,"tag":388,"props":3316,"children":3317},{"style":400},[3318],{"type":159,"value":3319}," tso_max_size",{"type":154,"tag":388,"props":3321,"children":3322},{"style":416},[3323],{"type":159,"value":3304},{"type":154,"tag":388,"props":3325,"children":3326},{"style":400},[3327],{"type":159,"value":3328}," tso_max_segs",{"type":154,"tag":388,"props":3330,"children":3331},{"style":416},[3332],{"type":159,"value":3314},{"type":154,"tag":388,"props":3334,"children":3335},{"style":400},[3336],{"type":159,"value":3337}," gro_max_size",{"type":154,"tag":388,"props":3339,"children":3340},{"style":416},[3341],{"type":159,"value":3342}," 65536\n",{"type":154,"tag":155,"props":3344,"children":3345},{},[3346],{"type":159,"value":3347},"And thats all the magic there is  the same VIP configuration concepts apply to IPIP DSR as they did for L2 DSR (setting up the VIP and ensuring it doesnt respond to ARP requests).",{"type":154,"tag":515,"props":3349,"children":3350},{"kind":517},[3351],{"type":154,"tag":155,"props":3352,"children":3353},{},[3354],{"type":159,"value":3355}," While we could also use XDP/eBPF programs on the backend nodes to handle decapsulation, we will skip that for now to keep our focus strictly on the load balancer implementation.",{"type":154,"tag":155,"props":3357,"children":3358},{},[3359],{"type":159,"value":3360},"Let's see it in action.",{"type":154,"tag":307,"props":3362,"children":3364},{"id":3363},"running-the-load-balancer",[3365],{"type":159,"value":3366},"Running the Load Balancer",{"type":154,"tag":515,"props":3368,"children":3370},{"kind":3369},"warning",[3371],{"type":154,"tag":155,"props":3372,"children":3373},{},[3374],{"type":159,"value":3375}," Before moving on, make sure the VIP is configured on both the load balancer and the backend nodes as described above, and that the ARP table is populated on the load balancer.",{"type":154,"tag":155,"props":3377,"children":3378},{},[3379,3381,3386,3388,3394],{"type":159,"value":3380},"Compile and run the load balancer (",{"type":154,"tag":212,"props":3382,"children":3384},{"className":3383},[],[3385],{"type":159,"value":37},{"type":159,"value":3387}," tab under ",{"type":154,"tag":212,"props":3389,"children":3391},{"className":3390},[],[3392],{"type":159,"value":3393},"lab",{"type":159,"value":3395}," directory) using:",{"type":154,"tag":377,"props":3397,"children":3399},{"className":379,"code":3398,"language":381,"meta":382,"style":382},"go generate\ngo build\nsudo ./lb -i eth0 -backends 172.16.0.10,172.16.0.11 -lb-ip 192.168.178.10\n",[3400],{"type":154,"tag":212,"props":3401,"children":3402},{"__ignoreMap":382},[3403,3416,3428],{"type":154,"tag":388,"props":3404,"children":3405},{"class":390,"line":100},[3406,3411],{"type":154,"tag":388,"props":3407,"children":3408},{"style":394},[3409],{"type":159,"value":3410},"go",{"type":154,"tag":388,"props":3412,"children":3413},{"style":400},[3414],{"type":159,"value":3415}," generate\n",{"type":154,"tag":388,"props":3417,"children":3418},{"class":390,"line":422},[3419,3423],{"type":154,"tag":388,"props":3420,"children":3421},{"style":394},[3422],{"type":159,"value":3410},{"type":154,"tag":388,"props":3424,"children":3425},{"style":400},[3426],{"type":159,"value":3427}," build\n",{"type":154,"tag":388,"props":3429,"children":3430},{"class":390,"line":57},[3431,3435,3440,3445,3450,3455,3460,3465],{"type":154,"tag":388,"props":3432,"children":3433},{"style":394},[3434],{"type":159,"value":397},{"type":154,"tag":388,"props":3436,"children":3437},{"style":400},[3438],{"type":159,"value":3439}," ./lb",{"type":154,"tag":388,"props":3441,"children":3442},{"style":400},[3443],{"type":159,"value":3444}," -i",{"type":154,"tag":388,"props":3446,"children":3447},{"style":400},[3448],{"type":159,"value":3449}," eth0",{"type":154,"tag":388,"props":3451,"children":3452},{"style":400},[3453],{"type":159,"value":3454}," -backends",{"type":154,"tag":388,"props":3456,"children":3457},{"style":400},[3458],{"type":159,"value":3459}," 172.16.0.10,172.16.0.11",{"type":154,"tag":388,"props":3461,"children":3462},{"style":400},[3463],{"type":159,"value":3464}," -lb-ip",{"type":154,"tag":388,"props":3466,"children":3467},{"style":416},[3468],{"type":159,"value":3469}," 192.168.178.10\n",{"type":154,"tag":2751,"props":3471,"children":3473},{":summary":3472},"What are these input parameters?",[3474],{"type":154,"tag":204,"props":3475,"children":3476},{},[3477,3488,3499],{"type":154,"tag":208,"props":3478,"children":3479},{},[3480,3486],{"type":154,"tag":212,"props":3481,"children":3483},{"className":3482},[],[3484],{"type":159,"value":3485},"-i",{"type":159,"value":3487},": The network interface on which this XDP load balancer program will run.",{"type":154,"tag":208,"props":3489,"children":3490},{},[3491,3497],{"type":154,"tag":212,"props":3492,"children":3494},{"className":3493},[],[3495],{"type":159,"value":3496},"-backends",{"type":159,"value":3498},": The list of backend IPs in this playground. You must provide exactly two backends, as simplified earlier for the basic hashing example.",{"type":154,"tag":208,"props":3500,"children":3501},{},[3502,3508],{"type":154,"tag":212,"props":3503,"children":3505},{"className":3504},[],[3506],{"type":159,"value":3507},"-lb-ip",{"type":159,"value":3509},": The load balancers IP address, used as the source IP in the outer IP header. This could be automated, but were keeping the setup simple.",{"type":154,"tag":155,"props":3511,"children":3512},{},[3513,3515,3520,3522,3527,3528,3533],{"type":159,"value":3514},"And run the HTTP Server binded to VIP (on the ",{"type":154,"tag":212,"props":3516,"children":3518},{"className":3517},[],[3519],{"type":159,"value":2765},{"type":159,"value":3521},") on both backends (",{"type":154,"tag":212,"props":3523,"children":3525},{"className":3524},[],[3526],{"type":159,"value":42},{"type":159,"value":556},{"type":154,"tag":212,"props":3529,"children":3531},{"className":3530},[],[3532],{"type":159,"value":45},{"type":159,"value":2797},{"type":154,"tag":377,"props":3535,"children":3537},{"className":379,"code":3536,"language":381,"meta":382,"style":382},"python3 -m http.server 8000 --bind 192.168.178.15\n",[3538],{"type":154,"tag":212,"props":3539,"children":3540},{"__ignoreMap":382},[3541],{"type":154,"tag":388,"props":3542,"children":3543},{"class":390,"line":100},[3544,3549,3554,3559,3564,3569],{"type":154,"tag":388,"props":3545,"children":3546},{"style":394},[3547],{"type":159,"value":3548},"python3",{"type":154,"tag":388,"props":3550,"children":3551},{"style":400},[3552],{"type":159,"value":3553}," -m",{"type":154,"tag":388,"props":3555,"children":3556},{"style":400},[3557],{"type":159,"value":3558}," http.server",{"type":154,"tag":388,"props":3560,"children":3561},{"style":416},[3562],{"type":159,"value":3563}," 8000",{"type":154,"tag":388,"props":3565,"children":3566},{"style":400},[3567],{"type":159,"value":3568}," --bind",{"type":154,"tag":388,"props":3570,"children":3571},{"style":416},[3572],{"type":159,"value":3573}," 192.168.178.15\n",{"type":154,"tag":155,"props":3575,"children":3576},{},[3577,3579,3584],{"type":159,"value":3578},"Now you can query the VIP from either ",{"type":154,"tag":212,"props":3580,"children":3582},{"className":3581},[],[3583],{"type":159,"value":51},{"type":159,"value":3585}," tab, using:",{"type":154,"tag":377,"props":3587,"children":3589},{"className":379,"code":3588,"language":381,"meta":382,"style":382},"curl http://192.168.178.15:8000\n",[3590],{"type":154,"tag":212,"props":3591,"children":3592},{"__ignoreMap":382},[3593],{"type":154,"tag":388,"props":3594,"children":3595},{"class":390,"line":100},[3596,3601],{"type":154,"tag":388,"props":3597,"children":3598},{"style":394},[3599],{"type":159,"value":3600},"curl",{"type":154,"tag":388,"props":3602,"children":3603},{"style":400},[3604],{"type":159,"value":3605}," http://192.168.178.15:8000\n",{"type":154,"tag":155,"props":3607,"children":3608},{},[3609],{"type":159,"value":3610},"And make sure that the HTTP server actually received the request from the client (IP at the beginning of the line):",{"type":154,"tag":377,"props":3612,"children":3614},{"className":379,"code":3613,"language":381,"meta":382,"style":382},"10.0.0.20 - - [01/Jan/2026 16:03:45] \"GET / HTTP/1.1\" 200 -\n",[3615],{"type":154,"tag":212,"props":3616,"children":3617},{"__ignoreMap":382},[3618],{"type":154,"tag":388,"props":3619,"children":3620},{"class":390,"line":100},[3621,3625,3629,3633,3638,3643,3648,3653],{"type":154,"tag":388,"props":3622,"children":3623},{"style":394},[3624],{"type":159,"value":150},{"type":154,"tag":388,"props":3626,"children":3627},{"style":400},[3628],{"type":159,"value":1336},{"type":154,"tag":388,"props":3630,"children":3631},{"style":400},[3632],{"type":159,"value":1336},{"type":154,"tag":388,"props":3634,"children":3635},{"style":805},[3636],{"type":159,"value":3637}," [01/Jan/2026 ",{"type":154,"tag":388,"props":3639,"children":3640},{"style":400},[3641],{"type":159,"value":3642},"16:03:45]",{"type":154,"tag":388,"props":3644,"children":3645},{"style":400},[3646],{"type":159,"value":3647}," \"GET / HTTP/1.1\"",{"type":154,"tag":388,"props":3649,"children":3650},{"style":416},[3651],{"type":159,"value":3652}," 200",{"type":154,"tag":388,"props":3654,"children":3655},{"style":400},[3656],{"type":159,"value":3657}," -\n",{"type":154,"tag":155,"props":3659,"children":3660},{},[3661],{"type":159,"value":3662},"Let's say you don't believe md, this actually led to request being routed through the load balancer and directly back to the client.",{"type":154,"tag":155,"props":3664,"children":3665},{},[3666,3668,3674,3676,3681],{"type":159,"value":3667},"If you want to be sure, play-around with ",{"type":154,"tag":212,"props":3669,"children":3671},{"className":3670},[],[3672],{"type":159,"value":3673},"tcpdump",{"type":159,"value":3675}," or just verify it by inspecting the load balancers logs, using (in the \"new\" ",{"type":154,"tag":212,"props":3677,"children":3679},{"className":3678},[],[3680],{"type":159,"value":37},{"type":159,"value":3682}," tab):",{"type":154,"tag":377,"props":3684,"children":3686},{"className":379,"code":3685,"language":381,"meta":382,"style":382},"sudo bpftool prog trace\n",[3687],{"type":154,"tag":212,"props":3688,"children":3689},{"__ignoreMap":382},[3690],{"type":154,"tag":388,"props":3691,"children":3692},{"class":390,"line":100},[3693,3697,3702,3707],{"type":154,"tag":388,"props":3694,"children":3695},{"style":394},[3696],{"type":159,"value":397},{"type":154,"tag":388,"props":3698,"children":3699},{"style":400},[3700],{"type":159,"value":3701}," bpftool",{"type":154,"tag":388,"props":3703,"children":3704},{"style":400},[3705],{"type":159,"value":3706}," prog",{"type":154,"tag":388,"props":3708,"children":3709},{"style":400},[3710],{"type":159,"value":3711}," trace\n",{"type":154,"tag":155,"props":3713,"children":3714},{},[3715],{"type":159,"value":3716},"Congrats - you've came to the end of this tutorial ",{"type":154,"tag":3718,"props":3719,"children":3720},"style",{},[3721],{"type":159,"value":3722},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}",["Reactive",35],{"title":382,"searchDepth":422,"depth":422,"links":3725},[3726,3730],{"id":309,"depth":422,"text":312,"children":3727},[3728,3729],{"id":360,"depth":57,"text":363},{"id":2733,"depth":57,"text":2736},{"id":3363,"depth":422,"text":3366},["Reactive",3732],{},["Reactive",3734],{},["Reactive",3736],{},"#xdp-dsr-load-balancer-b701a95a-server",{"left":40,"top":40,"width":716,"height":716,"rotate":40,"vFlip":3739,"hFlip":3739,"body":3740},false,"\u003Cpath fill=\"currentColor\" d=\"M6 18v-5h1v4h4v1zm11-7V7h-4V6h5v5z\"/>",{"left":40,"top":40,"width":3742,"height":3742,"rotate":40,"vFlip":3739,"hFlip":3739,"body":3743},256,"\u003Cpath fill=\"currentColor\" d=\"M216 32H88a8 8 0 0 0-8 8v40H40a8 8 0 0 0-8 8v128a8 8 0 0 0 8 8h128a8 8 0 0 0 8-8v-40h40a8 8 0 0 0 8-8V40a8 8 0 0 0-8-8m-56 176H48V96h112Zm48-48h-32V88a8 8 0 0 0-8-8H96V48h112Z\"/>",["Reactive",3745],{"$scurrentUser":3746,"$salerts":3750,"$scontentToggle":3751,"$ssite-config":3752},{"id":3747,"anonymous":11,"effectiveTier":3748,"hasEmailSubscription":3739},"697b5f64cc8f8f56faac74e1",{"name":3749},"free",[],{"/tutorials/xdp-dsr-load-balancer-b701a95a":11},{"_priority":3753,"env":3756,"name":3757,"url":3758},{"name":3754,"env":3755,"url":40},-3,-15,"production","iximiuz Labs","https://labs.iximiuz.com",["Set"],["ShallowReactive",3761],{"tutorial-page-tutorial-xdp-dsr-load-balancer-b701a95a":-1,"content-tutorial-xdp-dsr-load-balancer-b701a95a-v1769426947149":-1,"tutorial-page-play-none":-1,"i-material-symbols-light:expand-content":-1,"i-ph:copy":-1},"/tutorials/xdp-dsr-load-balancer-b701a95a"]</script></body></html>